<!-- Aggiungi questa sezione nel body della pagina, sotto le altre info meteo -->
<section id="marine-conditions" style="max-width:900px; margin: 24px auto; background: rgba(20,30,55,0.45); border-radius: 20px; padding: 22px 28px; color: #a8cff8; font-family: Arial, sans-serif; box-shadow: 0 0 28px #1352a4bb;">
  <h3 style="font-weight: 700; font-size: 1.8rem; margin-bottom: 12px; color: #e0f0ff;">Condizioni Marine</h3>
  <div id="marine-summary" style="margin-bottom: 14px; font-size: 1.1rem;"></div>
  <canvas id="marine-wave-chart" style="width:100%; height: 220px;"></canvas>
  <div id="marine-alerts" style="margin-top: 14px; color: #ffcc66; font-weight: 700; font-size: 1.1rem;"></div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const marineData = {"days":[{"day_label":"12/10","temp_max":"21.3","temp_min":"19.3","precipitation":"0.00","icon":"â›…","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[21.1,20.6,20.3,20.1,20,19.7,19.5,19.5,19.3,19.4,19.6,19.9,20.2,20.5,20.8,21,21.2,21.3,21.1,21,20.7,20.6,20.5,20.4],"hourly_winds":[8.1,9.2,10,11.6,12.3,11.4,10.4,9.1,8.9,8.1,6.6,4.3,3.1,3.3,4,3.9,3.8,4,4.1,4,4.3,3.8,3.6,3],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"13/10","temp_max":"21.2","temp_min":"19.4","precipitation":"0.00","icon":"ğŸŒ¤ï¸","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[20.2,20.1,19.9,19.7,19.6,19.6,19.5,19.5,19.4,19.5,19.7,19.9,20.2,20.3,20.5,20.9,21.2,21.2,20.9,20.8,20.8,20.7,20.6,20.5],"hourly_winds":[2.2,1.8,1.8,1.1,1.5,1.9,1.8,2.4,3.1,2.3,2.8,2.6,2.4,3.1,2.5,2.7,5.9,10.1,9.7,7.8,7.6,5.4,3.2,2],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"14/10","temp_max":"20.4","temp_min":"19.3","precipitation":"0.00","icon":"ğŸŒ¤ï¸","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[20.3,20.1,20,19.9,19.7,19.6,19.5,19.4,19.3,19.3,19.4,19.7,20,20.2,20.4,20.4,20.4,20.3,20.3,20.3,20.2,20.1,20,19.9],"hourly_winds":[3.1,2.2,3.4,4.1,4,4.7,3.6,3.6,5.1,5.4,5.4,5.8,5.7,5.6,5.5,7.2,9.1,9.7,7.6,4.4,1.9,4.6,5.3,7.2],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"15/10","temp_max":"20.8","temp_min":"19.3","precipitation":"0.40","icon":"â›…","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.9,19.9,19.9,19.7,19.6,19.5,19.4,19.3,19.3,19.4,19.5,19.7,19.9,20.4,20.8,20.6,20.3,20,19.9,19.8,19.7,19.6,19.5,19.3],"hourly_winds":[6.2,5.7,6.5,7.6,6.8,8.7,10.6,11.1,12.1,13.6,14.9,15.8,15.5,14.8,12.2,10.8,10.4,10.3,8.7,5.6,5.1,9.3,15.8,20.6],"hourly_precips":[0,0,0,0.1,0,0,0,0,0,0,0,0,0,0,0,0.1,0.1,0.1,0,0,0,0,0,0]},{"day_label":"16/10","temp_max":"20.5","temp_min":"18.2","precipitation":"0.00","icon":"â›…","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.1,18.9,18.8,18.7,18.6,18.5,18.3,18.2,18.2,18.5,19,19.4,19.8,20.3,20.5,20.4,20.1,19.9,19.6,19.3,19.1,19.1,19.2,19.2],"hourly_winds":[22.2,22.2,21.9,22.2,22.1,22.1,22.2,21.4,21.2,20.7,20.4,19.9,19.5,19.3,19,19.2,19.8,19.9,19.8,19.2,18.9,18.4,18.4,18.7],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"17/10","temp_max":"20.2","temp_min":"19.0","precipitation":"0.30","icon":"â›…","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.2,19.1,19,19,19,19.1,19.1,19.1,19.1,19.6,19.6,19.6,19.8,20,20.2,20.1,20,19.8,19.8,19.7,19.7,19.7,19.7,19.7],"hourly_winds":[18.8,18.9,18.4,17.3,15.9,14.5,13.8,13.1,12.7,20.2,19.5,19.5,20.4,21.5,22.4,22.8,23.2,22.9,22.1,20.6,19.1,17.6,15.7,14.2],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1,0.1,0.1]},{"day_label":"18/10","temp_max":"20.7","temp_min":"19.3","precipitation":"0.00","icon":"ğŸŒ¤ï¸","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.6,19.6,19.6,19.5,19.5,19.4,19.4,19.3,19.4,19.5,19.8,20,20.2,20.4,20.6,20.7,20.7,20.6,20.5,20.3,20.1,20,20,19.9],"hourly_winds":[13.1,11.9,10.5,8.6,6.8,4.7,2.3,0.5,2.5,4,5.4,6.4,6.8,7.2,7.4,7.6,7.5,7.6,8,8.6,9.2,9.2,9.7,9.8],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}],"updated_at":"12/10/2025, 12:41:28"};
const mergedHourly = marineData.mergedHourly || [];
const alerts = marineData.alerts || [];
const advice = marineData.advice || "";

// Mostra riepilogo sintetico
function humanDirection(deg) {
  const directions = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
  const ix = Math.round(deg / 22.5) % 16;
  return directions[ix];
}

// costruisci breve summary dalle prime ore
let summary = "";
if (mergedHourly.length > 0) {
  const first = mergedHourly[0];
  summary = `Altezza onda: ${first.wave_height.toFixed(2)} m, direzione swell: ${humanDirection(first.swell_direction)} (${first.swell_direction}Â°), altezza swell: ${first.swell_height.toFixed(2)} m.`;
}
document.getElementById('marine-summary').textContent = summary;

// Costruzione dati per il grafico
const labels = mergedHourly.map(h => h.time.slice(11,16)); // solo ora
const waveHeights = mergedHourly.map(h => h.wave_height);
const swellHeights = mergedHourly.map(h => h.swell_height);

// Config Chart.js line chart
const ctx = document.getElementById('marine-wave-chart').getContext('2d');
const marineWaveChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels,
    datasets: [
      {
        label: 'Altezza onda (m)',
        borderColor: 'rgba(30,144,255,0.85)',
        backgroundColor: 'rgba(30,144,255,0.25)',
        fill: true,
        data: waveHeights,
        tension: 0.3,
        pointRadius: 2,
      },
      {
        label: 'Altezza swell (m)',
        borderColor: 'rgba(0,255,128,0.85)',
        backgroundColor: 'rgba(0,255,128,0.25)',
        fill: true,
        data: swellHeights,
        tension: 0.3,
        pointRadius: 2,
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        beginAtZero: true,
        title: { display: true, text: 'Metri', color: '#a8cff8' },
        ticks: { color: '#a8cff8' }
      },
      x: {
        title: { display: true, text: 'Orario locale', color: '#a8cff8' },
        ticks: { color: '#a8cff8' }
      }
    },
    plugins: {
      legend: {
        labels: { color: '#a8cff8' }
      },
      tooltip: {
        mode: 'index',
        intersect: false
      }
    }
  }
});

// Mostra alert e consigli
const alertsDiv = document.getElementById('marine-alerts');
if (alerts.length > 0) {
  alertsDiv.innerHTML = alerts.map(a => `âš ï¸ ${a.message}`).join('<br/>');
} else {
  alertsDiv.textContent = `ğŸ—ï¸ ${advice}`;
}
</script>
