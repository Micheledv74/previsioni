<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Previsioni Procida - Dashboard Meteo MultiFonte & AI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css">
  <style>
    body { font-family: 'Roboto', Arial, sans-serif; background: linear-gradient(135deg, #26365a, #3498db 92%); color: #f0f8ff; margin:0; padding:0; }
    .header { font-family: Montserrat, sans-serif; font-size: 2.3em; font-weight: 900; color: #cfe9ff; text-shadow: 1px 2px 20px #09172a; text-align: center; margin: 21px 0 11px 0; letter-spacing:2px;}
    .dashboard { display: flex; flex-wrap: wrap; gap: 13px; justify-content: center; margin: 22px 0; }
    .box { background: rgba(37,59,102,0.22); border-radius: 18px; box-shadow: 0 5px 26px #06214672; padding: 17px; min-width:200px; max-width:380px; flex:1; margin-bottom: 12px; position:relative;}
    .box-title { font-family: Montserrat,sans-serif; font-size:1.18em; font-weight:800; color:#aadcf8; margin-bottom:9px; }
    .summ { font-size:1.15em; font-weight: 700; color:#efefa5;margin:16px auto 11px auto;text-align:center;}
    .det-btn { background: #127af7; color: #fff; font-weight:700; border: none; border-radius: 8px; padding: 8px 22px; margin:7px auto 0 auto; display:block;transition: background 0.15s;}
    .det-btn:hover { background: #5bd5fd; }
    .wi {margin-right:7px;}
    .mini-days {display:flex;flex-wrap:wrap;gap:8px;margin:14px auto 17px auto;justify-content:center;}
    .mini-day { background: #0b1333b0; color: #c6f3ff; border-radius: 10px; padding: 8px 12px; font-size: 0.98em; min-width:79px; box-shadow: 0 2px 8px #202b3b44; cursor: pointer; user-select: none; margin-bottom:4px;}
    .mini-day.active { background: #5dbef2d1; color:#fff; box-shadow: 0 0 12px #dbefff; }
    .icon {margin-left:4px; margin-right:1px;font-size:1.25em;}
    /* popup stile */
    #aiPopup {
      display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:99;
      background:rgba(20,36,64,0.96); color:#e4fbff; overflow:auto;
    }
    #aiPopup .mod-content {
      max-width:750px;
      margin:55px auto;
      background:#22365acd;
      border-radius:18px;
      padding:35px;
      position:relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    #aiPopup .close { position: absolute; right:17px; top: 11px; background:none; border:none; color:#fff; font-size:2.3em; cursor:pointer;}
    .footer { margin:22px 0 0 0; text-align:center; color:#badcff;}
    @media (max-width: 800px) { .dashboard{ flex-direction:column; gap:12px; } }
    @media (max-width:497px) { .header{font-size:1.1em;} .mod-content{padding:7px;} }
  </style>
</head>
<body>
  <div class="header">PREVISIONI METEO PROCIDA <i class="wi wi-day-sunny"></i> MultiFonte & AI</div>
  
  <!-- Mini cards giorni -->
  <div class="mini-days" id="miniDaysBox"></div>

  <!-- Pulsante per popup dettagli AI -->
  <button class="det-btn" onclick="document.getElementById('aiPopup').style.display='block'">
    <span class="wi wi-forecast-io-partly-cloudy-day"></span> Sintesi e Dettaglio AI
  </button>
  
  <!-- Popup dettagli AI scrollabile -->
  <div id="aiPopup">
    <div class="mod-content">
      <button class="close" title="Chiudi" onclick="document.getElementById('aiPopup').style.display='none'">&times;</button>
      <div id="ai-popup-content">
        <!-- Qui va la sintesi AI HTML generata dal nodo Code n8n -->
        <section class="ai-sintesi">
  <h2>Sintesi AI Multi-Sorgente</h2>
  <div class="ai-content">Ecco la previsione meteo dettagliata e combinata per Procida, basata sull'analisi delle diverse fonti fornite:</p><p><b>Località:</b> Procida, Italia<br><b>Data dell'aggiornamento:</b> 20 Ottobre 2025, sera (intorno alle 20:36-22:36)<br><b>Unità di misura:</b> Temperature in °C, Precipitazioni in mm, Vento in km/h, Pressione in hPa/mbar, Onde in cm.</p><p><hr></p><p><h3><b>Sintesi Generale della Settimana:</b></h3></p><p>La settimana a Procida sarà caratterizzata da temperature miti per il periodo, oscillando tra minime di circa 15°C e massime di 22°C. I venti saranno un elemento predominante, con raffiche significative soprattutto tra il 23 e il 25 ottobre. Si prevedono diversi episodi di pioggia, con accumuli più consistenti tra il 21 e il 26 ottobre, in particolare il 21 e il 26. Le condizioni del mare saranno generalmente mosse, con picchi di altezza onda il 24 ottobre.</p><p><hr></p><p><h3><b>Previsione Dettagliata Giorno per Giorno:</b></h3></p><p>#### <b>Lunedì 20 Ottobre 2025</b><br><li>  <b>Condizioni Generali:</b> Nuvoloso con schiarite.</li><br><li>  <b>Temperature:</b> Minima tra 15.7°C (Sorgente 1) e 18.4°C (Sorgente 4), massima tra 20.0°C (Sorgente 4) e 21.9°C (Sorgente 1). La temperatura media giornaliera sarà di circa 19.5°C (Sorgente 2), con una percezione tra 18.3°C e 19.6°C.</li><br><li>  <b>Precipitazioni:</b> Assenti o trascurabili (0.0 mm). Bassa probabilità di pioggia (20%).</li><br><li>  <b>Vento:</b> Moderato. Vento medio di 7.6 km/h (Sorgente 2) con raffiche massime fino a 13 km/h da SSO (sud-sudovest) (Sorgente 2).</li><br>    <i>   </i>Nelle ore serali e notturne (22:00-02:00 del 21/10):<i> Temperatura intorno ai 17.1-17.3°C, vento debole da S/SSE a 5-13 km/h (Sorgente 5).<br><li>  <b>Pressione Media:</b> Intorno ai 1015 hPa.</li><br><li>  <b>Umidità:</b> 62% (Sorgente 2), circa 75-78% in tarda serata (Sorgente 5).</li><br><li>  <b>Nuvolosità:</b> 65% (Sorgente 2).</li><br><li>  <b>Visibilità:</b> Buona (>10km) (Sorgente 5).</li><br><li>  <b>Mare:</b> Altezza onda da 4 a 12 cm, con moto ondoso da NW/W (Sorgente 3, converte m in cm). Temperatura superficiale del mare: 19.8-20.0°C.</li><br><li>  <b>Indice UV:</b> 0 (basso).</li></p><p>#### <b>Martedì 21 Ottobre 2025</b><br><li>  <b>Condizioni Generali:</b> Pioggia moderata, temporali possibili.</li><br><li>  <b>Temperature:</b> Minima tra 17.4°C (Sorgente 1) e 18.3°C (Sorgente 4), massima tra 19.2°C (Sorgente 2) e 19.9°C (Sorgente 1). La temperatura media sarà di 18.7°C (Sorgente 2), con una percezione simile alle temperature reali.</li><br><li>  <b>Precipitazioni:</b> Significative. Previsti tra 12.6 mm (Sorgente 2) e 15.8 mm (Sorgente 4) / 13.95 mm (Sorgente 1). Alta probabilità di pioggia (85%).</li><br>    </i>   <i>Dettagli orari:</i> Inizio precipitazioni deboli nel tardo mattino (0.01-0.03 mm tra 06:00-11:00), intensificazione nel pomeriggio e sera (picchi tra 1.09-3.5 mm/h tra 15:00-17:00 da S1/S4), diminuzione nella notte.<br><li>  <b>Vento:</b> Aumento dell'intensità. Vento medio di 3.2 m/s (11.5 km/h) (Sorgente 2) da SSE (sud-sudest), con raffiche massime fino a 5.4 m/s (19.4 km/h) (Sorgente 2). Altre fonti indicano raffiche molto più forti nel pomeriggio, fino a 21.7 km/h (Sorgente 4) e 5.3 m/s (19.1 km/h) (Sorgente 1).</li><br>    <i>   </i>Dettagli orari:<i> Venti in aumento dal mattino, con picchi nel tardo mattino/primo pomeriggio (11:00-14:00) da 15 a 21 km/h, prevalentemente da SE/SSE.<br><li>  <b>Pressione Media:</b> Intorno ai 1010 hPa.</li><br><li>  <b>Umidità:</b> 83% (Sorgente 2).</li><br><li>  <b>Nuvolosità:</b> 78% (Sorgente 2).</li><br><li>  <b>Mare:</b> Altezza onda in aumento, da 4 cm a 76 cm, con moto ondoso da S/SW (Sorgente 3). Temperatura superficiale del mare: 19.9-20.0°C.</li><br><li>  <b>Indice UV:</b> 1 (basso).</li></p><p>#### <b>Mercoledì 22 Ottobre 2025</b><br><li>  <b>Condizioni Generali:</b> Parzialmente nuvoloso, con piogge leggere intermittenti.</li><br><li>  <b>Temperature:</b> Minima tra 18.5°C (Sorgente 2) e 19.5°C (Sorgente 1), massima tra 19.7°C (Sorgente 4) e 20.1°C (Sorgente 1). La temperatura media sarà di 19.2°C (Sorgente 2), con una percezione tra 18.8°C e 20°C.</li><br><li>  <b>Precipitazioni:</b> Leggere. Previsti tra 1.0 mm (Sorgente 2) e 2.2 mm (Sorgente 1) / 1.9 mm (Sorgente 4). Bassa probabilità di pioggia (35%).</li><br>    </i>   <i>Dettagli orari:</i> Precipitazioni leggere concentrate nella prima parte della notte (00:00-01:00) e poi nel tardo pomeriggio/sera (14:00-23:00).<br><li>  <b>Vento:</b> Debole a moderato. Vento medio di 1.5 m/s (5.4 km/h) (Sorgente 2) da SSE (sud-sudest), con raffiche massime fino a 2.7 m/s (9.7 km/h) (Sorgente 2). Altre fonti indicano raffiche fino a 8.8 km/h (Sorgente 4).</li><br>    <i>   </i>Dettagli orari:<i> Vento debole nella notte, in aumento nel mattino (7-8 km/h da E/SE), poi stabile e nuovamente in calo la sera.<br><li>  <b>Pressione Media:</b> Stabile intorno ai 1010 hPa.</li><br><li>  <b>Umidità:</b> 88% (Sorgente 2).</li><br><li>  <b>Nuvolosità:</b> 24% (Sorgente 2), ma con indicazioni di parziale nuvolosità.</li><br><li>  <b>Mare:</b> Altezza onda in diminuzione, da 70 cm a 52 cm, con moto ondoso da SW/W (Sorgente 3). Temperatura superficiale del mare: 19.9-20.2°C.</li><br><li>  <b>Indice UV:</b> 4 (moderato).</li></p><p>#### <b>Giovedì 23 Ottobre 2025</b><br><li>  <b>Condizioni Generali:</b> Nuvolosità variabile con pioggia leggera.</li><br><li>  <b>Temperatur e:</b> Minima tra 19.0°C (Sorgente 2) e 19.4°C (Sorgente 1), massima tra 20.8°C (Sorgente 1) e 21.2°C (Sorgente 4). La temperatura media sarà di 20.1°C (Sorgente 2), con una percezione tra 19.3°C e 21.6°C.</li><br><li>  <b>Precipitazioni:</b> Leggere a moderate. Previsti tra 2.5 mm (Sorgente 2) e 3.6 mm (Sorgente 4) / 3.46 mm (Sorgente 1). Probabilità di pioggia del 45%.</li><br>    </i>   <i>Dettagli orari:</i> Precipitazioni più probabili nella prima metà della giornata (00:00-12:00), con accumuli orari fino a 0.3-0.6 mm.<br><li>  <b>Vento:</b> Moderato a forte. Vento medio di 3.2 m/s (11.5 km/h) (Sorgente 2) da S (sud), con raffiche massime fino a 5.2 m/s (18.7 km/h) (Sorgente 2). Altre fonti indicano raffiche molto elevate, fino a 22.2 km/h (Sorgente 4) e 7.18 m/s (25.8 km/h) (Sorgente 1).</li><br>    <i>   </i>Dettagli orari:<i> Vento in graduale aumento nel corso della giornata, con picchi serali (20:00-23:00) che possono superare i 20 km/h da S/SW.<br><li>  <b>Pressione Media:</b> Leggermente in calo, intorno ai 1010-1011 hPa.</li><br><li>  <b>Umidità:</b> 87% (Sorgente 2).</li><br><li>  <b>Nuvolosità:</b> 44% (Sorgente 2).</li><br><li>  <b>Mare:</b> Altezza onda in aumento, da 52 cm a 140 cm (Sorgente 3). Moto ondoso da SW/W. Temperatura superficiale del mare: 20.0-20.1°C.</li><br><li>  <b>Indice UV:</b> 4 (moderato).</li></p><p>#### <b>Venerdì 24 Ottobre 2025</b><br><li>  <b>Condizioni Generali:</b> Nuvolosità sparsa, tempo generalmente asciutto.</li><br><li>  <b>Temperature:</b> Minima tra 19.7°C (Sorgente 2) e 19.9°C (Sorgente 1/4), massima tra 21.0°C (Sorgente 1) e 21.9°C (Sorgente 4). La temperatura media sarà di 20.5°C (Sorgente 2), con una percezione tra 19.4°C e 21.7°C.</li><br><li>  <b>Precipitazioni:</b> Assenti o trascurabili (0.0 mm / 0.7 mm S2). Bassa probabilità di pioggia (20%).</li><br><li>  <b>Vento:</b> Molto forte. Vento medio di 6.4 m/s (23 km/h) (Sorgente 2) da O (ovest), con raffiche massime fino a 11 m/s (39.6 km/h) (Sorgente 2). Le sorgenti 1 e 4 indicano raffiche estreme, con picchi fino a 32.6 km/h (Sorgente 4) e 9.87 m/s (35.5 km/h) (Sorgente 1) nella mattinata, mantenendosi elevati per tutto il giorno.</li><br>    </i>   <i>Dettagli orari:</i> Venti forti o molto forti per tutta la giornata, con direzione prevalente da Ovest/Nordovest (260-299 gradi).<br><li>  <b>Pressione Media:</b> Stabile o in lieve aumento, intorno ai 1011-1011.3 hPa.</li><br><li>  <b>Umidità:</b> 63% (Sorgente 2).</li><br><li>  <b>Nuvolosità:</b> 16% (Sorgente 2).</li><br><li>  <b>Mare:</b> Molto mosso. Altezza onda in forte aumento, con picchi massimi di 2.22 metri (222 cm) nel mattino, e altezza significativa di circa 2 metri per gran parte della giornata (Sorgente 3). Moto ondoso da W/SW. Temperatura superficiale del mare: 20.1-20.2°C.</li><br><li>  <b>Indice UV:</b> 4 (moderato).</li></p><p>#### <b>Sabato 25 Ottobre 2025</b><br><li>  <b>Condizioni Generali:</b> Nuvolosità sparsa. Precipitazioni previste nella sera/notte.</li><br><li>  <b>Temperature:</b> Minima tra 18.4°C (Sorgente 4) e 19.4°C (Sorgente 1), massima tra 20.0°C (Sorgente 1) e 20.8°C (Sorgente 2/4). La temperatura media sarà di 19.8°C (Sorgente 2), con una percezione tra 18.5°C e 20.5°C.</li><br><li>  <b>Precipitazioni:</b> Previste tra 0.3 mm (Sorgente 2) e 7.2 mm (Sorgente 4) / 5.44 mm (Sorgente 1). Bassa probabilità di pioggia (10%) per il giorno, ma le sorgenti orarie indicano pioggia dalla sera.</li><br>    <i>   </i>Dettagli orari:<i> Precipitazioni assenti fino al tardo pomeriggio, poi in intensificazione dalla sera (19:00-23:00) con accumuli orari fino a 0.8-1.6 mm/h.<br><li>  <b>Vento:</b> Forte. Vento medio di 5.3 m/s (19.1 km/h) (Sorgente 2) da OSO (ovest-sudovest), con raffiche massime fino a 8.9 m/s (32 km/h) (Sorgente 2). Le sorgenti 1 e 4 indicano raffiche molto elevate, con picchi oltre 20 km/h per gran parte della giornata.</li><br>    </i>   <i>Dettagli orari:</i> Venti forti da W/NW al mattino, con rotazione verso W/SW e diminuzione graduale nel pomeriggio, per poi ruotare a S/SE in serata.<br><li>  <b>Pressione Media:</b> Intorno ai 1013-1014 hPa.</li><br><li>  <b>Umidità:</b> 65% (Sorgente 2).</li><br><li>  <b>Nuvolosità:</b> 18% (Sorgente 2).</li><br><li>  <b>Mare:</b> Molto mosso, con onda in graduale diminuzione nel corso della giornata, da 2 metri (200 cm) a 72 cm (Sorgente 3). Moto ondoso da W/NW. Temperatura superficiale del mare: 20.1-20.3°C.</li><br><li>  <b>Avviso (Sorgente 3):</b> Mare mosso, attenzione nelle partenze. Consiglio: mare mosso, utilizza precauzioni.</li><br><li>  <b>Indice UV:</b> 3 (moderato).</li></p><p>#### <b>Domenica 26 Ottobre 2025</b><br><li>  <b>Condizioni Generali:</b> Nuvoloso, con piogge significative.</li><br><li>  <b>Temperature:</b> Minima tra 18.7°C (Sorgente 4) e 19.0°C (Sorgente 1), massima tra 19.9°C (Sorgente 1) e 21.5°C (Sorgente 2). La temperatura media sarà di 20.3°C (Sorgente 2), con una percezione tra 19.3°C e 21.8°C.</li><br><li>  <b>Precipitazioni:</b> Molto significative. Previsti tra 0.5 mm (Sorgente 2) e 24.55 mm (Sorgente 1) / 22.8 mm (Sorgente 4). Probabilità di pioggia del 15% (Sorgente 2), ma le sorgenti orarie indicano forti accumuli. <b>Nota:</b> Forte discrepanza sulla quantità di precipitazioni tra S2 e S1/S4. Le sorgenti con dettaglio orario (S1, S4) prevedono molta più pioggia.</li><br>    <i>   </i>Dettagli orari:* Precipitazioni intense nella notte/mattina (00:00-06:00), con accumuli orari fino a 3-4.2 mm/h. Successiva pausa o piogge molto leggere, poi nuovamente lievi precipitazioni nel pomeriggio/sera.<br><li>  <b>Vento:</b> Moderato a forte. Vento medio di 6.1 m/s (22 km/h) (Sorgente 2) da S (sud), con raffiche massime fino a 7.9 m/s (28.4 km/h) (Sorgente 2). Le sorgenti 1 e 4 indicano raffiche molto elevate, con picchi oltre i 20-29 km/h per gran parte della giornata, specialmente nel pomeriggio/sera da W/NW.</li><br><li>  <b>Pressione Media:</b> Intorno ai 1006-1010 hPa.</li><br><li>  <b>Umidità:</b> 84% (Sorgente 2).</li><br><li>  <b>Nuvolosità:</b> 67% (Sorgente 2).</li><br><li>  <b>Mare:</b> Mosso, con altezza onda da 70 cm a 90 cm (Sorgente 3). Moto ondoso da W/NW. Temperatura superficiale del mare: 20.3-20.5°C.</li><br><li>  <b>Indice UV:</b> 4 (moderato).</li></p><p>#### <b>Lunedì 27 Ottobre 2025</b><br><li>  <b>Condizioni Generali:</b> Dati molto limitati, indicazioni di vento e temperature miti.</li><br><li>  <b>Temperature:</b> Minima/Massima di 19.2°C (Sorgente 1, solo 00:00).</li><br><li>  <b>Precipitazioni:</b> Assenti (Sorgente 1, solo 00:00).</li><br><li>  <b>Vento:</b> Forte, 5.51 m/s (19.8 km/h) da Ovest (275°) (Sorgente 1, solo 00:00).</li><br><li>  <b>Pressione:</b> 1009.3 hPa (Sorgente 1, solo 00:00).</li><br><li>  <b>Mare:</b> Nessun dato disponibile.</li></p><p><hr></p><p><h3><b>Considerazioni sulla Consistenza dei Dati:</b></h3></p><p><li>  <b>Temperature:</b> Generalmente consistenti tra le sorgenti, con variazioni accettabili per massime e minime. Le sorgenti con dettaglio orario (1 e 4) forniscono dati più precisi sui picchi giornalieri.</li><br><li>  <b>Precipitazioni:</b> Il totale giornaliero di precipitazioni mostra alcune discrepanze significative, in particolare per il 26 ottobre dove la Sorgente 2 indica un valore molto inferiore rispetto alle sorgenti 1 e 4, che forniscono dati orari. Si tende a dare più peso ai dati orari per l'accumulo totale, in quanto più granulari.</li><br><li>  <b>Vento:</b> La Sorgente 4 tende a prevedere venti più forti (in km/h) rispetto alla Sorgente 1 (in m/s) e 2 (in m/s), anche dopo la conversione. Per la previsione sono stati forniti i valori più elevati per cautela, indicando anche la sorgente 2 per un valore medio.</li><br><li>  <b>Pressione:</b> Abbastanza consistente tra le sorgenti.</li><br><li>  <b>Condizioni del cielo:</b> La Sorgente 2 fornisce le descrizioni più complete (nuvolosità, umidità, ecc.), mentre le Sorgenti 1 e 4 si concentrano sui dati numerici e iconografici.</li><br><li>  <b>Dati Marini:</b> La Sorgente 3 è l'unica a fornire dati marini dettagliati orari, e la sua "allerta" è un'informazione cruciale da evidenziare.</li><br><li>  <b>Dati Real-Time:</b> La Sorgente 5 offre uno sguardo molto specifico e a breve termine che è utile per le ore immediatamente successive all'aggiornamento, ma non per l'intera previsione.</li></p><p><hr></p><p><b>In sintesi, la settimana sarà variabile, con alternanza di giornate nuvolose e piovose, soprattutto a metà e fine settimana. Il vento sarà un fattore significativo, con picchi elevati tra giovedì e sabato, rendendo il mare mosso e richiedendo attenzione per le attività marittime.</b></div>
</section>
      </div>
    </div>
  </div>
  
  <!-- Dashboard box meteo con WeatherIcons e Chart.js -->
  <div class="dashboard">
    <section class="box vento" id="windbox"></section>
    <section class="box pioggia" id="rainbox"></section>
    <section class="box mare" id="seabox"></section>
    <section class="box pressione" id="pressbox"></section>
  </div>
  
  <div class="footer">Powered by n8n + Gemini & fonti meteo • Ultimo aggiornamento: <span id="updated_stamp"></span></div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Icone Meteo dinamiche -->
  <script>
  // Sostituisci questo con il tuo JSON aggregato multi-fonte!
  const DATA = window.DATA || {
    days:[
      { day_label:"20/10", icon:'<i class="wi wi-day-sunny"></i>', temp_max:21, temp_min:17, precipitation:0, wind_max:11, wind_gust:17, wind_min:5, wind_dir:90,
        hourly_winds:[7,9,11,13,12,10,7,6,10,12,9,8,7,6,6,7,8,9,11,12,13,12,10,9],
        hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
        hourly_precips:[0,0,0,0,0,0,0,0,0,0,0,0,0.2,0,0,0,0.1,0,0,0,0,0,0,0], 
        hourly_pressures:[1017,1017,1016,1016,1015,1015,1014,1014,1015,1015,1016,1016,1016,1016,1016,1016,1016,1016,1016,1015,1015,1016,1016,1016]
      }
      // ... aggiungi altri giorni con dati reali
    ]
  };

  function windDirectionName(deg) {
    const winds = ["N","NE","E","SE","S","SO","O","NO"];
    const idx = Math.round(((deg % 360) / 45)) % 8;
    return winds[idx] || "N/D";
  }

  function renderMiniDays() {
    let html = "";
    DATA.days.forEach((d, i) => {
      html += `<div class="mini-day${i === selectedDayIndex ? " active" : ""}" onclick="selectDay(${i})">
          <span class="icon">${d.icon}</span> ${d.day_label}
        </div>`;
    });
    document.getElementById("miniDaysBox").innerHTML = html;
  }

  let selectedDayIndex = 0;
  function selectDay(dayIndex) {
    selectedDayIndex = dayIndex;
    renderAll();
  }

  function renderWind() {
    const d = DATA.days[selectedDayIndex];
    document.getElementById("windbox").innerHTML = `
      <div class="box-title"><i class="wi wi-strong-wind"></i> Vento</div>
      <div class="summ"><i class="wi wi-wind-direction wi-from-${d.wind_dir||0}-deg"></i> ${d.wind_max} km/h (${windDirectionName(d.wind_dir)})<br>
      Folata max: ${d.wind_gust} km/h</div>
      <button class="det-btn" onclick="toggleDetail('wind-detail')">Dettagli / Grafico</button>
      <div class="detail-section" id="wind-detail" style="display:none;"><canvas id="windchart"></canvas></div>
    `;
    setTimeout(()=>{
      const ctx = document.getElementById('windchart').getContext('2d');
      new Chart(ctx, {
        type: 'line', data: { labels: d.hourly_labels, datasets:[{label:'Vento (km/h)',data:d.hourly_winds, borderColor:'#66E5FF', backgroundColor:'rgba(90,184,255,0.09)', fill:true}]},
        options: { plugins: {legend:{display:false}}, scales:{y:{beginAtZero:true}} }
      });
    }, 350);
  }

  function renderRain() {
    const d = DATA.days[selectedDayIndex];
    document.getElementById("rainbox").innerHTML = `
      <div class="box-title"><i class="wi wi-rain"></i> Pioggia</div>
      <div class="summ">${d.precipitation} mm</div>
      <button class="det-btn" onclick="toggleDetail('rain-detail')">Dettagli / Grafico</button>
      <div class="detail-section" id="rain-detail" style="display:none;"><canvas id="rainchart"></canvas></div>
    `;
    setTimeout(()=>{
      const ctx = document.getElementById('rainchart').getContext('2d');
      new Chart(ctx, {
        type: 'bar', data: { labels: d.hourly_labels, datasets:[{label:'Precip. (mm)',data:d.hourly_precips, backgroundColor:'#52c5f7'}]},
        options: { plugins: {legend:{display:false}}, scales:{y:{beginAtZero:true}} }
      });
    }, 350);
  }

  function renderSea() {
    document.getElementById("seabox").innerHTML = `
      <div class="box-title"><i class="wi wi-waves"></i> Mare</div>
      <div class="summ">-- metrature demo --</div>
      <button class="det-btn" onclick="toggleDetail('sea-detail')">Dettagli / Grafico</button>
      <div class="detail-section" id="sea-detail" style="display:none;"><!-- grafico mare qui --></div>
    `;
  }

  function renderPress() {
    const d = DATA.days[selectedDayIndex];
    document.getElementById("pressbox").innerHTML = `
      <div class="box-title"><i class="wi wi-barometer"></i> Pressione</div>
      <div class="summ">${Math.round((d.hourly_pressures?.reduce((a,b)=>a+b,0) || 0)/(d.hourly_pressures?.length || 1)) || '--'} hPa</div>
      <button class="det-btn" onclick="toggleDetail('press-detail')">Dettagli / Grafico</button>
      <div class="detail-section" id="press-detail" style="display:none;"><canvas id="presschart"></canvas></div>
    `;
    setTimeout(()=>{
      const ctx = document.getElementById('presschart').getContext('2d');
      new Chart(ctx, {
        type: 'line', data: { labels: d.hourly_labels, datasets:[{label:'Pressione (hPa)',data:d.hourly_pressures, borderColor:'#ffd472', backgroundColor:'rgba(255,240,51,0.10)', fill:true}]},
        options: { plugins: {legend:{display:false}}, scales:{y:{beginAtZero:false}} }
      });
    }, 350);
  }

  function toggleDetail(id) {
    document.querySelectorAll('.detail-section').forEach(e => {if (e.id!==id) e.style.display='none';});
    const el = document.getElementById(id);
    el.style.display = el.style.display==='block' ? 'none' : 'block';
  }

  function renderAll() {
    renderMiniDays(); renderWind(); renderRain(); renderSea(); renderPress();
  }
  let selectedDayIndex = 0;
  renderAll();

  document.getElementById('updated_stamp').innerText = new Date().toLocaleString('it-IT',{ dateStyle:'short', timeStyle:'medium' });
  </script>
</body>
</html>
