<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meteo Procida - Previsioni 7 Giorni</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* === COLORI DAL LOGO METEO PROCIDA === */
      --primary-blue: #012549;
      --primary-blue-light: #003d6b;
      --accent-orange: #faa202;
      --accent-cyan: #08a5e8;
      
      /* Gradazioni */
      --bg-gradient-start: #012549;
      --bg-gradient-end: #003d6b;
      --card-bg: rgba(255, 255, 255, 0.1);
      --card-border: rgba(255, 255, 255, 0.2);
      
      /* Testo */
      --text-primary: #ffffff;
      --text-secondary: #a0c4d8;
      --text-tertiary: #6a8da8;
      
      /* Accenti semantici */
      --accent-green: #34c759;
      --accent-red: #ff3b30;
      --accent-yellow: #ffcc00;
      
      /* Spacing */
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 0;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-md);
    }

    /* === HEADER con Logo e PDF Button === */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md);
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid var(--card-border);
      animation: fadeInUp 0.6s ease-out;
    }

    .header-logo {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .logo-icon {
      font-size: 2.5rem;
    }

    .header-title {
      display: flex;
      flex-direction: column;
    }

    .header-title h1 {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-cyan) 0%, var(--accent-orange) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-subtitle {
      font-size: 0.9rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pdf-button {
      background: linear-gradient(135deg, var(--accent-orange) 0%, #ff8800 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(250, 162, 2, 0.3);
    }

    .pdf-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(250, 162, 2, 0.5);
      background: linear-gradient(135deg, #ff8800 0%, var(--accent-orange) 100%);
    }

    .pdf-button:active {
      transform: translateY(0);
    }

    /* === ANIMAZIONI === */
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    /* === HERO SECTION === */
    
    .hero-card {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
      border-radius: 24px;
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-lg);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
      min-height: 50vh;
      animation: fadeInUp 0.8s ease-out;
      border: 1px solid rgba(8, 165, 232, 0.2);
    }

    /* Gradient dinamici temperature con colori logo */
    .hero-card.hot { 
      background: linear-gradient(135deg, #ff6b6b 0%, var(--accent-orange) 100%); 
    }
    .hero-card.warm { 
      background: linear-gradient(135deg, var(--accent-orange) 0%, #ff6348 100%); 
    }
    .hero-card.mild { 
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%); 
    }
    .hero-card.cool { 
      background: linear-gradient(135deg, var(--accent-cyan) 0%, var(--primary-blue-light) 100%); 
    }
    .hero-card.cold { 
      background: linear-gradient(135deg, #a8edea 0%, var(--accent-cyan) 100%); 
    }

    .hero-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }

    .hero-location {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 1.1rem;
      font-weight: 500;
      opacity: 0.9;
    }

    .hero-date {
      font-size: 0.95rem;
      opacity: 0.8;
    }

    .hero-main {
      text-align: center;
      margin: var(--spacing-xl) 0;
    }

    .hero-temp {
      font-size: 80px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: var(--spacing-sm);
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: fadeIn 1s ease-out;
    }

    .hero-condition {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      font-size: 1.5rem;
      font-weight: 500;
      margin-bottom: var(--spacing-md);
    }

    .hero-condition i {
      font-size: 3rem;
      animation: fadeIn 1.2s ease-out;
    }

    .hero-minmax {
      display: flex;
      justify-content: center;
      gap: var(--spacing-lg);
      font-size: 1.2rem;
      margin-bottom: var(--spacing-lg);
    }

    .hero-minmax span {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      transition: transform 0.3s ease;
    }

    .hero-minmax span:hover {
      transform: translateY(-2px);
    }

    .hero-summary {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: var(--spacing-md);
      font-size: 1.05rem;
      line-height: 1.6;
      margin-bottom: var(--spacing-md);
      animation: slideInLeft 0.8s ease-out;
    }

    /* === AQI WIDGET === */
    .aqi-widget {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      animation: slideInLeft 0.9s ease-out;
    }

    .aqi-icon {
      font-size: 3rem;
      opacity: 0.9;
    }

    .aqi-content {
      flex: 1;
    }

    .aqi-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.8;
      margin-bottom: 4px;
    }

    .aqi-value {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .aqi-level {
      font-size: 0.95rem;
      font-weight: 500;
    }

    /* Colori AQI standard */
    .aqi-good { 
      border-left: 4px solid var(--accent-green);
      color: var(--accent-green);
    }
    .aqi-moderate { 
      border-left: 4px solid var(--accent-yellow);
      color: var(--accent-yellow);
    }
    .aqi-unhealthy-sensitive { 
      border-left: 4px solid var(--accent-orange);
      color: var(--accent-orange);
    }
    .aqi-unhealthy { 
      border-left: 4px solid var(--accent-red);
      color: var(--accent-red);
    }
    .aqi-very-unhealthy { 
      border-left: 4px solid #8b00ff;
      color: #8b00ff;
    }
    .aqi-hazardous { 
      border-left: 4px solid #7e0023;
      color: #7e0023;
    }

    /* === ADVICE PILLS === */
    
    .advice-pills {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
      margin-bottom: var(--spacing-md);
    }

    .advice-pill {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: var(--spacing-xs) var(--spacing-md);
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .advice-pill:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* === DETAILS PILLS === */
    
    .details-pills {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: var(--spacing-sm);
    }

    .detail-pill {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: var(--spacing-sm);
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .detail-pill:hover {
      background: rgba(0, 0, 0, 0.3);
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .detail-pill i {
      font-size: 1.8rem;
      display: block;
      margin-bottom: 4px;
      opacity: 0.9;
      transition: transform 0.3s ease;
    }

    .detail-pill:hover i {
      transform: scale(1.1);
    }

    .detail-pill .value {
      font-size: 1.1rem;
      font-weight: 600;
      display: block;
      margin-bottom: 2px;
    }

    .detail-pill .label {
      font-size: 0.75rem;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Colori contestuali con palette logo */
    .detail-pill.rain-detail i { color: var(--accent-cyan); }
    .detail-pill.temp-detail i { color: var(--accent-orange); }
    .detail-pill.wind-detail i { color: var(--text-secondary); }

    /* === MOON PHASE === */
    
    .moon-phase-pill {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .moon-emoji {
      font-size: 2rem;
      display: block;
      margin-bottom: 4px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    /* === WIND ROSE === */
    
    .wind-rose-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wind-rose {
      width: 60px;
      height: 60px;
      position: relative;
    }

    .wind-rose-svg {
      width: 100%;
      height: 100%;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .detail-pill:hover .wind-rose-svg {
      transform: rotate(15deg);
    }

    /* === RAIN TIMELINE === */
    
    .rain-timeline {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      border: 1px solid rgba(8, 165, 232, 0.3);
      animation: fadeInUp 0.6s ease-out;
      animation-delay: 0.2s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    .timeline-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--spacing-md);
      color: var(--accent-cyan);
    }

    .timeline-bar {
      position: relative;
      height: 60px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: var(--spacing-sm);
    }

    .timeline-period {
      position: absolute;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: white;
      border-radius: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .timeline-period:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      z-index: 10;
    }

    .timeline-period.leggera { background: rgba(52, 199, 89, 0.8); }
    .timeline-period.moderata { background: rgba(250, 162, 2, 0.8); }
    .timeline-period.forte { background: rgba(255, 59, 48, 0.9); }

    .timeline-legend {
      display: flex;
      gap: var(--spacing-md);
      font-size: 0.85rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.2s ease;
    }

    .legend-item:hover {
      transform: scale(1.05);
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* === PRESSURE CHART === */
    
    .pressure-chart-container {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      animation: fadeInUp 0.6s ease-out;
      animation-delay: 0.3s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    .chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--accent-cyan);
    }

    .pressure-chart {
      position: relative;
      height: 150px;
      margin: var(--spacing-md) 0;
    }

    .pressure-svg {
      width: 100%;
      height: 100%;
    }

    .pressure-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: var(--spacing-xs);
    }

    .pressure-info {
      display: flex;
      gap: var(--spacing-lg);
      justify-content: center;
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }

    .pressure-stat {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 0.9rem;
    }

    .pressure-trend-up { color: var(--accent-green); }
    .pressure-trend-down { color: var(--accent-orange); }
    .pressure-trend-stable { color: var(--text-secondary); }

    /* === TEMPERATURE CHART === */
    
    .temp-chart-container {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      animation: fadeInUp 0.6s ease-out;
      animation-delay: 0.4s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    .temp-chart {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      height: 120px;
      gap: 8px;
      margin-bottom: var(--spacing-sm);
    }

    .temp-bar {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .temp-bar-visual {
      width: 100%;
      background: linear-gradient(180deg, var(--accent-orange), #ff6348);
      border-radius: 8px 8px 0 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .temp-bar-visual::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    .temp-bar:hover .temp-bar-visual {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(250, 162, 2, 0.5);
    }

    .temp-value {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent-orange);
    }

    .temp-day-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    /* === STATS GRID === */
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }

    .stat-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: var(--spacing-md);
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
    }

    .stat-card:nth-child(1) { animation-delay: 0.5s; }
    .stat-card:nth-child(2) { animation-delay: 0.6s; }
    .stat-card:nth-child(3) { animation-delay: 0.7s; }
    .stat-card:nth-child(4) { animation-delay: 0.8s; }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      background: rgba(255, 255, 255, 0.12);
    }

    .stat-card i {
      font-size: 2rem;
      margin-bottom: var(--spacing-xs);
      display: block;
      transition: transform 0.3s ease;
    }

    .stat-card:hover i {
      transform: scale(1.1) rotate(5deg);
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      margin: var(--spacing-xs) 0;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    /* === SECTION TITLE === */
    
    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: var(--spacing-xl) 0 var(--spacing-md) 0;
      padding-left: var(--spacing-xs);
      animation: slideInLeft 0.6s ease-out;
    }

    /* === DAY CARDS === */
    
    .days-grid {
      display: grid;
      gap: var(--spacing-md);
    }

    .day-card-compact {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: var(--spacing-lg);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
    }

    .day-card-compact:nth-child(1) { animation-delay: 0.9s; }
    .day-card-compact:nth-child(2) { animation-delay: 1.0s; }
    .day-card-compact:nth-child(3) { animation-delay: 1.1s; }
    .day-card-compact:nth-child(4) { animation-delay: 1.2s; }
    .day-card-compact:nth-child(5) { animation-delay: 1.3s; }
    .day-card-compact:nth-child(6) { animation-delay: 1.4s; }

    .day-card-compact:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
      background: rgba(255, 255, 255, 0.14);
      border-color: rgba(8, 165, 232, 0.4);
    }

    .day-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .day-name {
      font-size: 1.2rem;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    .day-card-compact:hover .day-name {
      color: var(--accent-cyan);
    }

    .day-temps-compact {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: 1.5rem;
    }

    .temp-max { 
      font-weight: 700; 
      color: var(--accent-orange);
      transition: transform 0.3s ease;
    }

    .day-card-compact:hover .temp-max {
      transform: scale(1.1);
    }

    .temp-min { 
      color: var(--text-secondary); 
    }

    .day-summary-short {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
      line-height: 1.5;
    }

    .day-details-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
    }

    .detail-compact {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: var(--spacing-sm);
      text-align: center;
      font-size: 0.85rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .detail-compact:hover {
      background: rgba(0, 0, 0, 0.35);
      transform: translateY(-2px);
    }

    .detail-compact i {
      display: block;
      font-size: 1.3rem;
      margin-bottom: 4px;
      opacity: 0.8;
      transition: transform 0.3s ease;
    }

    .detail-compact:hover i {
      transform: scale(1.15);
    }

    .detail-compact .value {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .detail-compact .label {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    /* === ALERTS === */
    
    .alerts {
      background: rgba(255, 59, 48, 0.15);
      border-left: 4px solid var(--accent-red);
      border-radius: 12px;
      padding: var(--spacing-md);
      margin: var(--spacing-md) 0;
      font-size: 0.9rem;
      animation: pulse 2s ease-in-out infinite;
    }

    .alerts strong {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    /* === FOOTER === */
    
    footer {
      text-align: center;
      margin-top: var(--spacing-xl);
      padding: var(--spacing-lg);
      color: var(--text-secondary);
      font-size: 0.85rem;
      opacity: 0;
      animation: fadeIn 1s ease-out forwards;
      animation-delay: 1.5s;
    }

    footer p {
      margin: 6px 0;
    }

    .error-message {
      background: rgba(255, 59, 48, 0.2);
      border: 1px solid var(--accent-red);
      border-radius: 20px;
      padding: var(--spacing-xl);
      text-align: center;
      margin: var(--spacing-lg) 0;
      animation: fadeInUp 0.6s ease-out;
    }

    /* === RESPONSIVE === */
    
    @media (max-width: 768px) {
      .container {
        padding: var(--spacing-sm);
      }

      header {
        flex-direction: column;
        gap: var(--spacing-md);
        text-align: center;
      }

      .header-logo {
        flex-direction: column;
      }

      .pdf-button {
        width: 100%;
        justify-content: center;
      }

      .hero-card {
        padding: var(--spacing-lg);
        min-height: 60vh;
      }

      .hero-temp {
        font-size: 72px;
      }

      .hero-condition {
        font-size: 1.3rem;
      }

      .hero-condition i {
        font-size: 2.5rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .details-pills {
        grid-template-columns: repeat(3, 1fr);
      }

      .day-details-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .section-title {
        font-size: 1.1rem;
      }

      .temp-chart, .pressure-chart {
        height: 100px;
      }

      .aqi-widget {
        flex-direction: column;
        text-align: center;
      }
    }

    @media (max-width: 390px) {
      .hero-temp {
        font-size: 64px;
      }

      .details-pills {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* === CSS PRINT STYLES per Export PDF === */
    
    @media print {
      body {
        background: white;
        color: black;
      }

      header, .pdf-button, footer {
        display: none;
      }

      .container {
        max-width: 100%;
        padding: 20px;
      }

      .hero-card, .day-card-compact, .stat-card {
        page-break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ddd;
      }

      .hero-card {
        min-height: auto;
      }

      .section-title {
        page-break-after: avoid;
      }

      .rain-timeline, .pressure-chart-container, .temp-chart-container {
        page-break-inside: avoid;
      }

      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }

    /* Performance optimizations */
    .timeline-period,
    .temp-bar-visual,
    .wind-rose-svg {
      will-change: transform;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER con Logo e PDF Button -->
    <header>
      <div class="header-logo">
        <div class="logo-icon">🌊</div>
        <div class="header-title">
          <h1>Meteo Procida</h1>
          <div class="header-subtitle">
            <i class="wi wi-day-sunny"></i>
            <span>Previsioni 7 giorni - Analisi AI Multi-Fonte</span>
          </div>
        </div>
      </div>
      <button class="pdf-button" onclick="exportToPDF()">
        📥 Scarica PDF
      </button>
    </header>

    <!-- HERO CARD - OGGI -->
    <div id="hero-container"></div>

    <!-- TIMELINE PRECIPITAZIONI -->
    <div id="rain-timeline-container"></div>

    <!-- GRAFICO PRESSIONE ATMOSFERICA -->
    <div id="pressure-chart-container"></div>

    <!-- GRAFICO TEMPERATURE 7 GIORNI -->
    <div id="temp-chart-container"></div>

    <!-- STATS SETTIMANALI -->
    <div id="stats-container"></div>

    <!-- GIORNI 2-7 -->
    <h2 class="section-title">📅 Prossimi 6 giorni</h2>
    <div id="forecast-container"></div>

    <footer>
      <p>Dati aggregati da Open-Meteo, Marine Open-Meteo, Weatherbit, Meteoblue e ilmeteo.it</p>
      <p>Analisi meteorologica professionale powered by AI</p>
      <p id="last-update"></p>
    </footer>
  </div>

  <script>
    // IMPORTANTE: In n8n, usa questa sintassi per iniettare i dati
    const weatherData = {"location":"Procida, Italia","generatedAt":"2025-10-21T10:30:00Z","days":[{"date":"2025-10-21","temp":{"min":16.5,"max":19.8,"feels_like":18},"rain":{"probability":90,"total_mm":18.5,"periods":[{"start":"06:30","end":"10:00","intensity":"moderata"},{"start":"13:00","end":"16:00","intensity":"forte"},{"start":"19:00","end":"22:00","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"08:00","speed_kmh":20,"gusts_kmh":30,"direction":"SE","intensity":"moderato"},{"start":"08:00","end":"17:00","speed_kmh":38,"gusts_kmh":55,"direction":"S","intensity":"molto forte"},{"start":"17:00","end":"23:59","speed_kmh":25,"gusts_kmh":40,"direction":"SW","intensity":"moderato"}]},"pressure":{"value_hPa":1005,"trend":"in forte calo"},"sea":{"condition":"molto mosso","wave_height_m":2.2,"swell_direction":"Sud"},"humidity":92,"uv_index":2,"sunrise":"07:15","sunset":"18:25","moon_phase":"Ultimo Quarto","summary":"La giornata odierna a Procida sarà caratterizzata da condizioni di forte instabilità. Le prime precipitazioni moderate sono attese già dalla prima mattinata, intensificandosi notevolmente nel primo pomeriggio con rovesci localmente forti, che potranno scaricare fino a 10-15mm/h. Nel tardo pomeriggio le piogge si attenueranno, per poi ripresentarsi in forma più leggera in serata. Il vento sarà il protagonista, con raffiche di Scirocco-Ostro che raggiungeranno picchi di oltre 50 km/h, rendendo il mare molto agitato. La pressione atmosferica subirà un calo significativo, indice di un peggioramento deciso. L'umidità sarà costantemente elevata, e il cielo rimarrà prevalentemente coperto per l'intera giornata.","advice":["Rimandare qualsiasi attività nautica; il mare sarà molto mosso e pericoloso per tutte le imbarcazioni.","Predisporre misure di sicurezza per vento forte: assicurare oggetti esposti, evitare passeggiate sul lungomare e vicino ad alberi.","Prepararsi a possibili disagi dovuti a piogge intense e raffiche di vento, quali allagamenti locali e caduta di rami."],"alerts":["Allerta Meteo per forti venti e mare agitato","Allerta per piogge localmente intense"]},{"date":"2025-10-22","temp":{"min":15,"max":18,"feels_like":16.5},"rain":{"probability":70,"total_mm":7,"periods":[{"start":"01:00","end":"04:00","intensity":"leggera"},{"start":"09:30","end":"12:00","intensity":"moderata"}]},"wind":{"periods":[{"start":"00:00","end":"06:00","speed_kmh":20,"gusts_kmh":35,"direction":"SW","intensity":"moderato"},{"start":"06:00","end":"18:00","speed_kmh":15,"gusts_kmh":25,"direction":"W","intensity":"leggero"},{"start":"18:00","end":"23:59","speed_kmh":10,"gusts_kmh":18,"direction":"NW","intensity":"leggero"}]},"pressure":{"value_hPa":1008,"trend":"in lieve aumento"},"sea":{"condition":"mosso","wave_height_m":1.4,"swell_direction":"Sud-Ovest"},"humidity":88,"uv_index":3,"sunrise":"07:16","sunset":"18:24","moon_phase":"Ultimo Quarto","summary":"Mercoledì vedrà un graduale miglioramento delle condizioni meteo rispetto alla giornata precedente, anche se l'instabilità non si sarà del tutto esaurita. Nelle ore notturne e al primo mattino persisteranno piogge leggere, con un'ulteriore fase di piogge moderate a metà mattinata, soprattutto tra le 09:30 e le 12:00. Il vento, pur rimanendo moderato da Sud-Ovest nelle prime ore, tenderà a diminuire d'intensità nel corso della giornata, ruotando da Ovest e Nord-Ovest e diventando più leggero. Di conseguenza, anche il mare, seppur ancora mosso al mattino, tenderà a placarsi gradualmente, pur mantenendo un'onda residua significativa. Le temperature si manterranno fresche, con un lieve aumento della pressione atmosferica che preannuncia una stabilizzazione per i giorni successivi.","advice":["Prestare attenzione a possibili residui di mare agitato nelle prime ore, la navigazione è da valutare con cautela.","Mantenere un ombrello a portata di mano per le piogge del mattino, che potrebbero essere improvvise.","Godersi il progressivo miglioramento delle condizioni, ma non abbassare la guardia fino al pomeriggio inoltrato."],"alerts":[]},{"date":"2025-10-23","temp":{"min":14,"max":17.5,"feels_like":15.8},"rain":{"probability":15,"total_mm":0.5,"periods":[{"start":"07:00","end":"08:00","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"12:00","speed_kmh":8,"gusts_kmh":15,"direction":"NW","intensity":"leggero"},{"start":"12:00","end":"23:59","speed_kmh":12,"gusts_kmh":20,"direction":"N","intensity":"leggero"}]},"pressure":{"value_hPa":1013,"trend":"in aumento"},"sea":{"condition":"poco mosso","wave_height_m":0.8,"swell_direction":"Nord-Ovest"},"humidity":80,"uv_index":4,"sunrise":"07:17","sunset":"18:22","moon_phase":"Ultimo Quarto","summary":"Giovedì si preannuncia una giornata in netto miglioramento su Procida, grazie all'arrivo di aria più stabile e asciutta. Il cielo si presenterà poco nuvoloso fin dal mattino, con la possibilità di qualche sporadica e molto debole precipitazione nelle primissime ore. Il vento sarà prevalentemente leggero, soffiando dai quadranti settentrionali, contribuendo a rendere l'aria più tersa e le temperature gradevoli per la stagione. La pressione atmosferica continuerà la sua risalita, consolidando le condizioni di bel tempo. Il mare, rispondendo al vento più debole, diventerà poco mosso, rendendo le attività nautiche decisamente più praticabili e piacevoli. L'umidità calerà rispetto ai giorni precedenti, regalando un maggiore senso di benessere.","advice":["Ottima giornata per attività all'aperto e passeggiate, sfruttando il miglioramento del tempo.","Le condizioni marine saranno favorevoli per uscite in barca di piccole e medie dimensioni.","Nonostante il sole, l'aria sarà fresca; si consiglia un abbigliamento a strati, soprattutto al mattino e alla sera."],"alerts":[]},{"date":"2025-10-24","temp":{"min":13,"max":18.5,"feels_like":16},"rain":{"probability":5,"total_mm":0,"periods":[]},"wind":{"periods":[{"start":"00:00","end":"06:00","speed_kmh":10,"gusts_kmh":15,"direction":"N","intensity":"leggero"},{"start":"06:00","end":"18:00","speed_kmh":15,"gusts_kmh":22,"direction":"NE","intensity":"leggero"},{"start":"18:00","end":"23:59","speed_kmh":10,"gusts_kmh":18,"direction":"E","intensity":"leggero"}]},"pressure":{"value_hPa":1016,"trend":"stabile"},"sea":{"condition":"calmo","wave_height_m":0.4,"swell_direction":"Nord-Est"},"humidity":75,"uv_index":4,"sunrise":"07:18","sunset":"18:21","moon_phase":"Calante","summary":"Venerdì si prospetta una giornata all'insegna della stabilità meteorologica su Procida. Il cielo sarà sereno o al più velato per l'intera giornata, senza alcuna probabilità di precipitazioni significative. Le temperature minime si abbasseranno leggermente, rendendo le prime ore del mattino fresche, ma le massime si manterranno su valori gradevoli, grazie anche alla quasi totale assenza di nuvolosità. Il vento sarà leggero, proveniente dai quadranti orientali, con brezze marine che si faranno sentire soprattutto nelle ore centrali. La pressione atmosferica rimarrà elevata e stabile, confermando il quadro di bel tempo. Il mare risulterà calmo o quasi calmo, ideale per qualsiasi attività marittima. Si prospetta una giornata perfetta per godere delle bellezze dell'isola.","advice":["Giornata ideale per escursioni in barca e gite via mare, con condizioni del mare ottimali.","Approfittare del sole e del clima mite per attività all'aperto, come passeggiate e sport.","Le temperature mattutine saranno fresche, si consiglia un giubbotto leggero per le prime ore del giorno."],"alerts":[]},{"date":"2025-10-25","temp":{"min":14.5,"max":19,"feels_like":17},"rain":{"probability":10,"total_mm":0,"periods":[]},"wind":{"periods":[{"start":"00:00","end":"10:00","speed_kmh":10,"gusts_kmh":16,"direction":"E","intensity":"leggero"},{"start":"10:00","end":"23:59","speed_kmh":18,"gusts_kmh":28,"direction":"SE","intensity":"moderato"}]},"pressure":{"value_hPa":1015,"trend":"stabile"},"sea":{"condition":"poco mosso","wave_height_m":0.6,"swell_direction":"Est"},"humidity":78,"uv_index":3,"sunrise":"07:19","sunset":"18:20","moon_phase":"Calante","summary":"Sabato si manterrà in un contesto di bel tempo, con un leggero aumento della ventilazione nel corso della giornata. Il cielo sarà prevalentemente sereno o poco nuvoloso, con temperature che si manterranno su valori gradevoli, leggermente superiori a quelli del giorno precedente nelle ore diurne. Il vento, inizialmente leggero da Est, tenderà a rinforzare a partire dalla tarda mattinata, ruotando a Sud-Est e diventando moderato, con qualche raffica che potrà sfiorare i 30 km/h. La pressione atmosferica rimarrà stabile su valori elevati. Il mare, di conseguenza, da calmo diverrà poco mosso, soprattutto sui versanti esposti allo Scirocco. Si tratta comunque di una giornata ampiamente godibile, che non richiederà particolari precauzioni se non per le attività nautiche più sensibili alle piccole onde.","advice":["Condizioni favorevoli per le attività balneari e in spiaggia, ma con vento in lieve rinforzo.","Per le imbarcazioni, tenere conto del vento da Sud-Est che renderà il mare poco mosso, specialmente sui versanti esposti.","Si consiglia di godere del clima mite e soleggiato."],"alerts":[]},{"date":"2025-10-26","temp":{"min":15,"max":20.5,"feels_like":18.5},"rain":{"probability":20,"total_mm":0,"periods":[]},"wind":{"periods":[{"start":"00:00","end":"08:00","speed_kmh":20,"gusts_kmh":30,"direction":"SE","intensity":"moderato"},{"start":"08:00","end":"23:59","speed_kmh":15,"gusts_kmh":25,"direction":"S","intensity":"leggero"}]},"pressure":{"value_hPa":1014,"trend":"in lieve calo"},"sea":{"condition":"poco mosso","wave_height_m":0.7,"swell_direction":"Sud-Est"},"humidity":82,"uv_index":3,"sunrise":"07:20","sunset":"18:19","moon_phase":"Luna Nuova","summary":"Domenica si presenterà con cieli prevalentemente sereni o poco nuvolosi, mantenendo un buon potenziale per attività all'aperto. Le temperature massime tenderanno ad aumentare leggermente, raggiungendo i 20°C, rendendo il clima piacevole durante le ore centrali della giornata. Il vento, inizialmente moderato da Sud-Est, diminuirà gradualmente d'intensità nel corso della mattinata, ruotando a Sud e diventando leggero. Questo comporterà un mare poco mosso, con un'onda residua da Sud-Est che non creerà particolari problematiche. La pressione atmosferica inizierà una lieve flessione, sebbene non tale da indicare un imminente peggioramento significativo. L'assenza di piogge renderà questa giornata ideale per escursioni e relax sull'isola.","advice":["Ideale per attività all'aperto e gite fuori porta, con clima mite e soleggiato.","Il mare poco mosso consente la navigazione, ma si consiglia di controllare le previsioni locali per piccole imbarcazioni.","Approfittare della giornata prima della possibile ripresa dell'instabilità all'inizio della settimana."],"alerts":[]},{"date":"2025-10-27","temp":{"min":16,"max":20,"feels_like":19},"rain":{"probability":60,"total_mm":4.5,"periods":[{"start":"14:00","end":"17:30","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"10:00","speed_kmh":12,"gusts_kmh":20,"direction":"SW","intensity":"leggero"},{"start":"10:00","end":"23:59","speed_kmh":25,"gusts_kmh":38,"direction":"SE","intensity":"moderato"}]},"pressure":{"value_hPa":1010,"trend":"in calo"},"sea":{"condition":"poco mosso","wave_height_m":0.9,"swell_direction":"Sud-Est"},"humidity":85,"uv_index":3,"sunrise":"07:21","sunset":"18:18","moon_phase":"Luna Nuova","summary":"Lunedì segnerà un nuovo, seppur lieve, cambiamento delle condizioni meteo su Procida, con un aumento dell'instabilità soprattutto nel pomeriggio. La mattinata si presenterà con cieli parzialmente nuvolosi e temperature ancora gradevoli. A partire dal primo pomeriggio, tra le 14:00 e le 17:30, sono attese piogge leggere e sparse, che non dovrebbero essere particolarmente intense. Il vento, inizialmente leggero e di provenienza sud-occidentale, tenderà a rinforzare e a ruotare a Sud-Est (Scirocco) nel corso della mattinata, diventando moderato con raffiche che potranno raggiungere i 35-40 km/h in serata. Questo comporterà un aumento del moto ondoso, con il mare che passerà da poco mosso a leggermente mosso. La pressione atmosferica continuerà la sua discesa, preannunciando un'atmosfera più umida.","advice":["Considerare la possibilità di piogge leggere nel pomeriggio; tenere un ombrello a portata di mano.","Per le attività nautiche, attenzione al vento di Scirocco in rinforzo nel pomeriggio e al mare che diventerà poco mosso.","Approfittare della mattinata più calma per attività all'aperto, prima dell'arrivo delle prime precipitazioni."],"alerts":[]},{"date":"2025-10-28","temp":{"min":16.8,"max":19.5,"feels_like":18.2},"rain":{"probability":80,"total_mm":11,"periods":[{"start":"00:00","end":"03:00","intensity":"leggera"},{"start":"08:00","end":"12:00","intensity":"moderata"},{"start":"17:00","end":"20:00","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"06:00","speed_kmh":30,"gusts_kmh":45,"direction":"SE","intensity":"forte"},{"start":"06:00","end":"16:00","speed_kmh":22,"gusts_kmh":35,"direction":"S","intensity":"moderato"},{"start":"16:00","end":"23:59","speed_kmh":18,"gusts_kmh":28,"direction":"SW","intensity":"moderato"}]},"pressure":{"value_hPa":1007,"trend":"in calo"},"sea":{"condition":"mosso","wave_height_m":1.6,"swell_direction":"Sud"},"humidity":90,"uv_index":2,"sunrise":"07:22","sunset":"18:17","moon_phase":"Luna Nuova","summary":"Martedì si preannuncia una giornata con condizioni di instabilità marcata su Procida, pur senza l'intensità delle piogge e del vento del primo giorno. Le prime ore della giornata vedranno piogge leggere, seguite da una fase più intensa di precipitazioni moderate tra le 08:00 e le 12:00. Nel pomeriggio ci sarà una pausa, ma la sera torneranno piogge leggere. Il vento sarà di Scirocco-Ostro, forte nelle prime ore con raffiche fino a 45 km/h, per poi attenuarsi a moderato nel corso della giornata, pur mantenendo una certa persistenza. Questo regime di vento contribuirà a rendere il mare mosso, con onde che potranno superare il metro e mezzo. La pressione atmosferica continuerà a diminuire, mantenendo un'atmosfera umida e un cielo spesso coperto. Sarà necessario prestare attenzione alle condizioni marine e alle precipitazioni diffuse.","advice":["Evitare uscite in mare con piccole imbarcazioni a causa del vento forte e del mare mosso, soprattutto al mattino.","Portare sempre un ombrello e un impermeabile, con particolare attenzione alle ore mattutine.","Assicurare oggetti esposti al vento, specialmente nelle prime ore della giornata."],"alerts":["Allerta per vento forte e mare mosso"]}],"processedAt":"2025-10-21T17:07:58.284Z","totalDays":8,"weekStats":{"maxTemp":20.5,"minTemp":13,"avgTemp":"19.1","rainyDays":5}};

    // === EXPORT PDF FUNCTION ===
    function exportToPDF() {
      window.print();
    }

    // === HELPER FUNCTIONS ===
    
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const giorni = ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato'];
      const mesi = ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'];
      return `${giorni[date.getDay()]} ${date.getDate()} ${mesi[date.getMonth()]}`;
    }

    function getShortDate(dateStr) {
      const date = new Date(dateStr);
      const giorni = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
      return giorni[date.getDay()];
    }

    function getWeatherIcon(summary) {
      const text = (summary || '').toLowerCase();
      if (text.includes('temporale') || text.includes('tuoni')) return 'wi-thunderstorm';
      if (text.includes('pioggia forte') || text.includes('intense')) return 'wi-rain';
      if (text.includes('pioggia')) return 'wi-showers';
      if (text.includes('neve')) return 'wi-snow';
      if (text.includes('nebbia')) return 'wi-fog';
      if (text.includes('nuvoloso') || text.includes('coperto')) return 'wi-cloudy';
      if (text.includes('parzialmente')) return 'wi-day-cloudy';
      if (text.includes('sereno') || text.includes('sole')) return 'wi-day-sunny';
      return 'wi-day-cloudy';
    }

    function getTempClass(temp) {
      if (temp >= 28) return 'hot';
      if (temp >= 22) return 'warm';
      if (temp >= 15) return 'mild';
      if (temp >= 8) return 'cool';
      return 'cold';
    }

    function getTimePosition(timeStr) {
      const [hours, minutes] = timeStr.split(':').map(Number);
      return ((hours * 60 + minutes) / 1440) * 100;
    }

    function getMoonPhaseEmoji(phaseText) {
      if (!phaseText) return '🌕';
      const phase = phaseText.toLowerCase();
      
      if (phase.includes('nuova') || phase.includes('new')) return '🌑';
      if (phase.includes('crescente') && phase.includes('primo')) return '🌓';
      if (phase.includes('crescente')) return '🌒';
      if (phase.includes('gibbosa') && phase.includes('crescente')) return '🌔';
      if (phase.includes('piena') || phase.includes('full')) return '🌕';
      if (phase.includes('gibbosa') && phase.includes('calante')) return '🌖';
      if (phase.includes('calante') && phase.includes('ultimo')) return '🌗';
      if (phase.includes('calante')) return '🌘';
      
      return '🌕';
    }

    function createWindRoseSVG(direction, speed) {
      const angle = getWindAngle(direction);
      
      return `
        <svg class="wind-rose-svg" viewBox="0 0 100 100" style="transform: rotate(${angle}deg)">
          <circle cx="50" cy="50" r="48" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2"/>
          <circle cx="50" cy="50" r="35" fill="none" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
          <circle cx="50" cy="50" r="22" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
          
          <text x="50" y="12" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="10" font-weight="600">N</text>
          <text x="88" y="55" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">E</text>
          <text x="50" y="92" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">S</text>
          <text x="12" y="55" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">O</text>
          
          <path d="M 50 20 L 55 40 L 50 35 L 45 40 Z" fill="#08a5e8" opacity="0.9"/>
          <path d="M 50 35 L 50 70" stroke="#08a5e8" stroke-width="3" stroke-linecap="round"/>
          <circle cx="50" cy="50" r="5" fill="#08a5e8"/>
        </svg>
      `;
    }

    function getWindAngle(direction) {
      const directions = {
        'N': 0, 'NNE': 22.5, 'NE': 45, 'ENE': 67.5,
        'E': 90, 'ESE': 112.5, 'SE': 135, 'SSE': 157.5,
        'S': 180, 'SSW': 202.5, 'SW': 225, 'WSW': 247.5,
        'W': 270, 'WNW': 292.5, 'NW': 315, 'NNW': 337.5,
        'SSO': 202.5, 'SO': 225, 'OSO': 247.5, 'O': 270,
        'ONO': 292.5, 'NO': 315, 'NNO': 337.5
      };
      return directions[direction?.toUpperCase()] || 0;
    }

    // === AQI FUNCTIONS ===
    
    function getAQIClass(aqi) {
      if (aqi <= 50) return 'aqi-good';
      if (aqi <= 100) return 'aqi-moderate';
      if (aqi <= 150) return 'aqi-unhealthy-sensitive';
      if (aqi <= 200) return 'aqi-unhealthy';
      if (aqi <= 300) return 'aqi-very-unhealthy';
      return 'aqi-hazardous';
    }

    function getAQILevel(aqi) {
      if (aqi <= 50) return 'Buona';
      if (aqi <= 100) return 'Moderata';
      if (aqi <= 150) return 'Malsana per sensibili';
      if (aqi <= 200) return 'Malsana';
      if (aqi <= 300) return 'Molto malsana';
      return 'Pericolosa';
    }

    function getAQIIcon(aqi) {
      if (aqi <= 50) return '😊';
      if (aqi <= 100) return '😐';
      if (aqi <= 150) return '😷';
      if (aqi <= 200) return '😨';
      if (aqi <= 300) return '☠️';
      return '💀';
    }

    // === RENDER HERO CARD ===
    
    function renderHero() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
      
      const today = weatherData.days[0];
      const tempClass = getTempClass(today.temp?.max || 20);
      const weatherIcon = getWeatherIcon(today.summary);
      const moonEmoji = getMoonPhaseEmoji(today.moon_phase);
      
      // AQI Widget (se disponibile)
      let aqiWidget = '';
      if (today.air_quality && today.air_quality.aqi) {
        const aqi = today.air_quality.aqi;
        const aqiClass = getAQIClass(aqi);
        const aqiLevel = getAQILevel(aqi);
        const aqiIcon = getAQIIcon(aqi);
        
        aqiWidget = `
          <div class="aqi-widget ${aqiClass}">
            <div class="aqi-icon">${aqiIcon}</div>
            <div class="aqi-content">
              <div class="aqi-title">Qualità dell'Aria</div>
              <div class="aqi-value">${aqi}</div>
              <div class="aqi-level">${aqiLevel}</div>
            </div>
          </div>
        `;
      }
      
      const html = `
        <div class="hero-card ${tempClass}">
          <div class="hero-header">
            <div class="hero-location">
              <i class="wi wi-horizon"></i>
              ${weatherData.location || 'Procida'}
            </div>
            <div class="hero-date">${formatDate(today.date)}</div>
          </div>

          <div class="hero-main">
            <div class="hero-temp">${Math.round(today.temp?.max || today.temp?.feels_like || 20)}°</div>
            
            <div class="hero-condition">
              <i class="wi ${weatherIcon}"></i>
              <span>${getConditionText(today)}</span>
            </div>

            <div class="hero-minmax">
              <span>
                <i class="wi wi-direction-down"></i>
                ${Math.round(today.temp?.min || 15)}°
              </span>
              <span>
                <i class="wi wi-direction-up"></i>
                ${Math.round(today.temp?.max || 20)}°
              </span>
            </div>
          </div>

          ${today.summary ? `
            <div class="hero-summary">
              ${today.summary}
            </div>
          ` : ''}

          ${aqiWidget}

          ${today.advice && today.advice.length > 0 ? `
            <div class="advice-pills">
              ${today.advice.map(a => `
                <div class="advice-pill">
                  💡 ${a}
                </div>
              `).join('')}
            </div>
          ` : ''}

          ${today.alerts && today.alerts.length > 0 ? `
            <div class="alerts">
              <strong>⚠️ ALLERTE METEO</strong>
              ${today.alerts.map(a => `<p>${a}</p>`).join('')}
            </div>
          ` : ''}

          <div class="details-pills">
            ${today.rain && today.rain.probability > 0 ? `
              <div class="detail-pill rain-detail">
                <i class="wi wi-raindrop"></i>
                <span class="value">${today.rain.probability}%</span>
                <span class="label">Pioggia</span>
              </div>
            ` : ''}
            
            ${today.wind && today.wind.periods && today.wind.periods[0] ? `
              <div class="detail-pill wind-detail">
                <div class="wind-rose-container">
                  ${createWindRoseSVG(today.wind.periods[0].direction, today.wind.periods[0].speed_kmh)}
                </div>
                <span class="value">${today.wind.periods[0].speed_kmh} km/h</span>
                <span class="label">${today.wind.periods[0].direction}</span>
              </div>
            ` : ''}

            ${today.humidity ? `
              <div class="detail-pill">
                <i class="wi wi-humidity"></i>
                <span class="value">${today.humidity}%</span>
                <span class="label">Umidità</span>
              </div>
            ` : ''}

            ${today.uv_index ? `
              <div class="detail-pill temp-detail">
                <i class="wi wi-day-sunny"></i>
                <span class="value">${today.uv_index}</span>
                <span class="label">UV</span>
              </div>
            ` : ''}

            ${today.pressure ? `
              <div class="detail-pill">
                <i class="wi wi-barometer"></i>
                <span class="value">${today.pressure.value_hPa}</span>
                <span class="label">hPa</span>
              </div>
            ` : ''}

            ${today.sea ? `
              <div class="detail-pill rain-detail">
                <i class="wi wi-tsunami"></i>
                <span class="value">${today.sea.wave_height_m}m</span>
                <span class="label">${today.sea.condition}</span>
              </div>
            ` : ''}

            ${today.sunrise ? `
              <div class="detail-pill temp-detail">
                <i class="wi wi-sunrise"></i>
                <span class="value">${today.sunrise}</span>
                <span class="label">Alba</span>
              </div>
            ` : ''}

            ${today.sunset ? `
              <div class="detail-pill temp-detail">
                <i class="wi wi-sunset"></i>
                <span class="value">${today.sunset}</span>
                <span class="label">Tramonto</span>
              </div>
            ` : ''}

            ${today.moon_phase ? `
              <div class="detail-pill moon-phase-pill">
                <span class="moon-emoji">${moonEmoji}</span>
                <span class="label">${today.moon_phase}</span>
              </div>
            ` : ''}
          </div>
        </div>
      `;
      
      document.getElementById('hero-container').innerHTML = html;
    }

    function getConditionText(day) {
      if (day.rain && day.rain.probability > 70) return 'Pioggia';
      if (day.rain && day.rain.probability > 40) return 'Possibile pioggia';
      const summary = (day.summary || '').toLowerCase();
      if (summary.includes('sereno')) return 'Sereno';
      if (summary.includes('nuvoloso')) return 'Nuvoloso';
      return 'Variabile';
    }

    // === RENDER RAIN TIMELINE ===
    
    function renderRainTimeline() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
      
      const today = weatherData.days[0];
      if (!today.rain || !today.rain.periods || today.rain.periods.length === 0) return;

      const periodsHTML = today.rain.periods.map(p => {
        const start = getTimePosition(p.start);
        const end = getTimePosition(p.end);
        const width = end - start;
        
        return `
          <div class="timeline-period ${p.intensity}" 
               style="left: ${start}%; width: ${width}%;"
               title="${p.start} - ${p.end}: ${p.intensity}">
            <span>${p.start}-${p.end}</span>
          </div>
        `;
      }).join('');

      const html = `
        <div class="rain-timeline">
          <div class="timeline-header">
            <i class="wi wi-rain"></i>
            Precipitazioni Oggi (${today.rain.total_mm}mm totali)
          </div>
          
          <div class="timeline-bar">
            ${periodsHTML}
          </div>

          <div class="timeline-legend">
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(52, 199, 89, 0.8);"></div>
              <span>Leggera</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(250, 162, 2, 0.8);"></div>
              <span>Moderata</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(255, 59, 48, 0.9);"></div>
              <span>Forte</span>
            </div>
          </div>
        </div>
      `;

      document.getElementById('rain-timeline-container').innerHTML = html;
    }

    // === RENDER PRESSURE CHART ===
    
    function renderPressureChart() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;

      const pressures = weatherData.days
        .filter(d => d.pressure && d.pressure.value_hPa)
        .map(d => ({
          date: d.date,
          value: d.pressure.value_hPa,
          trend: d.pressure.trend
        }));

      if (pressures.length === 0) return;

      const values = pressures.map(p => p.value);
      const maxPressure = Math.max(...values);
      const minPressure = Math.min(...values);
      const range = maxPressure - minPressure || 10;
      
      const chartWidth = 100;
      const chartHeight = 100;
      const pointsPerDay = chartWidth / pressures.length;

      // Genera punti SVG
      const points = pressures.map((p, i) => {
        const x = (i * pointsPerDay) + (pointsPerDay / 2);
        const y = chartHeight - (((p.value - minPressure) / range) * 80 + 10);
        return `${x},${y}`;
      }).join(' ');

      // Trend globale
      const firstPressure = pressures[0].value;
      const lastPressure = pressures[pressures.length - 1].value;
      const trendDiff = lastPressure - firstPressure;
      let trendClass = 'pressure-trend-stable';
      let trendText = 'Stabile';
      let trendIcon = '➡️';
      
      if (trendDiff > 3) {
        trendClass = 'pressure-trend-up';
        trendText = 'In salita';
        trendIcon = '↗️';
      } else if (trendDiff < -3) {
        trendClass = 'pressure-trend-down';
        trendText = 'In discesa';
        trendIcon = '↘️';
      }

      const html = `
        <div class="pressure-chart-container">
          <div class="chart-title">
            <i class="wi wi-barometer"></i>
            Pressione Atmosferica - 7 Giorni
          </div>
          
          <div class="pressure-chart">
            <svg class="pressure-svg" viewBox="0 0 ${chartWidth} ${chartHeight}" preserveAspectRatio="none">
              <!-- Threshold line 1013 hPa -->
              <line x1="0" y1="${chartHeight - (((1013 - minPressure) / range) * 80 + 10)}" 
                    x2="${chartWidth}" y2="${chartHeight - (((1013 - minPressure) / range) * 80 + 10)}"
                    stroke="rgba(255,255,255,0.2)" stroke-width="0.5" stroke-dasharray="2,2"/>
              
              <!-- Area sotto la linea -->
              <polygon points="0,${chartHeight} ${points} ${chartWidth},${chartHeight}"
                       fill="url(#pressureGradient)" opacity="0.3"/>
              
              <!-- Linea pressione -->
              <polyline points="${points}"
                        fill="none" stroke="#08a5e8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              
              <!-- Punti -->
              ${pressures.map((p, i) => {
                const x = (i * pointsPerDay) + (pointsPerDay / 2);
                const y = chartHeight - (((p.value - minPressure) / range) * 80 + 10);
                return `<circle cx="${x}" cy="${y}" r="1.5" fill="#08a5e8"/>`;
              }).join('')}
              
              <defs>
                <linearGradient id="pressureGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#08a5e8;stop-opacity:0.6"/>
                  <stop offset="100%" style="stop-color:#08a5e8;stop-opacity:0"/>
                </linearGradient>
              </defs>
            </svg>
          </div>

          <div class="pressure-labels">
            ${pressures.map(p => `<span>${getShortDate(p.date)}</span>`).join('')}
          </div>

          <div class="pressure-info">
            <div class="pressure-stat">
              <i class="wi wi-direction-up"></i>
              <span>Max: ${maxPressure} hPa</span>
            </div>
            <div class="pressure-stat">
              <i class="wi wi-direction-down"></i>
              <span>Min: ${minPressure} hPa</span>
            </div>
            <div class="pressure-stat ${trendClass}">
              <span>${trendIcon} ${trendText}</span>
            </div>
          </div>
        </div>
      `;

      document.getElementById('pressure-chart-container').innerHTML = html;
    }

    // === RENDER TEMPERATURE CHART ===
    
    function renderTempChart() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;

      const temps = weatherData.days.map(d => d.temp?.max || 20);
      const maxTemp = Math.max(...temps);
      const minTemp = Math.min(...temps);
      const range = maxTemp - minTemp || 1;

      const barsHTML = weatherData.days.map((day, i) => {
        const temp = day.temp?.max || 20;
        const height = ((temp - minTemp) / range) * 100;
        
        return `
          <div class="temp-bar">
            <div class="temp-value">${Math.round(temp)}°</div>
            <div class="temp-bar-visual" style="height: ${height}px; min-height: 20px;"></div>
            <div class="temp-day-label">${getShortDate(day.date)}</div>
          </div>
        `;
      }).join('');

      const html = `
        <div class="temp-chart-container">
          <div class="chart-title">
            <i class="wi wi-thermometer"></i>
            Temperature Massime - 7 Giorni
          </div>
          <div class="temp-chart">
            ${barsHTML}
          </div>
        </div>
      `;

      document.getElementById('temp-chart-container').innerHTML = html;
    }

    // === RENDER STATS ===
    
    function renderStats() {
      if (!weatherData || !weatherData.weekStats) return;
      const stats = weatherData.weekStats;
      
      const html = `
        <div class="stats-grid">
          <div class="stat-card">
            <i class="wi wi-thermometer" style="color: var(--accent-orange);"></i>
            <div class="stat-value">${stats.maxTemp}°C</div>
            <div class="stat-label">Max Settimana</div>
          </div>
          <div class="stat-card">
            <i class="wi wi-thermometer-exterior" style="color: var(--accent-cyan);"></i>
            <div class="stat-value">${stats.minTemp}°C</div>
            <div class="stat-label">Min Settimana</div>
          </div>
          <div class="stat-card">
            <i class="wi wi-thermometer" style="color: var(--accent-green);"></i>
            <div class="stat-value">${stats.avgTemp}°C</div>
            <div class="stat-label">Media</div>
          </div>
          <div class="stat-card">
            <i class="wi wi-rain" style="color: var(--accent-cyan);"></i>
            <div class="stat-value">${stats.rainyDays}</div>
            <div class="stat-label">Giorni Pioggia</div>
          </div>
        </div>
      `;
      
      document.getElementById('stats-container').innerHTML = html;
    }

    // === RENDER FORECAST DAYS 2-7 ===
    
    function renderForecast() {
      if (!weatherData || !weatherData.days || weatherData.days.length < 2) {
        document.getElementById('forecast-container').innerHTML = `
          <div class="error-message">
            <h2>⚠️ Errore nel caricamento dei dati</h2>
            <p>Impossibile recuperare le previsioni meteo. Riprova più tardi.</p>
          </div>
        `;
        return;
      }

      const futureDays = weatherData.days.slice(1);

      const html = futureDays.map(day => {
        const moonEmoji = getMoonPhaseEmoji(day.moon_phase);
        
        return `
        <div class="day-card-compact">
          <div class="day-card-header">
            <div class="day-name">${formatDate(day.date)}</div>
            <div class="day-temps-compact">
              <span class="temp-max">${Math.round(day.temp?.max || 20)}°</span>
              <span class="temp-min">${Math.round(day.temp?.min || 15)}°</span>
            </div>
          </div>

          ${day.summary ? `
            <div class="day-summary-short">${day.summary}</div>
          ` : ''}

          ${day.advice && day.advice.length > 0 ? `
            <div class="advice-pills">
              ${day.advice.slice(0, 2).map(a => `
                <div class="advice-pill">💡 ${a}</div>
              `).join('')}
            </div>
          ` : ''}

          ${day.alerts && day.alerts.length > 0 ? `
            <div class="alerts">
              <strong>⚠️ ALLERTE</strong>
              ${day.alerts.map(a => `<p>${a}</p>`).join('')}
            </div>
          ` : ''}

          <div class="day-details-row">
            ${day.rain && day.rain.probability > 0 ? `
              <div class="detail-compact">
                <i class="wi wi-raindrop" style="color: var(--accent-cyan);"></i>
                <div class="value">${day.rain.probability}%</div>
                <div class="label">${day.rain.total_mm}mm</div>
              </div>
            ` : ''}

            ${day.wind && day.wind.periods && day.wind.periods[0] ? `
              <div class="detail-compact">
                <div style="width: 40px; height: 40px; margin: 0 auto 4px;">
                  ${createWindRoseSVG(day.wind.periods[0].direction, day.wind.periods[0].speed_kmh)}
                </div>
                <div class="value">${day.wind.periods[0].speed_kmh} km/h</div>
                <div class="label">${day.wind.periods[0].direction}</div>
              </div>
            ` : ''}

            ${day.sea ? `
              <div class="detail-compact">
                <i class="wi wi-tsunami" style="color: var(--accent-cyan);"></i>
                <div class="value">${day.sea.wave_height_m}m</div>
                <div class="label">${day.sea.condition}</div>
              </div>
            ` : ''}

            ${day.humidity ? `
              <div class="detail-compact">
                <i class="wi wi-humidity"></i>
                <div class="value">${day.humidity}%</div>
                <div class="label">Umidità</div>
              </div>
            ` : ''}

            ${day.uv_index ? `
              <div class="detail-compact">
                <i class="wi wi-day-sunny" style="color: var(--accent-orange);"></i>
                <div class="value">${day.uv_index}</div>
                <div class="label">UV Index</div>
              </div>
            ` : ''}

            ${day.pressure ? `
              <div class="detail-compact">
                <i class="wi wi-barometer"></i>
                <div class="value">${day.pressure.value_hPa}</div>
                <div class="label">${day.pressure.trend || 'hPa'}</div>
              </div>
            ` : ''}

            ${day.moon_phase ? `
              <div class="detail-compact">
                <span style="font-size: 1.5rem; display: block; margin-bottom: 4px;">${moonEmoji}</span>
                <div class="label">${day.moon_phase}</div>
              </div>
            ` : ''}
          </div>
        </div>
      `}).join('');

      document.getElementById('forecast-container').innerHTML = `<div class="days-grid">${html}</div>`;
    }

    // === UPDATE TIMESTAMP ===
    
    function updateTimestamp() {
      if (weatherData && weatherData.generatedAt) {
        const date = new Date(weatherData.generatedAt);
        document.getElementById('last-update').textContent = 
          `Ultimo aggiornamento: ${date.toLocaleString('it-IT')}`;
      }
    }

    // === INIZIALIZZAZIONE ===
    
    renderHero();
    renderRainTimeline();
    renderPressureChart();
    renderTempChart();
    renderStats();
    renderForecast();
    updateTimestamp();
  </script>
</body>
</html>
