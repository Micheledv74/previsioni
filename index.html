<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>Previsioni Procida - Dashboard Meteo</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto&display=swap');
    html { box-sizing: border-box;} *,*:before,*:after { box-sizing: inherit; }
    body { font-family: 'Roboto', Arial, sans-serif; max-width: 1000px; margin: 0 auto; background: linear-gradient(135deg, #26365a, #3498db 92%); color: #f0f8ff; padding: 14px 2px 18px 2px; overflow-x: hidden; min-height: 100vh; }
    .header { font-family: 'Montserrat', sans-serif; font-size: 2.45em; font-weight: 900; text-align: center; color: #cfe9ff; text-shadow: 1px 2px 14px #09172a; letter-spacing: 2px; user-select: none; margin-bottom: 19px; }
    .dashboard { display: flex; flex-wrap: wrap; gap: 19px; justify-content: center; }
    .box { background: rgba(37,59,102,0.22); border-radius: 18px; box-shadow: 0 5px 26px #06214672; padding: 16px 14px 16px 14px; flex: 1 1 310px; max-width: 410px; min-width: 215px; display: flex; flex-direction: column; align-items: center; margin-bottom: 13px; position: relative;}
    .box-title { font-size: 1.17rem; font-weight: 900; color: #a9edff; letter-spacing: 1px; margin-bottom: 11px; font-family: 'Montserrat', sans-serif; }
    .box .main { font-weight: 700; font-size: 1.11em; color:#84dbff;}
    .box .desc { margin: 2px 0 0 0; font-size:1.01em; color:#c3ccdf;}
    button.detail-btn { margin-top:9px; background: #127af7; color: #fff; font-weight:700; border: none; border-radius: 8px; padding: 11px 24px; cursor: pointer; transition: background 0.12s;}
    button.detail-btn:hover { background: #45bafe;}
    .detail-section { display: none; margin-top: 8px; width: 100%; }
    .detail-section.active { display: block; }
    .chart-wrap { width: 99%; max-width: 385px; margin: 0 auto 18px auto; border-radius: 13px; background: #213260d0; padding: 11px 5px 7px 5px;}
    .mini-days { display:flex; flex-wrap:wrap; gap:8px; margin:18px auto 7px auto; justify-content:center;}
    .mini-day { background: #0b1333b0; color: #c6f3ff; border-radius:11px; padding:9px 15px; font-size:1em; min-width:85px; box-shadow: 0 2px 8px #202b3b44;}
    .mini-day .daylabel { font-weight:700; color:#fff;}
    .mini-day .icon {font-size:1.23em;vertical-align:-4px;}
    .mini-day .tmax {color:#ffd472;}
    .mini-day .tmin {color:#6fd7f8;}
    .mini-day .wind {color:#86caff;}
    .mini-day .rain {color:#9fffe1;}
    .footer { margin-top: 32px; text-align: center; color: #dbefff; font-size:17px; font-weight:500; text-shadow:0 2px 6px #283c5880;}
    @media (max-width:800px){ .dashboard{gap:12px;} .box{min-width:180px;max-width:97vw;} }
    @media (max-width:650px){ .dashboard{flex-direction:column;align-items:center;gap:14px;} .box{width:100%;max-width:98vw;} .header{font-size:1.17em;}}
    @media (max-width:510px){ .mini-day{padding:6px 5px;font-size:0.93em;} }
  </style>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="header">PREVISIONI METEO PROCIDA</div>
  <div class="dashboard">
    <section class="box vento" id="windbox"></section>
    <section class="box pioggia" id="rainbox"></section>
    <section class="box mare" id="seabox"></section>
    <section class="box pressione" id="pressbox"></section>
  </div>
  <div class="mini-days" id="miniDaysBox"></div>
  <div class="footer" id="footer"></div>
<script>
// Simulazione dati: Sostituisci con il tuo JSON $json reale!
const DATA = {
  days:[
    {day_label:"14/10",icon:"‚òÄÔ∏è",temp_max:22,temp_min:18,precipitation:2.3,wind_max:13,wind_gust:19,wind_min:6,wind_dir:90,hourly_winds:[7,9,11,13,12,10,7,6,10,12,9,8,7,6,6,7,8,9,11,12,13,12,10,9],hourly_wind_directions:[80,90,90,100,110,120,120,130,140,150,150,155,160,160,170,170,180,180,180,180,170,160,150,140],hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],hourly_precips:[0,0,0,0,0,0.4,0.8,0.0,0,0,0,0,0.2,0,0,0,0.7,0,0,0,0,0,0,0],pressure_avg:1017,hourly_pressures:[1017,1018,1018,1018,1018,1018,1017,1017,1017,1017,1018,1019,1020,1019,1018,1018,1017,1016,1016,1016,1016,1016,1017,1017]},
    {day_label:"15/10",icon:"‚õÖ",temp_max:21,temp_min:15,precipitation:0.5,wind_max:10,wind_gust:17,wind_min:5,wind_dir:70},
    {day_label:"16/10",icon:"üå§Ô∏è",temp_max:20,temp_min:14,precipitation:0,wind_max:12,wind_gust:16,wind_min:5,wind_dir:60},
    {day_label:"17/10",icon:"üåßÔ∏è",temp_max:18,temp_min:13,precipitation:5.6,wind_max:15,wind_gust:22,wind_min:9,wind_dir:120},
    {day_label:"18/10",icon:"‚õÖ",temp_max:19,temp_min:15,precipitation:0.8,wind_max:11,wind_gust:15,wind_min:6,wind_dir:105},
    {day_label:"19/10",icon:"üå¶Ô∏è",temp_max:20,temp_min:14,precipitation:1.2,wind_max:8,wind_gust:12,wind_min:4,wind_dir:90}
  ],
  mergedHourly:[
    {wave_height:0.05,sea_surface_temperature:21.7,time:"2025-10-14T00:00",swell_height:0.02,swell_direction:209},
    {wave_height:0.06,sea_surface_temperature:21.9,time:"2025-10-14T03:00",swell_height:0.02,swell_direction:212},
    {wave_height:0.04,sea_surface_temperature:21.8,time:"2025-10-14T06:00",swell_height:0.02,swell_direction:215},
    {wave_height:0.05,sea_surface_temperature:22.0,time:"2025-10-14T09:00",swell_height:0.02,swell_direction:218},
    {wave_height:0.08,sea_surface_temperature:22.4,time:"2025-10-14T12:00",swell_height:0.03,swell_direction:215},
    {wave_height:0.09,sea_surface_temperature:22.6,time:"2025-10-14T15:00",swell_height:0.04,swell_direction:222},
    {wave_height:0.06,sea_surface_temperature:22.3,time:"2025-10-14T18:00",swell_height:0.03,swell_direction:223},
    {wave_height:0.04,sea_surface_temperature:21.9,time:"2025-10-14T21:00",swell_height:0.02,swell_direction:220}
  ],
  alerts:["Nessuna allerta"],
  advice:"Giornata perfetta per attivit√† all'aperto!",
  updated_at:"14/10/2025, 23:12"
};

function windDirectionName(deg) {
  if(deg==null) return "--";
  const winds = [
    {name:"Tramontana",abbr:"N"}, {name:"Grecale",abbr:"NE"},
    {name:"Levante",abbr:"E"}, {name:"Scirocco",abbr:"SE"},
    {name:"Ostro",abbr:"S"}, {name:"Libeccio",abbr:"SO"},
    {name:"Ponente",abbr:"O"}, {name:"Maestrale",abbr:"NO"}];
  const idx = Math.floor(((deg+22.5)%360)/45);
  return winds[idx]?winds[idx].name+" ("+winds[idx].abbr+")":"N/D";
}
function calculateMean(arr){if(!arr.length)return 0;return arr.reduce((a,b)=>a+b,0)/arr.length;}
function calculateRange(arr){if(!arr.length)return 0;return Math.max(...arr)-Math.min(...arr);}
function calculateStdDev(arr){if(!arr.length)return 0;const m=calculateMean(arr);return Math.sqrt(arr.reduce((a,b)=>a+(b-m)**2,0)/arr.length);}
function rainIcon(valmm){if(valmm<0.1)return'';if(valmm<0.5)return'üíß';if(valmm<1)return'üíßüíß';if(valmm<3)return'üíßüíßüíß';if(valmm<10)return'üíßüíßüíßüíß';return'üíßüíßüíßüíßüíß';}
function pressureTrend(arr){
  if (!arr || arr.length < 5) return "N/D";
  const meanStart = (arr[0]+arr[1]+arr[2])/3, meanEnd = (arr[arr.length-3]+arr[arr.length-2]+arr[arr.length-1])/3;
  if (meanEnd > meanStart + 1) return 'in aumento ‚¨ÜÔ∏è (alta)';
  if (meanStart > meanEnd + 1) return 'in calo ‚¨áÔ∏è (bassa)';
  return 'stabile ‚ÜîÔ∏è‚Äô;
}
// ---- Toggle dettaglio ----
f// Funzione toggle aggiornata in modalit√† apri/chiudi/toggle
function toggleDetail(id){
  let el = document.getElementById(id);
  // Chiudi tutti i pannelli tranne quello selezionato se necessario
  document.querySelectorAll('.detail-section').forEach(e => {
    if (e !== el) e.classList.remove('active');
  });
  // Toggle su quello selezionato
  el.classList.toggle('active');
}
// ---- Render Vento ----
function renderWind(){
  const d = DATA.days[0];
  const windSpeed = d.hourly_winds?d.hourly_winds[new Date().getHours()] : d.wind_max || "--";
  const windDeg = d.hourly_wind_directions?d.hourly_wind_directions[new Date().getHours()]:d.wind_dir||"--";
  const windDirTxt = windDirectionName(windDeg);
  document.getElementById("windbox").innerHTML = `
    <div class="box-title">üå¨Ô∏è Vento</div>
    <div class="main">Corrente: <b>${windSpeed} km/h</b></div>
    <div class="desc">Direzione: <b>${windDeg}¬∞</b> ${windDirTxt}</div>
    <div class="main">Folata max: <b>${d.wind_gust||d.wind_max||"--"} km/h</b></div>
    <button class="detail-btn" onclick="toggleDetail('wind-detail')">Dettagli / Grafico</button>
    <div class="detail-section" id="wind-detail">
      <div class="chart-wrap"><canvas id="windchart"></canvas></div>
      <div><b>Massimo:</b> ${Math.max(...d.hourly_winds)} km/h &nbsp; <b>Minimo:</b> ${Math.min(...d.hourly_winds)} km/h</div>
      <div><b>Direzione max:</b> ${windDirectionName(Math.max(...d.hourly_wind_directions))}</div>
    </div>
  `;
  setTimeout(()=>{
    const ctx=document.getElementById('windchart').getContext('2d');
    new Chart(ctx,{type:'line',data:{
      labels:d.hourly_labels, datasets:[{label:'Vento (km/h)',data:d.hourly_winds,borderColor:'#66E5FF',backgroundColor:'rgba(90,184,255,0.12)',fill:true,tension:0.21,pointRadius:1}]
    },options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true},x:{}}}});
  },100);
}
// ---- Render Pioggia ----
function renderRain(){
  const d = DATA.days[0];
  const pioggia = d.precipitation || 0;
  document.getElementById("rainbox").innerHTML = `
    <div class="box-title">üåßÔ∏è Pioggia</div>
    <div class="main">Totale oggi: <b>${pioggia.toFixed(1)} mm</b> ${rainIcon(pioggia)}</div>
    <div class="desc">Previsione: ${pioggia > 0 ? "Possibile precipitazione" : "Nessuna pioggia significativa"}</div>
    <button class="detail-btn" onclick="toggleDetail('rain-detail')">Dettagli / Grafico</button>
    <div class="detail-section" id="rain-detail">
      <div class="chart-wrap"><canvas id="rainchart"></canvas></div>
      <div><b>Ora pi√π piovosa:</b> ${d.hourly_labels[d.hourly_precips.indexOf(Math.max(...d.hourly_precips))]} &nbsp; <b>Max:</b> ${Math.max(...d.hourly_precips)} mm</div>
    </div>
  `;
  setTimeout(()=>{
    const ctx=document.getElementById('rainchart').getContext('2d');
    new Chart(ctx,{type:'bar',data:{
      labels:d.hourly_labels, datasets:[{label:'Precipitazioni (mm)',data:d.hourly_precips,backgroundColor:'#52c5f7',borderColor:'#52afe7',borderWidth:2}]
    },options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true},x:{}}}});
  },100);
}
// ---- Render Mare ----
function renderSea(){
  const arr = DATA.mergedHourly||[];
  const waveMean = calculateMean(arr.map(h=>h.wave_height));
  const waveRange = calculateRange(arr.map(h=>h.wave_height));
  const waveStdDev = calculateStdDev(arr.map(h=>h.wave_height));
  const seaTemp = calculateMean(arr.map(h=>h.sea_surface_temperature));
  document.getElementById("seabox").innerHTML = `
    <div class="box-title">üåä Mare</div>
    <div class="main">Altezza media onda: <b>${waveMean.toFixed(2)} m</b></div>
    <div class="desc">Temperatura mare: <b>${seaTemp.toFixed(1)} ¬∞C</b></div>
    <button class="detail-btn" onclick="toggleDetail('sea-detail')">Dettagli / Grafico</button>
    <div class="detail-section" id="sea-detail">
      <div class="chart-wrap"><canvas id="seachart"></canvas></div>
      <div><b>Hsig:</b> ${waveMean.toFixed(2)} m &nbsp; <b>Range:</b> ${waveRange.toFixed(2)} m &nbsp; <b>Dev Std:</b> ${waveStdDev.toFixed(2)} m</div>
    </div>
  `;
  setTimeout(()=>{
    const ctx=document.getElementById('seachart').getContext('2d');
    new Chart(ctx,{type:'line',data:{
      labels:arr.map(h=>h.time.slice(11,16)),datasets:[
        {label:'Onda (m)',data:arr.map(h=>h.wave_height),borderColor:'#41f8bd',backgroundColor:'rgba(34,255,170,0.10)',fill:true,tension:0.22,pointRadius:2,pointBackgroundColor:'#25A9FA'},
        {label:'Swell (m)',data:arr.map(h=>h.swell_height),borderColor:'#21D08A',backgroundColor:'rgba(34,255,170,0.06)',fill:true,tension:0.18,pointRadius:2,pointBackgroundColor:'#21D08A'}
      ]
    },options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:true}},scales:{y:{beginAtZero:true},x:{}}}});
  },100);
}
// ---- Render Pressione ----
function renderPress(){
  const d = DATA.days[0];
  const arr = d.hourly_pressures||[];
  const pressMean = calculateMean(arr);
  const pressTrendTxt = pressureTrend(arr);
  document.getElementById("pressbox").innerHTML = `
    <div class="box-title">üîΩ Pressione</div>
    <div class="main">Media oggi: <b>${pressMean.toFixed(1)} hPa</b></div>
    <div class="desc">Tendenza: ${pressTrendTxt}</div>
    <button class="detail-btn" onclick="toggleDetail('press-detail')">Dettagli / Grafico</button>
    <div class="detail-section" id="press-detail">
      <div class="chart-wrap"><canvas id="presschart"></canvas></div>
      <div><b>Max:</b> ${Math.max(...arr)} hPa &nbsp; <b>Min:</b> ${Math.min(...arr)} hPa</div>
    </div>
  `;
  setTimeout(()=>{
    const ctx=document.getElementById('presschart').getContext('2d');
    new Chart(ctx,{type:'line',data:{
      labels:d.hourly_labels, datasets:[{label:'Pressione (hPa)',data:arr,borderColor:'#ffd472',backgroundColor:'rgba(255,240,51,0.10)',fill:true,tension:0.22,pointRadius:1}]
    },options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:false},x:{}}}});
  },100);
}
// ---- Render giorni successivi ----
function renderMiniDays(){
  let html="";
  DATA.days.slice(0,7).forEach(d=>{
    html+=`
      <div class="mini-day">
        <div class="daylabel">${d.day_label} <span class="icon">${d.icon}</span></div>
        <div><span class="tmax">‚Üë ${d.temp_max}¬∞</span> <span class="tmin">‚Üì ${d.temp_min}¬∞</span></div>
        <div><span class="wind">üí® ${d.wind_max} km/h</span> <span class="rain">${rainIcon(d.precipitation||0)} ${d.precipitation||0}mm</span></div>
      </div>
    `;
  });
  document.getElementById("miniDaysBox").innerHTML=html;
}
// ---- Render Footer ----
function renderFooter(){
  document.getElementById("footer").innerHTML = `Powered by Open-Meteo ‚Ä¢ UI by micheledv74 ‚Ä¢ Ultimo agg.: <span id="updated_stamp">${DATA.updated_at}</span>`;
}
function renderAll(){
  renderWind();renderRain();renderSea();renderPress();renderMiniDays();renderFooter();
}
renderAll();
</script>
</body>
</html>
