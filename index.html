<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>Previsioni Procida - Meteo Giornaliero</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto&display=swap');
    html { box-sizing: border-box;}
    *,*:before,*:after { box-sizing: inherit; }
    body {
      font-family: 'Roboto', Arial, sans-serif;
      max-width: 950px;
      margin: 40px auto;
      background: linear-gradient(135deg, #26365a, #2a3a7f 85%, #3498db 97%);
      color: #f0f8ff;
      padding: 22px 12px 22px 12px;
      overflow-x: hidden;
      min-height: 100vh;
    }
    .header { font-family: 'Montserrat', sans-serif; font-size: 2.6rem; font-weight: 900; text-align: center; color: #cfe9ff; text-shadow: 1px 2px 15px #09172a; letter-spacing: 2px; user-select: none; margin-bottom: 35px; }
    .today-main {
      background: linear-gradient(120deg,#24335b90 60%,#25355a 100%);
      border-radius: 32px;
      box-shadow: 0 8px 38px #2b488c33;
      padding: 26px 20px 24px 20px;
      margin: 0 auto 34px auto;
      max-width: 870px;
      min-height: 210px;
      display: grid;
      grid-template-columns: 1.2fr 5fr;
      gap: 0 11px;
      align-items: center;
      position: relative;
    }
    .slot-icon { grid-column: 1/2; display: flex; align-items: center; justify-content: center; height: 150px; }
    .main-icon { font-size: 108px; filter: drop-shadow(0 5px 17px #0690d9cc); user-select: none; margin: 0; }
    .slots-info { grid-column: 2/3; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; align-items: start; width: 100%; gap: 0 10px;}
    .slot-meteo { display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-start; gap: 8px; min-width: 0;}
    .main-values { margin-bottom: 8px; margin-top: -8px;}
    .main-temp { font-family: 'Montserrat', sans-serif; font-size: 2.6rem; font-weight: 900; color: #fee044; letter-spacing: -2px; text-shadow: 0 4px 12px #ffe16754; margin-right: 12px; display: inline-block; }
    .main-temp-min { font-size: 2rem; color: #64c7fa; font-weight: 900; margin-left: 0px; text-shadow: 0 4px 10px #3affff33; display: inline-block; }
    .main-details { font-size: 1.16rem; font-weight: 500; color: #ddeffd; display: flex; align-items: center; margin: 2px 0 6px 0; gap: 8px; }
    .data-label { color: #ffeebb; font-weight: 700; min-width:50px;}
    .data-up { color: #ffd452; font-size:1.13em; margin-right:5px;}
    .data-down { color: #78dbfd; font-size:1.13em; margin-right:5px;}
    .data-wind { color: #abdefa; font-size:1.17em;}
    .rain-icon { font-size:1.13em;vertical-align:-3px;}
    .info-title { font-size: 1.07rem; color: #b4e6fd; font-weight: 800; margin-bottom: 5px; }
    .advice-row { grid-column: 1/5; width: 100%; display: flex; justify-content: center; align-items: center; margin-top: 20px; }
    .main-advice { background: rgba(44, 88, 235, 0.13); color: #54e2ff; font-family: 'Montserrat', sans-serif; font-size: 1.17rem; font-weight: 700; border-radius: 13px; padding: 10px 44px; box-shadow: 0 1px 10px #23293b22; text-align: center; letter-spacing: 0.03em; display: inline-block; min-width: 180px; max-width: 95vw; }
    .footer { margin-top: 25px; text-align: center; color: #cbefff; font-size: 17px; font-weight: 500; }
    .tabs { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; justify-content: center; }
    .tab { background: rgba(255,255,255,0.14); border: 2px solid #66bfff; padding: 13px 19px; border-radius: 12px; cursor: pointer; transition: background 0.2s; }
    .tab.active { background: #0580ff; color: #fff; border-bottom: 4px solid #32d3ff; font-weight: bold; }
    .tab .bigicon { font-size: 2em; }
    .tab:hover { background: #3498db; }
    .card { background: rgba(255,255,255,0.09); border-radius: 18px; padding: 22px 12px; margin-bottom: 19px; box-shadow: 0 3px 14px rgba(27,74,128,0.07);}
    .chart-title { font-size: 17px; font-weight: bold; margin-bottom: 2px; color: #acf;}
    .chart-container { width: 100%; max-width: 900px; margin: 0 auto 18px auto; display: flex; flex-direction: column;}
    .canvas-wrap { width: 100%; aspect-ratio: 16/7; max-width: 100%; display: block; overflow: hidden; border-radius: 15px; position: relative;}
    canvas { width: 100% !important; height: 100% !important; display: block; background: rgba(255,255,255,0.12); border-radius: 14px; box-shadow: 0 0 24px #2886d9bb; }
    .card-anim { animation: fadeIn 0.45s; }
    @keyframes fadeIn { from {opacity:0;transform:translateY(20px);} to {opacity:1;transform:translateY(0);} }
    @media (max-width:900px){
      body {max-width: 99vw;}
      .chart-container {padding: 0 1vw;}
    }
    /* MOBILE - layout top dedicato */
    @media (max-width: 700px) {
      .today-main {
        display: flex !important;
        flex-direction: column !important;
        padding: 6vw 2vw 0 2vw;
        min-height: unset;
        align-items: stretch;
        gap: 0;
      }
      .slot-icon { align-self: center; margin-bottom: 2vw; }
      .main-icon { font-size: 60px; }
      .slots-info {
        display: flex !important;
        flex-direction: column;
        gap: 0;
        width: 100%;
        margin: 0 auto;
      }
      .slot-meteo {
        border-radius: 7px;
        padding: 6px 2vw 10px 2vw;
        margin-bottom: 13px;
        background: rgba(43,81,143,0.14);
        box-shadow: none;
        font-size: 1.13em;
        align-items: flex-start;
      }
      .main-values {margin-bottom: 6px;}
      .info-title { font-size: 1.03rem; margin-bottom: 1px;}
      .main-advice { font-size: 0.96rem; padding: 6px 2vw;}
      .advice-row {margin-top: 10px;}
      .card, .card-anim {padding: 9px 2vw;}
      .chart-title {font-size: 1.03em;}
      .canvas-wrap { aspect-ratio: 11/9; min-height: 160px;}
      .footer {font-size: 15px;}
      .tabs {gap: 6px; margin-bottom: 13px;}
      .tab {padding: 7px 7px;font-size:0.95em;}
    }
    @media (max-width: 500px) {
      .canvas-wrap { aspect-ratio: 13/15; min-height: 95px;}
      .main-advice { font-size: 0.94rem;}
    }
    @media (orientation: landscape) and (max-width: 820px) {
      .chart-container { max-width: 98vw; }
      .canvas-wrap { aspect-ratio: 2/1;}
      canvas { min-height: 110px;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="header">PREVISIONI METEO - PROCIDA</div>
  <div id="maininfo" class="today-main"></div>
  <div id="tabbar" class="tabs"></div>
  <div class="chart-container" id="chartcontainer"></div>
  <div class="chart-container" id="windchartcontainer"></div>
  <div class="chart-container" id="rainchartcontainer"></div>
  <div class="chart-container" id="marinechartcontainer">
    <section class="card card-anim" role="region" aria-label="Grafico onde marine">
      <div class="chart-title">Condizioni Marine</div>
      <div class="canvas-wrap"><canvas id="marine-wave-chart"></canvas></div>
      <div id="marine-summary"></div>
      <div id="marine-alerts"></div>
    </section>
  </div>
  <div class="footer" id="footer"></div>

<script>
const DATA = {
  days: [{ day_label: "13/10", hourly_temps: [20,21,22], hourly_winds: [5,7,8], hourly_wind_directions: [180,200,210], hourly_precips: [0,0,0], hourly_pressures: [1017,1018,1016], hourly_labels:["08:00","12:00","16:00"], temp_max: 22, temp_min: 19, icon: "‚òÄÔ∏è", wind_max: 8, precipitation: 0 }],
  mergedHourly: [
    { time: "2025-10-13T08:00", wave_height: 0.2, swell_height: 0.18, swell_direction: 200, sea_surface_temperature: 21.5 },
    { time: "2025-10-13T12:00", wave_height: 0.25, swell_height: 0.22, swell_direction: 205, sea_surface_temperature: 21.6 },
    { time: "2025-10-13T16:00", wave_height: 0.3, swell_height: 0.25, swell_direction: 210, sea_surface_temperature: 21.7 }
  ],
  alerts: [],
  advice: "Condizioni marine buone.",
  updated_at: "13/10/2025 20:00",
};

const days = DATA.days;
const mergedHourly = DATA.mergedHourly || [];
const alerts = DATA.alerts || [];
const advice = DATA.advice || "";
const updated_at = DATA.updated_at;
let current = 0;

function rainIntensityIcon(valmm) {
  if(valmm < 0.1) return '';
  if(valmm < 0.5) return 'üíß';
  if(valmm < 1) return 'üíßüíß';
  if(valmm < 3) return 'üíßüíßüíß';
  if(valmm < 10) return 'üíßüíßüíßüíß';
  return 'üíßüíßüíßüíßüíß';
}
function windDescriptor(speed) {
  if(speed < 6) return "calmo";
  if(speed < 13) return "brezza";
  if(speed < 25) return "ventoso";
  return "molto forte";
}
function dailyAdvice(day) {
  if(parseFloat(day.precipitation) > 5.0) return "üóûÔ∏è Potrebbe piovere forte, porta un ombrello e valuta attivit√† al coperto.";
  if(parseFloat(day.temp_max) >= 34) return "üóûÔ∏è Giornata molto calda: resta idratato e cerca zone ombreggiate.";
  if(parseFloat(day.temp_max) - parseFloat(day.temp_min) > 15) return "üóûÔ∏è Attenzione: forti escursioni termiche oggi.";
  if(parseFloat(day.precipitation) > 0.2) return "üóûÔ∏è Possibile pioggia, attivit√† all'aperto da valutare.";
  if(parseFloat(day.temp_min) < 5) return "üóûÔ∏è Giornata fredda, copriti bene!";
  if(parseFloat(day.wind_max || 0) > 30) return "üóûÔ∏è Previsto vento molto forte, massima cautela!";
  return "üóûÔ∏è Giornata generalmente serena, goditela!";
}
function humanDirection(deg) {
  if(deg == null) return '--';
  const directions = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
  const ix = Math.round(deg / 22.5) % 16;
  return directions[ix];
}
function getTraditionalWindName(deg) {
  const names = [ "Tramontana", "Tramontana", "Grecale", "Grecale", "Levante", "Levante", "Scirocco", "Scirocco", "Ostro", "Ostro", "Libeccio", "Libeccio", "Ponente", "Ponente", "Maestrale", "Maestrale" ];
  const index = Math.round(deg / 22.5) % 16;
  return names[index];
}
function calculateHsig(waves) {
  if(!waves || !waves.length) return 0;
  const sorted = [...waves].sort((a,b) => b - a);
  const topThird = sorted.slice(0, Math.ceil(waves.length / 3));
  return topThird.reduce((a,b) => a + b, 0) / topThird.length;
}
function getDouglasScale(hsig) {
  if(hsig < 0.1) return "0 - Calmo";
  if(hsig < 0.5) return "1 - Quasi calmo";
  if(hsig < 1.25) return "2 - Poco mosso";
  if(hsig < 2.5) return "3 - Mosso";
  if(hsig < 4) return "4 - Molto mosso";
  if(hsig < 6) return "5 - Agitato";
  if(hsig < 9) return "6 - Molto agitato";
  return "7+ - Tempestoso";
}
function detectRogueWaveRisk(waves, hsig) {
  if(!waves.length || hsig === 0) return false;
  const maxWave = Math.max(...waves);
  return maxWave > (hsig * 2.2);
}
function calculateMean(values) {
  if(!values.length) return 0;
  return values.reduce((a,b) => a + b, 0) / values.length;
}
function calculateRange(values) {
  if(!values.length) return 0;
  return Math.max(...values) - Math.min(...values);
}
function calculateStdDev(values) {
  if(!values.length) return 0;
  const mean = calculateMean(values);
  const variance = values.reduce((a,b) => a + (b-mean)**2, 0) / values.length;
  return Math.sqrt(variance);
}
function marineRiskAdvice(hsig, rogueRisk, windSpeed) {
  let advice = [];
  if(hsig < 0.5) advice.push("Mare calmo, condizioni favorevoli.");
  else if(hsig < 2.5) advice.push("Mare mosso, cautela per attivit√† diportistiche.");
  else if(hsig < 4) advice.push("Mare molto mosso, attenzione alla navigazione.");
  else advice.push("Mare agitato o tempestoso, evitare uscita in mare.");
  if(rogueRisk) advice.push("‚ö†Ô∏è Presenza di onde anomale! Massima prudenza.");
  if(windSpeed >= 25) advice.push("‚ö†Ô∏è Vento forte in arrivo, precauzioni raccomandate.");
  return advice.join(" ");
}
function getMarineDataForDay(){
  const day = days && days[current];
  if(!day || !mergedHourly.length) return [];
  let someTime = mergedHourly[0].time;
  const pref_year = someTime.slice(0,4);
  const [dd,mm] = day.day_label.split('/');
  const dateString = `${pref_year}-${mm.padStart(2,'0')}-${dd.padStart(2,'0')}`;
  return mergedHourly.filter(h => h.time && h.time.startsWith(dateString));
}
function renderMainToday(){
  const d = days && days[current];
  if(!d) return;
  let tempData = d.hourly_temps || [];
  let windData = d.hourly_winds || [];
  let windDirData = d.hourly_wind_directions || [];
  let precipData = d.hourly_precips || [];
  let pressureData = d.hourly_pressures || [];
  let timeData = d.hourly_labels || [];
  const tmax = Math.max(...tempData);
  const tmin = Math.min(...tempData);
  const imax = tempData.indexOf(tmax);
  const imin = tempData.indexOf(tmin);
  const tmax_hh = imax !== -1 && timeData[imax] ? timeData[imax] : "--:--";
  const tmin_hh = imin !== -1 && timeData[imin] ? timeData[imin] : "--:--";
  const ptotal = precipData.reduce((a,b)=>a+b,0);
  const rainIcon = rainIntensityIcon(ptotal);
  const windmax = Math.max(...windData);
  const iwmax = windData.indexOf(windmax);
  const windmax_hh = iwmax !== -1 && timeData[iwmax] ? timeData[iwmax]: "--:--";
  const windlast = windData[windData.length-1];
  const windDirectionAvg = windDirData.length ? averageWindDirection(windDirData) : null;
  const windName = windDirectionAvg !== null ? getTraditionalWindName(windDirectionAvg) : '--';
  let pressureAvg = null;
  if(pressureData.length){
    pressureAvg = calculateMean(pressureData);
  }
  let pressureAdvice = "";
  if(pressureAvg !== null){
    if(pressureAvg < 1010) pressureAdvice = "‚ö†Ô∏è Bassa pressione in arrivo, condizioni instabili.";
    else if(pressureAvg > 1020) pressureAdvice = "üìà Alta pressione, tempo stabile previsto.";
    else pressureAdvice = "Pressione atmosferica nella media.";
  }
  const advice = dailyAdvice({...d, wind_max: windmax});
  document.getElementById('maininfo').innerHTML = `
    <div class="slot-icon"><span class="main-icon">${d.icon}</span></div>
    <div class="slots-info">
      <div class="slot-meteo">
        <div class="main-values">
          <span class="main-temp">${tmax.toFixed(1)}¬∞</span>
          <span class="main-temp-min">${tmin.toFixed(1)}¬∞</span>
        </div>
        <div class="main-details"><span class="rain-icon">üåßÔ∏è</span> Precipitazioni: ${ptotal.toFixed(1)} mm ${rainIcon}</div>
      </div>
      <div class="slot-meteo">
        <div class="info-title">Temperature/Orari</div>
        <div class="data-up">‚ÜóÔ∏è max: <b>${tmax.toFixed(1)}¬∞C</b> alle ${tmax_hh} </div>
        <div class="data-down">‚ÜòÔ∏è min: <b>${tmin.toFixed(1)}¬∞C</b> alle ${tmin_hh}</div>
      </div>
      <div class="slot-meteo">
        <div class="info-title">Vento</div>
        <div class="data-wind">üí® max: <b>${windmax.toFixed(1)} km/h</b> (${windName} - ${windDirectionAvg !== null ? windDirectionAvg.toFixed(0) : '--'}¬∞) alle ${windmax_hh}</div>
        <div class="data-wind">üí® ora: <b>${windlast.toFixed(1)} km/h</b></div>
      </div>
      <div class="slot-meteo">
        <div class="info-title">Pressione atmosferica</div>
        <div class="data-label">${pressureAvg !== null ? pressureAvg.toFixed(1) + " hPa" : "--"}</div>
        <div class="data-label" style="color:#ffcc66;">${pressureAdvice}</div>
      </div>
      <div class="advice-row"><span class="main-advice">${advice}</span></div>
    </div>
  `;
}
function renderMarine(){
  const canvasWrap = document.querySelector('#marinechartcontainer .canvas-wrap');
  canvasWrap.innerHTML = '<canvas id="marine-wave-chart"></canvas>';
  const marineForDay = getMarineDataForDay();
  if (marineForDay.length === 0){
    document.getElementById('marine-summary').textContent = "Dati marine non disponibili.";
    document.getElementById('marine-alerts').textContent = "";
    if(marineChart) { marineChart.destroy(); marineChart = null; }
    return;
  }
  const hsig = calculateHsig(marineForDay.map(h => h.wave_height));
  const douglasScale = getDouglasScale(hsig);
  const rogueRisk = detectRogueWaveRisk(marineForDay.map(h => h.wave_height), hsig);
  const waveMean = calculateMean(marineForDay.map(h => h.wave_height));
  const waveRange = calculateRange(marineForDay.map(h => h.wave_height));
  const waveStdDev = calculateStdDev(marineForDay.map(h => h.wave_height));
  const windMax = days[current]?.wind_max || 0;

  const seaTemps = marineForDay
     .map(h => h.sea_surface_temperature)
     .filter(x => x !== null && x !== undefined);
  const seaTempAvg = calculateMean(seaTemps);

  const adviceText = marineRiskAdvice(hsig, rogueRisk, windMax);
  const divSummary = document.getElementById('marine-summary');
  let h = marineForDay[0];
  divSummary.innerHTML = `
    <div class="marine-summary-blocks">
      <div>
        <div class="marine-summary-label">H<sub>sig</sub></div>
        <div class="marine-summary-val">${hsig.toFixed(2)} m</div>
      </div>
      <div>
        <div class="marine-summary-label">Scala Douglas</div>
        <div class="marine-summary-val">${douglasScale}</div>
      </div>
      <div>
        <div class="marine-summary-label">Media onda / Range / Deviazione</div>
        <div class="marine-summary-val">${waveMean.toFixed(2)} m / ${waveRange.toFixed(2)} m / ${waveStdDev.toFixed(3)} m</div>
      </div>
      <div>
        <div class="marine-summary-label">Direzione Swell</div>
        <div class="marine-summary-val">${humanDirection(h.swell_direction)} (${h.swell_direction ?? '-' })¬∞</div>
      </div>
      ${seaTempAvg !== null && !isNaN(seaTempAvg) ? `
      <div>
        <div class="marine-summary-label">Temp. acqua</div>
        <div class="marine-summary-tempe">${seaTempAvg.toFixed(1)} ¬∞C</div>
      </div>`: ''}
    </div>
    <div style="margin-bottom: 2px;">
      <span class="marine-summary-label">Altezza onda:</span>
      <span class="marine-summary-val">${(h.wave_height ?? 0).toFixed(2)} m</span>
      <span class="marine-summary-label">Altezza swell:</span>
      <span class="marine-summary-val">${(h.swell_height ?? 0).toFixed(2)} m</span>
    </div>
    <div class="marine-summary-advice">${adviceText}</div>
  `;
  document.getElementById('marine-alerts').textContent = '';
  const ctx = document.getElementById('marine-wave-chart').getContext('2d');
  const labels = marineForDay.map(h => h.time && h.time.length > 11 ? h.time.slice(11, 16) : h.time || "");
  const waves = marineForDay.map(h => h.wave_height);
  const swells = marineForDay.map(h => h.swell_height);
  if (marineChart) marineChart.destroy();
  marineChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Altezza onda (m)',
        borderColor: '#25A9FA',
        backgroundColor: 'rgba(30,144,255,0.13)',
        fill: true,
        data: waves,
        borderWidth: 4,
        pointRadius: 3,
        pointBackgroundColor: '#25A9FA',
        tension: 0.28
      }, {
        label: 'Altezza swell (m)',
        borderColor: '#21D08A',
        backgroundColor: 'rgba(34,255,170,0.10)',
        fill: true,
        data: swells,
        borderWidth: 4,
        pointRadius: 3,
        pointBackgroundColor: '#21D08A',
        tension: 0.28
      }]
    },
    options: {
      responsive: false,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          labels: {
            color: '#cce6ff',
            font: { size: 22, family: "'Montserrat', 'Roboto', Arial, sans-serif", weight: 'bold' },
            boxWidth: 38,
            boxHeight: 7,
            usePointStyle: true,
            padding: 18
          }
        },
        tooltip: { mode: 'index', intersect: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'm', color: '#bae7fd', font: { size: 16, weight: 'bold' } },
          ticks: { color: '#bfe8ff', font: { size: 18, weight: 'bold' }, stepSize: 0.02, maxTicksLimit: 7 }
        },
        x: {
          title: { display: false },
          ticks: { color: '#ddddff', font: { size: 18, family: "'Roboto', Arial", weight: 'bold' }, maxTicksLimit: 8, padding: 8 }
        }
      },
      layout: { padding: { top: 10, bottom: 11, left: 8, right: 12 } }
    }
  });
}

function renderTabs() {
  const tabbar = document.getElementById('tabbar');
  tabbar.innerHTML = '';
  if (!days) return;
  days.forEach((d, idx) => {
    const el = document.createElement('div');
    el.className = idx === current ? 'tab active' : 'tab';
    el.role = 'tab';
    el.id = `tab-${idx}`;
    el.tabIndex = idx === current ? 0 : -1;
    el.setAttribute('aria-selected', idx === current ? 'true' : 'false');
    el.setAttribute('aria-controls', `tabpanel-${idx}`);
    el.setAttribute('aria-label', `Previsioni giorno ${d.day_label}`);
    el.innerHTML = `<div class="bigicon" aria-hidden="true">${d.icon}</div>
        <div>${d.day_label}</div>
        <div><span class="tempmax">${d.temp_max}¬∞</span> <span class="tempmin">${d.temp_min}¬∞</span></div>`;
    el.onclick = () => { switchTab(idx); };
    el.onkeydown = (e) => {
      if(e.key === 'ArrowRight') switchTab((idx + 1) % days.length);
      else if(e.key === 'ArrowLeft') switchTab((idx - 1 + days.length) % days.length);
      else if(e.key === "Enter" || e.key === " ") switchTab(idx);
    };
    tabbar.appendChild(el);
  });
}

function switchTab(idx) {
  current = idx;
  renderAll();
  const tab = document.getElementById(`tab-${idx}`);
  if(tab) tab.focus();
}

let tempChart = null, windChart = null, rainChart = null;

function renderCharts() {
  const d = days && days[current];
  if (!d) return;
  document.getElementById('chartcontainer').innerHTML =
    `<section class="card card-anim" role="region" aria-label="Grafico temperatura oraria">
      <div class="chart-title">Temperatura oraria (¬∞C)</div>
      <div class="canvas-wrap"><canvas id="chart"></canvas></div>
      <div id="chartdesc" hidden>Grafico temperatura in gradi Celsius per ogni ora del giorno.</div>
    </section>`;
  const ctx1 = document.getElementById('chart').getContext('2d');
  if (tempChart) tempChart.destroy();
  tempChart = new Chart(ctx1, {
    type: 'line',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Temperatura (¬∞C)',
        data: d.hourly_temps,
        borderColor: 'rgba(255,214,91,1)',
        backgroundColor: 'rgba(255,214,91,0.10)',
        fill: true,
        tension: 0.3,
        pointRadius: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display:false }, tooltip: {mode:'index',intersect:false} },
      scales: {
        y: { beginAtZero: false, title: { display: true, text: '¬∞C', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
      }
    }
  });

  document.getElementById('windchartcontainer').innerHTML =
    `<section class="card card-anim" role="region" aria-label="Grafico vento orario">
      <div class="chart-title">Vento orario (km/h)</div>
      <div class="canvas-wrap"><canvas id="windchart"></canvas></div>
      <div id="winddesc" hidden>Grafico velocit√† del vento in chilometri orari per ogni ora del giorno.</div>
    </section>`;
  const ctx2 = document.getElementById('windchart').getContext('2d');
  if (windChart) windChart.destroy();
  windChart = new Chart(ctx2, {
    type: 'line',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Vento (km/h)',
        data: d.hourly_winds,
        borderColor: 'rgba(90,184,255,1)',
        backgroundColor: 'rgba(90,184,255,0.18)',
        fill: true,
        tension: 0.3,
        pointRadius: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display:false}, tooltip: {mode:'index',intersect:false} },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'km/h', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
      }
    }
  });

  document.getElementById('rainchartcontainer').innerHTML =
    `<section class="card card-anim" role="region" aria-label="Grafico precipitazioni orarie">
      <div class="chart-title">Precipitazioni orarie (mm)</div>
      <div class="canvas-wrap"><canvas id="rainchart"></canvas></div>
      <div id="raindesc" hidden>Grafico precipitazioni in millimetri per ogni ora del giorno.</div>
    </section>`;
  const ctx3 = document.getElementById('rainchart').getContext('2d');
  if (rainChart) rainChart.destroy();
  rainChart = new Chart(ctx3, {
    type: 'bar',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Precipitazioni (mm)',
        data: d.hourly_precips,
        backgroundColor: 'rgba(30,180,255,0.73)',
        borderColor: 'rgba(13,80,180,1)',
        borderWidth: 1,
        minBarLength: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display:false}, tooltip: {mode:'index',intersect:false} },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'mm', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
      }
    }
  });
}
function renderAll(){
  if(!days || days.length === 0){
    document.body.innerHTML = "<h2 style='color:#fff'>Nessun dato meteo disponibile!</h2>";
    return;
  }
  renderMainToday();
  renderTabs();
  renderCharts();
  renderMarine();
  document.getElementById('footer').innerHTML = `Powered by Open-Meteo ‚Ä¢ UI by micheledv74 ‚Ä¢ Ultimo agg.: <span id="updated_stamp">${updated_at}</span>`;
}
renderAll();
</script>
</body>
</html>
