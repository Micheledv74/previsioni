<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Previsioni Procida - Meteo Giornaliero</title>
  <style>
    body { font-family: Arial, max-width: 920px; margin: auto; background: linear-gradient(#182948,#374058); color: #fff; padding: 30px;}
    .tabs { display: flex; gap: 8px; margin-bottom: 24px; }
    .tab { background: rgba(255,255,255,0.12); border: 1px solid #333b4a; padding: 16px 28px; border-radius: 8px; cursor: pointer;}
    .tab.active { background: #0580ff; color: #fff; border-bottom: 3px solid #fff;}
    .card { background: rgba(255,255,255,0.08); border-radius:16px; padding:24px; margin-bottom:18px; }
    .bigicon { font-size:68px; }
    .tempmax { font-size:32px; font-weight:bold; }
    .tempmin { font-size:20px; color:#9bdfff; }
    .details { font-size:17px; color:#b2b9cd;}
    .underline { border-bottom: 1.5px solid #224;}
    canvas { background: rgba(255,255,255,0.12); border-radius:8px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div id="tabbar" class="tabs"></div>
<div id="daycard"></div>

<!-- DIV per grafici, già posizionati -->
<div id="chartcontainer"></div>
<div id="windchartcontainer"></div>
<div id="rainchartcontainer"></div>

<script>
// Dati dal backend fusion n8n
const days = [{"day_label":"10/10","temp_max":"21.5","temp_min":"19.3","precipitation":"0.00","icon":"⛅","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[20.5,20.4,20.1,19.9,19.7,19.7,19.5,19.4,19.3,19.3,19.6,19.9,20.2,20.6,20.9,21.2,21.3,21.4,21.5,21.3,21,21.2,21.2,21.1],"hourly_winds":[5.5,6.5,7.2,7.7,6.8,7.6,6.3,5.9,5.8,6.8,5.3,4.7,4.7,4,2.8,4.4,5,4.1,4.9,6.7,9.8,8.9,9.4,7.6],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"11/10","temp_max":"23.7","temp_min":"20.0","precipitation":"0.00","icon":"☀️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[21.1,21,20.8,20.4,20.2,20.1,20.2,20.1,20,20.1,20.5,21.1,21.7,22.5,23,23.5,23.7,23.6,23.2,22.4,22,21.2,20.7,20.2],"hourly_winds":[7.4,5.6,6.4,8,7.2,8.3,8.7,9.2,9.9,8.8,10,11,10.8,11.3,8.9,6.5,5.8,5,6.4,8.5,9.4,8.9,9.3,12.1],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"12/10","temp_max":"21.2","temp_min":"18.9","precipitation":"0.00","icon":"⛅","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.9,19.9,19.7,19.5,19.3,19.1,19,18.9,18.9,19.1,19.4,19.8,20.3,20.8,21,21.1,21.2,21.2,20.8,20.6,20.5,20.6,20.7,20.6],"hourly_winds":[13.1,14,13,12,12,12,11.5,11.2,11,9.8,9.7,8.9,7.2,4,3.2,5.5,7.7,8.2,8.7,8.4,8.5,7.4,5.2,3.6],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"13/10","temp_max":"20.9","temp_min":"19.1","precipitation":"0.00","icon":"☀️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[20.4,20.1,19.9,19.7,19.6,19.4,19.3,19.2,19.1,19.2,19.3,19.5,19.8,20.1,20.3,20.6,20.8,20.9,20.8,20.6,20.4,20.3,20.2,20.1],"hourly_winds":[2.6,2.6,3,3.3,3.3,3.3,3.8,3.9,4.2,4.6,4.5,4,2.7,2.5,4,5.9,8.2,9.7,9.4,8.7,7.4,5.6,4.5,4.2],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"14/10","temp_max":"20.5","temp_min":"18.8","precipitation":"0.00","icon":"☀️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.9,19.7,19.5,19.4,19.2,19.1,18.9,18.8,18.8,18.9,19.2,19.5,19.8,20.1,20.3,20.4,20.4,20.3,20.3,20.3,20.3,20.4,20.5,20.5],"hourly_winds":[3.6,2.9,3.3,3.6,4.5,5.2,5.8,6.4,6.6,7,7.3,6.9,5.4,4.1,4.8,6.1,6.9,6.6,3.3,1.4,5.1,8.2,8.6,10.5],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"15/10","temp_max":"20.5","temp_min":"17.1","precipitation":"33.00","icon":"🌧️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[20.5,20.5,20.3,19.5,18.4,17.6,17.2,17.2,17.1,17.1,17.1,17.2,17.6,18.1,18.5,18.8,19,19.1,19.1,19,18.9,18.8,18.7,18.6],"hourly_winds":[11.9,13.1,15.2,18.7,22.7,25.6,26.1,25.7,25.4,25.9,26.7,27.4,26.9,26,24.9,23.3,21,19.2,17.3,16.9,17.4,18.3,19.5,20.6],"hourly_precips":[0,0,0,1.5,1.5,1.5,2.1,2.1,2.1,4.1,4.1,4.1,1.4,1.4,1.4,0.7,0.7,0.7,0.3,0.3,0.3,0.9,0.9,0.9]},{"day_label":"16/10","temp_max":"20.7","temp_min":"18.6","precipitation":"44.40","icon":"🌧️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[18.6,18.7,18.9,19.3,19.8,20.3,20.5,20.6,20.7,20.7,20.7,20.6,20.6,20.5,20.4,20.2,20,19.8,19.6,19.5,19.5,19.5,19.5,19.6],"hourly_winds":[23.5,26.8,25.6,18,22.3,32.3,32.4,26.5,21.9,20.5,20.4,19.6,18.4,17.3,16.6,15.5,14.4,13.4,11.9,10.5,9.1,8,7.3,7.4],"hourly_precips":[3.5,3.5,3.5,5.5,5.5,5.5,1.5,1.5,1.5,0.8,0.8,0.8,0.5,0.5,0.5,1.2,1.2,1.2,1.5,1.5,1.5,0.3,0.3,0.3]}];
let current = 0;

function renderTabs() {
  const tabbar = document.getElementById('tabbar');
  tabbar.innerHTML = '';
  days.forEach((d, idx) => {
    const el = document.createElement('div');
    el.className = idx === current ? 'tab active' : 'tab';
    el.innerHTML = `<div class="bigicon">${d.icon}</div>
      <div>${d.day_label}</div>
      <div><span class="tempmax">${d.temp_max}°</span> <span class="tempmin">${d.temp_min}°</span></div>`;
    el.onclick = () => { current = idx; renderAll(); };
    tabbar.appendChild(el);
  });
}

function renderCard() {
  const d = days[current];
  document.getElementById('daycard').innerHTML = `<div class="card underline">
    <div style="display:flex;align-items:center;">
      <div class="bigicon">${d.icon}</div>
      <div style="margin-left:20px;">
        <div class="tempmax">${d.temp_max}°C <span class="tempmin">${d.temp_min}°C</span></div>
        <div class="details">Precipitazioni: ${d.precipitation} mm<br>
        Aggiornamento: 10/10/2025, 00:05:18</div>
      </div>
    </div>
  </div>`;
}

let tempChart = null, windChart = null, rainChart = null;
function renderCharts() {
  const d = days[current];

  // Temperatura
  document.getElementById('chartcontainer').innerHTML =
    `<div class="card"><canvas id="chart" width="775" height="240"></canvas></div>`;
  const ctx1 = document.getElementById('chart').getContext('2d');
  if (tempChart) tempChart.destroy();
  tempChart = new Chart(ctx1, {
    type: 'line',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Temperatura (°C)',
        data: d.hourly_temps,
        borderColor: 'rgba(255,214,91,1)',
        backgroundColor: 'rgba(255,214,91,0.15)',
        fill: true,
        tension: 0.3,
        pointRadius: 2
      }]
    },
    options: {
      plugins: { legend: { display:true, labels: { color:'#fff', font: {weight:'bold', size:16} } }},
      scales: {
        y: { beginAtZero: false, title: { display: true, text: '°C', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color:'#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:16}, maxRotation:0, minRotation:0 } }
      }
    }
  });

  // Vento
  document.getElementById('windchartcontainer').innerHTML =
    `<div class="card"><canvas id="windchart" width="775" height="240"></canvas></div>`;
  const ctx2 = document.getElementById('windchart').getContext('2d');
  if (windChart) windChart.destroy();
  windChart = new Chart(ctx2, {
    type: 'line',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Vento (km/h)',
        data: d.hourly_winds,
        borderColor: 'rgba(148,210,255,1)',
        backgroundColor: 'rgba(148,210,255,0.18)',
        fill: true,
        tension: 0.3,
        pointRadius: 2
      }]
    },
    options: {
      plugins: { legend: { display:true, labels: { color:'#fff', font: {weight:'bold', size:16} } }},
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'km/h', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:16}, maxRotation:0, minRotation:0 } }
      }
    }
  });

  // Pioggia
  document.getElementById('rainchartcontainer').innerHTML =
    `<div class="card"><canvas id="rainchart" width="775" height="160"></canvas></div>`;
  const ctx3 = document.getElementById('rainchart').getContext('2d');
  if (rainChart) rainChart.destroy();
  rainChart = new Chart(ctx3, {
    type: 'bar',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Precipitazioni (mm)',
        data: d.hourly_precips,
        backgroundColor: 'rgba(30,180,255,0.75)',
        borderColor: 'rgba(13,80,180,1)',
        borderWidth: 1,
        minBarLength: 1
      }]
    },
    options: {
      plugins: { legend: { display:true, labels: { color:'#fff', font: {weight:'bold', size:16} } }},
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'mm', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:16}, maxRotation:0, minRotation:0 } }
      }
    }
  });
}

function renderAll() {
  if (!days || days.length === 0) {
    document.body.innerHTML = "<h2 style='color:#fff'>Nessun dato meteo disponibile!</h2>";
    return;
  }
  renderTabs();
  renderCard();
  renderCharts();
}
renderAll();
</script>

</body>
</html>
