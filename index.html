<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#012549">
  <meta name="description" content="Previsioni meteo dettagliate per Procida - Analisi AI multi-fonte">
  <title>Meteo Procida - Previsioni 7 Giorni</title>
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(180deg, #012549 0%, #003d6b 100%);
      color: #fff;
      margin: 0; padding: 0;
    }
    .container {
      padding: 32px 10vw 0 10vw;
      max-width: 860px;
      margin: auto;
    }
    .ai-summary {
      margin: 24px 0 10px 0;
      color: #fff9ab;
      font-weight: bold;
      font-size: 1.12em;
    }
    .ai-advice {
      margin: 0 0 18px 0;
      padding-left: 20px;
      color: #e0e0e0;
    }
    .ai-advice li {
      margin-bottom: 5px;
      line-height: 1.3;
    }
    .ai-alerts {
      margin: 10px 0 24px 0;
    }
    .ai-alert {
      background: #fbf068;
      color: #222;
      padding: 10px 14px;
      border-radius: 9px;
      margin-bottom: 9px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .ai-alert button {
      background: #08a5e8;
      border: none;
      color: #fff;
      font-size: 0.97em;
      padding: 4px 13px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .ai-alert button:hover {
      background: #025880;
    }
    .error-box {
      background: #ff5e2f;
      color: #fff;
      padding: 18px;
      border-radius: 10px;
      margin: 40px 0;
      font-size: 1.15em;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container" id="main-box">
    <!-- I contenuti verranno riempiti via JavaScript -->
  </div>
  <script>
    // Simulazione fetch: qui sotto devi inserire direttamente il tuo oggetto weatherData **completo**
    // Sostituisci il valore di weatherData con quello prodotto da n8n (inclusa .ai)

    const weatherData = window.weatherData || /* Inserisci qui i tuoi dati weatherData come oggetto JS */

    // Fallback per demo
    {
      location: "Procida",
      ai: {
        summary: "Allerta meteo: Piogge intense e venti forti in arrivo. Attenzione fino al primo pomeriggio.",
        advice: [
          "Evita spostamenti non indispensabili, soprattutto la mattina.",
          "Fissa o ripara oggetti all‚Äôaperto: le raffiche superano i 60 km/h.",
          "Consulta spesso la dashboard/meteo per cambiamenti repentini."
        ],
        alerts: [
          "Vento forte: raffiche fino a 62 km/h. Massima prudenza.",
          "Situazione radar: Pioggia intensa in arrivo tra 8 minuti.  [https://www.rainviewer.com](https://www.rainviewer.com)"
        ]
      }
    };

    // --- SEZIONE RENDERING AI ---
    function renderAISummaryAdviceAlerts(aiBlock) {
      if (!aiBlock) return '';
      const summary = aiBlock.summary || '';
      const adviceArr = Array.isArray(aiBlock.advice) ? aiBlock.advice : [];
      const alertsArr = Array.isArray(aiBlock.alerts) ? aiBlock.alerts : [];
      let html = '';
      if (summary) {
        html += `<div class="ai-summary">${summary}</div>`;
      }
      if (adviceArr.length) {
        html += `<ul class="ai-advice">`;
        adviceArr.forEach(c => html += `<li>${c}</li>`);
        html += `</ul>`;
      }
      if (alertsArr.length) {
        html += `<div class="ai-alerts">`;
        alertsArr.forEach(a => {
          const radarMatch = a.match(/\[(https[^\]]+)\]/);
          let txt = a.replace(/\[https[^\]]+\]/, "").trim();
          let link = radarMatch ? radarMatch[1] : null;
          html += `<div class="ai-alert">${txt}${link ? ` <button onclick="window.open('${link}')">Radar</button>` : ""}</div>`;
        });
        html += `</div>`;
      }
      return html;
    }

    // --- SEZIONE MAIN RENDER ---
    function renderAll() {
      let html = '';
      // --- Errore caricamento dati ---
      if (!weatherData || Object.keys(weatherData).length === 0) {
        html += `<div class="error-box">Errore caricamento dati meteo.<br>Verifica la pipeline n8n e riprova.</div>`;
        document.getElementById("main-box").innerHTML = html;
        return;
      }

      html += `<h1>üå§Ô∏è Meteo ${weatherData.location || ""} - Analisi AI</h1>`;

      // SEZIONE AI AGENT
      html += renderAISummaryAdviceAlerts(weatherData.ai);

      // Puoi aggiungere qui altre sezioni meteo classiche

      document.getElementById("main-box").innerHTML = html;
    }

    renderAll();
  </script>
</body>
</html>
