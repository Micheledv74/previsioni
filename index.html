<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Previsioni Procida - Meteo Giornaliero</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto&display=swap');
    body {
      font-family: 'Roboto', Arial, sans-serif;
      max-width: 950px;
      margin: 40px auto;
      background: linear-gradient(135deg, #26365a, #2a3a7f 85%, #3498db 97%);
      color: #f0f8ff;
      padding: 22px 12px 22px 12px;
      overflow-x: hidden;
    }
    .header {
      font-family: 'Montserrat', sans-serif;
      font-size: 2.6rem;
      font-weight: 900;
      text-align: center;
      color: #cfe9ff;
      text-shadow: 1px 2px 15px #09172a;
      letter-spacing: 2px;
      user-select: none;
      margin-bottom: 35px;
    }
    .today-main {
      background: linear-gradient(120deg,#24335b90 60%,#25355a 100%);
      border-radius: 32px;
      box-shadow: 0 8px 38px #2b488c33;
      padding: 36px 32px 34px 32px;
      margin: 0 auto 34px auto;
      max-width: 820px;
      min-height: 210px;
      display: grid;
      grid-template-columns: 1fr 3fr;
      gap: 0;
      align-items: center;
      position: relative;
    }
    .slot-icon {
      grid-column: 1/2;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 160px;
    }
    .main-icon {
      font-size: 108px;
      filter: drop-shadow(0 5px 17px #0690d9cc);
      user-select: none;
      margin: 0;
    }
    .slots-info {
      grid-column: 2/3;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      align-items: start;
      width: 100%;
      gap: 0 18px;
    }
    .slot-meteo {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 9px;
    }
    .main-values {
      margin-bottom: 8px;
      margin-top: -8px;
    }
    .main-temp {
      font-family: 'Montserrat', sans-serif;
      font-size: 2.6rem;
      font-weight: 900;
      color: #fee044;
      letter-spacing: -2px;
      text-shadow: 0 4px 12px #ffe16754;
      margin-right: 12px;
      display: inline-block;
    }
    .main-temp-min {
      font-size: 2rem;
      color: #64c7fa;
      font-weight: 900;
      margin-left: 0px;
      text-shadow: 0 4px 10px #3affff33;
      display: inline-block;
    }
    .main-details {
      font-size: 1.1rem;
      font-weight: 600;
      color: #ddeffd;
      display: flex;
      align-items: center;
      margin: 2px 0 6px 0;
      gap: 8px;
    }
    .data-label { color: #b3cfff; font-weight: 700; min-width:52px;}
    .data-up { color: #ffd452; font-size:1.13em; margin-right:5px;}
    .data-down { color: #78dbfd; font-size:1.13em; margin-right:5px;}
    .data-wind { color: #abdefa; font-size:1.17em;}
    .data-windmax-time { color: #bde4fa; font-size:1em;}
    .rain-icon {font-size:1.15em;vertical-align:-3px;}
    .info-title { font-size: 1.08rem; color: #bad6ff; font-weight:800; margin-bottom:5px;}
    .advice-row {
      grid-column: 1/4;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }
    .main-advice {
      background: rgba(44, 88, 235, 0.13);
      color: #54e2ff;
      font-family: 'Montserrat', sans-serif;
      font-size: 1.17rem;
      font-weight: 700;
      border-radius: 13px;
      padding: 10px 44px;
      box-shadow: 0 1px 10px #23293b22;
      text-align: center;
      letter-spacing: 0.03em;
      display:inline-block;
      min-width:220px;
      max-width:95vw;
    }
    .footer {
      margin-top: 25px;
      text-align: center;
      color: #cbefff;
      font-size: 17px;
      font-weight: 500;
    }
    .tabs { display: flex; gap: 14px; margin-bottom: 26px; flex-wrap: wrap; justify-content: center;}
    .tab { background: rgba(255,255,255,0.14); border: 2px solid #66bfff; padding: 14px 22px; border-radius: 12px; cursor: pointer; transition: background 0.2s;}
    .tab.active { background: #0580ff; color: #fff; border-bottom: 4px solid #32d3ff; font-weight: bold;}
    .tab .bigicon { font-size: 2em;}
    .tab:hover { background: #3498db;}
    .card { background: rgba(255,255,255,0.09); border-radius:18px; padding:26px 18px; margin-bottom:22px; box-shadow: 0 3px 14px rgba(27,74,128,0.07);}
    .chart-title { font-size:18px; font-weight:bold; margin-bottom: 4px; color:#acf;}
    .chart-container { width: 100%; max-width: 900px; margin: 0 auto 24px auto; display:flex; flex-direction:column;}
    .canvas-wrap { width: 100%; aspect-ratio: 16/6; max-width: 100%; display: block; overflow: hidden; border-radius: 15px; position: relative;}
    canvas { width: 100% !important; height: 100% !important; display: block; background: rgba(255,255,255,0.12); border-radius:14px; box-shadow: 0 0 24px #2886d9bb;}
    .card-anim { animation: fadeIn 0.45s;}
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }
    @media (max-width: 700px) {
      .today-main {grid-template-columns: 1fr; grid-template-rows: auto auto; min-height:120px; padding-inline:8px;}
      .slots-info {grid-template-columns: 1fr;}
      .main-icon { font-size:60px;}
      .slot-icon {height:90px;}
      .info-title {font-size:1rem;}
      .advice-row {margin-top:10px;}
      .main-advice { padding: 8px 12px;}
      .chart-container { max-width: 99vw; padding: 0 1vw;}
      .canvas-wrap { aspect-ratio: 1.3/1;}
    }
    @media (orientation: landscape) and (max-width: 820px) {
      .chart-container { max-width: 97vw; }
      .canvas-wrap { aspect-ratio: 2.1/1;}
      canvas { min-height: 110px;}
    }
    ::selection { background: #81baffb3;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="header">PREVISIONI METEO - PROCIDA</div>
<div id="maininfo" class="today-main"></div>
<div id="tabbar" class="tabs"></div>
<div class="chart-container" id="chartcontainer"></div>
<div class="chart-container" id="windchartcontainer"></div>
<div class="chart-container" id="rainchartcontainer"></div>
<div class="footer" id="footer">Powered by Open-Meteo ‚Ä¢ UI by micheledv74 ‚Ä¢ Ultimo agg.: <span id="updated_stamp"></span></div>
<script>
const DATA = {"days":[{"day_label":"12/10","temp_max":"21.3","temp_min":"19.5","precipitation":"0.00","icon":"‚õÖ","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[21.1,20.6,20.3,20.2,20.1,19.9,19.7,19.6,19.5,19.5,19.8,20.1,20.4,20.7,20.8,21,21.1,21.3,21.1,20.9,20.7,20.6,20.5,20.3],"hourly_winds":[8.1,9.2,9.7,11,12.3,12.3,11.2,10,9,8.1,5.9,4,3.1,4,4.5,4.6,5.4,6.6,6.3,5.4,5.2,5.1,3.5,2.5],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"13/10","temp_max":"21.0","temp_min":"19.3","precipitation":"0.00","icon":"‚òÄÔ∏è","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[20.2,20,19.9,19.7,19.5,19.4,19.4,19.3,19.3,19.3,19.5,19.8,20.1,20.3,20.5,20.7,21,21,20.7,20.6,20.6,20.6,20.4,20.3],"hourly_winds":[1.4,1.3,2.5,2.5,2.2,2.5,2.8,2.9,3.5,4,3.4,2.9,1.9,2.4,1.8,4,8,10.9,8.8,7,7,5,4.5,3.3],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"14/10","temp_max":"20.2","temp_min":"19.1","precipitation":"0.00","icon":"‚õÖ","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[20.1,19.9,19.7,19.5,19.4,19.3,19.3,19.2,19.1,19.2,19.3,19.5,19.7,19.9,20.1,20.2,20.1,20,20,20,19.9,19.8,19.7,19.6],"hourly_winds":[3.6,3.8,4.8,4,3.3,4.1,4.3,4,5.4,4.7,5.4,5.2,5.5,5.9,7.4,8,8.3,9.4,7.9,2.9,1.4,3.3,3.7,5.3],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"15/10","temp_max":"22.6","temp_min":"18.9","precipitation":"0.00","icon":"‚õÖ","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.4,19.4,19.4,19.3,19.2,19.1,19,19.1,19.2,19.3,19.6,20,20.7,21.5,22.1,22.5,22.6,22.4,21.8,20.9,20.1,19.6,19.2,18.9],"hourly_winds":[5.9,4.1,6.4,6.7,7,7.6,8.1,9.3,10.6,13,16.2,17.6,16.8,14.5,12.9,12.6,13.3,14.2,16.4,19.3,21.7,21.6,20.6,19.4],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"16/10","temp_max":"21.9","temp_min":"17.6","precipitation":"0.00","icon":"‚õÖ","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[18.7,18.5,18.3,18.1,18,17.9,17.7,17.6,17.7,18.1,18.6,19.3,20,20.9,21.5,21.8,21.9,21.7,21.2,20.4,19.9,19.1,19,18.9],"hourly_winds":[19.2,19,19.2,19.3,19.8,19.8,19.5,19.3,18.9,19.1,19.1,19.1,17.6,15.4,14.3,14.8,16.3,17.7,18.9,19.9,20.7,24.6,23.1,21.3],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"17/10","temp_max":"20.7","temp_min":"18.8","precipitation":"0.00","icon":"üå§Ô∏è","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[18.9,18.9,19,19,19.1,19.1,19,18.8,18.8,18.8,19,19.3,19.7,20.3,20.6,20.7,20.6,20.5,20.4,20.2,20.1,20,19.9,19.8],"hourly_winds":[20,18.4,17.3,16.5,15.8,15.1,15,15.1,15.1,14.8,14.3,13,10.9,8.1,5.4,3,5.7,8.7,9,8,6.9,6.1,5.2,4.5],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"day_label":"18/10","temp_max":"20.4","temp_min":"18.6","precipitation":"0.00","icon":"üå§Ô∏è","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.6,19.4,19.2,19,18.9,18.7,18.7,18.6,18.7,19,19.4,19.7,20,20.2,20.3,20.4,20.3,20.3,20.2,20,19.9,19.7,19.6,19.4],"hourly_winds":[3.6,3.1,2.6,2.7,4.4,6,7.3,8.6,9.3,9.2,8.9,8.9,8.6,8.3,8.6,9,9.3,9.2,8.3,7.2,6,5.7,5.7,6],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}],"updated_at":"12/10/2025, 03:05:26"};
const days = DATA.days;
const updated_at = DATA.updated_at;
let current = 0;

function rainIntensityIcon(valmm) {
  if (valmm < 0.1) return '';
  if (valmm < 0.5) return 'üíß';
  if (valmm < 1) return 'üíßüíß';
  if (valmm < 3) return 'üíßüíßüíß';
  if (valmm < 10) return 'üíßüíßüíßüíß';
  return 'üíßüíßüíßüíßüíß';
}
function windDescriptor(speed) {
  if (speed < 6) return "calmo";
  if (speed < 13) return "brezza";
  if (speed < 25) return "ventoso";
  return "molto forte";
}
function dailyAdvice(day) {
  if (parseFloat(day.precipitation) > 5.0) return "üóûÔ∏è Potrebbe piovere forte, porta un ombrello e valuta attivit√† al coperto.";
  if (parseFloat(day.temp_max) >= 34) return "üóûÔ∏è Giornata molto calda: resta idratato e cerca zone ombreggiate.";
  if (parseFloat(day.temp_max) - parseFloat(day.temp_min) > 15) return "üóûÔ∏è Attenzione: forti escursioni termiche oggi.";
  if (parseFloat(day.precipitation) > 0.2) return "üóûÔ∏è Possibile pioggia, attivit√† all'aperto da valutare.";
  if (parseFloat(day.temp_min) < 5) return "üóûÔ∏è Giornata fredda, copriti bene!";
  if (parseFloat(day.wind_max || 0) > 30) return "üóûÔ∏è Previsto vento molto forte, massima cautela!";
  return "üóûÔ∏è Giornata generalmente serena, goditela!";
}
function renderMainToday() {
  const d = days[current];
  let tempData = d.hourly_temps || [];
  let windData = d.hourly_winds || [];
  let precipData = d.hourly_precips || [];
  let timeData = d.hourly_labels || [];
  const tmax = Math.max(...tempData);
  const tmin = Math.min(...tempData);
  const imax = tempData.indexOf(tmax);
  const imin = tempData.indexOf(tmin);
  const tmax_hh = imax !== -1 && timeData[imax] ? timeData[imax] : "--:--";
  const tmin_hh = imin !== -1 && timeData[imin] ? timeData[imin] : "--:--";
  const ptotal = precipData.reduce((a,b)=>a+b,0);
  const rainIcon = rainIntensityIcon(ptotal);
  const windmax = Math.max(...windData);
  const iwmax = windData.indexOf(windmax);
  const windmax_hh = iwmax !== -1 && timeData[iwmax] ? timeData[iwmax] : "--:--";
  const windlast = windData[windData.length-1];
  const advice = dailyAdvice({...d, wind_max: windmax});
  document.getElementById('maininfo').innerHTML = `
    <div class="slot-icon">
      <span class="main-icon">${d.icon}</span>
    </div>
    <div class="slots-info">
      <div class="slot-meteo">
        <div class="main-values">
          <span class="main-temp">${tmax.toFixed(1)}¬∞</span>
          <span class="main-temp-min">${tmin.toFixed(1)}¬∞</span>
        </div>
        <div class="main-details"><span class="rain-icon">üåßÔ∏è</span> Precipitazioni: ${ptotal.toFixed(1)} mm ${rainIcon}</div>
      </div>
      <div class="slot-meteo">
        <div class="info-title">Temperature/Orari</div>
        <div class="data-up">‚ÜóÔ∏è max: <b>${tmax.toFixed(1)}¬∞C</b> alle ${tmax_hh} </div>
        <div class="data-down">‚ÜòÔ∏è min: <b>${tmin.toFixed(1)}¬∞C</b> alle ${tmin_hh}</div>
      </div>
      <div class="slot-meteo">
        <div class="info-title">Vento</div>
        <div class="data-wind">üí® max: <b>${windmax.toFixed(1)} km/h</b> (${windDescriptor(windmax)}) alle ${windmax_hh}</div>
        <div class="data-wind">üí® ora: <b>${windlast.toFixed(1)} km/h</b></div>
      </div>
      <div class="advice-row"><span class="main-advice">${advice}</span></div>
    </div>
  `;
}
function renderTabs() {
  const tabbar = document.getElementById('tabbar');
  tabbar.innerHTML = '';
  days.forEach((d, idx) => {
    const el = document.createElement('div');
    el.className = idx === current ? 'tab active' : 'tab';
    el.role = 'tab';
    el.id = `tab-${idx}`;
    el.tabIndex = idx === current ? 0 : -1;
    el.setAttribute('aria-selected', idx === current ? 'true' : 'false');
    el.setAttribute('aria-controls', `tabpanel-${idx}`);
    el.setAttribute('aria-label', `Previsioni giorno ${d.day_label}`);
    el.innerHTML = `<div class="bigicon" aria-hidden="true">${d.icon}</div>
        <div>${d.day_label}</div>
        <div><span class="tempmax">${d.temp_max}¬∞</span> <span class="tempmin">${d.temp_min}¬∞</span></div>`;
    el.onclick = () => { switchTab(idx); };
    el.onkeydown = (e) => {
      if(e.key === 'ArrowRight') { switchTab((idx + 1) % days.length); }
      else if(e.key === 'ArrowLeft') { switchTab((idx - 1 + days.length) % days.length); }
      else if(e.key === "Enter" || e.key === " ") { switchTab(idx); }
    };
    tabbar.appendChild(el);
  });
}
function switchTab(idx) {
  current = idx;
  renderAll();
  const tab = document.getElementById(`tab-${idx}`);
  if(tab) tab.focus();
}
let tempChart = null, windChart = null, rainChart = null;
function renderCharts() {
  const d = days[current];
  document.getElementById('chartcontainer').innerHTML =
    `<section class="card card-anim" role="region" aria-label="Grafico temperatura oraria">
      <div class="chart-title">Temperatura oraria (¬∞C)</div>
      <div class="canvas-wrap"><canvas id="chart"></canvas></div>
      <div id="chartdesc" hidden>Grafico temperatura in gradi Celsius per ogni ora del giorno.</div>
    </section>`;
  const ctx1 = document.getElementById('chart').getContext('2d');
  if (tempChart) tempChart.destroy();
  tempChart = new Chart(ctx1, {
    type: 'line',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Temperatura (¬∞C)',
        data: d.hourly_temps,
        borderColor: 'rgba(255,214,91,1)',
        backgroundColor: 'rgba(255,214,91,0.10)',
        fill: true,
        tension: 0.3,
        pointRadius: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display:false }, tooltip: {mode:'index',intersect:false} },
      scales: {
        y: { beginAtZero: false, title: { display: true, text: '¬∞C', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
      }
    }
  });

  document.getElementById('windchartcontainer').innerHTML =
    `<section class="card card-anim" role="region" aria-label="Grafico vento orario">
      <div class="chart-title">Vento orario (km/h)</div>
      <div class="canvas-wrap"><canvas id="windchart"></canvas></div>
      <div id="winddesc" hidden>Grafico velocit√† del vento in chilometri orari per ogni ora del giorno.</div>
    </section>`;
  const ctx2 = document.getElementById('windchart').getContext('2d');
  if (windChart) windChart.destroy();
  windChart = new Chart(ctx2, {
    type: 'line',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Vento (km/h)',
        data: d.hourly_winds,
        borderColor: 'rgba(90,184,255,1)',
        backgroundColor: 'rgba(90,184,255,0.18)',
        fill: true,
        tension: 0.3,
        pointRadius: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display:false}, tooltip: {mode:'index',intersect:false} },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'km/h', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
      }
    }
  });

  document.getElementById('rainchartcontainer').innerHTML =
    `<section class="card card-anim" role="region" aria-label="Grafico precipitazioni orarie">
      <div class="chart-title">Precipitazioni orarie (mm)</div>
      <div class="canvas-wrap"><canvas id="rainchart"></canvas></div>
      <div id="raindesc" hidden>Grafico precipitazioni in millimetri per ogni ora del giorno.</div>
    </section>`;
  const ctx3 = document.getElementById('rainchart').getContext('2d');
  if (rainChart) rainChart.destroy();
  rainChart = new Chart(ctx3, {
    type: 'bar',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Precipitazioni (mm)',
        data: d.hourly_precips,
        backgroundColor: 'rgba(30,180,255,0.73)',
        borderColor: 'rgba(13,80,180,1)',
        borderWidth: 1,
        minBarLength: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display:false}, tooltip: {mode:'index',intersect:false} },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'mm', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
        x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
      }
    }
  });
}
function renderAll() {
  if (!days || days.length === 0) {
    document.body.innerHTML = "<h2 style='color:#fff'>Nessun dato meteo disponibile!</h2>";
    return;
  }
  renderMainToday();
  renderTabs();
  renderCharts();
  document.getElementById('footer').innerHTML = `Powered by Open-Meteo ‚Ä¢ UI by micheledv74 ‚Ä¢ Ultimo agg.: <span id="updated_stamp">${updated_at}</span>`;
}
renderAll();
</script>
</body>
</html>
