<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>Previsioni Procida - Meteo Giornaliero</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto&display=swap');
    html { box-sizing: border-box;}
    *,*:before,*:after { box-sizing: inherit; }
    body {
      font-family: 'Roboto', Arial, sans-serif;
      max-width: 950px;
      margin: 40px auto;
      background: linear-gradient(135deg, #26365a, #2a3a7f 85%, #3498db 97%);
      color: #f0f8ff;
      padding: 22px 12px 22px 12px;
      overflow-x: hidden;
      min-height: 100vh;
    }
    .header { font-family: 'Montserrat', sans-serif; font-size: 2.6rem; font-weight: 900; text-align: center; color: #cfe9ff; text-shadow: 1px 2px 15px #09172a; letter-spacing: 2px; user-select: none; margin-bottom: 35px; }
    .today-main {
      background: linear-gradient(120deg,#24335b90 60%,#25355a 100%);
      border-radius: 32px;
      box-shadow: 0 8px 38px #2b488c33;
      padding: 26px 20px 24px 20px;
      margin: 0 auto 34px auto;
      max-width: 870px;
      min-height: 210px;
      display: grid;
      grid-template-columns: 1.2fr 5fr;
      gap: 0 11px;
      align-items: center;
      position: relative;
    }
    .slot-icon { grid-column: 1/2; display: flex; align-items: center; justify-content: center; height: 150px; }
    .main-icon { font-size: 108px; filter: drop-shadow(0 5px 17px #0690d9cc); user-select: none; margin: 0; }
    .slots-info { grid-column: 2/3; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; align-items: start; width: 100%; gap: 0 10px;}
    .slot-meteo {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 8px;
      min-width: 0;
    }
    .main-values { margin-bottom: 8px; margin-top: -8px;}
    .main-temp { font-family: 'Montserrat', sans-serif; font-size: 2.6rem; font-weight: 900; color: #fee044; letter-spacing: -2px; text-shadow: 0 4px 12px #ffe16754; margin-right: 12px; display: inline-block; }
    .main-temp-min { font-size: 2rem; color: #64c7fa; font-weight: 900; margin-left: 0px; text-shadow: 0 4px 10px #3affff33; display: inline-block; }
    .sea-temp { font-size: 1.8rem; color: #4dd0e1; font-weight: 700; margin-left: 6px; text-shadow: 0 3px 5px #27a0b5; display: inline-block; }
    .main-details { font-size: 1.16rem; font-weight: 500; color: #ddeffd; display: flex; align-items: center; margin: 2px 0 6px 0; gap: 8px; }
    .data-label { color: #ffeebb; font-weight: 700; min-width:50px;}
    .data-up { color: #ffd452; font-size:1.13em; margin-right:5px;}
    .data-down { color: #78dbfd; font-size:1.13em; margin-right:5px;}
    .data-wind { color: #abdefa; font-size:1.17em;}
    .rain-icon { font-size:1.13em;vertical-align:-3px;}
    .info-title { font-size: 1.07rem; color: #b4e6fd; font-weight: 800; margin-bottom: 5px; }
    .advice-row { grid-column: 1/5; width: 100%; display: flex; justify-content: center; align-items: center; margin-top: 20px; }
    .main-advice { background: rgba(44, 88, 235, 0.13); color: #54e2ff; font-family: 'Montserrat', sans-serif; font-size: 1.17rem; font-weight: 700; border-radius: 13px; padding: 10px 44px; box-shadow: 0 1px 10px #23293b22; text-align: center; letter-spacing: 0.03em; display: inline-block; min-width: 180px; max-width: 95vw; }
    .footer { margin-top: 25px; text-align: center; color: #cbefff; font-size: 17px; font-weight: 500; }
    .tabs { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; justify-content: center; }
    .tab { background: rgba(255,255,255,0.14); border: 2px solid #66bfff; padding: 13px 19px; border-radius: 12px; cursor: pointer; transition: background 0.2s; }
    .tab.active { background: #0580ff; color: #fff; border-bottom: 4px solid #32d3ff; font-weight: bold; }
    .tab .bigicon { font-size: 2em; }
    .tab:hover { background: #3498db; }
    .card { background: rgba(255,255,255,0.09); border-radius: 18px; padding: 22px 12px; margin-bottom: 19px; box-shadow: 0 3px 14px rgba(27,74,128,0.07);}
    .chart-title { font-size: 17px; font-weight: bold; margin-bottom: 2px; color: #acf;}
    .chart-container { width: 100%; max-width: 900px; margin: 0 auto 18px auto; display: flex; flex-direction: column;}
    .canvas-wrap { width: 100%; aspect-ratio: 16/7; max-width: 100%; display: block; overflow: hidden; border-radius: 15px; position: relative;}
    canvas { width: 100% !important; height: 100% !important; display: block; background: rgba(255,255,255,0.12); border-radius: 14px; box-shadow: 0 0 24px #2886d9bb; }
    .card-anim { animation: fadeIn 0.45s; }
    @keyframes fadeIn { from {opacity:0;transform:translateY(20px);} to {opacity:1;transform:translateY(0);} }
    @media (max-width:900px){
      body {max-width: 99vw;}
      .chart-container {padding: 0 1vw;}
    }
    /* MOBILE - layout top dedicato */
    @media (max-width: 700px) {
      .today-main {
        display: flex !important;
        flex-direction: column !important;
        padding: 6vw 2vw 0 2vw;
        min-height: unset;
        align-items: stretch;
        gap: 0;
      }
      .slot-icon { align-self: center; margin-bottom: 2vw; }
      .main-icon { font-size: 60px; }
      .slots-info {
        display: flex !important;
        flex-direction: column;
        gap: 0;
        width: 100%;
        margin: 0 auto;
      }
      .slot-meteo {
        border-radius: 7px;
        padding: 6px 2vw 10px 2vw;
        margin-bottom: 13px;
        background: rgba(43,81,143,0.14);
        box-shadow: none;
        font-size: 1.13em;
        align-items: flex-start;
      }
      .main-values {margin-bottom: 6px;}
      .info-title { font-size: 1.03rem; margin-bottom: 1px;}
      .main-advice { font-size: 0.96rem; padding: 6px 2vw;}
      .advice-row {margin-top: 10px;}
      .card, .card-anim {padding: 9px 2vw;}
      .chart-title {font-size: 1.03em;}
      .canvas-wrap { aspect-ratio: 11/9; min-height: 160px;}
      .footer {font-size: 15px;}
      .tabs {gap: 6px; margin-bottom: 13px;}
      .tab {padding: 7px 7px;font-size:0.95em;}
    }
    @media (max-width: 500px) {
      .canvas-wrap { aspect-ratio: 13/15; min-height: 95px;}
      .main-advice { font-size: 0.94rem;}
    }
    @media (orientation: landscape) and (max-width: 820px) {
      .chart-container { max-width: 98vw; }
      .canvas-wrap { aspect-ratio: 2/1;}
      canvas { min-height: 110px;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="header">PREVISIONI METEO - PROCIDA</div>
  <div id="maininfo" class="today-main"></div>
  <div id="tabbar" class="tabs"></div>
  
  <div class="chart-container" id="chartcontainer"></div>
  <div class="chart-container" id="windchartcontainer"></div>
  <div class="chart-container" id="rainchartcontainer"></div>
  <div class="chart-container" id="marinechartcontainer">
    <section class="card card-anim" role="region" aria-label="Grafico onde marine">
      <div class="chart-title">Condizioni Marine</div>
      <div class="canvas-wrap"><canvas id="marine-wave-chart"></canvas></div>
      <div id="marine-summary"></div>
      <div id="marine-alerts"></div>
    </section>
  </div>
  <div class="footer" id="footer"></div>

  <script>
    const DATA = {"mergedHourly":[{"time":"2025-10-13T00:00","wave_height":0.06,"swell_height":0.04,"swell_direction":208,"sea_surface_temperature":21.5},{"time":"2025-10-13T01:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-13T02:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-13T03:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-13T04:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.4},{"time":"2025-10-13T05:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.4},{"time":"2025-10-13T06:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.4},{"time":"2025-10-13T07:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.4},{"time":"2025-10-13T08:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.4},{"time":"2025-10-13T09:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-13T10:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-13T11:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.6},{"time":"2025-10-13T12:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209,"sea_surface_temperature":21.8},{"time":"2025-10-13T13:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.8},{"time":"2025-10-13T14:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.9},{"time":"2025-10-13T15:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.9},{"time":"2025-10-13T16:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.8},{"time":"2025-10-13T17:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.8},{"time":"2025-10-13T18:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.6},{"time":"2025-10-13T19:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.6},{"time":"2025-10-13T20:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-13T21:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-13T22:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-13T23:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-14T00:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209,"sea_surface_temperature":21.5},{"time":"2025-10-14T01:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208,"sea_surface_temperature":21.4},{"time":"2025-10-14T02:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208,"sea_surface_temperature":21.4},{"time":"2025-10-14T03:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208,"sea_surface_temperature":21.4},{"time":"2025-10-14T04:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208,"sea_surface_temperature":21.4},{"time":"2025-10-14T05:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208,"sea_surface_temperature":21.4},{"time":"2025-10-14T06:00","wave_height":0.04,"swell_height":0.02,"swell_direction":241,"sea_surface_temperature":21.4},{"time":"2025-10-14T07:00","wave_height":0.04,"swell_height":0.02,"swell_direction":273,"sea_surface_temperature":21.4},{"time":"2025-10-14T08:00","wave_height":0.04,"swell_height":0.02,"swell_direction":306,"sea_surface_temperature":21.4},{"time":"2025-10-14T09:00","wave_height":0.04,"swell_height":0.02,"swell_direction":273,"sea_surface_temperature":21.4},{"time":"2025-10-14T10:00","wave_height":0.04,"swell_height":0.02,"swell_direction":241,"sea_surface_temperature":21.5},{"time":"2025-10-14T11:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208,"sea_surface_temperature":21.5},{"time":"2025-10-14T12:00","wave_height":0.04,"swell_height":0.02,"swell_direction":184,"sea_surface_temperature":21.5},{"time":"2025-10-14T13:00","wave_height":0.04,"swell_height":0.04,"swell_direction":160,"sea_surface_temperature":21.6},{"time":"2025-10-14T14:00","wave_height":0.04,"swell_height":0.04,"swell_direction":136,"sea_surface_temperature":21.6},{"time":"2025-10-14T15:00","wave_height":0.04,"swell_height":0.04,"swell_direction":134,"sea_surface_temperature":21.6},{"time":"2025-10-14T16:00","wave_height":0.04,"swell_height":0.04,"swell_direction":132,"sea_surface_temperature":21.6},{"time":"2025-10-14T17:00","wave_height":0.04,"swell_height":0.04,"swell_direction":130,"sea_surface_temperature":21.5},{"time":"2025-10-14T18:00","wave_height":0.04,"swell_height":0.04,"swell_direction":130,"sea_surface_temperature":21.5},{"time":"2025-10-14T19:00","wave_height":0.04,"swell_height":0.04,"swell_direction":130,"sea_surface_temperature":21.5},{"time":"2025-10-14T20:00","wave_height":0.04,"swell_height":0.04,"swell_direction":130,"sea_surface_temperature":21.5},{"time":"2025-10-14T21:00","wave_height":0.04,"swell_height":0.04,"swell_direction":159,"sea_surface_temperature":21.5},{"time":"2025-10-14T22:00","wave_height":0.04,"swell_height":0.02,"swell_direction":187,"sea_surface_temperature":21.4},{"time":"2025-10-14T23:00","wave_height":0.04,"swell_height":0.02,"swell_direction":216,"sea_surface_temperature":21.4},{"time":"2025-10-15T00:00","wave_height":0.04,"swell_height":0.02,"swell_direction":218,"sea_surface_temperature":21.4},{"time":"2025-10-15T01:00","wave_height":0.04,"swell_height":0.04,"swell_direction":219,"sea_surface_temperature":21.4},{"time":"2025-10-15T02:00","wave_height":0.04,"swell_height":0.04,"swell_direction":221,"sea_surface_temperature":21.4},{"time":"2025-10-15T03:00","wave_height":0.04,"swell_height":0.04,"swell_direction":221,"sea_surface_temperature":21.4},{"time":"2025-10-15T04:00","wave_height":0.04,"swell_height":0.04,"swell_direction":220,"sea_surface_temperature":21.3},{"time":"2025-10-15T05:00","wave_height":0.04,"swell_height":0.04,"swell_direction":220,"sea_surface_temperature":21.3},{"time":"2025-10-15T06:00","wave_height":0.06,"swell_height":0.06,"swell_direction":220,"sea_surface_temperature":21.3},{"time":"2025-10-15T07:00","wave_height":0.06,"swell_height":0.06,"swell_direction":220,"sea_surface_temperature":21.3},{"time":"2025-10-15T08:00","wave_height":0.08,"swell_height":0.08,"swell_direction":220,"sea_surface_temperature":21.3},{"time":"2025-10-15T09:00","wave_height":0.1,"swell_height":0.1,"swell_direction":220,"sea_surface_temperature":21.3},{"time":"2025-10-15T10:00","wave_height":0.12,"swell_height":0.12,"swell_direction":220,"sea_surface_temperature":21.4},{"time":"2025-10-15T11:00","wave_height":0.14,"swell_height":0.14,"swell_direction":220,"sea_surface_temperature":21.4},{"time":"2025-10-15T12:00","wave_height":0.2,"swell_height":0.16,"swell_direction":220,"sea_surface_temperature":21.4},{"time":"2025-10-15T13:00","wave_height":0.24,"swell_height":0.18,"swell_direction":219,"sea_surface_temperature":21.5},{"time":"2025-10-15T14:00","wave_height":0.3,"swell_height":0.2,"swell_direction":219,"sea_surface_temperature":21.5},{"time":"2025-10-15T15:00","wave_height":0.3,"swell_height":0.22,"swell_direction":219,"sea_surface_temperature":21.5},{"time":"2025-10-15T16:00","wave_height":0.3,"swell_height":0.22,"swell_direction":218,"sea_surface_temperature":21.4},{"time":"2025-10-15T17:00","wave_height":0.3,"swell_height":0.24,"swell_direction":218,"sea_surface_temperature":21.4},{"time":"2025-10-15T18:00","wave_height":0.32,"swell_height":0.24,"swell_direction":218,"sea_surface_temperature":21.4},{"time":"2025-10-15T19:00","wave_height":0.34,"swell_height":0.26,"swell_direction":217,"sea_surface_temperature":21.3},{"time":"2025-10-15T20:00","wave_height":0.36,"swell_height":0.26,"swell_direction":217,"sea_surface_temperature":21.3},{"time":"2025-10-15T21:00","wave_height":0.38,"swell_height":0.26,"swell_direction":217,"sea_surface_temperature":21.3},{"time":"2025-10-15T22:00","wave_height":0.42,"swell_height":0.26,"swell_direction":217,"sea_surface_temperature":21.3},{"time":"2025-10-15T23:00","wave_height":0.44,"swell_height":0.26,"swell_direction":217,"sea_surface_temperature":21.2},{"time":"2025-10-16T00:00","wave_height":0.46,"swell_height":0.28,"swell_direction":217,"sea_surface_temperature":21.2},{"time":"2025-10-16T01:00","wave_height":0.46,"swell_height":0.32,"swell_direction":218,"sea_surface_temperature":21.2},{"time":"2025-10-16T02:00","wave_height":0.48,"swell_height":0.34,"swell_direction":218,"sea_surface_temperature":21.2},{"time":"2025-10-16T03:00","wave_height":0.5,"swell_height":0.36,"swell_direction":218,"sea_surface_temperature":21.2},{"time":"2025-10-16T04:00","wave_height":0.5,"swell_height":0.36,"swell_direction":218,"sea_surface_temperature":21.2},{"time":"2025-10-16T05:00","wave_height":0.52,"swell_height":0.38,"swell_direction":218,"sea_surface_temperature":21.2},{"time":"2025-10-16T06:00","wave_height":0.56,"swell_height":0.38,"swell_direction":217,"sea_surface_temperature":21.2},{"time":"2025-10-16T07:00","wave_height":0.58,"swell_height":0.38,"swell_direction":217,"sea_surface_temperature":21.1},{"time":"2025-10-16T08:00","wave_height":0.62,"swell_height":0.38,"swell_direction":216,"sea_surface_temperature":21.1},{"time":"2025-10-16T09:00","wave_height":0.64,"swell_height":0.38,"swell_direction":195,"sea_surface_temperature":21.1},{"time":"2025-10-16T10:00","wave_height":0.66,"swell_height":0.4,"swell_direction":174,"sea_surface_temperature":21.1},{"time":"2025-10-16T11:00","wave_height":0.68,"swell_height":0.4,"swell_direction":153,"sea_surface_temperature":21.1},{"time":"2025-10-16T12:00","wave_height":0.68,"swell_height":0.44,"swell_direction":152,"sea_surface_temperature":21.1},{"time":"2025-10-16T13:00","wave_height":0.7,"swell_height":0.46,"swell_direction":152,"sea_surface_temperature":21.1},{"time":"2025-10-16T14:00","wave_height":0.7,"swell_height":0.5,"swell_direction":151,"sea_surface_temperature":21.1},{"time":"2025-10-16T15:00","wave_height":0.72,"swell_height":0.52,"swell_direction":152,"sea_surface_temperature":21.1},{"time":"2025-10-16T16:00","wave_height":0.76,"swell_height":0.54,"swell_direction":154,"sea_surface_temperature":21.1},{"time":"2025-10-16T17:00","wave_height":0.78,"swell_height":0.56,"swell_direction":155,"sea_surface_temperature":21.1},{"time":"2025-10-16T18:00","wave_height":0.78,"swell_height":0.56,"swell_direction":155,"sea_surface_temperature":21.1},{"time":"2025-10-16T19:00","wave_height":0.78,"swell_height":0.58,"swell_direction":154,"sea_surface_temperature":21.1},{"time":"2025-10-16T20:00","wave_height":0.78,"swell_height":0.58,"swell_direction":154,"sea_surface_temperature":21.1},{"time":"2025-10-16T21:00","wave_height":0.76,"swell_height":0.56,"swell_direction":154,"sea_surface_temperature":21.1},{"time":"2025-10-16T22:00","wave_height":0.74,"swell_height":0.54,"swell_direction":155,"sea_surface_temperature":21.1},{"time":"2025-10-16T23:00","wave_height":0.72,"swell_height":0.52,"swell_direction":155,"sea_surface_temperature":21.1},{"time":"2025-10-17T00:00","wave_height":0.72,"swell_height":0.5,"swell_direction":153,"sea_surface_temperature":21},{"time":"2025-10-17T01:00","wave_height":0.72,"swell_height":0.48,"swell_direction":151,"sea_surface_temperature":21},{"time":"2025-10-17T02:00","wave_height":0.72,"swell_height":0.46,"swell_direction":149,"sea_surface_temperature":21},{"time":"2025-10-17T03:00","wave_height":0.7,"swell_height":0.46,"swell_direction":171,"sea_surface_temperature":21},{"time":"2025-10-17T04:00","wave_height":0.68,"swell_height":0.46,"swell_direction":194,"sea_surface_temperature":21},{"time":"2025-10-17T05:00","wave_height":0.66,"swell_height":0.46,"swell_direction":216,"sea_surface_temperature":21},{"time":"2025-10-17T06:00","wave_height":0.66,"swell_height":0.46,"swell_direction":215,"sea_surface_temperature":21},{"time":"2025-10-17T07:00","wave_height":0.68,"swell_height":0.44,"swell_direction":215,"sea_surface_temperature":21},{"time":"2025-10-17T08:00","wave_height":0.68,"swell_height":0.44,"swell_direction":214,"sea_surface_temperature":21},{"time":"2025-10-17T09:00","wave_height":0.68,"swell_height":0.46,"swell_direction":215,"sea_surface_temperature":21},{"time":"2025-10-17T10:00","wave_height":0.68,"swell_height":0.46,"swell_direction":217,"sea_surface_temperature":21},{"time":"2025-10-17T11:00","wave_height":0.68,"swell_height":0.48,"swell_direction":218,"sea_surface_temperature":21},{"time":"2025-10-17T12:00","wave_height":0.68,"swell_height":0.5,"swell_direction":217,"sea_surface_temperature":21},{"time":"2025-10-17T13:00","wave_height":0.68,"swell_height":0.5,"swell_direction":215,"sea_surface_temperature":21},{"time":"2025-10-17T14:00","wave_height":0.68,"swell_height":0.52,"swell_direction":214,"sea_surface_temperature":21},{"time":"2025-10-17T15:00","wave_height":0.68,"swell_height":0.52,"swell_direction":213,"sea_surface_temperature":21},{"time":"2025-10-17T16:00","wave_height":0.68,"swell_height":0.52,"swell_direction":212,"sea_surface_temperature":21},{"time":"2025-10-17T17:00","wave_height":0.68,"swell_height":0.52,"swell_direction":211,"sea_surface_temperature":20.9},{"time":"2025-10-17T18:00","wave_height":0.68,"swell_height":0.48,"swell_direction":210,"sea_surface_temperature":20.9},{"time":"2025-10-17T19:00","wave_height":0.7,"swell_height":0.46,"swell_direction":209,"sea_surface_temperature":20.9},{"time":"2025-10-17T20:00","wave_height":0.7,"swell_height":0.42,"swell_direction":208,"sea_surface_temperature":20.9},{"time":"2025-10-17T21:00","wave_height":0.68,"swell_height":0.44,"swell_direction":234,"sea_surface_temperature":20.9},{"time":"2025-10-17T22:00","wave_height":0.66,"swell_height":0.44,"swell_direction":259,"sea_surface_temperature":20.9},{"time":"2025-10-17T23:00","wave_height":0.64,"swell_height":0.46,"swell_direction":285,"sea_surface_temperature":20.9},{"time":"2025-10-18T00:00","wave_height":0.62,"swell_height":0.44,"swell_direction":279,"sea_surface_temperature":20.9},{"time":"2025-10-18T01:00","wave_height":0.58,"swell_height":0.44,"swell_direction":272,"sea_surface_temperature":20.9},{"time":"2025-10-18T02:00","wave_height":0.56,"swell_height":0.42,"swell_direction":266,"sea_surface_temperature":20.9},{"time":"2025-10-18T03:00","wave_height":0.52,"swell_height":0.42,"swell_direction":268,"sea_surface_temperature":20.9},{"time":"2025-10-18T04:00","wave_height":0.5,"swell_height":0.4,"swell_direction":270,"sea_surface_temperature":20.9},{"time":"2025-10-18T05:00","wave_height":0.46,"swell_height":0.4,"swell_direction":272,"sea_surface_temperature":20.9},{"time":"2025-10-18T06:00","wave_height":0.46,"swell_height":0.4,"swell_direction":272,"sea_surface_temperature":20.9},{"time":"2025-10-18T07:00","wave_height":0.44,"swell_height":0.42,"swell_direction":272,"sea_surface_temperature":20.9},{"time":"2025-10-18T08:00","wave_height":0.44,"swell_height":0.42,"swell_direction":272,"sea_surface_temperature":20.9},{"time":"2025-10-18T09:00","wave_height":0.44,"swell_height":0.42,"swell_direction":271,"sea_surface_temperature":20.9},{"time":"2025-10-18T10:00","wave_height":0.46,"swell_height":0.44,"swell_direction":270,"sea_surface_temperature":20.9},{"time":"2025-10-18T11:00","wave_height":0.46,"swell_height":0.44,"swell_direction":269,"sea_surface_temperature":20.9},{"time":"2025-10-18T12:00","wave_height":0.46,"swell_height":0.44,"swell_direction":268,"sea_surface_temperature":20.9},{"time":"2025-10-18T13:00","wave_height":0.48,"swell_height":0.46,"swell_direction":267,"sea_surface_temperature":21},{"time":"2025-10-18T14:00","wave_height":0.48,"swell_height":0.46,"swell_direction":266,"sea_surface_temperature":21},{"time":"2025-10-18T15:00","wave_height":0.48,"swell_height":0.46,"swell_direction":265,"sea_surface_temperature":21},{"time":"2025-10-18T16:00","wave_height":0.5,"swell_height":0.46,"swell_direction":265,"sea_surface_temperature":21},{"time":"2025-10-18T17:00","wave_height":0.5,"swell_height":0.46,"swell_direction":264,"sea_surface_temperature":21},{"time":"2025-10-18T18:00","wave_height":0.5,"swell_height":0.44,"swell_direction":259,"sea_surface_temperature":21},{"time":"2025-10-18T19:00","wave_height":0.48,"swell_height":0.44,"swell_direction":254,"sea_surface_temperature":20.9},{"time":"2025-10-18T20:00","wave_height":0.48,"swell_height":0.42,"swell_direction":249,"sea_surface_temperature":20.9},{"time":"2025-10-18T21:00","wave_height":0.46,"swell_height":0.4,"swell_direction":248,"sea_surface_temperature":20.9},{"time":"2025-10-18T22:00","wave_height":0.46,"swell_height":0.4,"swell_direction":248,"sea_surface_temperature":20.9},{"time":"2025-10-18T23:00","wave_height":0.44,"swell_height":0.38,"swell_direction":247,"sea_surface_temperature":20.9},{"time":"2025-10-19T00:00","wave_height":0.42,"swell_height":0.38,"swell_direction":256,"sea_surface_temperature":20.9},{"time":"2025-10-19T01:00","wave_height":0.42,"swell_height":0.36,"swell_direction":265,"sea_surface_temperature":20.8},{"time":"2025-10-19T02:00","wave_height":0.4,"swell_height":0.36,"swell_direction":274,"sea_surface_temperature":20.8},{"time":"2025-10-19T03:00","wave_height":0.38,"swell_height":0.36,"swell_direction":271,"sea_surface_temperature":20.8},{"time":"2025-10-19T04:00","wave_height":0.38,"swell_height":0.34,"swell_direction":268,"sea_surface_temperature":20.8},{"time":"2025-10-19T05:00","wave_height":0.36,"swell_height":0.34,"swell_direction":265,"sea_surface_temperature":20.8},{"time":"2025-10-19T06:00","wave_height":0.36,"swell_height":0.32,"swell_direction":266,"sea_surface_temperature":20.7},{"time":"2025-10-19T07:00","wave_height":0.38,"swell_height":0.28,"swell_direction":266,"sea_surface_temperature":20.7},{"time":"2025-10-19T08:00","wave_height":0.38,"swell_height":0.26,"swell_direction":267,"sea_surface_temperature":20.7},{"time":"2025-10-19T09:00","wave_height":0.36,"swell_height":0.24,"swell_direction":268,"sea_surface_temperature":20.7},{"time":"2025-10-19T10:00","wave_height":0.36,"swell_height":0.22,"swell_direction":268,"sea_surface_temperature":20.8},{"time":"2025-10-19T11:00","wave_height":0.34,"swell_height":0.2,"swell_direction":269,"sea_surface_temperature":20.8},{"time":"2025-10-19T12:00","wave_height":0.32,"swell_height":0.2,"swell_direction":218,"sea_surface_temperature":20.8},{"time":"2025-10-19T13:00","wave_height":0.28,"swell_height":0.18,"swell_direction":168,"sea_surface_temperature":20.9},{"time":"2025-10-19T14:00","wave_height":0.26,"swell_height":0.18,"swell_direction":117,"sea_surface_temperature":20.9},{"time":"2025-10-19T15:00","wave_height":0.28,"swell_height":0.16,"swell_direction":120,"sea_surface_temperature":20.9},{"time":"2025-10-19T16:00","wave_height":0.28,"swell_height":0.16,"swell_direction":124,"sea_surface_temperature":20.9},{"time":"2025-10-19T17:00","wave_height":0.3,"swell_height":0.14,"swell_direction":127,"sea_surface_temperature":20.8},{"time":"2025-10-19T18:00","wave_height":0.34,"swell_height":0.14,"swell_direction":129,"sea_surface_temperature":20.8},{"time":"2025-10-19T19:00","wave_height":0.38,"swell_height":0.14,"swell_direction":131,"sea_surface_temperature":20.8},{"time":"2025-10-19T20:00","wave_height":0.42,"swell_height":0.14,"swell_direction":133,"sea_surface_temperature":20.8},{"time":"2025-10-19T21:00","wave_height":0.44,"swell_height":0.14,"swell_direction":131,"sea_surface_temperature":20.8},{"time":"2025-10-19T22:00","wave_height":0.44,"swell_height":0.14,"swell_direction":128,"sea_surface_temperature":20.7},{"time":"2025-10-19T23:00","wave_height":0.46,"swell_height":0.14,"swell_direction":126,"sea_surface_temperature":20.6}],"alerts":[],"advice":"Condizioni marine generalmente buone.","tides":{},"days":[{"day_label":"13/10","temp_max":"21.1","temp_min":"19.1","precipitation":"0.00","icon":"🌤️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.8,19.7,19.7,19.6,19.5,19.4,19.3,19.3,19.1,19.2,19.4,19.7,20,20.2,20.6,21,21,21.1,20.9,20.8,20.7,20.6,20.6,20.4],"hourly_winds":[2.6,2.1,1.8,2.1,1.9,1.3,1.6,2.3,3.4,3.2,2.6,3.1,1.1,1.5,5.1,7.2,9.1,9.3,8.6,6.8,5.4,5.4,4.1,2.9],"hourly_wind_directions":[16,31,37,59,68,56,27,18,18,27,34,36,18,284,278,288,288,286,285,295,312,318,322,353],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"hourly_pressures":[1022.1,1022.1,1021.2,1020.9,1020.3,1020.8,1020.1,1020,1020.5,1020.8,1021,1021.2,1021,1020.8,1020.2,1019.7,1019.6,1019.8,1019.8,1019.7,1019.9,1019.9,1020.3,1020.6],"pressure_avg":"1020.5"},{"day_label":"14/10","temp_max":"20.3","temp_min":"18.8","precipitation":"0.60","icon":"⛅","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[20.2,20.1,19.9,19.8,19.6,19.4,19.2,19.2,19.2,19.3,19.5,19.8,20,20.2,20.2,20.1,20.1,20.1,20.2,20.3,19.9,19.3,19.1,18.8],"hourly_winds":[2.7,3.1,2.4,3,3.6,4.3,4.4,5.4,5.3,5.3,6,6.8,7.3,8.2,9.4,9.4,9.5,8.4,7.4,7.5,6.8,8.9,8.1,8],"hourly_wind_directions":[23,54,63,76,96,95,99,110,118,118,115,115,123,139,157,173,189,200,219,253,273,302,328,342],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1,0.3,0.1,0.1],"hourly_pressures":[1020.6,1020.8,1020.6,1020.2,1019.7,1019.6,1019.6,1019.6,1019.8,1020.3,1020.6,1020.6,1020.7,1020.4,1019.9,1019.2,1018.7,1018.4,1018.5,1018.8,1019,1018.9,1018.9,1018.9],"pressure_avg":"1019.7"},{"day_label":"15/10","temp_max":"18.9","temp_min":"18.2","precipitation":"1.70","icon":"⛅","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[18.8,18.8,18.6,18.7,18.7,18.7,18.6,18.6,18.7,18.9,18.9,18.8,18.6,18.6,18.7,18.6,18.7,18.3,18.2,18.6,18.7,18.9,18.8,18.5],"hourly_winds":[4.4,6.2,7.4,8.5,10.1,8.7,8.8,8.3,9.1,9.6,9.9,10.8,12.2,12.7,12.9,13.1,13,14.5,10.1,10.9,9.1,10.5,12.3,11.4],"hourly_wind_directions":[81,80,61,54,55,66,81,92,108,103,100,88,88,98,108,111,118,136,125,117,97,82,83,72],"hourly_precips":[0.1,0.1,0,0.1,0.1,0,0,0,0.1,0.1,0.1,0.2,0.2,0.1,0,0.1,0,0.1,0.1,0,0,0,0,0.2],"hourly_pressures":[1018.8,1018.5,1018.3,1017.8,1017.3,1017.1,1016.8,1016.9,1017.1,1017.5,1017.5,1017.3,1017,1016.5,1015.9,1015.6,1015.3,1015.3,1015.1,1015.1,1014.9,1014.6,1014.5,1014.4],"pressure_avg":"1016.5"},{"day_label":"16/10","temp_max":"19.0","temp_min":"17.3","precipitation":"19.60","icon":"🌧️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[18.3,18.3,18.3,18,17.7,17.3,17.6,17.8,17.9,17.4,17.4,17.4,17.5,18,18.5,18.2,18.1,18.2,18.3,18.2,18.3,18.5,18.8,19],"hourly_winds":[12.2,15.3,15.8,15.3,15.6,12.4,13.3,16.8,21.4,22.8,24.2,22.4,21.5,22,22.1,21.9,19.9,18.9,19.6,18.6,18.1,17.6,16.3,15.8],"hourly_wind_directions":[47,49,55,51,56,54,49,48,46,51,46,42,40,40,44,44,41,40,32,15,6,359,352,348],"hourly_precips":[0.3,0.1,0,0.4,1.2,3.2,2.4,1.4,0.4,1.3,3.1,1.9,0.9,0.2,0.1,0.3,0.5,0.5,0.5,0.4,0.2,0.1,0.1,0.1],"hourly_pressures":[1014,1013.6,1013.3,1012.7,1012.2,1011.8,1011.5,1011.3,1011.4,1011.8,1011.8,1012,1012,1011.6,1011.1,1010.9,1010.7,1010.6,1010.6,1010.9,1011,1011,1011,1011],"pressure_avg":"1011.7"},{"day_label":"17/10","temp_max":"19.7","temp_min":"18.7","precipitation":"0.90","icon":"🌤️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19,18.9,18.9,19.1,19.4,19.5,19.3,19,18.8,18.7,18.7,18.8,19,19.3,19.5,19.6,19.7,19.6,19.5,19.3,19.1,18.9,18.8,18.7],"hourly_winds":[16,16.4,16.9,17.7,18.1,18.2,17.3,15.6,13.4,10.7,7.6,4.7,1.6,1.8,4.5,5.8,7,7.4,7.9,9,10.2,10.7,10.5,9.8],"hourly_wind_directions":[346,345,344,343,343,342,339,337,336,340,352,9,27,180,194,202,215,227,246,268,280,284,286,287],"hourly_precips":[0,0,0,0,0,0,0.1,0.1,0.1,0.2,0.2,0.2,0,0,0,0,0,0,0,0,0,0,0,0],"hourly_pressures":[1011,1011,1010.9,1010.7,1010.4,1010.3,1010.6,1011.1,1011.6,1012.3,1013,1013.5,1013.6,1013.5,1013.5,1013.7,1014,1014.4,1014.8,1015.2,1015.6,1016.1,1016.6,1017.1],"pressure_avg":"1013.1"},{"day_label":"18/10","temp_max":"20.3","temp_min":"18.5","precipitation":"0.00","icon":"☀️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[18.6,18.5,18.6,18.9,19.3,19.6,19.6,19.5,19.5,19.4,19.3,19.4,19.6,20,20.2,20.3,20.3,20.2,20.2,20.1,20,20,19.9,19.8],"hourly_winds":[8.9,7.6,6.8,7.2,8.2,9.2,9.4,10,9.7,8.7,7.4,6.5,7.1,8.1,9.1,11.9,11.2,10.4,9.4,8.3,6.5,3.8,1.8,4.1],"hourly_wind_directions":[291,295,302,307,308,309,310,311,312,312,309,304,294,283,279,270,270,272,272,272,273,287,349,45],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"hourly_pressures":[1017.4,1017.7,1017.9,1017.9,1017.8,1017.9,1018.2,1018.6,1019,1019.5,1020,1020.4,1020.4,1020.2,1020.1,1020,1019.8,1019.7,1019.7,1019.7,1019.8,1020,1020.2,1020.4],"pressure_avg":"1019.3"},{"day_label":"19/10","temp_max":"21.0","temp_min":"16.9","precipitation":"0.00","icon":"☀️","hourly_labels":["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],"hourly_temps":[19.4,18.8,18.4,18,17.7,17.5,17.2,17,16.9,17.2,17.7,18.3,19.1,20,20.6,20.9,21,20.9,20.4,19.7,19.1,18.6,18.3,17.9],"hourly_winds":[6.5,8.7,10.3,10.8,11,10.9,10.8,10.8,11,12,13.3,14.6,15.8,16.8,18,19.7,21.1,21.9,21.1,19.7,18,17,16,15.3],"hourly_wind_directions":[56,60,61,60,58,56,53,53,52,51,52,52,55,59,61,62,60,60,60,62,61,58,54,51],"hourly_precips":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"hourly_pressures":[1020.5,1020.5,1020.5,1020.3,1020.1,1019.9,1019.9,1020,1020.2,1020.4,1020.7,1020.8,1020.5,1020,1019.5,1019.1,1018.8,1018.7,1018.8,1019.1,1019.4,1019.6,1019.7,1019.7],"pressure_avg":"1019.9"}],"updated_at":"13/10/2025, 22:57:33"};
    const days = DATA.days;
    const mergedHourly = DATA.mergedHourly || [];
    const alerts = DATA.alerts || [];
    const advice = DATA.advice || "";
    const updated_at = DATA.updated_at;
    let current = 0;

    // Variabili globali per i grafici Chart.js
    let tempChart = null;
    let windChart = null;
    let rainChart = null;
    let marineChart = null;

    function rainIntensityIcon(valmm) {
      if (valmm < 0.1) return '';
      if (valmm < 0.5) return '💧';
      if (valmm < 1) return '💧💧';
      if (valmm < 3) return '💧💧💧';
      if (valmm < 10) return '💧💧💧💧';
      return '💧💧💧💧💧';
    }

    function windDescriptor(speed) {
      if (speed < 6) return "calmo";
      if (speed < 13) return "brezza";
      if (speed < 25) return "ventoso";
      return "molto forte";
    }

    function dailyAdvice(day) {
      if (parseFloat(day.precipitation) > 5.0) return "🗞️ Potrebbe piovere forte, porta un ombrello e valuta attività al coperto.";
      if (parseFloat(day.temp_max) >= 34) return "🗞️ Giornata molto calda: resta idratato e cerca zone ombreggiate.";
      if (parseFloat(day.temp_max) - parseFloat(day.temp_min) > 15) return "🗞️ Attenzione: forti escursioni termiche oggi.";
      if (parseFloat(day.precipitation) > 0.2) return "🗞️ Possibile pioggia, attività all'aperto da valutare.";
      if (parseFloat(day.temp_min) < 5) return "🗞️ Giornata fredda, copriti bene!";
      if (parseFloat(day.wind_max || 0) > 30) return "🗞️ Previsto vento molto forte, massima cautela!";
      return "🗞️ Giornata generalmente serena, goditela!";
    }

    function humanDirection(deg) {
      if (deg == null) return '--';
      const directions = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
      const ix = Math.round(deg / 22.5) % 16;
      return directions[ix];
    }

    function getTraditionalWindName(deg) {
      const names = [
        "Tramontana", "Tramontana", "Grecale", "Grecale", "Levante", "Levante",
        "Scirocco", "Scirocco", "Ostro", "Ostro", "Libeccio", "Libeccio",
        "Ponente", "Ponente", "Maestrale", "Maestrale"
      ];
      const index = Math.round(deg / 22.5) % 16;
      return names[index];
    }

    function calculateMean(values) {
      if (!values.length) return 0;
      return values.reduce((a,b) => a+b, 0) / values.length;
    }

    function calculateRange(values) {
      if (!values.length) return 0;
      return Math.max(...values) - Math.min(...values);
    }

    function calculateStdDev(values) {
      if (!values.length) return 0;
      const mean = calculateMean(values);
      const variance = values.reduce((a,b) => a + (b - mean)**2, 0) / values.length;
      return Math.sqrt(variance);
    }

    function detectRogueWaveRisk(waves, hsig) {
      if (!waves.length || hsig === 0) return false;
      const maxWave = Math.max(...waves);
      return maxWave > (hsig * 2.2);
    }

    function marineRiskAdvice(hsig, rogueRisk, windSpeed) {
      let advice = [];
      if (hsig < 0.5) advice.push("Mare calmo, condizioni favorevoli.");
      else if (hsig < 2.5) advice.push("Mare mosso, cautela per attività diportistiche.");
      else if (hsig < 4) advice.push("Mare molto mosso, attenzione alla navigazione.");
      else advice.push("Mare agitato o tempestoso, evitare uscita in mare.");
      if (rogueRisk) advice.push("⚠️ Presenza di onde anomale! Massima prudenza.");
      if (windSpeed >= 25) advice.push("⚠️ Vento forte in arrivo, precauzioni raccomandate.");
      return advice.join(" ");
    }

    function averageWindDirection(degreesArray) {
      if (!degreesArray.length) return null;
      let sinSum = 0, cosSum = 0;
      degreesArray.forEach(deg => {
        const rad = deg * Math.PI / 180;
        sinSum += Math.sin(rad);
        cosSum += Math.cos(rad);
      });
      const avgRad = Math.atan2(sinSum / degreesArray.length, cosSum / degreesArray.length);
      const avgDeg = (avgRad * 180 / Math.PI + 360) % 360;
      return avgDeg;
    }

    function getMarineDataForDay() {
      const day = days && days[current];
      if (!day || !mergedHourly.length) return [];
      let someTime = mergedHourly[0].time;
      const pref_year = someTime.slice(0, 4);
      const [dd, mm] = day.day_label.split('/');
      const dateString = `${pref_year}-${mm.padStart(2,'0')}-${dd.padStart(2,'0')}`;
      return mergedHourly.filter(h => h.time && h.time.startsWith(dateString));
    }

    function renderMainToday() {
      const d = days && days[current];
      if (!d) return;
      let tempData = d.hourly_temps || [];
      let windData = d.hourly_winds || [];
      let windDirData = d.hourly_wind_directions || [];
      let precipData = d.hourly_precips || [];
      let pressureData = d.hourly_pressures || [];
      let timeData = d.hourly_labels || [];
      const tmax = Math.max(...tempData);
      const tmin = Math.min(...tempData);
      const imax = tempData.indexOf(tmax);
      const imin = tempData.indexOf(tmin);
      const tmax_hh = imax !== -1 && timeData[imax] ? timeData[imax] : "--:--";
      const tmin_hh = imin !== -1 && timeData[imin] ? timeData[imin] : "--:--";
      const ptotal = precipData.reduce((a,b)=>a+b,0);
      const rainIcon = rainIntensityIcon(ptotal);
      const windmax = Math.max(...windData);
      const iwmax = windData.indexOf(windmax);
      const windmax_hh = iwmax !== -1 && timeData[iwmax] ? timeData[iwmax]: "--:--";
      const windlast = windData[windData.length-1];
      const windDirectionAvg = windDirData.length ? averageWindDirection(windDirData) : null;
      const windName = windDirectionAvg !== null ? getTraditionalWindName(windDirectionAvg) : '--';
      let pressureAvg = null;
      if (pressureData.length) {
        pressureAvg = calculateMean(pressureData);
      }
      let pressureAdvice = "";
      if (pressureAvg !== null) {
        if (pressureAvg < 1010) pressureAdvice = "⚠️ Bassa pressione in arrivo, condizioni instabili.";
        else if (pressureAvg > 1020) pressureAdvice = "📈 Alta pressione, tempo stabile previsto.";
        else pressureAdvice = "Pressione atmosferica nella media.";
      }
      // Calcolo temperatura mare media del giorno corrente dalla mergedHourly
      const marineDayData = getMarineDataForDay();
      const seaTemps = marineDayData.map(h => h.sea_surface_temperature).filter(t => typeof t === 'number');
      const seaTempAvg = seaTemps.length ? calculateMean(seaTemps) : null;

      const advice = dailyAdvice({...d, wind_max: windmax});

      document.getElementById('maininfo').innerHTML = `
        <div class="slot-icon">
          <span class="main-icon">${d.icon}</span>
        </div>
        <div class="slots-info">
          <div class="slot-meteo">
            <div class="main-values">
              <span class="main-temp">${tmax.toFixed(1)}°</span>
              <span class="main-temp-min">${tmin.toFixed(1)}°</span>
            </div>
            <div class="main-details"><span class="rain-icon">🌧️</span> Precipitazioni: ${ptotal.toFixed(1)} mm ${rainIcon}</div>
          </div>
          <div class="slot-meteo">
            <div class="info-title">Temperature/Orari</div>
            <div class="data-up">↗️ max: <b>${tmax.toFixed(1)}°C</b> alle ${tmax_hh} </div>
            <div class="data-down">↘️ min: <b>${tmin.toFixed(1)}°C</b> alle ${tmin_hh}</div>
          </div>
          <div class="slot-meteo">
            <div class="info-title">Temperatura mare</div>
            <div class="data-label sea-temp">${seaTempAvg !== null ? seaTempAvg.toFixed(1) + " °C" : "N.D."}</div>
          </div>
          <div class="slot-meteo">
            <div class="info-title">Vento</div>
            <div class="data-wind">💨 max: <b>${windmax.toFixed(1)} km/h</b> (${windName} - ${windDirectionAvg !== null ? windDirectionAvg.toFixed(0) : '--'}°) alle ${windmax_hh}</div>
            <div class="data-wind">💨 ora: <b>${windlast.toFixed(1)} km/h</b></div>
          </div>
          <div class="slot-meteo">
            <div class="info-title">Pressione atmosferica</div>
            <div class="data-label">${pressureAvg !== null ? pressureAvg.toFixed(1) + " hPa" : "--"}</div>
            <div class="data-label" style="color:#ffcc66;">${pressureAdvice}</div>
          </div>
          <div class="advice-row"><span class="main-advice">${advice}</span></div>
        </div>
      `;
    }

   function renderMarine() {
  const canvasWrap = document.querySelector('#marinechartcontainer .canvas-wrap');
  canvasWrap.innerHTML = '<canvas id="marine-wave-chart"></canvas>';
  const marineForDay = getMarineDataForDay();
  const waveData = marineForDay.map(h => typeof h.waveheight === 'number' ? h.waveheight : 0);
  const swellData = marineForDay.map(h => typeof h.swellheight === 'number' ? h.swellheight : 0);
      const hsig = calculateMean(waveData.slice(0, Math.ceil(waveData.length / 3)));
      const douglasScale = getDouglasScale(hsig);
      const rogueRisk = detectRogueWaveRisk(waveData, hsig);
      const waveMean = calculateMean(waveData);
      const waveRange = calculateRange(waveData);
      const waveStdDev = calculateStdDev(waveData);
      const windMax = days[current]?.wind_max || 0;
      const adviceText = marineRiskAdvice(hsig, rogueRisk, windMax);
      const divSummary = document.getElementById('marine-summary');
      if (marineForDay.length) {
        const h = marineForDay[0];
        divSummary.innerHTML = `
          <div style="color:#94dfeb;font-size:1.11em;font-weight:bold;margin-bottom:2px;">
            H<sub>sig</sub> (altezza significativa): ${hsig.toFixed(2)} m
          </div>
          <div style="color:#8ee4af; font-weight:bold; margin-bottom:4px;">
            Scala Douglas: ${douglasScale}
          </div>
          <div style="color:#a0d8ef; margin-top: 8px; font-size: 0.95rem;">
            <div>Media altezza onda: ${waveMean.toFixed(2)} m</div>
            <div>Range onda: ${waveRange.toFixed(2)} m</div>
            <div>Deviazione standard: ${waveStdDev.toFixed(3)} m</div>
          </div>
          <div>
            Altezza onda: ${(h.wave_height??0).toFixed(2)}m,
            direzione swell: ${humanDirection(h.swell_direction)} (${h.swell_direction??'-'}°),
            altezza swell: ${(h.swell_height??0).toFixed(2)}m.
          </div>
          ${rogueRisk ? '<div style="color: #f85c50; font-weight: 900; margin-top: 6px;">⚠️ Attenzione! Possibile onda anomala rilevata.</div>' : ''}
        `;
      } else {
        divSummary.textContent = "Dati marine non disponibili.";
      }
      const divAlerts = document.getElementById('marine-alerts');
      divAlerts.textContent = adviceText;
      
      const ctx = document.getElementById('marine-wave-chart').getContext('2d');
      const labels = marineForDay.map(h => h.time && h.time.length > 11 ? h.time.slice(11, 16) : h.time || "");
      if (marineChart) marineChart.destroy();
      marineChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: 'Altezza onda (m)',
              borderColor: '#25A9FA',
              backgroundColor: 'rgba(30,144,255,0.13)',
              fill: true,
              data: waveData,
              borderWidth: 4,
              pointRadius: 3,
              pointBackgroundColor: '#25A9FA',
              tension: 0.28
            },
            {
              label: 'Altezza swell (m)',
              borderColor: '#21D08A',
              backgroundColor: 'rgba(34,255,170,0.10)',
              fill: true,
              data: swellData,
              borderWidth: 4,
              pointRadius: 3,
              pointBackgroundColor: '#21D08A',
              tension: 0.28
            }
          ]
        },
        options: {
          responsive: false,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              labels: {
                color: '#cce6ff',
                font: { size: 22, family: "'Montserrat', 'Roboto', Arial, sans-serif", weight: 'bold' },
                boxWidth: 38,
                boxHeight: 7,
                usePointStyle: true,
                padding: 18
              }
            },
            tooltip: { mode: 'index', intersect: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'm', color: '#bae7fd', font: { size: 16, weight: 'bold' } },
              ticks: { color: '#bfe8ff', font: { size: 18, weight: 'bold' }, stepSize: 0.02, maxTicksLimit: 7 }
            },
            x: {
              title: { display: false },
              ticks: { color: '#ddddff', font: { size: 18, family: "'Roboto', Arial", weight: 'bold' }, maxTicksLimit: 8, padding: 8 }
            }
          },
          layout: { padding: { top: 10, bottom: 11, left: 8, right: 12 } }
        }
      });
    }

    function renderTabs() {
      const tabbar = document.getElementById('tabbar');
      tabbar.innerHTML = '';
      if (!days) return;
      days.forEach((d, idx) => {
        const el = document.createElement('div');
        el.className = idx === current ? 'tab active' : 'tab';
        el.role = 'tab';
        el.id = `tab-${idx}`;
        el.tabIndex = idx === current ? 0 : -1;
        el.setAttribute('aria-selected', idx === current ? 'true' : 'false');
        el.setAttribute('aria-controls', `tabpanel-${idx}`);
        el.setAttribute('aria-label', `Previsioni giorno ${d.day_label}`);
        el.innerHTML = `<div class="bigicon" aria-hidden="true">${d.icon}</div>
            <div>${d.day_label}</div>
            <div><span class="tempmax">${d.temp_max}°</span> <span class="tempmin">${d.temp_min}°</span></div>`;
        el.onclick = () => { switchTab(idx); };
        el.onkeydown = (e) => {
          if(e.key === 'ArrowRight') switchTab((idx + 1) % days.length);
          else if(e.key === 'ArrowLeft') switchTab((idx - 1 + days.length) % days.length);
          else if(e.key === "Enter" || e.key === " ") switchTab(idx);
        };
        tabbar.appendChild(el);
      });
    }

    function switchTab(idx) {
      current = idx;
      renderAll();
      const tab = document.getElementById(`tab-${idx}`);
      if(tab) tab.focus();
    }

    function renderCharts() {
      const d = days && days[current];
      if (!d) return;

      document.getElementById('chartcontainer').innerHTML =
        `<section class="card card-anim" role="region" aria-label="Grafico temperatura oraria">
          <div class="chart-title">Temperatura oraria (°C)</div>
          <div class="canvas-wrap"><canvas id="chart"></canvas></div>
          <div id="chartdesc" hidden>Grafico temperatura in gradi Celsius per ogni ora del giorno.</div>
        </section>`;
      const ctx1 = document.getElementById('chart').getContext('2d');
      if (tempChart) tempChart.destroy();
      tempChart = new Chart(ctx1, {
        type: 'line',
        data: {
          labels: d.hourly_labels,
          datasets: [{
            label: 'Temperatura (°C)',
            data: d.hourly_temps,
            borderColor: 'rgba(255,214,91,1)',
            backgroundColor: 'rgba(255,214,91,0.10)',
            fill: true,
            tension: 0.3,
            pointRadius: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display:false }, tooltip: {mode:'index',intersect:false} },
          scales: {
            y: { beginAtZero: false, title: { display: true, text: '°C', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
            x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
          }
        }
      });

      document.getElementById('windchartcontainer').innerHTML =
        `<section class="card card-anim" role="region" aria-label="Grafico vento orario">
          <div class="chart-title">Vento orario (km/h)</div>
          <div class="canvas-wrap"><canvas id="windchart"></canvas></div>
          <div id="winddesc" hidden>Grafico velocità del vento in chilometri orari per ogni ora del giorno.</div>
        </section>`;
      const ctx2 = document.getElementById('windchart').getContext('2d');
      if (windChart) windChart.destroy();
      windChart = new Chart(ctx2, {
        type: 'line',
        data: {
          labels: d.hourly_labels,
          datasets: [{
            label: 'Vento (km/h)',
            data: d.hourly_winds,
            borderColor: 'rgba(90,184,255,1)',
            backgroundColor: 'rgba(90,184,255,0.18)',
            fill: true,
            tension: 0.3,
            pointRadius: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display:false}, tooltip: {mode:'index',intersect:false} },
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'km/h', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
            x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
          }
        }
      });

      document.getElementById('rainchartcontainer').innerHTML =
        `<section class="card card-anim" role="region" aria-label="Grafico precipitazioni orarie">
          <div class="chart-title">Precipitazioni orarie (mm)</div>
          <div class="canvas-wrap"><canvas id="rainchart"></canvas></div>
          <div id="raindesc" hidden>Grafico precipitazioni in millimetri per ogni ora del giorno.</div>
        </section>`;
      const ctx3 = document.getElementById('rainchart').getContext('2d');
      if (rainChart) rainChart.destroy();
      rainChart = new Chart(ctx3, {
        type: 'bar',
        data: {
          labels: d.hourly_labels,
          datasets: [{
            label: 'Precipitazioni (mm)',
            data: d.hourly_precips,
            backgroundColor: 'rgba(30,180,255,0.73)',
            borderColor: 'rgba(13,80,180,1)',
            borderWidth: 1,
            minBarLength: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display:false}, tooltip: {mode:'index',intersect:false} },
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'mm', color: '#fff' }, ticks: { color:'#fff', font: {weight:'bold'} }},
            x: { title: { display: true, text: 'Ora locale', color: '#fff' }, ticks: { color: '#fff', font: {weight:'bold', size:15}, maxRotation:0, minRotation:0 } }
          }
        }
      });
    }

    function renderAll() {
      if (!days || days.length === 0) {
        document.body.innerHTML = "<h2 style='color:#fff'>Nessun dato meteo disponibile!</h2>";
        return;
      }
      renderMainToday();
      renderTabs();
      renderCharts();
      renderMarine();
      document.getElementById('footer').innerHTML = `Powered by Open-Meteo • UI by micheledv74 • Ultimo agg.: <span id="updated_stamp">${updated_at}</span>`;
    }

    renderAll();

  </script>
</body>
</html>
