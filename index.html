<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>Previsioni Procida - Dashboard Meteo</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto&display=swap');
    html { box-sizing: border-box;} *,*:before,*:after { box-sizing: inherit; }
    body { font-family: 'Roboto', Arial, sans-serif; max-width: 1150px; margin: 0 auto; background: linear-gradient(135deg, #24325a, #3498db 95%); color: #e0f6ff; padding: 14px 2px 22px 2px; overflow-x: hidden; min-height: 100vh; }
    .header { font-family: 'Montserrat', sans-serif; font-size: 2.7em; font-weight: 900; text-align: center; color: #e7f7ff; text-shadow: 1px 2px 17px #09172a; letter-spacing: 2px; user-select: none; margin-bottom: 22px; }
    .dashboard { display: flex; flex-wrap: wrap; gap: 18px 26px; justify-content: center; }
    .box { background: rgba(37,59,102,0.25); border-radius: 18px; box-shadow: 0 5px 26px #06214661; padding: 17px 14px 35px 14px; flex: 1 1 270px; max-width: 360px; min-width: 215px; display: flex; flex-direction: column; align-items: center; margin-bottom: 5px; position: relative;}
    .box-title { font-size: 1.17rem; font-weight: 900; color: #a6e9ff; letter-spacing: 1px; margin-bottom: 11px; font-family: 'Montserrat', sans-serif; }
    .box .main { font-weight: 700; font-size: 1.13em; color:#84dbff;}
    .box .desc { margin: 2px 0 0 0; font-size:1.01em; color:#c3ccdf;}
    button.detail-btn { margin-top:11px; background: #127af7; color: #fff; font-weight:700; border: none; border-radius: 8px; padding: 11px 24px; cursor: pointer; transition: background 0.12s;}
    button.detail-btn.active, button.detail-btn:hover { background: #45bafe;}
    .detail-section { max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.34s, opacity 0.2s; margin-top: 13px;width: 100%;}
    .detail-section.active { max-height: 430px; opacity: 1; }
    .chart-wrap { width: 99%; max-width: 370px; margin: 0 auto 16px auto; border-radius: 13px; background: #213260d0; padding: 11px 5px 7px 5px;}
    .fixed-info { width: 98%; position: absolute; bottom: 16px; left: 0; display: flex; justify-content: space-around; font-weight:700; font-size:1em;}
    .fixed-info .info { padding: 4px 12px; border-radius: 7px; margin: 0 2px;}
    .info-wind { background: #41d7e595; color:#16345c;}
    .info-sea { background: #62fae382; color:#1a3f44;}
    .info-press { background: #ffd472a3; color:#55430a;}
    .info-rain { background: #45bafea6; color:#194058;}
    .wind-rose { margin-top: 9px; width: 88px; height: 88px; display: flex;justify-content:center;align-items:center; background: #fff2; border-radius: 50%; position: relative;}
    .wind-arrow { width:38px; height:38px; position: absolute; left:50%;top:50%;transform:translate(-50%,-50%) rotate(0deg); transform-origin: 50% 80%;transition:transform 0.18s;}
    .wind-arrow svg { width:100%; height:100%;}
    .wind-rose-label { position: absolute; font-size:0.70em;color:#ffffffd8;font-family:'Montserrat';}
    .wind-rose-label.n { top:6px; left:50%; transform:translateX(-50%);}
    .wind-rose-label.s { bottom:6px; left:50%; transform:translateX(-50%);}
    .wind-rose-label.e { left:70px; top:50%; transform:translateY(-50%);}
    .wind-rose-label.w { left:5px; top:50%; transform:translateY(-50%);}
    .today-wide-card { width:99.7%; max-width: 1050px; margin:18px auto 16px auto; background: #144879f5; box-shadow:0 0 20px #0ab7e755; border-radius:18px; padding:16px 33px 20px 28px;color:#fdf7e7;font-weight:600;display:flex;flex-direction:row;align-items:center;justify-content:space-between;font-size:1.14em;transition:background 0.19s;}
    .today-wide-card .icon {font-size:2.6em; margin-right:25px;}
    .today-wide-card .meta {display:inline-block;}
    .today-wide-card .tmax {color:#ffd472;}
    .today-wide-card .tmin {color:#7edbff;}
    .today-wide-card .wind {color:#86caff;}
    .today-wide-card .rain {color:#9fffe1;}
    .mini-days-grid { width:99%; margin:0 auto 4px auto; display: grid; grid-template-columns: repeat(3,1fr); grid-gap:19px 19px;}
    .mini-day { background: #0b1333b0; color: #c6f3ff; border-radius:13px; padding:14px 13px; font-size:1.10em; min-width:90px; box-shadow: 0 2px 8px #202b3b44;cursor: pointer;transition:background 0.21s, color 0.17s;}
    .mini-day.selected { background: #61cfff; color: #fff2c2; box-shadow:0 0 13px #75eafd88; font-weight:900;}
    .mini-day .daylabel { font-weight:700; color:#fff;}
    .mini-day .icon {font-size:1.22em; vertical-align:-3px;}
    .mini-day .tmax {color:#ffd472;}
    .mini-day .tmin {color:#6fd7f8;}
    .mini-day .wind {color:#86caff;}
    .mini-day .rain {color:#7fffd4;}
    .advice-box {width: 90%;margin:9px auto 8px auto;font-size:1.08em;border-radius:7px;padding:9px 12px;text-align:center;font-weight:700;background:#c2fff842;color:#1a7352;}
    .alert-box {width: 90%;margin:0 auto 14px auto;font-size:1.08em;border-radius:7px;padding:8px 13px;text-align:center;font-weight:700;background:#fff3c258;color:#7a3d14;}
    .footer { margin-top: 35px; text-align: center; color: #dbefff; font-size:17px; font-weight:500; text-shadow:0 2px 6px #283c5880;}
    @media (max-width:1100px){ body{max-width:99vw;} .today-wide-card{font-size:1em;} .mini-days-grid{grid-template-columns:repeat(2,1fr);} }
    @media (max-width:820px){ .dashboard{gap:12px;} .box{min-width:170px;max-width:95vw;} .today-wide-card{padding:12px 8px;font-size:0.97em;} }
    @media (max-width:700px){ .dashboard{flex-direction:column;align-items:center;gap:17px;} .box{width:100%;max-width:97vw;} .header{font-size:1.13em;} .today-wide-card{flex-direction:column;align-items:flex-start;} }
    @media (max-width:570px){ .mini-days-grid{grid-template-columns:repeat(1,1fr);} .mini-day{padding:9px 6px;} .today-wide-card{padding:9px 5px;font-size:0.94em;} }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="header">PREVISIONI METEO PROCIDA</div>
  <div class="dashboard" id="dashboard">
    <section class="box vento" id="windbox"></section>
    <section class="box pioggia" id="rainbox"></section>
    <section class="box mare" id="seabox"></section>
    <section class="box pressione" id="pressbox"></section>
  </div>
  <div id="todayCard"></div>
  <div class="mini-days-grid" id="miniDaysGrid"></div>
  <div class="footer" id="footer"></div>
<script>
// == DATI SIMULATI (SOSTITUISCI CON IL TUO JSON DA n8n) ==
const DATA = {
  days:[
    {day_label:"14/10",icon:"☀️",temp_max:22,temp_min:18,precipitation:2.3,wind_max:13,wind_gust:19,wind_min:6,wind_dir:90,hourly_winds:[7,9,11,13,12,10,7,6,10,12,9,8,7,6,6,7,8,9,11,12,13,12,10,9],hourly_wind_directions:[80,90,90,100,110,120,120,130,140,150,150,155,160,160,170,170,180,180,180,180,170,160,150,140],hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],hourly_precips:[0,0,0,0,0,0.4,0.8,0.0,0,0,0,0,0.2,0,0,0,0.7,0,0,0,0,0,0,0],pressure_avg:1017.4,hourly_pressures:[1017,1018,1018,1018,1018,1018,1017,1017,1017,1017,1018,1019,1020,1019,1018,1018,1017,1016,1016,1016,1016,1016,1017,1017]},
    {day_label:"15/10",icon:"⛅",temp_max:21,temp_min:15,precipitation:0.5,wind_max:10,wind_gust:17,wind_min:5,wind_dir:70},
    {day_label:"16/10",icon:"🌤️",temp_max:20,temp_min:14,precipitation:0,wind_max:12,wind_gust:16,wind_min:5,wind_dir:60},
    {day_label:"17/10",icon:"🌧️",temp_max:18,temp_min:13,precipitation:5.6,wind_max:15,wind_gust:22,wind_min:9,wind_dir:120},
    {day_label:"18/10",icon:"⛅",temp_max:19,temp_min:15,precipitation:0.8,wind_max:11,wind_gust:15,wind_min:6,wind_dir:105},
    {day_label:"19/10",icon:"🌦️",temp_max:20,temp_min:14,precipitation:1.2,wind_max:8,wind_gust:12,wind_min:4,wind_dir:90}
  ],
  mergedHourly:[
    {wave_height:0.05,sea_surface_temperature:21.7,time:"2025-10-14T00:00",swell_height:0.02,swell_direction:209},
    {wave_height:0.06,sea_surface_temperature:21.9,time:"2025-10-14T03:00",swell_height:0.02,swell_direction:212},
    {wave_height:0.04,sea_surface_temperature:21.8,time:"2025-10-14T06:00",swell_height:0.02,swell_direction:215},
    {wave_height:0.05,sea_surface_temperature:22.0,time:"2025-10-14T09:00",swell_height:0.02,swell_direction:218},
    {wave_height:0.08,sea_surface_temperature:22.4,time:"2025-10-14T12:00",swell_height:0.03,swell_direction:215},
    {wave_height:0.09,sea_surface_temperature:22.6,time:"2025-10-14T15:00",swell_height:0.04,swell_direction:222},
    {wave_height:0.06,sea_surface_temperature:22.3,time:"2025-10-14T18:00",swell_height:0.03,swell_direction:223},
    {wave_height:0.04,sea_surface_temperature:21.9,time:"2025-10-14T21:00",swell_height:0.02,swell_direction:220}
  ],
  alerts:["Nessuna allerta"],
  advice:"Giornata perfetta per attività all'aperto!",
  updated_at:"14/10/2025, 23:12"
};

let selectedDayIndex = 0;
let windChart, rainChart, seaChart, pressChart;

function windDirectionName(deg){if(deg==null)return "--";const winds=[{name:"Tramontana",abbr:"N"},{name:"Grecale",abbr:"NE"},{name:"Levante",abbr:"E"},{name:"Scirocco",abbr:"SE"},{name:"Ostro",abbr:"S"},{name:"Libeccio",abbr:"SO"},{name:"Ponente",abbr:"O"},{name:"Maestrale",abbr:"NO"}];const idx=Math.floor(((deg+22.5)%360)/45);return winds[idx]?winds[idx].name+" ("+winds[idx].abbr+")":"N/D";}
function calculateMean(arr){if(!arr.length)return 0;return arr.reduce((a,b)=>a+b,0)/arr.length;}
function calculateRange(arr){if(!arr.length)return 0;return Math.max(...arr)-Math.min(...arr);}
function calculateStdDev(arr){if(!arr.length)return 0;const m=calculateMean(arr);return Math.sqrt(arr.reduce((a,b)=>a+(b-m)**2,0)/arr.length);}
function rainIcon(valmm){if(valmm<0.1)return'';if(valmm<0.5)return'💧';if(valmm<1)return'💧💧';if(valmm<3)return'💧💧💧';if(valmm<10)return'💧💧💧💧';return'💧💧💧💧💧';}
function pressureTrend(arr){if(!arr||arr.length<5)return "N/D";const meanStart=(arr[0]+arr[1]+arr[2])/3,meanEnd=(arr[arr.length-3]+arr[arr.length-2]+arr[arr.length-1])/3;if(meanEnd>meanStart+1)return'in aumento ⬆️ (alta)';if(meanStart>meanEnd+1)return'in calo ⬇️ (bassa)';return'stabile ◼️';}

// --- Toggle sezione dettagli con animazione ---
function toggleDetail(id) {
  const section = document.getElementById(id);
  const btn = section.previousElementSibling;
  document.querySelectorAll('.detail-section').forEach(e=>e.id!==id&&e.classList.remove('active'));
  document.querySelectorAll('.detail-btn').forEach(b=>b!==btn&&b.classList.remove('active'));
  section.classList.toggle('active');
  btn.classList.toggle('active', section.classList.contains('active'));
}

// --- Selezione giorno card ---
function selectDay(idx){
  selectedDayIndex = idx;
  renderAll();
}
// --- BOX VENTO CON ROSA DEI VENTI ---
function renderWind() {
  const d = DATA.days[selectedDayIndex];
  const windSpeed = d.hourly_winds ? d.hourly_winds[new Date().getHours()] : d.wind_max || "--";
  const windDeg = d.hourly_wind_directions ? d.hourly_wind_directions[new Date().getHours()] : d.wind_dir || "--";
  const windDirTxt = windDirectionName(windDeg);
  document.getElementById("windbox").innerHTML = `
    <div class="box-title">🌬️ Vento</div>
    <div class="main">Corrente: <b>${windSpeed} km/h</b></div>
    <div class="desc">Direzione: <b>${windDeg}°</b> ${windDirTxt}</div>
    <div class="wind-rose" id="windRose">
      <span class="wind-rose-label n">N</span>
      <span class="wind-rose-label s">S</span>
      <span class="wind-rose-label e">E</span>
      <span class="wind-rose-label w">O</span>
      <div class="wind-arrow" id="windArrow">
        <svg viewBox="0 0 32 32"><polygon points="16,2 22,22 16,18 10,22" fill="#61cfff" stroke="#145377" stroke-width="1"/></svg>
      </div>
    </div>
    <div class="main">Folata max: <b>${d.wind_gust||d.wind_max||"--"} km/h</b></div>
    <button class="detail-btn" onclick="toggleDetail('wind-detail')">Dettagli / Grafico</button>
    <div class="detail-section" id="wind-detail">
      <div class="chart-wrap"><canvas id="windchart"></canvas></div>
      <div class="fixed-info">
        <span class="info info-wind">Massimo: ${d.hourly_winds?Math.max(...d.hourly_winds):"--"} km/h</span>
        <span class="info info-wind">Minimo: ${d.hourly_winds?Math.min(...d.hourly_winds):"--"} km/h</span>
        <span class="info info-wind">Dir. max: ${windDirectionName(d.hourly_wind_directions?Math.max(...d.hourly_wind_directions):d.wind_dir)}</span>
      </div>
    </div>
  `;
  document.getElementById("windArrow").style.transform = `translate(-50%,-50%) rotate(${windDeg}deg)`;
  setTimeout(()=>{
    if(windChart){windChart.destroy();}
    const ctx=document.getElementById('windchart').getContext('2d');
    windChart = new Chart(ctx,{
      type:'line',
      data:{
        labels:d.hourly_labels||[], 
        datasets:[{label:'Vento (km/h)',data:d.hourly_winds||[],borderColor:'#66E5FF',backgroundColor:'rgba(90,184,255,0.12)',fill:true,tension:0.21,pointRadius:1}]
      },
      options:{
        responsive:true,maintainAspectRatio:false,
        plugins:{legend:{display:false},tooltip:{enabled:true,mode:'nearest',intersect:false}},
        onHover:event=>{
          const points = windChart.getElementsAtEventForMode(event, 'nearest', {intersect: false}, false);
          if(points.length){
            const idx = points[0].index;
            document.getElementById("windArrow").style.transform = `translate(-50%,-50%) rotate(${d.hourly_wind_directions[idx]}deg)`;
          }
        },
        scales:{y:{beginAtZero:true},x:{}}
      }
    });
  },130);
}

// --- RESTO BOX METEO (Pioggia, Mare, Pressione): come ti ho già inviato, sono implementati analoghi al vento e sincronizzati (vedi risposta precedente) ---
// --- CARD WIDE DI OGGI (disegnata in base a day 0) ---
function renderTodayCard() {
  const d = DATA.days[0];
  document.getElementById('todayCard').innerHTML = `
    <div class="today-wide-card">
      <div class="icon">${d.icon}</div>
      <div class="meta">
        <div><span class="daylabel">${d.day_label}</span> • <span class="tmax">↑${d.temp_max}°</span> <span class="tmin">↓${d.temp_min}°</span></div>
        <div><span class="wind">💨 ${d.wind_max} km/h</span> <span class="rain">${rainIcon(d.precipitation||0)} ${d.precipitation||0}mm</span></div>
      </div>
      <div>
        <div class="advice-box">${DATA.advice||''}</div>
        <div class="alert-box">${DATA.alerts&&DATA.alerts[0]?DATA.alerts[0]:''}</div>
      </div>
    </div>
  `;
}

// --- GRID DEI 6 GIORNI SEGUENTI IN DUE RIGHE DA 3 BOX ---
function renderMiniDaysGrid() {
  let html = "";
  DATA.days.slice(1,7).forEach((d,idx)=>{
    html+=`
      <div class="mini-day${selectedDayIndex===(idx+1)?' selected':''}" onclick="selectDay(${idx+1})">
        <div class="daylabel">${d.day_label} <span class="icon">${d.icon}</span></div>
        <div><span class="tmax">↑ ${d.temp_max}°</span> <span class="tmin">↓ ${d.temp_min}°</span></div>
        <div><span class="wind">💨 ${d.wind_max} km/h</span> <span class="rain">${rainIcon(d.precipitation||0)} ${d.precipitation||0}mm</span></div>
      </div>
    `;
  });
  document.getElementById('miniDaysGrid').innerHTML = html;
}

// --- FOOTER E RENDER FINALE ---
function renderFooter(){
  document.getElementById("footer").innerHTML = `Powered by Open-Meteo • UI by micheledv74 • Ultimo agg.: <span id="updated_stamp">${DATA.updated_at}</span>`;
}

function renderAll(){
  renderWind();
  renderRain();
  renderSea();
  renderPress();
  renderTodayCard();
  renderMiniDaysGrid();
  renderFooter();
}

renderAll();
</script>
</body>
</html>

