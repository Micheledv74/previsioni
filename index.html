<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>Previsioni Procida - Dashboard Meteo</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto&display=swap');
    html { box-sizing: border-box;} *,*:before,*:after { box-sizing: inherit; }
    body { font-family: 'Roboto', Arial, sans-serif; max-width: 990px; margin: 0 auto; background: linear-gradient(135deg, #26365a, #3498db 92%); color: #f0f8ff; padding: 16px 8px 16px 8px; overflow-x: hidden; min-height: 100vh; }
    .header { font-family: 'Montserrat', sans-serif; font-size: 2.5rem; font-weight: 900; text-align: center; color: #cfe9ff; text-shadow: 1px 2px 14px #09172a; letter-spacing: 2px; user-select: none; margin-bottom: 25px; }
    .dashboard { display: flex; flex-wrap: wrap; gap: 22px; justify-content: center; }
    .box { background: rgba(37,59,102,0.18); border-radius: 22px; box-shadow: 0 6px 30px #0a1b3882; padding: 19px 17px 18px 17px; margin-bottom: 12px; flex: 1 1 320px; max-width: 430px; min-width: 250px; display: flex; flex-direction: column; align-items: center; }
    .box-title { font-size: 1.3rem; font-weight: 900; color: #a9edff; letter-spacing: 1px; margin-bottom: 15px; font-family: 'Montserrat', sans-serif; }
    .wind-gauge { margin: 8px 0 7px 0;}
    .wind-arrow { font-size: 2.4em; vertical-align: middle;}
    .wind-info { font-weight: 700; font-size: 1.11em; color:#84dbff;}
    .wind-desc { margin: 2px 0 0 0; font-size:1.01em; color:#c3ccdf;}
    .rain-main { font-size:1.3em; margin-bottom:5px; color:#79e1fd;}
    .rain-desc { font-size:1.07em; color:#eaefff;}
    .sea-main { font-size:1.2em; margin-bottom:5px; color:#41f8bd;}
    .sea-desc { font-size:1.04em; color:#c3fcff;}
    .press-main { font-size:1.1em; color:#f9e69e; font-weight:700;}
    .press-trend { font-size:1.05em; color:#ffebcf; margin-top:2px;}
    .footer { margin-top: 35px; text-align: center; color: #dbefff; font-size: 17px; font-weight: 500; }
    @media (max-width:800px){ .dashboard{gap:12px;} .box{min-width:180px;max-width:90vw;} }
    @media (max-width:600px){ .dashboard{flex-direction:column;align-items:center;gap:14px;} .box{width:100%;max-width:99vw;} .header{font-size:1.44em;}}
  </style>
</head>
<body>
  <div class="header">PREVISIONI METEO PROCIDA - DASHBOARD</div>
  <div class="dashboard">
    <section class="box vento" id="windbox"></section>
    <section class="box pioggia" id="rainbox"></section>
    <section class="box mare" id="seabox"></section>
    <section class="box pressione" id="pressbox"></section>
  </div>
  <div class="footer" id="footer"></div>
<script>
// --- Simulazione dati (sostituisci con il tuo $json dinamico) ---
const DATA = {
  days: [{
    day_label:"14/10",
    wind_max:10,
    wind_min:3,
    wind_gust:16,
    hourly_winds:[7,8,10,11,9,8,7,6,7,8,10,12,10,11,10,8,7,8,9,10,9,8,7,6],
    hourly_wind_directions:[70,75,80,90,120,130,150,180,190,210,220,221,221,222,222,221,220,218,215,216,215,210,200,190],
    pressure_avg:1018,
    hourly_pressures:[1017,1017,1018,1018,1019,1019,1019,1018,1017,1017,1017,1018,1019,1020,1018,1017,1017,1016,1015,1015,1015,1017,1017,1018],
    precipitation:2.4
  }],
  mergedHourly:[
    {wave_height:0.05,sea_surface_temperature:21.7,time:"2025-10-14T00:00",swell_height:0.02,swell_direction:209},
    {wave_height:0.05,sea_surface_temperature:21.8,time:"2025-10-14T03:00",swell_height:0.02,swell_direction:212},
    {wave_height:0.04,sea_surface_temperature:21.8,time:"2025-10-14T06:00",swell_height:0.02,swell_direction:215},
    {wave_height:0.05,sea_surface_temperature:22.0,time:"2025-10-14T09:00",swell_height:0.02,swell_direction:218},
    {wave_height:0.08,sea_surface_temperature:22.4,time:"2025-10-14T12:00",swell_height:0.03,swell_direction:215},
    {wave_height:0.09,sea_surface_temperature:22.6,time:"2025-10-14T15:00",swell_height:0.04,swell_direction:222},
    {wave_height:0.06,sea_surface_temperature:22.3,time:"2025-10-14T18:00",swell_height:0.03,swell_direction:223},
    {wave_height:0.04,sea_surface_temperature:21.9,time:"2025-10-14T21:00",swell_height:0.02,swell_direction:220}
  ],
  alerts:["Nessuna allerta"],
  advice:"Giornata perfetta per attivit√† all'aperto!",
  updated_at:"14/10/2025, 23:11:00"
};
// ---- Funzioni di supporto ----
function windDirectionName(deg) {
  if(deg==null) return "--";
  const winds = [
    {name:"Tramontana",abbr:"N",arrow:"‚¨áÔ∏è"}, {name:"Grecale",abbr:"NE",arrow:"‚ÜôÔ∏è"},
    {name:"Levante",abbr:"E",arrow:"‚¨ÖÔ∏è"}, {name:"Scirocco",abbr:"SE",arrow:"‚ÜñÔ∏è"},
    {name:"Ostro",abbr:"S",arrow:"‚¨ÜÔ∏è"}, {name:"Libeccio",abbr:"SO",arrow:"‚ÜóÔ∏è"},
    {name:"Ponente",abbr:"O",arrow:"‚û°Ô∏è"}, {name:"Maestrale",abbr:"NO",arrow:"‚ÜòÔ∏è"}];
  const idx = Math.floor(((deg+22.5)%360)/45);
  return winds[idx]?winds[idx]:{name:"N/D",abbr:"?",arrow:"‚¨áÔ∏è"};
}
function rainIcon(valmm){if(valmm<0.1)return'';if(valmm<0.5)return'üíß';if(valmm<1)return'üíßüíß';if(valmm<3)return'üíßüíßüíß';if(valmm<10)return'üíßüíßüíßüíß';return'üíßüíßüíßüíßüíß';}
function calculateMean(arr){if(!arr.length)return 0;return arr.reduce((a,b)=>a+b,0)/arr.length;}
function pressureTrend(arr){
  if (!arr || arr.length < 5) return "N/D";
  const meanStart = (arr[0]+arr[1]+arr[2])/3, meanEnd = (arr[arr.length-3]+arr[arr.length-2]+arr[arr.length-1])/3;
  if (meanEnd > meanStart + 1) return 'in aumento ‚¨ÜÔ∏è (alta)';
  if (meanStart > meanEnd + 1) return 'in calo ‚¨áÔ∏è (bassa)';
  return 'stabile ‚óºÔ∏è';
}
function getMarineDataForDay(){ return DATA.mergedHourly; }
// ---- Render Wind Box ----
function renderWind(){
  const d = DATA.days[0];
  const nowIdx = new Date().getHours();
  const windSpeed = d.hourly_winds[nowIdx] ?? d.wind_max ?? "--";
  const windDeg = d.hourly_wind_directions[nowIdx] ?? "--";
  const windDirInfo = windDirectionName(windDeg);
  document.getElementById("windbox").innerHTML = `
    <div class="box-title">üå¨Ô∏è Vento</div>
    <div class="wind-info">
      <span>Corrente: <b>${windSpeed} km/h</b></span>
    </div>
    <div class="wind-desc">
      Direzione: <b>${windDeg}¬∞</b> (${windDirInfo.name}) <span class="wind-arrow">${windDirInfo.arrow}</span>
    </div>
    <div class="wind-info">
      Folata max: <b>${d.wind_gust || d.wind_max || "--"} km/h</b>
    </div>
    <div class="wind-desc">
      Max oggi: <b>${Math.max(...d.hourly_winds)} km/h</b>
    </div>
  `;
}
// ---- Render Rain Box ----
function renderRain(){
  const d = DATA.days[0];
  const pioggia = d.precipitation || 0;
  document.getElementById("rainbox").innerHTML = `
    <div class="box-title">üåßÔ∏è Pioggia</div>
    <div class="rain-main">
      Totale oggi: <b>${pioggia.toFixed(1)} mm</b> ${rainIcon(pioggia)}
    </div>
    <div class="rain-desc">
      Previsione: ${pioggia > 0 ? "Possibile precipitazione" : "Nessuna pioggia significativa"}
    </div>
  `;
}
// ---- Render Mare Box ----
function renderSea(){
  const marineDayData = getMarineDataForDay();
  const waveMean = calculateMean(marineDayData.map(h=>h.wave_height));
  const seaTemp = calculateMean(marineDayData.map(h=>h.sea_surface_temperature));
  const waveDir = marineDayData[marineDayData.length-1]?.swell_direction;
  const waveDirInfo = windDirectionName(waveDir);
  document.getElementById("seabox").innerHTML = `
    <div class="box-title">üåä Mare</div>
    <div class="sea-main">
      Altezza media onda: <b>${waveMean.toFixed(2)} m</b>
    </div>
    <div class="sea-desc">
      Temperatura media mare: <b>${seaTemp.toFixed(1)} ¬∞C</b>
    </div>
    <div class="sea-desc">
      Direzione Swell: <b>${waveDir}¬∞</b> (${waveDirInfo.name}) <span class="wind-arrow">${waveDirInfo.arrow}</span>
    </div>
  `;
}
// ---- Render Pressione Box ----
function renderPress(){
  const d = DATA.days[0];
  const pressureArr = d.hourly_pressures || [];
  const pressMean = calculateMean(pressureArr);
  const pressTrendTxt = pressureTrend(pressureArr);
  document.getElementById("pressbox").innerHTML = `
    <div class="box-title">üîΩ Pressione atmosferica</div>
    <div class="press-main">
      Media oggi: <b>${pressMean.toFixed(1)} hPa</b>
    </div>
    <div class="press-trend">
      Tendenza: ${pressTrendTxt}
    </div>
  `;
}
// ---- Render Footer ----
function renderFooter(){
  document.getElementById("footer").innerHTML = `Powered by Open-Meteo ‚Ä¢ UI by micheledv74 ‚Ä¢ Ultimo agg.: <span id="updated_stamp">${DATA.updated_at}</span>`;
}
// ---- Render All ----
function renderAll(){
  renderWind();renderRain();renderSea();renderPress();renderFooter();
}
renderAll();
</script>
</body>
</html>
