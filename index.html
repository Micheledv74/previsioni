<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meteo Procida - Previsioni 7 Giorni</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-gradient-start: #1c1c1e;
      --bg-gradient-end: #2c2c2e;
      --card-bg: rgba(255, 255, 255, 0.1);
      --card-border: rgba(255, 255, 255, 0.2);
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --text-tertiary: #636366;
      --accent-blue: #007aff;
      --accent-green: #34c759;
      --accent-orange: #ff9500;
      --accent-red: #ff3b30;
      --accent-yellow: #ffcc00;
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 0;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-md);
    }

    /* === ANIMAZIONI KEYFRAMES === */
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Classe per elementi animati */
    .animate-on-load {
      animation: fadeInUp 0.6s ease-out forwards;
      opacity: 0;
    }

    /* Ritardi scaglionati per effetto cascade */
    .animate-delay-1 { animation-delay: 0.1s; }
    .animate-delay-2 { animation-delay: 0.2s; }
    .animate-delay-3 { animation-delay: 0.3s; }
    .animate-delay-4 { animation-delay: 0.4s; }
    .animate-delay-5 { animation-delay: 0.5s; }
    .animate-delay-6 { animation-delay: 0.6s; }

    /* === HERO SECTION === */
    
    .hero-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 24px;
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-lg);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
      min-height: 50vh;
      animation: fadeInUp 0.8s ease-out;
    }

    .hero-card.hot { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); }
    .hero-card.warm { background: linear-gradient(135deg, #ff9500 0%, #ff6348 100%); }
    .hero-card.mild { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .hero-card.cool { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .hero-card.cold { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }

    .hero-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }

    .hero-location {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 1.1rem;
      font-weight: 500;
      opacity: 0.9;
    }

    .hero-date {
      font-size: 0.95rem;
      opacity: 0.8;
    }

    .hero-main {
      text-align: center;
      margin: var(--spacing-xl) 0;
    }

    .hero-temp {
      font-size: 80px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: var(--spacing-sm);
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: fadeIn 1s ease-out;
    }

    .hero-condition {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      font-size: 1.5rem;
      font-weight: 500;
      margin-bottom: var(--spacing-md);
    }

    .hero-condition i {
      font-size: 3rem;
      animation: fadeIn 1.2s ease-out;
    }

    .hero-minmax {
      display: flex;
      justify-content: center;
      gap: var(--spacing-lg);
      font-size: 1.2rem;
      margin-bottom: var(--spacing-lg);
    }

    .hero-minmax span {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      transition: transform 0.3s ease;
    }

    .hero-minmax span:hover {
      transform: translateY(-2px);
    }

    .hero-summary {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: var(--spacing-md);
      font-size: 1.05rem;
      line-height: 1.6;
      margin-bottom: var(--spacing-md);
      animation: slideInLeft 0.8s ease-out;
    }

    /* === ADVICE PILLS === */
    
    .advice-pills {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
      margin-bottom: var(--spacing-md);
    }

    .advice-pill {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: var(--spacing-xs) var(--spacing-md);
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .advice-pill:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* === DETAILS PILLS === */
    
    .details-pills {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: var(--spacing-sm);
    }

    .detail-pill {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: var(--spacing-sm);
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .detail-pill:hover {
      background: rgba(0, 0, 0, 0.3);
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .detail-pill i {
      font-size: 1.8rem;
      display: block;
      margin-bottom: 4px;
      opacity: 0.9;
      transition: transform 0.3s ease;
    }

    .detail-pill:hover i {
      transform: scale(1.1);
    }

    .detail-pill .value {
      font-size: 1.1rem;
      font-weight: 600;
      display: block;
      margin-bottom: 2px;
    }

    .detail-pill .label {
      font-size: 0.75rem;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* === FASE LUNARE con Unicode Emoji === */
    
    .moon-phase-pill {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .moon-emoji {
      font-size: 2rem;
      display: block;
      margin-bottom: 4px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    /* === WIND ROSE (Rosa dei Venti) === */
    
    .wind-rose-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wind-rose {
      width: 60px;
      height: 60px;
      position: relative;
    }

    .wind-rose-svg {
      width: 100%;
      height: 100%;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .detail-pill:hover .wind-rose-svg {
      transform: rotate(15deg);
    }

    /* === TIMELINE PRECIPITAZIONI === */
    
    .rain-timeline {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      animation: fadeInUp 0.6s ease-out;
      animation-delay: 0.2s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    .timeline-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--spacing-md);
      opacity: 0.9;
    }

    .timeline-bar {
      position: relative;
      height: 60px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: var(--spacing-sm);
    }

    .timeline-period {
      position: absolute;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: white;
      border-radius: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .timeline-period:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      z-index: 10;
    }

    .timeline-period.leggera { background: rgba(52, 199, 89, 0.8); }
    .timeline-period.moderata { background: rgba(255, 149, 0, 0.8); }
    .timeline-period.forte { background: rgba(255, 59, 48, 0.9); }

    .timeline-legend {
      display: flex;
      gap: var(--spacing-md);
      font-size: 0.85rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.2s ease;
    }

    .legend-item:hover {
      transform: scale(1.05);
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* === TEMPERATURE SPARKLINE (Grafico 7 giorni) === */
    
    .temp-chart-container {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      animation: fadeInUp 0.6s ease-out;
      animation-delay: 0.4s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    .chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .temp-chart {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      height: 120px;
      gap: 8px;
      margin-bottom: var(--spacing-sm);
    }

    .temp-bar {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .temp-bar-visual {
      width: 100%;
      background: linear-gradient(180deg, var(--accent-orange), var(--accent-red));
      border-radius: 8px 8px 0 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .temp-bar-visual::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    .temp-bar:hover .temp-bar-visual {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(255, 149, 0, 0.5);
    }

    .temp-value {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent-orange);
    }

    .temp-day-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    /* === STATS GRID === */
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }

    .stat-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: var(--spacing-md);
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      background: rgba(255, 255, 255, 0.12);
    }

    .stat-card i {
      font-size: 2rem;
      margin-bottom: var(--spacing-xs);
      display: block;
      transition: transform 0.3s ease;
    }

    .stat-card:hover i {
      transform: scale(1.1) rotate(5deg);
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      margin: var(--spacing-xs) 0;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    /* === SECTION TITLE === */
    
    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: var(--spacing-xl) 0 var(--spacing-md) 0;
      padding-left: var(--spacing-xs);
      animation: slideInLeft 0.6s ease-out;
    }

    /* === COMPACT DAY CARDS === */
    
    .days-grid {
      display: grid;
      gap: var(--spacing-md);
    }

    .day-card-compact {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: var(--spacing-lg);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
    }

    .day-card-compact:nth-child(1) { animation-delay: 0.5s; }
    .day-card-compact:nth-child(2) { animation-delay: 0.6s; }
    .day-card-compact:nth-child(3) { animation-delay: 0.7s; }
    .day-card-compact:nth-child(4) { animation-delay: 0.8s; }
    .day-card-compact:nth-child(5) { animation-delay: 0.9s; }
    .day-card-compact:nth-child(6) { animation-delay: 1s; }

    .day-card-compact:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
      background: rgba(255, 255, 255, 0.14);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .day-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .day-name {
      font-size: 1.2rem;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    .day-card-compact:hover .day-name {
      color: var(--accent-blue);
    }

    .day-temps-compact {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: 1.5rem;
    }

    .temp-max { 
      font-weight: 700; 
      color: var(--accent-orange);
      transition: transform 0.3s ease;
    }

    .day-card-compact:hover .temp-max {
      transform: scale(1.1);
    }

    .temp-min { 
      color: var(--text-secondary); 
    }

    .day-summary-short {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
      line-height: 1.5;
    }

    .day-details-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
    }

    .detail-compact {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: var(--spacing-sm);
      text-align: center;
      font-size: 0.85rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .detail-compact:hover {
      background: rgba(0, 0, 0, 0.35);
      transform: translateY(-2px);
    }

    .detail-compact i {
      display: block;
      font-size: 1.3rem;
      margin-bottom: 4px;
      opacity: 0.8;
      transition: transform 0.3s ease;
    }

    .detail-compact:hover i {
      transform: scale(1.15);
    }

    .detail-compact .value {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .detail-compact .label {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    /* === ALERTS con Pulse Animation === */
    
    .alerts {
      background: rgba(255, 59, 48, 0.15);
      border-left: 4px solid var(--accent-red);
      border-radius: 12px;
      padding: var(--spacing-md);
      margin: var(--spacing-md) 0;
      font-size: 0.9rem;
      animation: pulse 2s ease-in-out infinite;
    }

    .alerts strong {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    /* === FOOTER === */
    
    footer {
      text-align: center;
      margin-top: var(--spacing-xl);
      padding: var(--spacing-lg);
      color: var(--text-secondary);
      font-size: 0.85rem;
      opacity: 0.7;
      animation: fadeIn 1s ease-out;
      animation-delay: 1.2s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    footer p {
      margin: 6px 0;
    }

    .error-message {
      background: rgba(255, 59, 48, 0.2);
      border: 1px solid var(--accent-red);
      border-radius: 20px;
      padding: var(--spacing-xl);
      text-align: center;
      margin: var(--spacing-lg) 0;
      animation: fadeInUp 0.6s ease-out;
    }

    /* === RESPONSIVE === */
    
    @media (max-width: 768px) {
      .container {
        padding: var(--spacing-sm);
      }

      .hero-card {
        padding: var(--spacing-lg);
        min-height: 60vh;
      }

      .hero-temp {
        font-size: 72px;
      }

      .hero-condition {
        font-size: 1.3rem;
      }

      .hero-condition i {
        font-size: 2.5rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .details-pills {
        grid-template-columns: repeat(3, 1fr);
      }

      .day-details-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .section-title {
        font-size: 1.1rem;
      }

      .temp-chart {
        height: 100px;
      }
    }

    @media (max-width: 390px) {
      .hero-temp {
        font-size: 64px;
      }

      .details-pills {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Rimuovi transizioni da elementi specifici per performance */
    .timeline-period,
    .temp-bar-visual {
      will-change: transform;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HERO CARD - OGGI -->
    <div id="hero-container"></div>

    <!-- TIMELINE PRECIPITAZIONI -->
    <div id="rain-timeline-container"></div>

    <!-- GRAFICO TEMPERATURE 7 GIORNI -->
    <div id="temp-chart-container"></div>

    <!-- STATS SETTIMANALI -->
    <div id="stats-container"></div>

    <!-- GIORNI 2-7 -->
    <h2 class="section-title">📅 Prossimi 6 giorni</h2>
    <div id="forecast-container"></div>

    <footer>
      <p>Dati aggregati da Open-Meteo, Marine Open-Meteo, Weatherbit, Meteoblue e ilmeteo.it</p>
      <p>Analisi meteorologica professionale powered by AI</p>
      <p id="last-update"></p>
    </footer>
  </div>

  <script>
    // IMPORTANTE: In n8n, usa questa sintassi per iniettare i dati
    const weatherData = {"location":"Procida, Italia","generatedAt":"2025-10-21T10:30:00Z","days":[{"date":"2025-10-21","temp":{"min":17.5,"max":19.8,"feels_like":18.7},"rain":{"probability":85,"total_mm":11.5,"periods":[{"start":"09:15","end":"12:45","intensity":"moderata"},{"start":"15:45","end":"18:15","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"09:30","speed_kmh":20,"gusts_kmh":32,"direction":"SE","intensity":"moderato"},{"start":"09:30","end":"23:59","speed_kmh":28,"gusts_kmh":45,"direction":"S","intensity":"forte"}]},"pressure":{"value_hPa":1009,"trend":"in calo"},"sea":{"condition":"mosso","wave_height_m":1.4,"swell_direction":"Sud"},"humidity":88,"uv_index":3,"sunrise":"07:15","sunset":"18:08","moon_phase":"Luna calante","summary":"La giornata odierna a Procida sarà caratterizzata da un cielo prevalentemente coperto con precipitazioni a intermittenza. Una prima fase di piogge moderate è attesa tra le 09:15 e le 12:45, seguita da una pausa temporanea nel primo pomeriggio. Successivamente, tra le 15:45 e le 18:15, si manifesteranno piogge più leggere. Il vento, inizialmente moderato da Sud-Est, rinforzerà gradualmente dopo le 09:30, diventando forte da Sud con raffiche che potranno toccare i 45 km/h. La pressione atmosferica è in diminuzione, indicando condizioni di instabilità. Il mare si presenterà mosso per gran parte della giornata, con onde che potranno raggiungere 1.4 metri.","advice":["Si raccomanda di portare un ombrello o un impermeabile per l'intera giornata, con attenzione particolare alla mattinata.","A causa del vento forte e del mare mosso, si consiglia massima cautela per la navigazione e di evitare uscite con piccole imbarcazioni.","Assicurare oggetti esterni come vasi, tende da sole e arredi da giardino per prevenire danni dovuti alle raffiche di vento."],"alerts":[]},{"date":"2025-10-22","temp":{"min":16.8,"max":18.5,"feels_like":17.5},"rain":{"probability":30,"total_mm":1,"periods":[{"start":"03:00","end":"05:00","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"08:00","speed_kmh":35,"gusts_kmh":55,"direction":"S-SO","intensity":"forte"},{"start":"08:00","end":"16:00","speed_kmh":25,"gusts_kmh":40,"direction":"SO","intensity":"moderato"},{"start":"16:00","end":"23:59","speed_kmh":18,"gusts_kmh":28,"direction":"O","intensity":"leggero"}]},"pressure":{"value_hPa":1012,"trend":"in aumento"},"sea":{"condition":"molto mosso","wave_height_m":2.2,"swell_direction":"Sud-Ovest"},"humidity":80,"uv_index":4,"sunrise":"07:16","sunset":"18:07","moon_phase":"Luna calante","summary":"Mercoledì 22 ottobre vedrà Procida risentir ancora degli effetti della perturbazione notturna, con residue piogge leggere in attenuazione prima dell'alba. Il cielo tenderà a schiarirsi nel corso della mattinata, lasciando spazio a schiarite sempre più ampie nel pomeriggio. Il vento sarà il protagonista, forte da Sud-SudOvest nelle prime ore, con raffiche fino a 55 km/h, per poi diminuire gradualmente d'intensità e ruotare a Ovest nel tardo pomeriggio e sera. L'aumento della pressione indica un miglioramento generale. Le condizioni del mare rimarranno molto mosse per gran parte della giornata, con onde significative, ma si attenderà una progressiva attenuazione entro sera.","advice":["Prestare attenzione al forte vento nelle prime ore del giorno, specie se in prossimità di strutture esposte o alberi.","Il mare sarà molto mosso: si sconsiglia vivamente qualsiasi attività nautica o balneare.","Considerare che la visibilità potrebbe essere ridotta al mattino presto in caso di pioggia residua."],"alerts":["Vento forte al mattino","Mare molto mosso"]},{"date":"2025-10-23","temp":{"min":15,"max":17,"feels_like":16},"rain":{"probability":0,"total_mm":0,"periods":[]},"wind":{"periods":[{"start":"00:00","end":"10:00","speed_kmh":15,"gusts_kmh":25,"direction":"N-NO","intensity":"leggero"},{"start":"10:00","end":"23:59","speed_kmh":10,"gusts_kmh":20,"direction":"NO","intensity":"leggero"}]},"pressure":{"value_hPa":1018,"trend":"in aumento"},"sea":{"condition":"poco mosso","wave_height_m":0.8,"swell_direction":"Nord-Ovest"},"humidity":75,"uv_index":5,"sunrise":"07:17","sunset":"18:06","moon_phase":"Luna calante","summary":"Giovedì si preannuncia una giornata serena e asciutta su Procida, grazie all'influenza di un'alta pressione in rafforzamento. Il cielo sarà limpido o al più velato da nubi alte, con ampi spazi di sole per l'intera giornata. Le temperature subiranno un lieve calo, soprattutto nelle minime notturne, attestandosi su valori più freschi ma gradevoli. Il vento sarà debole o al più leggero, proveniente dai quadranti settentrionali, con raffiche quasi impercettibili. La pressione atmosferica continuerà a salire, stabilizzando ulteriormente le condizioni meteo. Il mare, ancora leggermente mosso al mattino per la residuale onda lunga, tenderà a divenire poco mosso nel corso della giornata, con condizioni ideali per le attività marittime.","advice":["Approfittare della giornata di sole per attività all'aperto; non dimenticare una protezione solare leggera per le ore centrali.","Le condizioni marine saranno in miglioramento, favorevoli per gite in barca e attività costiere.","Considerare le temperature più fresche del mattino e della sera, specialmente se si prevede di stare all'aperto."],"alerts":[]},{"date":"2025-10-24","temp":{"min":15.5,"max":18,"feels_like":17},"rain":{"probability":0,"total_mm":0,"periods":[]},"wind":{"periods":[{"start":"00:00","end":"23:59","speed_kmh":8,"gusts_kmh":15,"direction":"Variabile","intensity":"leggero"}]},"pressure":{"value_hPa":1021,"trend":"stabile"},"sea":{"condition":"calmo","wave_height_m":0.3,"swell_direction":"Variabile"},"humidity":70,"uv_index":5,"sunrise":"07:18","sunset":"18:05","moon_phase":"Luna calante","summary":"Venerdì su Procida sarà una giornata all'insegna della stabilità e del bel tempo, con cielo sereno e temperature miti. L'alta pressione si manterrà ben salda, garantendo assenza di nuvolosità significativa per l'intera durata del giorno. Le temperature massime si riporteranno su valori gradevoli, mentre le minime rimarranno fresche ma senza eccessi. Il vento sarà molto debole, con direzione variabile e raffiche quasi assenti, rendendo l'aria particolarmente calma. La pressione atmosferica si manterrà stabile su valori elevati. Le condizioni del mare saranno eccellenti, con assenza di onde e acque calme per tutta la giornata, ideali per ogni tipo di attività marittima e per godersi il litorale procidano.","advice":["Giornata perfetta per escursioni, passeggiate e attività ricreative all'aria aperta; non dimenticare gli occhiali da sole.","Le condizioni di mare calmo sono ottimali per la pesca, le immersioni e la balneazione (per i più coraggiosi).","È un buon momento per la manutenzione delle imbarcazioni o per spostamenti via mare, data l'assenza di vento e onde."],"alerts":[]},{"date":"2025-10-25","temp":{"min":16,"max":19,"feels_like":18},"rain":{"probability":40,"total_mm":0.5,"periods":[{"start":"21:00","end":"23:59","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"14:00","speed_kmh":12,"gusts_kmh":20,"direction":"E","intensity":"leggero"},{"start":"14:00","end":"23:59","speed_kmh":22,"gusts_kmh":35,"direction":"SE","intensity":"moderato"}]},"pressure":{"value_hPa":1017,"trend":"in lieve calo"},"sea":{"condition":"poco mosso","wave_height_m":0.6,"swell_direction":"Sud-Est"},"humidity":78,"uv_index":4,"sunrise":"07:19","sunset":"18:04","moon_phase":"Luna nuova","summary":"Sabato vedrà un graduale cambiamento delle condizioni meteo su Procida, precursore di una nuova fase di instabilità. La mattinata sarà ancora piuttosto soleggiata o con nubi sparse e temperature miti. Nel corso del pomeriggio, la nuvolosità aumenterà progressivamente, e in serata è prevista la possibilità di leggere piogge isolate, concentrate soprattutto dopo le 21:00. Il vento, che al mattino soffierà leggero da Est, tenderà a rinforzare dal pomeriggio, divenendo moderato da Sud-Est con raffiche fino a 35 km/h. La pressione atmosferica inizierà una lenta discesa. Il mare, inizialmente calmo o quasi, diverrà poco mosso a partire dal pomeriggio, con un'onda lunga in formazione da Sud-Est.","advice":["Godetevi la mattinata all'aperto, ma tenete d'occhio l'evoluzione del cielo nel pomeriggio e preparatevi a eventuali piogge serali.","Chi intende uscire in barca nel pomeriggio o in serata dovrà considerare l'aumento del vento e del moto ondoso.","Controllare gli aggiornamenti serali, la tendenza è al peggioramento per la giornata successiva."],"alerts":[]},{"date":"2025-10-26","temp":{"min":14.5,"max":16.5,"feels_like":15},"rain":{"probability":95,"total_mm":20,"periods":[{"start":"02:00","end":"08:00","intensity":"moderata"},{"start":"10:00","end":"14:00","intensity":"forte"},{"start":"16:00","end":"22:00","intensity":"moderata"}]},"wind":{"periods":[{"start":"00:00","end":"10:00","speed_kmh":40,"gusts_kmh":60,"direction":"S-SO","intensity":"forte"},{"start":"10:00","end":"23:59","speed_kmh":50,"gusts_kmh":75,"direction":"SO","intensity":"molto forte"}]},"pressure":{"value_hPa":998,"trend":"in forte calo"},"sea":{"condition":"molto mosso","wave_height_m":2.8,"swell_direction":"Sud-Ovest"},"humidity":92,"uv_index":1,"sunrise":"07:20","sunset":"18:02","moon_phase":"Luna nuova","summary":"Domenica 26 ottobre sarà una giornata di forte maltempo per Procida. Dalle prime ore del giorno si prevedono piogge diffuse, inizialmente moderate e poi intense tra le 10:00 e le 14:00, con accumuli significativi e possibili rovesci di forte intensità. Nel pomeriggio e sera le precipitazioni torneranno a essere moderate. Il vento sarà l'elemento più critico: inizialmente forte da Sud-SudOvest con raffiche fino a 60 km/h, subirà un ulteriore rinforzo dopo le 10:00, diventando molto forte da Sud-Ovest, con raffiche estreme che potranno superare i 75 km/h. La pressione atmosferica crollerà, indicando una profonda depressione. Il mare sarà agitato o molto agitato, con onde che potranno raggiungere quasi i 3 metri, rendendo la navigazione estremamente pericolosa. Massima allerta per l'intera giornata.","advice":["Evitare spostamenti non strettamente necessari e rimanere al riparo per l'intera giornata a causa delle intense piogge e del vento fortissimo.","Sospendere qualsiasi attività nautica o balneare; il mare sarà molto agitato e pericoloso.","Verificare il corretto ancoraggio di barche e natanti, e mettere in sicurezza qualsiasi oggetto esposto all'esterno che possa essere danneggiato o volare via a causa delle raffiche eccezionali."],"alerts":["ALLERTA ROSSA: Maltempo estremo, piogge abbondanti e persistenti","ALLERTA ROSSA: Vento molto forte con raffiche superiori a 75 km/h","ALLERTA ROSSA: Mare molto mosso o agitato con onde alte e pericolose"]},{"date":"2025-10-27","temp":{"min":13,"max":15.5,"feels_like":14},"rain":{"probability":60,"total_mm":5,"periods":[{"start":"00:00","end":"04:00","intensity":"moderata"},{"start":"04:00","end":"07:00","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"06:00","speed_kmh":45,"gusts_kmh":65,"direction":"O-SO","intensity":"molto forte"},{"start":"06:00","end":"14:00","speed_kmh":30,"gusts_kmh":50,"direction":"O","intensity":"forte"},{"start":"14:00","end":"23:59","speed_kmh":20,"gusts_kmh":35,"direction":"NO","intensity":"moderato"}]},"pressure":{"value_hPa":1005,"trend":"in aumento"},"sea":{"condition":"agitato","wave_height_m":3.2,"swell_direction":"Ovest"},"humidity":85,"uv_index":2,"sunrise":"07:21","sunset":"18:01","moon_phase":"Luna nuova","summary":"Lunedì 27 ottobre sarà ancora una giornata perturbata per Procida, seppur con segnali di lento miglioramento nel corso del giorno. La notte e l'alba saranno caratterizzate da piogge moderate e poi leggere, che tenderanno a cessare entro la mattinata, lasciando spazio a cieli nuvolosi ma con occasionali schiarite pomeridiane. Le temperature subiranno un ulteriore calo, rendendo l'aria più fredda e umida. Il vento rimarrà molto forte da Ovest-SudOvest nelle prime ore, con raffiche fino a 65 km/h, per poi diminuire gradualmente d'intensità nel corso della giornata, pur mantenendosi forte o moderato. La pressione atmosferica inizierà a risalire. Il mare, inizialmente agitato con onde oltre i 3 metri, si manterrà molto mosso per gran parte del giorno, calando solo verso sera.","advice":["Nonostante un lieve miglioramento, le condizioni rimangono difficili: prestare massima attenzione ai residui di pioggia e al vento ancora intenso.","Evitare ancora attività in mare aperto a causa del mare agitato e molto mosso; le condizioni rimarranno impegnative per i primi due terzi della giornata.","Indossare abbigliamento caldo e impermeabile, considerando il calo delle temperature e l'umidità elevata."],"alerts":["ALLERTA ARANCIONE: Vento forte e mare molto mosso/agitato","ALLERTA GIALLA: Piogge residue al mattino"]}],"processedAt":"2025-10-21T15:29:01.661Z","totalDays":7,"weekStats":{"maxTemp":19.8,"minTemp":13,"avgTemp":"17.8","rainyDays":5}};

    // === FUNZIONI HELPER ===
    
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const giorni = ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato'];
      const mesi = ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'];
      return `${giorni[date.getDay()]} ${date.getDate()} ${mesi[date.getMonth()]}`;
    }

    function getShortDate(dateStr) {
      const date = new Date(dateStr);
      const giorni = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
      return giorni[date.getDay()];
    }

    function getWeatherIcon(summary) {
      const text = (summary || '').toLowerCase();
      if (text.includes('temporale') || text.includes('tuoni')) return 'wi-thunderstorm';
      if (text.includes('pioggia forte') || text.includes('intense')) return 'wi-rain';
      if (text.includes('pioggia')) return 'wi-showers';
      if (text.includes('neve')) return 'wi-snow';
      if (text.includes('nebbia')) return 'wi-fog';
      if (text.includes('nuvoloso') || text.includes('coperto')) return 'wi-cloudy';
      if (text.includes('parzialmente')) return 'wi-day-cloudy';
      if (text.includes('sereno') || text.includes('sole')) return 'wi-day-sunny';
      return 'wi-day-cloudy';
    }

    function getTempClass(temp) {
      if (temp >= 28) return 'hot';
      if (temp >= 22) return 'warm';
      if (temp >= 15) return 'mild';
      if (temp >= 8) return 'cool';
      return 'cold';
    }

    function getTimePosition(timeStr) {
      const [hours, minutes] = timeStr.split(':').map(Number);
      return ((hours * 60 + minutes) / 1440) * 100;
    }

    // === NUOVA FUNZIONE: Moon Phase Emoji ===
    function getMoonPhaseEmoji(phaseText) {
      if (!phaseText) return '🌕';
      const phase = phaseText.toLowerCase();
      
      if (phase.includes('nuova') || phase.includes('new')) return '🌑';
      if (phase.includes('crescente') && phase.includes('primo')) return '🌓';
      if (phase.includes('crescente')) return '🌒';
      if (phase.includes('gibbosa') && phase.includes('crescente')) return '🌔';
      if (phase.includes('piena') || phase.includes('full')) return '🌕';
      if (phase.includes('gibbosa') && phase.includes('calante')) return '🌖';
      if (phase.includes('calante') && phase.includes('ultimo')) return '🌗';
      if (phase.includes('calante')) return '🌘';
      
      return '🌕'; // default full moon
    }

    // === NUOVA FUNZIONE: Wind Rose SVG ===
    function createWindRoseSVG(direction, speed) {
      const angle = getWindAngle(direction);
      
      return `
        <svg class="wind-rose-svg" viewBox="0 0 100 100" style="transform: rotate(${angle}deg)">
          <circle cx="50" cy="50" r="48" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2"/>
          <circle cx="50" cy="50" r="35" fill="none" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
          <circle cx="50" cy="50" r="22" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
          
          <!-- Punti cardinali -->
          <text x="50" y="12" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="10" font-weight="600">N</text>
          <text x="88" y="55" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">E</text>
          <text x="50" y="92" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">S</text>
          <text x="12" y="55" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">O</text>
          
          <!-- Freccia indicatore vento -->
          <path d="M 50 20 L 55 40 L 50 35 L 45 40 Z" fill="#007aff" opacity="0.9"/>
          <path d="M 50 35 L 50 70" stroke="#007aff" stroke-width="3" stroke-linecap="round"/>
          <circle cx="50" cy="50" r="5" fill="#007aff"/>
        </svg>
      `;
    }

    function getWindAngle(direction) {
      const directions = {
        'N': 0, 'NNE': 22.5, 'NE': 45, 'ENE': 67.5,
        'E': 90, 'ESE': 112.5, 'SE': 135, 'SSE': 157.5,
        'S': 180, 'SSW': 202.5, 'SW': 225, 'WSW': 247.5,
        'W': 270, 'WNW': 292.5, 'NW': 315, 'NNW': 337.5,
        'SSO': 202.5, 'SO': 225, 'OSO': 247.5, 'O': 270,
        'ONO': 292.5, 'NO': 315, 'NNO': 337.5
      };
      return directions[direction?.toUpperCase()] || 0;
    }

    // === RENDER HERO CARD ===
    
    function renderHero() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
      
      const today = weatherData.days[0];
      const tempClass = getTempClass(today.temp?.max || 20);
      const weatherIcon = getWeatherIcon(today.summary);
      const moonEmoji = getMoonPhaseEmoji(today.moon_phase);
      
      const html = `
        <div class="hero-card ${tempClass}">
          <div class="hero-header">
            <div class="hero-location">
              <i class="wi wi-horizon"></i>
              ${weatherData.location || 'Procida'}
            </div>
            <div class="hero-date">${formatDate(today.date)}</div>
          </div>

          <div class="hero-main">
            <div class="hero-temp">${Math.round(today.temp?.max || today.temp?.feels_like || 20)}°</div>
            
            <div class="hero-condition">
              <i class="wi ${weatherIcon}"></i>
              <span>${getConditionText(today)}</span>
            </div>

            <div class="hero-minmax">
              <span>
                <i class="wi wi-direction-down"></i>
                ${Math.round(today.temp?.min || 15)}°
              </span>
              <span>
                <i class="wi wi-direction-up"></i>
                ${Math.round(today.temp?.max || 20)}°
              </span>
            </div>
          </div>

          ${today.summary ? `
            <div class="hero-summary">
              ${today.summary}
            </div>
          ` : ''}

          ${today.advice && today.advice.length > 0 ? `
            <div class="advice-pills">
              ${today.advice.map(a => `
                <div class="advice-pill">
                  💡 ${a}
                </div>
              `).join('')}
            </div>
          ` : ''}

          ${today.alerts && today.alerts.length > 0 ? `
            <div class="alerts">
              <strong>⚠️ ALLERTE METEO</strong>
              ${today.alerts.map(a => `<p>${a}</p>`).join('')}
            </div>
          ` : ''}

          <div class="details-pills">
            ${today.rain && today.rain.probability > 0 ? `
              <div class="detail-pill">
                <i class="wi wi-raindrop"></i>
                <span class="value">${today.rain.probability}%</span>
                <span class="label">Pioggia</span>
              </div>
            ` : ''}
            
            ${today.wind && today.wind.periods && today.wind.periods[0] ? `
              <div class="detail-pill">
                <div class="wind-rose-container">
                  ${createWindRoseSVG(today.wind.periods[0].direction, today.wind.periods[0].speed_kmh)}
                </div>
                <span class="value">${today.wind.periods[0].speed_kmh} km/h</span>
                <span class="label">${today.wind.periods[0].direction}</span>
              </div>
            ` : ''}

            ${today.humidity ? `
              <div class="detail-pill">
                <i class="wi wi-humidity"></i>
                <span class="value">${today.humidity}%</span>
                <span class="label">Umidità</span>
              </div>
            ` : ''}

            ${today.uv_index ? `
              <div class="detail-pill">
                <i class="wi wi-day-sunny"></i>
                <span class="value">${today.uv_index}</span>
                <span class="label">UV</span>
              </div>
            ` : ''}

            ${today.pressure ? `
              <div class="detail-pill">
                <i class="wi wi-barometer"></i>
                <span class="value">${today.pressure.value_hPa}</span>
                <span class="label">hPa</span>
              </div>
            ` : ''}

            ${today.sea ? `
              <div class="detail-pill">
                <i class="wi wi-tsunami"></i>
                <span class="value">${today.sea.wave_height_m}m</span>
                <span class="label">${today.sea.condition}</span>
              </div>
            ` : ''}

            ${today.sunrise ? `
              <div class="detail-pill">
                <i class="wi wi-sunrise"></i>
                <span class="value">${today.sunrise}</span>
                <span class="label">Alba</span>
              </div>
            ` : ''}

            ${today.sunset ? `
              <div class="detail-pill">
                <i class="wi wi-sunset"></i>
                <span class="value">${today.sunset}</span>
                <span class="label">Tramonto</span>
              </div>
            ` : ''}

            ${today.moon_phase ? `
              <div class="detail-pill moon-phase-pill">
                <span class="moon-emoji">${moonEmoji}</span>
                <span class="label">${today.moon_phase}</span>
              </div>
            ` : ''}
          </div>
        </div>
      `;
      
      document.getElementById('hero-container').innerHTML = html;
    }

    function getConditionText(day) {
      if (day.rain && day.rain.probability > 70) return 'Pioggia';
      if (day.rain && day.rain.probability > 40) return 'Possibile pioggia';
      const summary = (day.summary || '').toLowerCase();
      if (summary.includes('sereno')) return 'Sereno';
      if (summary.includes('nuvoloso')) return 'Nuvoloso';
      return 'Variabile';
    }

    // === RENDER RAIN TIMELINE ===
    
    function renderRainTimeline() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
      
      const today = weatherData.days[0];
      if (!today.rain || !today.rain.periods || today.rain.periods.length === 0) return;

      const periodsHTML = today.rain.periods.map(p => {
        const start = getTimePosition(p.start);
        const end = getTimePosition(p.end);
        const width = end - start;
        
        return `
          <div class="timeline-period ${p.intensity}" 
               style="left: ${start}%; width: ${width}%;"
               title="${p.start} - ${p.end}: ${p.intensity}">
            <span>${p.start}-${p.end}</span>
          </div>
        `;
      }).join('');

      const html = `
        <div class="rain-timeline">
          <div class="timeline-header">
            <i class="wi wi-rain"></i>
            Precipitazioni Oggi (${today.rain.total_mm}mm totali)
          </div>
          
          <div class="timeline-bar">
            ${periodsHTML}
          </div>

          <div class="timeline-legend">
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(52, 199, 89, 0.8);"></div>
              <span>Leggera</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(255, 149, 0, 0.8);"></div>
              <span>Moderata</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(255, 59, 48, 0.9);"></div>
              <span>Forte</span>
            </div>
          </div>
        </div>
      `;

      document.getElementById('rain-timeline-container').innerHTML = html;
    }

    // === NUOVA FUNZIONE: Temperature Chart ===
    function renderTempChart() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;

      const temps = weatherData.days.map(d => d.temp?.max || 20);
      const maxTemp = Math.max(...temps);
      const minTemp = Math.min(...temps);
      const range = maxTemp - minTemp || 1;

      const barsHTML = weatherData.days.map((day, i) => {
        const temp = day.temp?.max || 20;
        const height = ((temp - minTemp) / range) * 100;
        
        return `
          <div class="temp-bar">
            <div class="temp-value">${Math.round(temp)}°</div>
            <div class="temp-bar-visual" style="height: ${height}px; min-height: 20px;"></div>
            <div class="temp-day-label">${getShortDate(day.date)}</div>
          </div>
        `;
      }).join('');

      const html = `
        <div class="temp-chart-container">
          <div class="chart-title">
            <i class="wi wi-thermometer"></i>
            Temperature Massime - 7 Giorni
          </div>
          <div class="temp-chart">
            ${barsHTML}
          </div>
        </div>
      `;

      document.getElementById('temp-chart-container').innerHTML = html;
    }

    // === RENDER STATS ===
    
    function renderStats() {
      if (!weatherData || !weatherData.weekStats) return;
      const stats = weatherData.weekStats;
      
      const html = `
        <div class="stats-grid">
          <div class="stat-card animate-on-load animate-delay-1">
            <i class="wi wi-thermometer" style="color: var(--accent-orange);"></i>
            <div class="stat-value">${stats.maxTemp}°C</div>
            <div class="stat-label">Max Settimana</div>
          </div>
          <div class="stat-card animate-on-load animate-delay-2">
            <i class="wi wi-thermometer-exterior" style="color: var(--accent-blue);"></i>
            <div class="stat-value">${stats.minTemp}°C</div>
            <div class="stat-label">Min Settimana</div>
          </div>
          <div class="stat-card animate-on-load animate-delay-3">
            <i class="wi wi-thermometer" style="color: var(--accent-green);"></i>
            <div class="stat-value">${stats.avgTemp}°C</div>
            <div class="stat-label">Media</div>
          </div>
          <div class="stat-card animate-on-load animate-delay-4">
            <i class="wi wi-rain" style="color: var(--accent-blue);"></i>
            <div class="stat-value">${stats.rainyDays}</div>
            <div class="stat-label">Giorni Pioggia</div>
          </div>
        </div>
      `;
      
      document.getElementById('stats-container').innerHTML = html;
    }

    // === RENDER FORECAST DAYS 2-7 ===
    
    function renderForecast() {
      if (!weatherData || !weatherData.days || weatherData.days.length < 2) {
        document.getElementById('forecast-container').innerHTML = `
          <div class="error-message">
            <h2>⚠️ Errore nel caricamento dei dati</h2>
            <p>Impossibile recuperare le previsioni meteo. Riprova più tardi.</p>
          </div>
        `;
        return;
      }

      const futureDays = weatherData.days.slice(1);

      const html = futureDays.map(day => {
        const moonEmoji = getMoonPhaseEmoji(day.moon_phase);
        
        return `
        <div class="day-card-compact">
          <div class="day-card-header">
            <div class="day-name">${formatDate(day.date)}</div>
            <div class="day-temps-compact">
              <span class="temp-max">${Math.round(day.temp?.max || 20)}°</span>
              <span class="temp-min">${Math.round(day.temp?.min || 15)}°</span>
            </div>
          </div>

          ${day.summary ? `
            <div class="day-summary-short">${day.summary}</div>
          ` : ''}

          ${day.advice && day.advice.length > 0 ? `
            <div class="advice-pills">
              ${day.advice.slice(0, 2).map(a => `
                <div class="advice-pill">💡 ${a}</div>
              `).join('')}
            </div>
          ` : ''}

          ${day.alerts && day.alerts.length > 0 ? `
            <div class="alerts">
              <strong>⚠️ ALLERTE</strong>
              ${day.alerts.map(a => `<p>${a}</p>`).join('')}
            </div>
          ` : ''}

          <div class="day-details-row">
            ${day.rain && day.rain.probability > 0 ? `
              <div class="detail-compact">
                <i class="wi wi-raindrop"></i>
                <div class="value">${day.rain.probability}%</div>
                <div class="label">${day.rain.total_mm}mm</div>
              </div>
            ` : ''}

            ${day.wind && day.wind.periods && day.wind.periods[0] ? `
              <div class="detail-compact">
                <div style="width: 40px; height: 40px; margin: 0 auto 4px;">
                  ${createWindRoseSVG(day.wind.periods[0].direction, day.wind.periods[0].speed_kmh)}
                </div>
                <div class="value">${day.wind.periods[0].speed_kmh} km/h</div>
                <div class="label">${day.wind.periods[0].direction}</div>
              </div>
            ` : ''}

            ${day.sea ? `
              <div class="detail-compact">
                <i class="wi wi-tsunami"></i>
                <div class="value">${day.sea.wave_height_m}m</div>
                <div class="label">${day.sea.condition}</div>
              </div>
            ` : ''}

            ${day.humidity ? `
              <div class="detail-compact">
                <i class="wi wi-humidity"></i>
                <div class="value">${day.humidity}%</div>
                <div class="label">Umidità</div>
              </div>
            ` : ''}

            ${day.uv_index ? `
              <div class="detail-compact">
                <i class="wi wi-day-sunny"></i>
                <div class="value">${day.uv_index}</div>
                <div class="label">UV Index</div>
              </div>
            ` : ''}

            ${day.pressure ? `
              <div class="detail-compact">
                <i class="wi wi-barometer"></i>
                <div class="value">${day.pressure.value_hPa}</div>
                <div class="label">${day.pressure.trend || 'hPa'}</div>
              </div>
            ` : ''}

            ${day.moon_phase ? `
              <div class="detail-compact">
                <span style="font-size: 1.5rem; display: block; margin-bottom: 4px;">${moonEmoji}</span>
                <div class="label">${day.moon_phase}</div>
              </div>
            ` : ''}
          </div>
        </div>
      `}).join('');

      document.getElementById('forecast-container').innerHTML = `<div class="days-grid">${html}</div>`;
    }

    // === UPDATE TIMESTAMP ===
    
    function updateTimestamp() {
      if (weatherData && weatherData.generatedAt) {
        const date = new Date(weatherData.generatedAt);
        document.getElementById('last-update').textContent = 
          `Ultimo aggiornamento: ${date.toLocaleString('it-IT')}`;
      }
    }

    // === INIZIALIZZAZIONE ===
    
    renderHero();
    renderRainTimeline();
    renderTempChart();
    renderStats();
    renderForecast();
    updateTimestamp();
  </script>
</body>
</html>
