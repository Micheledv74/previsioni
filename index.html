<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>Test Grafico Vento Dinamico</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background:#22365c; color:#f0f8ff; font-family:Roboto,Arial,sans-serif;}
    .mini-day { cursor:pointer; padding:8px 12px; background:#355088; border-radius:7px; margin:3px; display:inline-block; }
    .mini-day.active { background:#4fa9df; font-weight:700; color:#fff;}
    .wind-box { max-width:410px; margin:30px auto; padding:22px; background:rgba(37,59,102,0.22); border-radius:16px;}
  </style>
</head>
<body>
  <div id="miniDaysBox"></div>
  <div class="wind-box" id="windbox"></div>
<script>
const DATA = {
  days:[
    { day_label:"14/10", icon:"‚òÄÔ∏è", wind_max:13, wind_gust:19, wind_min:6, wind_dir:90,
      hourly_winds:[7,9,11,13,12,10,7,6,10,12,9,8,7,6,6,7,8,9,11,12,13,12,10,9],
      hourly_wind_directions:[80,90,90,100,110,120,120,130,140,150,150,155,160,160,170,170,180,180,180,180,170,160,150,140],
      hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"]
    },
    { day_label:"15/10", icon:"‚õÖ", wind_max:10, wind_gust:17, wind_min:5, wind_dir:70,
      hourly_winds:[5,7,8,9,7,8,8,8,9,10,10,9,8,8,7,6,8,8,7,7,6,6,5,5],
      hourly_wind_directions:[70,72,75,76,78,80,83,85,87,90,92,95,97,98,99,100,100,101,102,103,103,104,105,105],
      hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"]
    }
  ]
};

let selectedDayIndex = 0;
let windChart;

function renderMiniDays() {
  let html = "";
  DATA.days.forEach((d, i) => {
    html += `<div class="mini-day${i === selectedDayIndex ? " active" : ""}" onclick="selectDay(${i})">
        ${d.day_label} <span>${d.icon}</span>
      </div>`;
  });
  document.getElementById("miniDaysBox").innerHTML = html;
}

function selectDay(dayIndex) {
  selectedDayIndex = dayIndex;
  renderWind();
  renderMiniDays();
}

function windDirectionName(deg) {
  const winds = [
    {name:"Tramontana",abbr:"N"}, {name:"Grecale",abbr:"NE"},
    {name:"Levante",abbr:"E"}, {name:"Scirocco",abbr:"SE"},
    {name:"Ostro",abbr:"S"}, {name:"Libeccio",abbr:"SO"},
    {name:"Ponente",abbr:"O"}, {name:"Maestrale",abbr:"NO"}];
  const idx = Math.floor(((deg+22.5)%360)/45);
  return winds[idx]?winds[idx].name+" ("+winds[idx].abbr+")":"N/D";
}

function renderWind() {
  const d = DATA.days[selectedDayIndex];
  const windSpeed = d.hourly_winds ? d.hourly_winds[new Date().getHours()] : d.wind_max || "--";
  const windDeg = d.hourly_wind_directions ? d.hourly_wind_directions[new Date().getHours()] : d.wind_dir || "--";
  const windDirTxt = windDirectionName(windDeg);
  document.getElementById("windbox").innerHTML = `
    <h3>üå¨Ô∏è Vento ${d.day_label}</h3>
    <div>üçÉ ${windSpeed} km/h ‚éã ${windDeg}¬∞ ${windDirTxt}</div>
    <div>Folata max: <b>${d.wind_gust || d.wind_max || "--"} km/h</b></div>
    <button onclick="toggleWindDetail()">Dettagli / Grafico</button>
    <div id="wind-detail" style="display:none;">
      <canvas id="windchart"></canvas>
    </div>
  `;
}

function toggleWindDetail() {
  const el = document.getElementById('wind-detail');
  el.style.display = el.style.display === "none" ? "block" : "none";
  if (el.style.display === "block") {
    renderWindChart();
  } else {
    if(windChart) windChart.destroy();
  }
}

function renderWindChart() {
  const d = DATA.days[selectedDayIndex];
  if (windChart) windChart.destroy();
  const ctx = document.getElementById('windchart').getContext('2d');
  windChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Vento (km/h)',
        data: d.hourly_winds,
        borderColor: '#66E5FF',
        backgroundColor: 'rgba(90,184,255,0.12)',
        fill: true,
        tension: 0.21,
        pointRadius: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {legend: {display: false}},
      scales: {y: {beginAtZero: true}, x:{}}
    }
  });
}

renderMiniDays();
renderWind();
</script>
</body>
</html>
