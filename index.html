<!-- Aggiungi questa sezione nel body della pagina, sotto le altre info meteo -->
<section id="marine-conditions" style="max-width:700px; margin: 24px auto; background: rgba(20,30,55,0.41); border-radius: 20px; padding: 16px 12px; color: #a8cff8; font-family: Arial, sans-serif; box-shadow: 0 0 16px #1352a4bb;">
  <h3 style="font-weight: 700; font-size: 1.3rem; margin-bottom: 8px; color: #e0f0ff;">Condizioni Marine</h3>
  <div id="marine-summary" style="margin-bottom: 11px; font-size: 1.00rem;"></div>
  <div style="width:100%; max-width: 530px; height: 146px; margin:0 auto 7px auto;">
    <canvas id="marine-wave-chart" width="530" height="140"></canvas>
  </div>
  <div id="marine-alerts" style="margin-top: 8px; color: #ffcc66; font-weight: 700; font-size: 1rem;"></div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const marineData = {"mergedHourly":[{"time":"2025-10-12T00:00","wave_height":0.18,"swell_height":0.12,"swell_direction":246},{"time":"2025-10-12T01:00","wave_height":0.2,"swell_height":0.1,"swell_direction":276},{"time":"2025-10-12T02:00","wave_height":0.22,"swell_height":0.1,"swell_direction":306},{"time":"2025-10-12T03:00","wave_height":0.22,"swell_height":0.1,"swell_direction":272},{"time":"2025-10-12T04:00","wave_height":0.24,"swell_height":0.1,"swell_direction":239},{"time":"2025-10-12T05:00","wave_height":0.24,"swell_height":0.1,"swell_direction":205},{"time":"2025-10-12T06:00","wave_height":0.22,"swell_height":0.1,"swell_direction":170},{"time":"2025-10-12T07:00","wave_height":0.22,"swell_height":0.1,"swell_direction":136},{"time":"2025-10-12T08:00","wave_height":0.2,"swell_height":0.1,"swell_direction":101},{"time":"2025-10-12T09:00","wave_height":0.18,"swell_height":0.1,"swell_direction":85},{"time":"2025-10-12T10:00","wave_height":0.16,"swell_height":0.12,"swell_direction":70},{"time":"2025-10-12T11:00","wave_height":0.14,"swell_height":0.12,"swell_direction":54},{"time":"2025-10-12T12:00","wave_height":0.12,"swell_height":0.1,"swell_direction":106},{"time":"2025-10-12T13:00","wave_height":0.12,"swell_height":0.08,"swell_direction":157},{"time":"2025-10-12T14:00","wave_height":0.1,"swell_height":0.06,"swell_direction":209},{"time":"2025-10-12T15:00","wave_height":0.1,"swell_height":0.06,"swell_direction":207},{"time":"2025-10-12T16:00","wave_height":0.08,"swell_height":0.04,"swell_direction":206},{"time":"2025-10-12T17:00","wave_height":0.08,"swell_height":0.04,"swell_direction":204},{"time":"2025-10-12T18:00","wave_height":0.08,"swell_height":0.04,"swell_direction":206},{"time":"2025-10-12T19:00","wave_height":0.06,"swell_height":0.04,"swell_direction":207},{"time":"2025-10-12T20:00","wave_height":0.06,"swell_height":0.04,"swell_direction":209},{"time":"2025-10-12T21:00","wave_height":0.06,"swell_height":0.04,"swell_direction":209},{"time":"2025-10-12T22:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209},{"time":"2025-10-12T23:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209},{"time":"2025-10-13T00:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209},{"time":"2025-10-13T01:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209},{"time":"2025-10-13T02:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209},{"time":"2025-10-13T03:00","wave_height":0.04,"swell_height":0.04,"swell_direction":209},{"time":"2025-10-13T04:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209},{"time":"2025-10-13T05:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209},{"time":"2025-10-13T06:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209},{"time":"2025-10-13T07:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T08:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T09:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T10:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T11:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T12:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T13:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T14:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T15:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T16:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T17:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T18:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T19:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T20:00","wave_height":0.04,"swell_height":0.02,"swell_direction":208},{"time":"2025-10-13T21:00","wave_height":0.04,"swell_height":0.02,"swell_direction":209},{"time":"2025-10-13T22:00","wave_height":0.04,"swell_height":0.02,"swell_direction":211},{"time":"2025-10-13T23:00","wave_height":0.04,"swell_height":0.02,"swell_direction":212},{"time":"2025-10-14T00:00","wave_height":0.04,"swell_height":0.02,"swell_direction":245},{"time":"2025-10-14T01:00","wave_height":0.04,"swell_height":0.04,"swell_direction":278},{"time":"2025-10-14T02:00","wave_height":0.04,"swell_height":0.04,"swell_direction":311},{"time":"2025-10-14T03:00","wave_height":0.04,"swell_height":0.04,"swell_direction":310},{"time":"2025-10-14T04:00","wave_height":0.04,"swell_height":0.04,"swell_direction":309},{"time":"2025-10-14T05:00","wave_height":0.04,"swell_height":0.04,"swell_direction":308},{"time":"2025-10-14T06:00","wave_height":0.04,"swell_height":0.04,"swell_direction":307},{"time":"2025-10-14T07:00","wave_height":0.04,"swell_height":0.04,"swell_direction":307},{"time":"2025-10-14T08:00","wave_height":0.04,"swell_height":0.04,"swell_direction":306},{"time":"2025-10-14T09:00","wave_height":0.04,"swell_height":0.04,"swell_direction":305},{"time":"2025-10-14T10:00","wave_height":0.04,"swell_height":0.04,"swell_direction":304},{"time":"2025-10-14T11:00","wave_height":0.04,"swell_height":0.04,"swell_direction":303},{"time":"2025-10-14T12:00","wave_height":0.04,"swell_height":0.04,"swell_direction":303},{"time":"2025-10-14T13:00","wave_height":0.04,"swell_height":0.04,"swell_direction":303},{"time":"2025-10-14T14:00","wave_height":0.04,"swell_height":0.04,"swell_direction":303},{"time":"2025-10-14T15:00","wave_height":0.04,"swell_height":0.04,"swell_direction":302},{"time":"2025-10-14T16:00","wave_height":0.04,"swell_height":0.02,"swell_direction":301},{"time":"2025-10-14T17:00","wave_height":0.04,"swell_height":0.02,"swell_direction":300},{"time":"2025-10-14T18:00","wave_height":0.04,"swell_height":0.02,"swell_direction":274},{"time":"2025-10-14T19:00","wave_height":0.04,"swell_height":0.02,"swell_direction":247},{"time":"2025-10-14T20:00","wave_height":0.04,"swell_height":0.02,"swell_direction":221},{"time":"2025-10-14T21:00","wave_height":0.04,"swell_height":0.02,"swell_direction":221},{"time":"2025-10-14T22:00","wave_height":0.04,"swell_height":0.02,"swell_direction":222},{"time":"2025-10-14T23:00","wave_height":0.04,"swell_height":0.02,"swell_direction":222},{"time":"2025-10-15T00:00","wave_height":0.04,"swell_height":0.02,"swell_direction":222},{"time":"2025-10-15T01:00","wave_height":0.04,"swell_height":0.04,"swell_direction":223},{"time":"2025-10-15T02:00","wave_height":0.04,"swell_height":0.04,"swell_direction":223},{"time":"2025-10-15T03:00","wave_height":0.04,"swell_height":0.04,"swell_direction":223},{"time":"2025-10-15T04:00","wave_height":0.04,"swell_height":0.04,"swell_direction":223},{"time":"2025-10-15T05:00","wave_height":0.04,"swell_height":0.04,"swell_direction":223},{"time":"2025-10-15T06:00","wave_height":0.06,"swell_height":0.06,"swell_direction":223},{"time":"2025-10-15T07:00","wave_height":0.06,"swell_height":0.06,"swell_direction":222},{"time":"2025-10-15T08:00","wave_height":0.08,"swell_height":0.08,"swell_direction":222},{"time":"2025-10-15T09:00","wave_height":0.14,"swell_height":0.1,"swell_direction":222},{"time":"2025-10-15T10:00","wave_height":0.2,"swell_height":0.1,"swell_direction":221},{"time":"2025-10-15T11:00","wave_height":0.26,"swell_height":0.12,"swell_direction":221},{"time":"2025-10-15T12:00","wave_height":0.26,"swell_height":0.12,"swell_direction":220},{"time":"2025-10-15T13:00","wave_height":0.24,"swell_height":0.14,"swell_direction":219},{"time":"2025-10-15T14:00","wave_height":0.24,"swell_height":0.14,"swell_direction":218},{"time":"2025-10-15T15:00","wave_height":0.24,"swell_height":0.16,"swell_direction":218},{"time":"2025-10-15T16:00","wave_height":0.22,"swell_height":0.16,"swell_direction":218},{"time":"2025-10-15T17:00","wave_height":0.22,"swell_height":0.18,"swell_direction":218},{"time":"2025-10-15T18:00","wave_height":0.26,"swell_height":0.18,"swell_direction":218},{"time":"2025-10-15T19:00","wave_height":0.32,"swell_height":0.2,"swell_direction":217},{"time":"2025-10-15T20:00","wave_height":0.36,"swell_height":0.2,"swell_direction":217},{"time":"2025-10-15T21:00","wave_height":0.4,"swell_height":0.2,"swell_direction":216},{"time":"2025-10-15T22:00","wave_height":0.42,"swell_height":0.18,"swell_direction":216},{"time":"2025-10-15T23:00","wave_height":0.46,"swell_height":0.18,"swell_direction":215},{"time":"2025-10-16T00:00","wave_height":0.46,"swell_height":0.18,"swell_direction":215},{"time":"2025-10-16T01:00","wave_height":0.48,"swell_height":0.2,"swell_direction":214},{"time":"2025-10-16T02:00","wave_height":0.48,"swell_height":0.2,"swell_direction":214},{"time":"2025-10-16T03:00","wave_height":0.5,"swell_height":0.2,"swell_direction":190},{"time":"2025-10-16T04:00","wave_height":0.5,"swell_height":0.2,"swell_direction":166},{"time":"2025-10-16T05:00","wave_height":0.52,"swell_height":0.2,"swell_direction":142},{"time":"2025-10-16T06:00","wave_height":0.52,"swell_height":0.22,"swell_direction":144},{"time":"2025-10-16T07:00","wave_height":0.54,"swell_height":0.26,"swell_direction":145},{"time":"2025-10-16T08:00","wave_height":0.54,"swell_height":0.28,"swell_direction":147},{"time":"2025-10-16T09:00","wave_height":0.52,"swell_height":0.28,"swell_direction":150},{"time":"2025-10-16T10:00","wave_height":0.5,"swell_height":0.26,"swell_direction":153},{"time":"2025-10-16T11:00","wave_height":0.48,"swell_height":0.26,"swell_direction":156},{"time":"2025-10-16T12:00","wave_height":0.46,"swell_height":0.28,"swell_direction":150},{"time":"2025-10-16T13:00","wave_height":0.42,"swell_height":0.28,"swell_direction":145},{"time":"2025-10-16T14:00","wave_height":0.4,"swell_height":0.3,"swell_direction":139},{"time":"2025-10-16T15:00","wave_height":0.36,"swell_height":0.28,"swell_direction":139},{"time":"2025-10-16T16:00","wave_height":0.34,"swell_height":0.28,"swell_direction":139},{"time":"2025-10-16T17:00","wave_height":0.3,"swell_height":0.26,"swell_direction":139},{"time":"2025-10-16T18:00","wave_height":0.3,"swell_height":0.24,"swell_direction":140},{"time":"2025-10-16T19:00","wave_height":0.32,"swell_height":0.24,"swell_direction":142},{"time":"2025-10-16T20:00","wave_height":0.32,"swell_height":0.22,"swell_direction":143},{"time":"2025-10-16T21:00","wave_height":0.34,"swell_height":0.2,"swell_direction":144},{"time":"2025-10-16T22:00","wave_height":0.36,"swell_height":0.2,"swell_direction":144},{"time":"2025-10-16T23:00","wave_height":0.38,"swell_height":0.18,"swell_direction":145},{"time":"2025-10-17T00:00","wave_height":0.36,"swell_height":0.16,"swell_direction":145},{"time":"2025-10-17T01:00","wave_height":0.36,"swell_height":0.16,"swell_direction":145},{"time":"2025-10-17T02:00","wave_height":0.34,"swell_height":0.14,"swell_direction":145},{"time":"2025-10-17T03:00","wave_height":0.32,"swell_height":0.14,"swell_direction":146},{"time":"2025-10-17T04:00","wave_height":0.28,"swell_height":0.12,"swell_direction":147},{"time":"2025-10-17T05:00","wave_height":0.26,"swell_height":0.12,"swell_direction":148},{"time":"2025-10-17T06:00","wave_height":0.24,"swell_height":0.12,"swell_direction":144},{"time":"2025-10-17T07:00","wave_height":0.22,"swell_height":0.12,"swell_direction":140},{"time":"2025-10-17T08:00","wave_height":0.2,"swell_height":0.12,"swell_direction":136},{"time":"2025-10-17T09:00","wave_height":0.18,"swell_height":0.12,"swell_direction":135},{"time":"2025-10-17T10:00","wave_height":0.16,"swell_height":0.12,"swell_direction":135},{"time":"2025-10-17T11:00","wave_height":0.14,"swell_height":0.12,"swell_direction":134},{"time":"2025-10-17T12:00","wave_height":0.14,"swell_height":0.12,"swell_direction":135},{"time":"2025-10-17T13:00","wave_height":0.12,"swell_height":0.1,"swell_direction":136},{"time":"2025-10-17T14:00","wave_height":0.12,"swell_height":0.1,"swell_direction":137},{"time":"2025-10-17T15:00","wave_height":0.12,"swell_height":0.1,"swell_direction":137},{"time":"2025-10-17T16:00","wave_height":0.1,"swell_height":0.1,"swell_direction":136},{"time":"2025-10-17T17:00","wave_height":0.1,"swell_height":0.1,"swell_direction":136},{"time":"2025-10-17T18:00","wave_height":0.1,"swell_height":0.1,"swell_direction":136},{"time":"2025-10-17T19:00","wave_height":0.08,"swell_height":0.08,"swell_direction":136},{"time":"2025-10-17T20:00","wave_height":0.08,"swell_height":0.08,"swell_direction":136},{"time":"2025-10-17T21:00","wave_height":0.08,"swell_height":0.08,"swell_direction":137},{"time":"2025-10-17T22:00","wave_height":0.08,"swell_height":0.06,"swell_direction":137},{"time":"2025-10-17T23:00","wave_height":0.08,"swell_height":0.06,"swell_direction":138},{"time":"2025-10-18T00:00","wave_height":0.08,"swell_height":0.06,"swell_direction":138},{"time":"2025-10-18T01:00","wave_height":0.06,"swell_height":0.04,"swell_direction":139},{"time":"2025-10-18T02:00","wave_height":0.06,"swell_height":0.04,"swell_direction":139},{"time":"2025-10-18T03:00","wave_height":0.06,"swell_height":0.04,"swell_direction":139},{"time":"2025-10-18T04:00","wave_height":0.04,"swell_height":0.04,"swell_direction":140},{"time":"2025-10-18T05:00","wave_height":0.04,"swell_height":0.04,"swell_direction":140},{"time":"2025-10-18T06:00","wave_height":0.04,"swell_height":0.04,"swell_direction":140},{"time":"2025-10-18T07:00","wave_height":0.04,"swell_height":0.04,"swell_direction":140},{"time":"2025-10-18T08:00","wave_height":0.04,"swell_height":0.04,"swell_direction":140},{"time":"2025-10-18T09:00","wave_height":0.04,"swell_height":0.04,"swell_direction":140},{"time":"2025-10-18T10:00","wave_height":0.04,"swell_height":0.04,"swell_direction":140},{"time":"2025-10-18T11:00","wave_height":0.04,"swell_height":0.04,"swell_direction":140},{"time":"2025-10-18T12:00","wave_height":0.08,"swell_height":0.04,"swell_direction":145},{"time":"2025-10-18T13:00","wave_height":0.1,"swell_height":0.02,"swell_direction":151},{"time":"2025-10-18T14:00","wave_height":0.14,"swell_height":0.02,"swell_direction":156},{"time":"2025-10-18T15:00","wave_height":0.18,"swell_height":0.04,"swell_direction":162},{"time":"2025-10-18T16:00","wave_height":0.2,"swell_height":0.08,"swell_direction":168},{"time":"2025-10-18T17:00","wave_height":0.24,"swell_height":0.1,"swell_direction":174},{"time":"2025-10-18T18:00","wave_height":0.28,"swell_height":0.12,"swell_direction":172},{"time":"2025-10-18T19:00","wave_height":0.34,"swell_height":0.16,"swell_direction":170},{"time":"2025-10-18T20:00","wave_height":0.38,"swell_height":0.18,"swell_direction":168},{"time":"2025-10-18T21:00","wave_height":0.4,"swell_height":0.24,"swell_direction":163},{"time":"2025-10-18T22:00","wave_height":0.42,"swell_height":0.32,"swell_direction":157},{"time":"2025-10-18T23:00","wave_height":0.44,"swell_height":0.38,"swell_direction":152}],"alerts":[],"advice":"Condizioni marine generalmente buone.","tides":{}};
const mergedHourly = marineData.mergedHourly || [];
const alerts = marineData.alerts || [];
const advice = marineData.advice || "";

// Mostra riepilogo sintetico
function humanDirection(deg) {
  const directions = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
  const ix = Math.round(deg / 22.5) % 16;
  return directions[ix];
}

// costruisci breve summary dalle prime ore
let summary = "";
if (mergedHourly.length > 0) {
  const first = mergedHourly[0];
  summary = `Altezza onda: ${first.wave_height.toFixed(2)} m, direzione swell: ${humanDirection(first.swell_direction)} (${first.swell_direction}Â°), altezza swell: ${first.swell_height.toFixed(2)} m.`;
}
document.getElementById('marine-summary').textContent = summary;

// Costruzione dati per il grafico
const labels = mergedHourly.map(h => h.time.slice(11,16)); // solo ora
const waveHeights = mergedHourly.map(h => h.wave_height);
const swellHeights = mergedHourly.map(h => h.swell_height);

// Config Chart.js line chart
const ctx = document.getElementById('marine-wave-chart').getContext('2d');
const marineWaveChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels,
    datasets: [
      {
        label: 'Altezza onda (m)',
        borderColor: 'rgba(30,144,255,0.85)',
        backgroundColor: 'rgba(30,144,255,0.25)',
        fill: true,
        data: waveHeights,
        tension: 0.3,
        pointRadius: 2,
      },
      {
        label: 'Altezza swell (m)',
        borderColor: 'rgba(0,255,128,0.85)',
        backgroundColor: 'rgba(0,255,128,0.25)',
        fill: true,
        data: swellHeights,
        tension: 0.3,
        pointRadius: 2,
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        beginAtZero: true,
        title: { display: true, text: 'Metri', color: '#a8cff8' },
        ticks: { color: '#a8cff8' }
      },
      x: {
        title: { display: true, text: 'Orario locale', color: '#a8cff8' },
        ticks: { color: '#a8cff8' }
      }
    },
    plugins: {
      legend: {
        labels: { color: '#a8cff8' }
      },
      tooltip: {
        mode: 'index',
        intersect: false
      }
    }
  }
});

// Mostra alert e consigli
const alertsDiv = document.getElementById('marine-alerts');
if (alerts.length > 0) {
  alertsDiv.innerHTML = alerts.map(a => `âš ï¸ ${a.message}`).join('<br/>');
} else {
  alertsDiv.textContent = `ğŸ—ï¸ ${advice}`;
}
</script>
