<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Meteo Procida</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#012549">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="description" content="Previsioni meteo dettagliate per Procida - Analisi AI multi-fonte">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(135deg, #012549, #003d6b);
      color: white; margin:0; padding:0;
    }
    .container { max-width: 550px; margin: 40px auto; background: rgba(0,0,0,0.24); border-radius: 20px; box-shadow: 0 10px 32px #01254950; padding: 34px; }
    h1 { font-size: 2.2em; margin-bottom: 10px; }
    .meta { margin-bottom: 12px; font-size:1.03em; opacity: .7; }
    .card { background: #0a284f; border-radius: 9px; margin: 18px 0; padding: 20px; }
    .advice, .alerts { margin:10px 0 0 18px; font-size:1.05em; }
    .advice li, .alerts li { margin-bottom: 4px; }
    .today-main { display:flex; align-items:center; gap:16px;}
    .today-temp { font-size: 3em; font-weight:bold; }
    .today-icon { font-size: 2.5em; }
    .today-details { margin-top:6px; }
  </style>
</head>
<body>
  <div class="container" id="main"></div>
  <script>
    // JSON DATI METEO AGGIORNATI - TUO OUTPUT, gi√† integrato.
    window.WEATHERDATA_RAW = `[{"location":{"name":"Procida","latitude":40.7584,"longitude":14.0166},"generated_at":"2025-10-23T11:58:34.891Z","days":[{"date":"2025-10-23","temp":{"max":21.675,"min":19.16},"rain":{"probability":53,"total_mm":2.8,"periods":[{"start":"04:00","end":"06:59","intensity":"leggera"},{"start":"08:00","end":"08:59","intensity":"leggera"},{"start":"12:00","end":"16:59","intensity":"leggera"},{"start":"19:00","end":"21:59","intensity":"leggera"}]},"wind":{"periods":[{"time":"00:00","speed_kmh":3,"direction":"SSE"},{"time":"01:00","speed_kmh":5,"direction":"SSE"},{"time":"02:00","speed_kmh":5,"direction":"SSE"},{"time":"03:00","speed_kmh":7,"direction":"SE"},{"time":"04:00","speed_kmh":8,"direction":"SSE"},{"time":"05:00","speed_kmh":9,"direction":"SE"},{"time":"06:00","speed_kmh":11,"direction":"SE"},{"time":"07:00","speed_kmh":13,"direction":"SE"},{"time":"08:00","speed_kmh":19,"direction":"SE"},{"time":"09:00","speed_kmh":22,"direction":"SSE"},{"time":"10:00","speed_kmh":21,"direction":"SSE"},{"time":"11:00","speed_kmh":22,"direction":"SSE"},{"time":"12:00","speed_kmh":19,"direction":"SSE"},{"time":"13:00","speed_kmh":19,"direction":"SSE"},{"time":"14:00","speed_kmh":17,"direction":"SSE"},{"time":"15:00","speed_kmh":15,"direction":"S"},{"time":"16:00","speed_kmh":16,"direction":"SSO"},{"time":"17:00","speed_kmh":20,"direction":"SO"},{"time":"18:00","speed_kmh":28,"direction":"SO"},{"time":"19:00","speed_kmh":27,"direction":"SO"},{"time":"20:00","speed_kmh":32,"direction":"OSO"},{"time":"21:00","speed_kmh":31,"direction":"OSO"},{"time":"22:00","speed_kmh":36,"direction":"O"},{"time":"23:00","speed_kmh":34,"direction":"O"}]},"humidity":85,"pressure":{"value_hPa":1008,"trend":"stabile"},"uv_index":2,"sea":{"wave_height_m":0.8,"temperature_c":20,"condition":"poco mosso"},"sunrise":"07:24","sunset":"18:12","moon_phase":null,"summary":"19¬∞-22¬∞C. Possibili precipitazioni (2.8mm). Vento forte fino a 36km/h.","advice":["üå°Ô∏è Temperature miti: abbigliamento leggero consigliato","‚òî Possibili piogge: porta ombrello o impermeabile","üåä Mare calmo (onde 0.8m): condizioni favorevoli per navigare"],"alerts":[]},{"date":"2025-10-24","temp":{"max":20.8,"min":19.700000000000003},"rain":{"probability":7,"total_mm":0,"periods":[]},"wind":{"periods":[{"time":"00:00","speed_kmh":41,"direction":"ONO"},{"time":"01:00","speed_kmh":44,"direction":"ONO"},{"time":"02:00","speed_kmh":46,"direction":"ONO"},{"time":"03:00","speed_kmh":43,"direction":"ONO"},{"time":"04:00","speed_kmh":42,"direction":"ONO"},{"time":"05:00","speed_kmh":40,"direction":"ONO"},{"time":"06:00","speed_kmh":38,"direction":"ONO"},{"time":"07:00","speed_kmh":37,"direction":"ONO"},{"time":"08:00","speed_kmh":34,"direction":"ONO"},{"time":"09:00","speed_kmh":30,"direction":"ONO"},{"time":"10:00","speed_kmh":26,"direction":"ONO"},{"time":"11:00","speed_kmh":25,"direction":"ONO"},{"time":"12:00","speed_kmh":27,"direction":"O"},{"time":"13:00","speed_kmh":31,"direction":"ONO"},{"time":"14:00","speed_kmh":32,"direction":"ONO"},{"time":"15:00","speed_kmh":33,"direction":"ONO"},{"time":"16:00","speed_kmh":32,"direction":"ONO"},{"time":"17:00","speed_kmh":30,"direction":"ONO"},{"time":"18:00","speed_kmh":29,"direction":"ONO"},{"time":"19:00","speed_kmh":27,"direction":"ONO"},{"time":"20:00","speed_kmh":28,"direction":"ONO"},{"time":"21:00","speed_kmh":28,"direction":"ONO"},{"time":"22:00","speed_kmh":27,"direction":"ONO"},{"time":"23:00","speed_kmh":28,"direction":"ONO"}]},"humidity":66,"pressure":{"value_hPa":1010,"trend":"stabile"},"uv_index":3,"sea":{"wave_height_m":2.6,"temperature_c":19.8,"condition":"molto mosso"},"sunrise":"07:25","sunset":"18:10","moon_phase":null,"summary":"20¬∞-21¬∞C. Tempo asciutto. Vento forte fino a 46km/h.","advice":["üå°Ô∏è Temperature miti: abbigliamento leggero consigliato","‚òÄÔ∏è Tempo asciutto: ideale per attivit√† all'aperto","üåä Mare mosso (onde 2.6m): evita attivit√† nautiche"],"alerts":["‚ö†Ô∏è Allerta vento: Raffiche fino a 46 km/h. Prudenza consigliata","‚ö†Ô∏è Allerta mare mosso: Onde fino a 2.6m. Navigazione sconsigliata"]}],"weekStats":{"maxTemp":22,"minTemp":17,"avgTemp":20,"rainyDays":4},"source":"openweathermap_airquality","timestamp":"2025-10-23T11:58:34.778Z","air_quality":{"aqi":2,"aqi_description":"Discreta","timestamp":"2025-10-23T11:58:34.000Z","components":{"co":101.04,"no":0.03,"no2":0.31,"o3":77.2,"so2":0.4,"pm2_5":3.59,"pm10":14.42,"nh3":0.13},"assessment":{"pm2_5_level":"Ottimo","pm10_level":"Ottimo","o3_level":"Buono","no2_level":"Ottimo"}}}]`;

    let dataArr = [];
    try { dataArr = JSON.parse(window.WEATHERDATA_RAW); } catch(e){ }
    let data = dataArr[0] || {};

    // --- RENDERING PRINCIPALE ---
    let mainEl = document.getElementById('main');
    let today = (data.days && data.days.length) ? data.days[0] : {};
    let adviceList = today.advice ? today.advice.map(a=>'<li>'+a+'</li>').join('') : '';
    let alertsList = today.alerts ? today.alerts.map(a=>'<li>'+a+'</li>').join('') : '';

    mainEl.innerHTML = `
      <h1>Meteo ${data.location?.name || 'Localit√†'}</h1>
      <div class="meta">Ultimo aggiornamento: ${new Date(data.generated_at).toLocaleString('it-IT')}</div>
      <div class="card today-main">
        <span class="today-icon">${today.rain && today.rain.total_mm > 5 ? "üåßÔ∏è" : "üå§Ô∏è"}</span>
        <span class="today-temp">${today.temp ? today.temp.max+"¬∞" : ""}</span>
        <div>
          <div class="today-details">${today.summary || ""}</div>
          <div>Umidit√†: ${today.humidity || ""}%</div>
          <div>Pressione: ${today.pressure?.value_hPa || ""} hPa (${today.pressure?.trend || ""})</div>
          <div>Vento max: ${today.wind && today.wind.periods ? Math.max(...today.wind.periods.map(x=>x.speed_kmh))+'km/h' : ''}</div>
          <div>Alba: ${today.sunrise || ""} - Tramonto: ${today.sunset || ""}</div>
          <div>Mare: ${today.sea?.condition || ""} (${today.sea?.wave_height_m||""}m)</div>
        </div>
      </div>
      <div class="card">
        <strong>Consigli per la giornata:</strong>
        <ul class="advice">${adviceList || '<li>Nessun consiglio</li>'}</ul>
      </div>
      <div class="card">
        <strong>Allerte:</strong>
        <ul class="alerts">${alertsList || '<li>Nessuna allerta</li>'}</ul>
      </div>
      <div class="card">
        <strong>Indice qualit√† aria:</strong>
        <div>AQI: ${data.air_quality?.aqi || ""} / ${data.air_quality?.aqi_description || ""}</div>
        <div>PM2.5: ${data.air_quality?.components?.pm2_5 || ""} Œºg/m¬≥ - Livello: ${data.air_quality?.assessment?.pm2_5_level || ""}</div>
        <div>PM10: ${data.air_quality?.components?.pm10 || ""} Œºg/m¬≥ - Livello: ${data.air_quality?.assessment?.pm10_level || ""}</div>
      </div>
      <div class="meta">Statistiche settimanali: Massima ${data.weekStats?.maxTemp||""}¬∞C, Minima ${data.weekStats?.minTemp||""}¬∞C, ${data.weekStats?.rainyDays||""} giorni di pioggia</div>
    `;
  </script>
</body>
</html>
