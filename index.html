<!DOCTYPE html>
<html lang="it">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <meta name="theme-color" content="#012549">
Â  <link rel="manifest" href="manifest.json">
Â  <link rel="apple-touch-icon" href="apple-touch-icon.png">
Â  <meta name="description" content="Previsioni meteo dettagliate per Procida - Analisi AI multi-fonte">
Â Â 
Â  <meta name="apple-mobile-web-app-capable" content="yes">
Â  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
Â  <meta name="apple-mobile-web-app-title" content="Meteo Procida">
Â  <link rel="icon" type="image/png" href="apple-touch-icon.png">
Â Â 
Â  <title>Meteo Procida - Previsioni 7 Giorni</title>
Â Â 
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
Â Â 
Â  <style>
Â  Â  * {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  box-sizing: border-box;
Â  Â  }

Â  Â  :root {
Â  Â  Â  --primary-blue: #012549;
Â  Â  Â  --primary-blue-light: #003d6b;
Â  Â  Â  --accent-orange: #faa202;
Â  Â  Â  --accent-cyan: #08a5e8;
Â  Â  Â  --bg-gradient-start: #012549;
Â  Â  Â  --bg-gradient-end: #003d6b;
Â  Â  Â  --card-bg: rgba(255, 255, 255, 0.1);
Â  Â  Â  --card-border: rgba(255, 255, 255, 0.2);
Â  Â  Â  --text-primary: #ffffff;
Â  Â  Â  --text-secondary: #a0c4d8;
Â  Â  Â  --text-tertiary: #6a8da8;
Â  Â  Â  --accent-green: #34c759;
Â  Â  Â  --accent-red: #ff3b30;
Â  Â  Â  --accent-yellow: #ffcc00;
Â  Â  Â  --spacing-xs: 8px;
Â  Â  Â  --spacing-sm: 12px;
Â  Â  Â  --spacing-md: 16px;
Â  Â  Â  --spacing-lg: 24px;
Â  Â  Â  --spacing-xl: 32px;
Â  Â  }
Â  Â  Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="notification-toggle" id="notificationToggle" onclick="toggleNotifications()" title="Gestisci notifiche meteo">
Â  Â  <img id="notifIcon" src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/notifiche-disabilitate.svg" style="width: 28px; height: 28px; object-fit: contain;">
Â  </div>

Â  <div class="container">
Â  Â  <header>
Â  Â  Â  <div class="header-logo">
Â  Â  Â  Â  <img src="apple-touch-icon.png" alt="Meteo Procida Logo" class="logo-img">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <h1>Meteo Procida</h1>
Â  Â  Â  Â  Â  <div class="header-subtitle">
Â  Â  Â  Â  Â  Â  <span>â˜€ï¸ Previsioni 7 giorni - Analisi AI</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="header-actions">
Â  Â  Â  Â  <button class="action-button secondary" onclick="shareWeather()" title="Condividi previsioni">
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/condividi.svg" style="width: 22px; height: 22px; object-fit: contain; filter: brightness(0) invert(1);">
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button class="action-button" onclick="exportToPDF()" title="Esporta PDF">
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/pdf.svg" style="width: 22px; height: 22px; object-fit: contain; filter: brightness(0) invert(1);">
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <div id="hero-container"></div>

Â  Â  <div class="charts-section">
Â  Â  Â  <div class="chart-title">
Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/thermometer-celsius.svg" alt="Temperatura">
Â  Â  Â  Â  Temperature & Precipitazioni - 7 Giorni
Â  Â  Â  </div>
Â  Â  Â  <canvas id="weatherChart" class="chart-canvas"></canvas>
Â  Â  </div>

Â  Â  <div class="charts-section">
Â  Â  Â  <div class="chart-title">
Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/barometer.svg" alt="Pressione">
Â  Â  Â  Â  Pressione Atmosferica & Vento
Â  Â  Â  </div>
Â  Â  Â  <canvas id="pressureWindChart" class="chart-canvas"></canvas>
Â  Â  </div>

Â  Â  <div class="charts-section">
Â  Â  Â  <div class="chart-title">
Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/tide-high.svg" alt="Mare">
Â  Â  Â  Â  Condizioni Meteomarine - 7 Giorni
Â  Â  Â  </div>
Â  Â  Â  <canvas id="marineChart" class="chart-canvas"></canvas>
Â  Â  </div>

Â  Â  <div id="stats-container"></div>

Â  Â  <h2 class="section-title">ğŸ“… Prossimi 6 giorni</h2>
Â  Â  <div id="forecast-container"></div>

Â  Â  <footer>
Â  Â  Â  <p>Dati aggregati da Open-Meteo, Marine Open-Meteo, Weatherbit, Meteoblue e ilmeteo.it</p>
Â  Â  Â  <p>Analisi meteorologica professionale powered by AI</p>
Â  Â  Â  <p id="last-update"></p>
Â  Â  Â  <p style="margin-top: 10px; opacity: 0.6;">
Â  Â  Â  Â  <span id="notification-status">Notifiche: Disattivate</span>
Â  Â  Â  </p>
Â  Â  </footer>
Â  </div>
Â  <!-- MODAL RIEPILOGO/CONSIGLI/ALLERTE -->
Â  <div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
Â  Â  <div class="modal-content" onclick="event.stopPropagation()">
Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  <div class="modal-icon" id="modalIcon"></div>
Â  Â  Â  Â  <h3 id="modalTitle"></h3>
Â  Â  Â  Â  <button class="modal-close" onclick="closeModal()" aria-label="Chiudi">Ã—</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="modal-body" id="modalBody"></div>
Â  Â  </div>
Â  </div>

<!-- MODAL PIOGGIA -->
<div class="modal-overlay" id="rainModal" onclick="closeRainModal()">
Â  <div class="modal-content" onclick="event.stopPropagation()">
Â  Â  <div class="modal-header">
Â  Â  Â  <div class="modal-icon" style="color: #08a5e8;">
Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/raindrops.svg" style="width: 28px; height: 28px;">
Â  Â  Â  </div>
Â  Â  Â  <h3>Pioggia Oggi - <span id="rainModalDate"></span></h3>
Â  Â  Â  <button class="modal-close" onclick="closeRainModal()" aria-label="Chiudi">Ã—</button>
Â  Â  </div>
Â  Â  <div class="modal-body">
Â  Â  Â  <canvas id="rainChart" style="max-height: 300px;"></canvas>
Â  Â  <div id="rainviewer-alert" style="margin:8px 0;font-size:1.2em;"></div>
<div id="rainviewer-radar" style="margin-bottom:14px;"></div>
<script>
Â  // --- Rainviewer Alert/Radar POPUP su weatherData.rainviewer
Â  (function() {
Â  Â  if (!window.weatherData || !weatherData.rainviewer) {
Â  Â  Â  document.getElementById("rainviewer-alert").innerHTML = "âŒ Radar pioggia non disponibile";
Â  Â  Â  return;
Â  Â  }
Â  Â  var rv = weatherData.rainviewer;
Â  Â  var rain = rv.nowcast_summary;
Â  Â  var frame = rv.nowcast_frames && rv.nowcast_frames[0];
Â  Â  if (!rain) {
Â  Â  Â  document.getElementById("rainviewer-alert").innerHTML = "âŒ Dato radar mancante";
Â  Â  Â  return;
Â  Â  }
Â  Â  document.getElementById('rainviewer-alert').innerHTML =
Â  Â  Â  rain.has_rain_incoming
Â  Â  Â  Â  ? "ğŸš¨ Pioggia in arrivo tra " + rain.rain_in_minutes + " minuti!"
Â  Â  Â  Â  : "âœ… Nessuna pioggia imminente rilevata";
Â  Â  if (frame && frame.tile_url) {
Â  Â  Â  var img = document.createElement('img');
Â  Â  Â  img.src = frame.tile_url.replace('https://https://', 'https://');
Â  Â  Â  img.width = 256;
Â  Â  Â  img.height = 256;
Â  Â  Â  img.className = "radar-img";
Â  Â  Â  document.getElementById('rainviewer-radar').appendChild(img);
Â  Â  Â  var timeInfo = document.createElement('div');
Â  Â  Â  timeInfo.style="font-size:11px;color:#a0c4d8;margin-top:6px;";
Â  Â  Â  timeInfo.innerText = 'Ultima scansione radar: ' + frame.timestamp;
Â  Â  Â  document.getElementById('rainviewer-radar').appendChild(timeInfo);
Â  Â  }
Â  })();
</script>
Â  Â  Â  <div class="rain-stats">
Â  Â  Â  Â  <div class="rain-stat">
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/raindrops.svg" class="rain-stat-icon" alt="Totale">
Â  Â  Â  Â  Â  <div class="rain-stat-value" id="rainTotalValue">--</div>
Â  Â  Â  Â  Â  <div class="rain-stat-label">Totale mm</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="rain-stat">
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/raindrop-measure.svg" class="rain-stat-icon" alt="Picco">
Â  Â  Â  Â  Â  <div class="rain-stat-value" id="rainPeakValue">--</div>
Â  Â  Â  Â  Â  <div class="rain-stat-label">Picco mm/h</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="rain-stat">
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/wi-time-2.svg" class="rain-stat-icon" alt="Durata">
Â  Â  Â  Â  Â  <div class="rain-stat-value" id="rainDurationValue">--</div>
Â  Â  Â  Â  Â  <div class="rain-stat-label">Durata ore</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="rain-stat">
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/barometer.svg" class="rain-stat-icon" alt="ProbabilitÃ ">
Â  Â  Â  Â  Â  <div class="rain-stat-value" id="rainProbValue">--</div>
Â  Â  Â  Â  Â  <div class="rain-stat-label">ProbabilitÃ </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>
Â </div>

Â  <!-- MODAL VENTO -->
Â  <div class="modal-overlay" id="windModal" onclick="closeWindModal()">
Â  Â  <div class="modal-content" onclick="event.stopPropagation()">
Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  <div class="modal-icon" style="color: #08a5e8;">
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/wind.svg" style="width: 28px; height: 28px;">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <h3>Vento Oggi - <span id="windModalDate"></span></h3>
Â  Â  Â  Â  <button class="modal-close" onclick="closeWindModal()" aria-label="Chiudi">Ã—</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="modal-body">
Â  Â  Â  Â  <canvas id="windChart" style="max-height: 300px;"></canvas>
Â Â  Â  Â  Â 
Â  Â  Â  Â  <div class="rain-stats">
Â  Â  Â  Â  Â  <div class="rain-stat">
Â  Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/wind.svg" class="rain-stat-icon" alt="Media">
Â  Â  Â  Â  Â  Â  <div class="rain-stat-value" id="windAvgValue">--</div>
Â  Â  Â  Â  Â  Â  <div class="rain-stat-label">Media Km/h</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="rain-stat">
Â  Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/wind-beaufort-12.svg" class="rain-stat-icon" alt="Max">
Â  Â  Â  Â  Â  Â  <div class="rain-stat-value" id="windMaxValue">--</div>
Â  Â  Â  Â  Â  Â  <div class="rain-stat-label">Raffica Max</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="rain-stat">
Â  Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/compass.svg" class="rain-stat-icon" alt="Beaufort">
Â  Â  Â  Â  Â  Â  <div class="rain-stat-value" id="windBeaufortValue">--</div>
Â  Â  Â  Â  Â  Â  <div class="rain-stat-label">Beaufort Max</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="rain-stat">
Â  Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons/wind.svg" class="rain-stat-icon" alt="Dir">
Â  Â  Â  Â  Â  Â  <div class="rain-stat-value" id="windDirValue">--</div>
Â  Â  Â  Â  Â  Â  <div class="rain-stat-label">Direzione</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â  <script>
Â Â  // FIX universale per ARRAY o OGGETTO:
let weatherDataRaw = {"ai":{}};
let weatherData;
if (Array.isArray(weatherDataRaw)) {
Â  weatherData = weatherDataRaw[0];
} else if (typeof weatherDataRaw === 'string') {
Â  try {
Â  Â  const parsed = JSON.parse(weatherDataRaw);
Â  Â  weatherData = Array.isArray(parsed) ? parsed[0] : parsed;
Â  } catch(e) {
Â  Â  weatherData = null;
Â  }
} else {
Â  weatherData = weatherDataRaw;
}

Â  Â  let notificationsEnabled = false;
Â  Â  let rainChartInstance = null;
Â  Â  let windChartInstance = null;

Â  Â  const METEOCONS_CDN = 'https://raw.githubusercontent.com/Micheledv74/previsioni/main/icons/meteocons';

Â  Â  const ICONS = {
Â  Â  Â  summary: `<img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/Riepilogo.svg" style="width: 1.8rem; height: 1.8rem; object-fit: contain; filter: brightness(0) saturate(100%) invert(56%) sepia(91%) saturate(2664%) hue-rotate(175deg) brightness(96%) contrast(93%);">`,
Â  Â  Â  advice: `<img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/Consigli.svg" style="width: 1.8rem; height: 1.8rem; object-fit: contain; filter: brightness(0) saturate(100%) invert(71%) sepia(98%) saturate(1714%) hue-rotate(358deg) brightness(101%) contrast(98%);">`,
Â  Â  Â  alert: `<img src="https://raw.githubusercontent.com/Micheledv74/previsioni/main/Allerte.svg" style="width: 1.8rem; height: 1.8rem; object-fit: contain; filter: brightness(0) saturate(100%) invert(28%) sepia(86%) saturate(4586%) hue-rotate(351deg) brightness(102%) contrast(105%);">`
Â  Â  };

Â  Â  function getWeatherIcon(summary) {
Â  Â  Â  const text = (summary || '').toLowerCase();
Â  Â  Â  let iconName = 'partly-cloudy-day.svg';
Â Â  Â  Â 
Â  Â  Â  if (text.includes('temporale') || text.includes('thunderstorm')) {
Â  Â  Â  Â  iconName = 'thunderstorms-rain.svg';
Â  Â  Â  } else if (text.includes('pioggia forte') || text.includes('heavy rain')) {
Â  Â  Â  Â  iconName = 'rain.svg';
Â  Â  Â  } else if (text.includes('pioggia') || text.includes('rain')) {
Â  Â  Â  Â  iconName = 'drizzle.svg';
Â  Â  Â  } else if (text.includes('neve') || text.includes('snow')) {
Â  Â  Â  Â  iconName = 'snow.svg';
Â  Â  Â  } else if (text.includes('nebbia') || text.includes('fog')) {
Â  Â  Â  Â  iconName = 'fog.svg';
Â  Â  Â  } else if (text.includes('nuvoloso') || text.includes('cloudy')) {
Â  Â  Â  Â  iconName = 'cloudy.svg';
Â  Â  Â  } else if (text.includes('parzialmente') || text.includes('partly')) {
Â  Â  Â  Â  iconName = 'partly-cloudy-day.svg';
Â  Â  Â  } else if (text.includes('sereno') || text.includes('clear') || text.includes('sunny')) {
Â  Â  Â  Â  iconName = 'clear-day.svg';
Â  Â  Â  }
Â Â  Â  Â 
Â  Â  Â  return `${METEOCONS_CDN}/${iconName}`;
Â  Â  }

Â  Â  function getBeaufortIcon(speed_kmh) {
Â  Â  Â  if (speed_kmh < 2) return 'wind-beaufort-0.svg';
Â  Â  Â  if (speed_kmh < 6) return 'wind-beaufort-1.svg';
Â  Â  Â  if (speed_kmh < 12) return 'wind-beaufort-2.svg';
Â  Â  Â  if (speed_kmh < 20) return 'wind-beaufort-3.svg';
Â  Â  Â  if (speed_kmh < 29) return 'wind-beaufort-4.svg';
Â  Â  Â  if (speed_kmh < 39) return 'wind-beaufort-5.svg';
Â  Â  Â  if (speed_kmh < 50) return 'wind-beaufort-6.svg';
Â  Â  Â  if (speed_kmh < 62) return 'wind-beaufort-7.svg';
Â  Â  Â  if (speed_kmh < 75) return 'wind-beaufort-8.svg';
Â  Â  Â  if (speed_kmh < 89) return 'wind-beaufort-9.svg';
Â  Â  Â  if (speed_kmh < 103) return 'wind-beaufort-10.svg';
Â  Â  Â  if (speed_kmh < 118) return 'wind-beaufort-11.svg';
Â  Â  Â  return 'wind-beaufort-12.svg';
Â  Â  }

// ... altre utility omesse per brevitÃ  fino alla funzione openAdviceModal ...

function openSummaryModal() {
Â  if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
Â  const today = weatherData.days[0];

Â  // --- PRIORITÃ€ DATO: .ai.summary se presente! ---
Â  const summary = (weatherData.ai && weatherData.ai.summary) ? weatherData.ai.summary : (today.summary || 'Nessun riepilogo disponibile per oggi.');

Â  const content = `<p>${summary}</p>`;
Â  openModal('summary', 'Riepilogo Giornata', `<div style="color: #08a5e8">${ICONS.summary}</div>`, content);
}

function openAdviceModal() {
Â  if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
Â  const today = weatherData.days[0];

Â  // --- PRIORITÃ€ DATO: .ai.advice SE disponibile, SE no fallback a today.advice ---

Â  const adviceArr = (weatherData.ai && Array.isArray(weatherData.ai.advice)) ? weatherData.ai.advice : (today.advice || []);

Â  let content = '';
Â  if (adviceArr.length > 0) {
Â  Â  content = '<ul>';
Â  Â  adviceArr.forEach(adv => {
Â  Â  Â  content += `<li>${adv}</li>`;
Â  Â  });
Â  Â  content += '</ul>';
Â  } else {
Â  Â  content = '<p>Nessun consiglio particolare per oggi.</p>';
Â  }

Â  openModal('advice', 'Consigli del Giorno', `<div style="color: #faa202">${ICONS.advice}</div>`, content);
}

function openAlertModal() {
Â  if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
Â  const today = weatherData.days[0];

Â  // --- PRIORITÃ€ DATO: .ai.alerts SE presente, fallback a today.alerts ---
Â  const alertsArr = (weatherData.ai && Array.isArray(weatherData.ai.alerts)) ? weatherData.ai.alerts : (today.alerts || []);

Â  let content = '';
Â  if (alertsArr.length > 0) {
Â  Â  content = '<ul>';
Â  Â  alertsArr.forEach(alert => {
Â  Â  Â  content += `<li>${alert}</li>`;
Â  Â  });
Â  Â  content += '</ul>';
Â  } else {
Â  Â  content = '<p style="color: var(--accent-green);">âœ… Nessuna allerta meteo attiva per oggi.</p>';
Â  }

Â  openModal('alert', 'Allerte Meteo', `<div style="color: #ff3b30">${ICONS.alert}</div>`, content);
}
function renderHero() {
Â  if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
Â  const today = weatherData.days[0];
Â  const tempClass = getTempClass(today.temp?.max || 20);
Â  const weatherIcon = getWeatherIcon(today.summary);

Â  // --- PRIORITÃ€ AI AGENT SUL RIASSUNTO NELLA HERO (box principale) ---
Â  const summary = (weatherData.ai && weatherData.ai.summary) ? weatherData.ai.summary : (today.summary || '');

Â  // puoi aggiungere altre modifiche sui consigli/allerte se vuoi riportarli in hero
Â  // const advices = ...Â  (come sopra, logic fallback)
Â  // const alertsArr = ...

Â  // ... Originale, struttura card, rimane invariata:
Â  // ... vedi blocchi precedenti giÃ  forniti per la hero-card ...
}

function renderStats() {
Â  if (!weatherData || !weatherData.weekStats) return;
Â  const stats = weatherData.weekStats;
Â  // ... tutto invariato per le stats settimanali ...
}

function renderForecast() {
Â  if (!weatherData || !weatherData.days || weatherData.days.length < 2) {
Â  Â  document.getElementById('forecast-container').innerHTML = `
Â  Â  Â  <div class="error-message">
Â  Â  Â  Â  <h2>âš ï¸ Errore nel caricamento dei dati</h2>
Â  Â  Â  Â  <p>Impossibile recuperare le previsioni meteo. Riprova piÃ¹ tardi.</p>
Â  Â  Â  </div>
Â  Â  `;
Â  Â  return;
Â  }

Â  const futureDays = weatherData.days.slice(1);
Â  const html = futureDays.map(day => {
Â  Â  const moonEmoji = getMoonPhaseEmoji(day.moon_phase);
Â  Â  const dayIcon = getWeatherIcon(day.summary);

Â  Â  return `
Â  Â  <div class="day-card-compact">
Â  Â  Â  <div class="day-card-header">
Â  Â  Â  Â  <div class="day-name">
Â  Â  Â  Â  Â  <img src="${dayIcon}" class="day-weather-icon" alt="Meteo">
Â  Â  Â  Â  Â  ${formatDate(day.date)}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="day-temps-compact">
Â  Â  Â  Â  Â  <span class="temp-max">${Math.round(day.temp?.max || 20)}Â°</span>
Â  Â  Â  Â  Â  <span class="temp-min">${Math.round(day.temp?.min || 15)}Â°</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  ${day.summary ? `<div class="day-summary-short">${day.summary}</div>` : ''}

Â  Â  Â  <div class="day-details-row">
Â  Â  Â  Â  ${day.rain && day.rain.probability > 0 ? `
Â  Â  Â  Â  Â  <div class="detail-compact">
Â  Â  Â  Â  Â  Â  <img src="${METEOCONS_CDN}/raindrops.svg" alt="Pioggia">
Â  Â  Â  Â  Â  Â  <div class="value">${day.rain.probability}%</div>
Â  Â  Â  Â  Â  Â  <div class="label">${day.rain.total_mm}mm</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  ${day.wind && day.wind.periods && day.wind.periods[0] ? `
Â  Â  Â  Â  Â  <div class="detail-compact">
Â  Â  Â  Â  Â  Â  <img src="${METEOCONS_CDN}/${getBeaufortIcon(day.wind.periods[0].speed_kmh)}" alt="Vento">
Â  Â  Â  Â  Â  Â  <div class="value">${day.wind.periods[0].speed_kmh} km/h</div>
Â  Â  Â  Â  Â  Â  <div class="label">${getWindDegrees(day.wind.periods[0].direction)}Â° ${day.wind.periods[0].direction}</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  ...
Â  Â  Â  </div>
Â  Â  </div>
Â  `}).join('');

Â  document.getElementById('forecast-container').innerHTML = `<div class="days-grid">${html}</div>`;
}

function updateTimestamp() {
Â  if (weatherData && weatherData.generatedAt) {
Â  Â  const date = new Date(weatherData.generatedAt);
Â  Â  document.getElementById('last-update').textContent =Â 
Â  Â  Â  `Ultimo aggiornamento: ${date.toLocaleString('it-IT')}`;
Â  }
}

// --- Setup --- (rimane uguale)
renderHero();
renderCharts();
renderStats();
renderForecast();
updateTimestamp();

if ('serviceWorker' in navigator) {
Â  navigator.serviceWorker.register('service-worker.js')
Â  Â  .then(reg => console.log('Service Worker registrato'))
Â  Â  .catch(err => console.log('Service Worker errore:', err));
}
</script>
</body>
</html>


