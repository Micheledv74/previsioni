<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meteo Procida - Previsioni 7 Giorni</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-gradient-start: #1c1c1e;
      --bg-gradient-end: #2c2c2e;
      --card-bg: rgba(255, 255, 255, 0.1);
      --card-border: rgba(255, 255, 255, 0.2);
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --text-tertiary: #636366;
      --accent-blue: #007aff;
      --accent-green: #34c759;
      --accent-orange: #ff9500;
      --accent-red: #ff3b30;
      --accent-yellow: #ffcc00;
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 0;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-md);
    }

    /* === ANIMAZIONI KEYFRAMES === */
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Classe per elementi animati */
    .animate-on-load {
      animation: fadeInUp 0.6s ease-out forwards;
      opacity: 0;
    }

    /* Ritardi scaglionati per effetto cascade */
    .animate-delay-1 { animation-delay: 0.1s; }
    .animate-delay-2 { animation-delay: 0.2s; }
    .animate-delay-3 { animation-delay: 0.3s; }
    .animate-delay-4 { animation-delay: 0.4s; }
    .animate-delay-5 { animation-delay: 0.5s; }
    .animate-delay-6 { animation-delay: 0.6s; }

    /* === HERO SECTION === */
    
    .hero-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 24px;
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-lg);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
      min-height: 50vh;
      animation: fadeInUp 0.8s ease-out;
    }

    .hero-card.hot { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); }
    .hero-card.warm { background: linear-gradient(135deg, #ff9500 0%, #ff6348 100%); }
    .hero-card.mild { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .hero-card.cool { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .hero-card.cold { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }

    .hero-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }

    .hero-location {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 1.1rem;
      font-weight: 500;
      opacity: 0.9;
    }

    .hero-date {
      font-size: 0.95rem;
      opacity: 0.8;
    }

    .hero-main {
      text-align: center;
      margin: var(--spacing-xl) 0;
    }

    .hero-temp {
      font-size: 80px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: var(--spacing-sm);
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: fadeIn 1s ease-out;
    }

    .hero-condition {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      font-size: 1.5rem;
      font-weight: 500;
      margin-bottom: var(--spacing-md);
    }

    .hero-condition i {
      font-size: 3rem;
      animation: fadeIn 1.2s ease-out;
    }

    .hero-minmax {
      display: flex;
      justify-content: center;
      gap: var(--spacing-lg);
      font-size: 1.2rem;
      margin-bottom: var(--spacing-lg);
    }

    .hero-minmax span {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      transition: transform 0.3s ease;
    }

    .hero-minmax span:hover {
      transform: translateY(-2px);
    }

    .hero-summary {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: var(--spacing-md);
      font-size: 1.05rem;
      line-height: 1.6;
      margin-bottom: var(--spacing-md);
      animation: slideInLeft 0.8s ease-out;
    }

    /* === ADVICE PILLS === */
    
    .advice-pills {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
      margin-bottom: var(--spacing-md);
    }

    .advice-pill {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: var(--spacing-xs) var(--spacing-md);
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .advice-pill:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* === DETAILS PILLS === */
    
    .details-pills {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: var(--spacing-sm);
    }

    .detail-pill {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: var(--spacing-sm);
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .detail-pill:hover {
      background: rgba(0, 0, 0, 0.3);
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .detail-pill i {
      font-size: 1.8rem;
      display: block;
      margin-bottom: 4px;
      opacity: 0.9;
      transition: transform 0.3s ease;
    }

    .detail-pill:hover i {
      transform: scale(1.1);
    }

    .detail-pill .value {
      font-size: 1.1rem;
      font-weight: 600;
      display: block;
      margin-bottom: 2px;
    }

    .detail-pill .label {
      font-size: 0.75rem;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* === FASE LUNARE con Unicode Emoji === */
    
    .moon-phase-pill {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .moon-emoji {
      font-size: 2rem;
      display: block;
      margin-bottom: 4px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    /* === WIND ROSE (Rosa dei Venti) === */
    
    .wind-rose-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wind-rose {
      width: 60px;
      height: 60px;
      position: relative;
    }

    .wind-rose-svg {
      width: 100%;
      height: 100%;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .detail-pill:hover .wind-rose-svg {
      transform: rotate(15deg);
    }

    /* === TIMELINE PRECIPITAZIONI === */
    
    .rain-timeline {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      animation: fadeInUp 0.6s ease-out;
      animation-delay: 0.2s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    .timeline-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--spacing-md);
      opacity: 0.9;
    }

    .timeline-bar {
      position: relative;
      height: 60px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: var(--spacing-sm);
    }

    .timeline-period {
      position: absolute;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: white;
      border-radius: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .timeline-period:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      z-index: 10;
    }

    .timeline-period.leggera { background: rgba(52, 199, 89, 0.8); }
    .timeline-period.moderata { background: rgba(255, 149, 0, 0.8); }
    .timeline-period.forte { background: rgba(255, 59, 48, 0.9); }

    .timeline-legend {
      display: flex;
      gap: var(--spacing-md);
      font-size: 0.85rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.2s ease;
    }

    .legend-item:hover {
      transform: scale(1.05);
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* === TEMPERATURE SPARKLINE (Grafico 7 giorni) === */
    
    .temp-chart-container {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      animation: fadeInUp 0.6s ease-out;
      animation-delay: 0.4s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    .chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .temp-chart {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      height: 120px;
      gap: 8px;
      margin-bottom: var(--spacing-sm);
    }

    .temp-bar {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .temp-bar-visual {
      width: 100%;
      background: linear-gradient(180deg, var(--accent-orange), var(--accent-red));
      border-radius: 8px 8px 0 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .temp-bar-visual::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    .temp-bar:hover .temp-bar-visual {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(255, 149, 0, 0.5);
    }

    .temp-value {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent-orange);
    }

    .temp-day-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    /* === STATS GRID === */
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }

    .stat-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: var(--spacing-md);
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      background: rgba(255, 255, 255, 0.12);
    }

    .stat-card i {
      font-size: 2rem;
      margin-bottom: var(--spacing-xs);
      display: block;
      transition: transform 0.3s ease;
    }

    .stat-card:hover i {
      transform: scale(1.1) rotate(5deg);
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      margin: var(--spacing-xs) 0;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    /* === SECTION TITLE === */
    
    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: var(--spacing-xl) 0 var(--spacing-md) 0;
      padding-left: var(--spacing-xs);
      animation: slideInLeft 0.6s ease-out;
    }

    /* === COMPACT DAY CARDS === */
    
    .days-grid {
      display: grid;
      gap: var(--spacing-md);
    }

    .day-card-compact {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: var(--spacing-lg);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
    }

    .day-card-compact:nth-child(1) { animation-delay: 0.5s; }
    .day-card-compact:nth-child(2) { animation-delay: 0.6s; }
    .day-card-compact:nth-child(3) { animation-delay: 0.7s; }
    .day-card-compact:nth-child(4) { animation-delay: 0.8s; }
    .day-card-compact:nth-child(5) { animation-delay: 0.9s; }
    .day-card-compact:nth-child(6) { animation-delay: 1s; }

    .day-card-compact:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
      background: rgba(255, 255, 255, 0.14);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .day-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .day-name {
      font-size: 1.2rem;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    .day-card-compact:hover .day-name {
      color: var(--accent-blue);
    }

    .day-temps-compact {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: 1.5rem;
    }

    .temp-max { 
      font-weight: 700; 
      color: var(--accent-orange);
      transition: transform 0.3s ease;
    }

    .day-card-compact:hover .temp-max {
      transform: scale(1.1);
    }

    .temp-min { 
      color: var(--text-secondary); 
    }

    .day-summary-short {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
      line-height: 1.5;
    }

    .day-details-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
    }

    .detail-compact {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: var(--spacing-sm);
      text-align: center;
      font-size: 0.85rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .detail-compact:hover {
      background: rgba(0, 0, 0, 0.35);
      transform: translateY(-2px);
    }

    .detail-compact i {
      display: block;
      font-size: 1.3rem;
      margin-bottom: 4px;
      opacity: 0.8;
      transition: transform 0.3s ease;
    }

    .detail-compact:hover i {
      transform: scale(1.15);
    }

    .detail-compact .value {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .detail-compact .label {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    /* === ALERTS con Pulse Animation === */
    
    .alerts {
      background: rgba(255, 59, 48, 0.15);
      border-left: 4px solid var(--accent-red);
      border-radius: 12px;
      padding: var(--spacing-md);
      margin: var(--spacing-md) 0;
      font-size: 0.9rem;
      animation: pulse 2s ease-in-out infinite;
    }

    .alerts strong {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    /* === FOOTER === */
    
    footer {
      text-align: center;
      margin-top: var(--spacing-xl);
      padding: var(--spacing-lg);
      color: var(--text-secondary);
      font-size: 0.85rem;
      opacity: 0.7;
      animation: fadeIn 1s ease-out;
      animation-delay: 1.2s;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    footer p {
      margin: 6px 0;
    }

    .error-message {
      background: rgba(255, 59, 48, 0.2);
      border: 1px solid var(--accent-red);
      border-radius: 20px;
      padding: var(--spacing-xl);
      text-align: center;
      margin: var(--spacing-lg) 0;
      animation: fadeInUp 0.6s ease-out;
    }

    /* === RESPONSIVE === */
    
    @media (max-width: 768px) {
      .container {
        padding: var(--spacing-sm);
      }

      .hero-card {
        padding: var(--spacing-lg);
        min-height: 60vh;
      }

      .hero-temp {
        font-size: 72px;
      }

      .hero-condition {
        font-size: 1.3rem;
      }

      .hero-condition i {
        font-size: 2.5rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .details-pills {
        grid-template-columns: repeat(3, 1fr);
      }

      .day-details-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .section-title {
        font-size: 1.1rem;
      }

      .temp-chart {
        height: 100px;
      }
    }

    @media (max-width: 390px) {
      .hero-temp {
        font-size: 64px;
      }

      .details-pills {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Rimuovi transizioni da elementi specifici per performance */
    .timeline-period,
    .temp-bar-visual {
      will-change: transform;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HERO CARD - OGGI -->
    <div id="hero-container"></div>

    <!-- TIMELINE PRECIPITAZIONI -->
    <div id="rain-timeline-container"></div>

    <!-- GRAFICO TEMPERATURE 7 GIORNI -->
    <div id="temp-chart-container"></div>

    <!-- STATS SETTIMANALI -->
    <div id="stats-container"></div>

    <!-- GIORNI 2-7 -->
    <h2 class="section-title">📅 Prossimi 6 giorni</h2>
    <div id="forecast-container"></div>

    <footer>
      <p>Dati aggregati da Open-Meteo, Marine Open-Meteo, Weatherbit, Meteoblue e ilmeteo.it</p>
      <p>Analisi meteorologica professionale powered by AI</p>
      <p id="last-update"></p>
    </footer>
  </div>

  <script>
    // IMPORTANTE: In n8n, usa questa sintassi per iniettare i dati
    const weatherData = {"location":"Procida, Italia","generatedAt":"2024-05-20T10:30:00Z","days":[{"date":"2024-05-21","temp":{"min":17.5,"max":19.3,"feels_like":18.6},"rain":{"probability":85,"total_mm":8,"periods":[{"start":"08:30","end":"11:30","intensity":"leggera"},{"start":"14:30","end":"16:30","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"09:00","speed_kmh":12,"gusts_kmh":20,"direction":"NW","intensity":"leggero"},{"start":"09:00","end":"23:59","speed_kmh":32,"gusts_kmh":48,"direction":"S-SW","intensity":"moderato"}]},"pressure":{"value_hPa":1011,"trend":"in calo"},"sea":{"condition":"mosso","wave_height_m":1.8,"swell_direction":"S-SW"},"humidity":87,"uv_index":3,"sunrise":"05:43","sunset":"19:54","moon_phase":"Luna crescente","summary":"La giornata di martedì 21 maggio a Procida si aprirà con cielo nuvoloso e venti leggeri da Nord-Ovest, mantenendo il mare inizialmente poco mosso. Le prime precipitazioni, di intensità leggera, sono attese a partire dalle 08:30 e si protrarranno fino a metà mattinata. Intorno alle 09:00, assisteremo a un deciso cambio delle condizioni: il vento rinforzerà significativamente provenendo da Sud-Sud-Ovest, assumendo carattere moderato ma con raffiche che potranno toccare i 48 km/h. Questa evoluzione renderà il mare mosso, con onde che potranno raggiungere 1.8 metri. Nel pomeriggio, le piogge si ripresenteranno con intensità leggera tra le 14:30 e le 16:30. Pressione in calo per tutto il giorno, umidità elevata e temperature miti.","advice":["Prepararsi a piogge intermittenti per gran parte della giornata; un ombrello o un impermeabile saranno indispensabili.","Le attività nautiche sono sconsigliate a partire dalla tarda mattinata a causa del mare mosso e delle forti raffiche di vento da S-SW.","Assicurare oggetti esposti su balconi e terrazzi per prevenire danni dovuti al vento in rinforzo."],"alerts":["Allerta per vento forte e mare mosso a partire dalla mattinata, con raffiche superiori ai 45 km/h e onde oltre 1.5 metri."]},{"date":"2024-05-22","temp":{"min":17.8,"max":19.5,"feels_like":18.8},"rain":{"probability":95,"total_mm":18.5,"periods":[{"start":"02:00","end":"08:00","intensity":"moderata"},{"start":"10:00","end":"13:00","intensity":"leggera"},{"start":"16:00","end":"19:00","intensity":"forte"}]},"wind":{"periods":[{"start":"00:00","end":"15:00","speed_kmh":40,"gusts_kmh":65,"direction":"S-SE","intensity":"forte"},{"start":"15:00","end":"23:59","speed_kmh":28,"gusts_kmh":45,"direction":"SW","intensity":"moderato"}]},"pressure":{"value_hPa":1005,"trend":"stazionario"},"sea":{"condition":"molto mosso","wave_height_m":2.5,"swell_direction":"S-SE"},"humidity":92,"uv_index":2,"sunrise":"05:42","sunset":"19:55","moon_phase":"Luna crescente","summary":"Mercoledì 22 sarà una giornata fortemente perturbata su Procida. Le piogge inizieranno già nella notte con intensità moderata, proseguendo a tratti deboli al mattino. Il clou delle precipitazioni si avrà nel tardo pomeriggio con un'ondata di piogge intense, accompagnate da venti di Libeccio (S-SE) molto forti, con raffiche che potranno superare i 65 km/h per gran parte della giornata. Il mare sarà molto mosso, con onde che raggiungeranno i 2.5 metri e mareggiate lungo le coste esposte. Le temperature si manterranno simili al giorno precedente. Pressione atmosferica bassa e stazionaria, umidità molto elevata. La visibilità sarà ridotta durante le fasi di pioggia più intensa.","advice":["Si raccomanda di rimanere a casa o limitare gli spostamenti allo stretto necessario, soprattutto nel pomeriggio a causa delle piogge forti e del vento molto intenso.","Evitare categoricamente qualsiasi attività marittima o balneare. Il mare sarà molto agitato e pericoloso.","Verificare lo stato di chiusure o limitazioni ai collegamenti marittimi, che potrebbero essere interrotti per gran parte della giornata."],"alerts":["Allerta meteo arancione per vento molto forte e mare molto mosso/agitato. Raffiche oltre 60 km/h e onde fino a 2.5 metri.","Allerta per piogge intense e rischio idrogeologico localizzato nel tardo pomeriggio."]},{"date":"2024-05-23","temp":{"min":16,"max":18.5,"feels_like":17},"rain":{"probability":60,"total_mm":6,"periods":[{"start":"00:00","end":"04:00","intensity":"leggera"},{"start":"07:00","end":"09:00","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"10:00","speed_kmh":25,"gusts_kmh":40,"direction":"SW","intensity":"moderato"},{"start":"10:00","end":"23:59","speed_kmh":18,"gusts_kmh":28,"direction":"W-NW","intensity":"leggero"}]},"pressure":{"value_hPa":1010,"trend":"in aumento"},"sea":{"condition":"mosso","wave_height_m":1.5,"swell_direction":"SW"},"humidity":80,"uv_index":4,"sunrise":"05:41","sunset":"19:56","moon_phase":"Luna crescente","summary":"La giornata di giovedì 23 maggio vedrà un graduale miglioramento delle condizioni meteo. La notte e le prime ore del mattino saranno ancora interessate da piogge leggere e residue, ma con tendenza a esaurirsi entro le 09:00. Il vento, pur rimanendo moderato da Sud-Ovest con raffiche fino a 40 km/h nella prima parte della giornata, diminuirà di intensità nel corso della mattinata, ruotando da Ovest-Nord-Ovest e diventando leggero. Di conseguenza, anche il mare, inizialmente mosso con onde di 1.5 metri per effetto della mareggiata precedente, tenderà a placarsi nel pomeriggio, diventando poco mosso in serata. Le temperature subiranno un lieve calo. Pressione in risalita, segnale di un miglioramento generale.","advice":["Prestare attenzione ai residui venti e mareggiate in mattinata, specialmente se si effettuano spostamenti via mare.","Considerare un abbigliamento a strati, data la leggera diminuzione delle temperature e il cambio di vento.","Monitorare l'evolvere delle condizioni del mare prima di riprendere le attività nautiche, anche se in miglioramento."],"alerts":[]},{"date":"2024-05-24","temp":{"min":14.5,"max":17,"feels_like":15.5},"rain":{"probability":10,"total_mm":0,"periods":[]},"wind":{"periods":[{"start":"00:00","end":"23:59","speed_kmh":15,"gusts_kmh":25,"direction":"N-NW","intensity":"leggero"}]},"pressure":{"value_hPa":1018,"trend":"stazionario"},"sea":{"condition":"poco mosso","wave_height_m":0.8,"swell_direction":"NW"},"humidity":70,"uv_index":5,"sunrise":"05:40","sunset":"19:57","moon_phase":"Luna crescente","summary":"Venerdì 24 maggio sarà una giornata all'insegna del bel tempo su Procida. Il cielo si presenterà sereno o poco nuvoloso per tutto il giorno, con assenza di precipitazioni. Il vento sarà leggero, proveniente dai quadranti settentrionali (Nord-Nord-Ovest), con raffiche massime intorno ai 25 km/h. Questo contribuirà a rendere il mare poco mosso, con onde che non supereranno gli 0.8 metri, e moto ondoso in ulteriore calo verso sera. Le temperature subiranno un ulteriore lieve calo, attestandosi su valori gradevoli per il periodo. La pressione atmosferica sarà alta e stabile, garantendo un'atmosfera asciutta e una buona visibilità. Ottima giornata per godere delle bellezze dell'isola.","advice":["Approfittare della giornata di sole e vento leggero per attività all'aperto e gite in mare.","Considerare di indossare una giacca leggera, soprattutto nelle ore più fresche del mattino e della sera.","Ideale per la navigazione e la balneazione, con mare calmo e vento favorevole."],"alerts":[]},{"date":"2024-05-25","temp":{"min":14,"max":17.5,"feels_like":15.8},"rain":{"probability":5,"total_mm":0,"periods":[]},"wind":{"periods":[{"start":"00:00","end":"23:59","speed_kmh":10,"gusts_kmh":18,"direction":"N","intensity":"leggero"}]},"pressure":{"value_hPa":1020,"trend":"stazionario"},"sea":{"condition":"calmo","wave_height_m":0.4,"swell_direction":"N"},"humidity":65,"uv_index":6,"sunrise":"05:39","sunset":"19:58","moon_phase":"Luna crescente","summary":"Sabato 25 maggio si preannuncia una giornata splendida e serena su Procida. Il cielo sarà limpido e soleggiato dalla mattina alla sera, senza alcuna probabilità di precipitazioni. I venti saranno molto leggeri, principalmente di direzione settentrionale, con intensità non superiori ai 10 km/h e raffiche minime. Queste condizioni contribuiranno a un mare calmo o quasi calmo per l'intera giornata, con onde inferiori al mezzo metro. Le temperature si manterranno fresche al mattino ma gradevoli durante le ore centrali del giorno, con una lieve risalita rispetto al giorno precedente. La pressione atmosferica rimarrà alta, garantendo stabilità e un'ottima visibilità. Ottime condizioni per attività all'aperto e balneari.","advice":["Approfittare del clima ideale per escursioni, passeggiate e attività in spiaggia.","Data l'alta irradiazione solare e l'UV index elevato, è consigliabile l'uso di protezione solare, soprattutto nelle ore centrali del giorno.","Il mare sarà perfetto per nuoto, snorkeling e gite in barca, condizioni ideali per tutte le attività acquatiche."],"alerts":[]},{"date":"2024-05-26","temp":{"min":15,"max":18,"feels_like":16.5},"rain":{"probability":5,"total_mm":0,"periods":[]},"wind":{"periods":[{"start":"00:00","end":"12:00","speed_kmh":8,"gusts_kmh":15,"direction":"variabile","intensity":"leggero"},{"start":"12:00","end":"23:59","speed_kmh":12,"gusts_kmh":20,"direction":"NE","intensity":"leggero"}]},"pressure":{"value_hPa":1019,"trend":"in lieve calo"},"sea":{"condition":"calmo","wave_height_m":0.3,"swell_direction":"Variabile"},"humidity":68,"uv_index":7,"sunrise":"05:39","sunset":"19:59","moon_phase":"Luna crescente","summary":"Domenica 26 maggio si prospetta un'altra giornata di bel tempo su Procida. Il cielo sarà sereno o al più poco nuvoloso, con temperature in leggero aumento e massime che potranno raggiungere i 18°C, rendendo l'atmosfera molto piacevole. I venti saranno deboli e variabili al mattino, per poi stabilizzarsi da Nord-Est nel pomeriggio con intensità leggerissima. Di conseguenza, il mare rimarrà calmo per l'intera giornata, con onde quasi assenti, condizioni ideali per godere appieno delle spiagge e del mare procidano. La pressione atmosferica, pur mostrando una lieve tendenza alla diminuzione, si manterrà su valori alti, garantendo stabilità. L'indice UV sarà elevato, indicando la necessità di proteggersi dal sole.","advice":["Approfittare della giornata ideale per attività balneari, relax in spiaggia e gite in barca.","Indossare cappello, occhiali da sole e applicare crema solare con fattore di protezione alto, dato l'elevato indice UV.","Idratarsi frequentemente, specialmente se si trascorre molto tempo all'aria aperta sotto il sole."],"alerts":[]},{"date":"2024-05-27","temp":{"min":15.5,"max":18.2,"feels_like":16.8},"rain":{"probability":25,"total_mm":1,"periods":[{"start":"22:00","end":"23:59","intensity":"leggera"}]},"wind":{"periods":[{"start":"00:00","end":"18:00","speed_kmh":10,"gusts_kmh":18,"direction":"SE","intensity":"leggero"},{"start":"18:00","end":"23:59","speed_kmh":20,"gusts_kmh":30,"direction":"S","intensity":"moderato"}]},"pressure":{"value_hPa":1016,"trend":"in calo"},"sea":{"condition":"poco mosso","wave_height_m":0.7,"swell_direction":"S"},"humidity":75,"uv_index":6,"sunrise":"05:38","sunset":"20:00","moon_phase":"Luna crescente","summary":"Lunedì 27 maggio vedrà un graduale cambiamento delle condizioni meteo su Procida. La mattinata si presenterà con cielo parzialmente nuvoloso, ma senza precipitazioni. I venti saranno leggeri da Sud-Est. Nel corso del pomeriggio, la nuvolosità aumenterà progressivamente, e i venti rinforzeranno, ruotando da Sud e diventando moderati, con raffiche fino a 30 km/h in serata. Questa rotazione del vento renderà il mare da calmo a poco mosso. Le temperature si manterranno gradevoli, simili ai giorni precedenti. La pressione atmosferica sarà in calo, indicando un potenziale peggioramento. È prevista una leggera pioggia in tarda serata, con un accumulo minimo, preludio a condizioni più instabili per i giorni successivi.","advice":["Essere preparati a un aumento della nuvolosità e un rinforzo del vento nel pomeriggio, specialmente se si prevedono attività all'aperto prolungate.","Le condizioni del mare resteranno buone per la mattinata, ma tenderanno a peggiorare leggermente in serata con vento da Sud.","Considerare la possibilità di qualche goccia di pioggia in tarda serata, utile avere un ombrello a portata di mano."],"alerts":[]}],"processedAt":"2025-10-21T16:46:39.804Z","totalDays":7,"weekStats":{"maxTemp":19.5,"minTemp":14,"avgTemp":"18.3","rainyDays":4}};

    // === FUNZIONI HELPER ===
    
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const giorni = ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato'];
      const mesi = ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'];
      return `${giorni[date.getDay()]} ${date.getDate()} ${mesi[date.getMonth()]}`;
    }

    function getShortDate(dateStr) {
      const date = new Date(dateStr);
      const giorni = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
      return giorni[date.getDay()];
    }

    function getWeatherIcon(summary) {
      const text = (summary || '').toLowerCase();
      if (text.includes('temporale') || text.includes('tuoni')) return 'wi-thunderstorm';
      if (text.includes('pioggia forte') || text.includes('intense')) return 'wi-rain';
      if (text.includes('pioggia')) return 'wi-showers';
      if (text.includes('neve')) return 'wi-snow';
      if (text.includes('nebbia')) return 'wi-fog';
      if (text.includes('nuvoloso') || text.includes('coperto')) return 'wi-cloudy';
      if (text.includes('parzialmente')) return 'wi-day-cloudy';
      if (text.includes('sereno') || text.includes('sole')) return 'wi-day-sunny';
      return 'wi-day-cloudy';
    }

    function getTempClass(temp) {
      if (temp >= 28) return 'hot';
      if (temp >= 22) return 'warm';
      if (temp >= 15) return 'mild';
      if (temp >= 8) return 'cool';
      return 'cold';
    }

    function getTimePosition(timeStr) {
      const [hours, minutes] = timeStr.split(':').map(Number);
      return ((hours * 60 + minutes) / 1440) * 100;
    }

    // === NUOVA FUNZIONE: Moon Phase Emoji ===
    function getMoonPhaseEmoji(phaseText) {
      if (!phaseText) return '🌕';
      const phase = phaseText.toLowerCase();
      
      if (phase.includes('nuova') || phase.includes('new')) return '🌑';
      if (phase.includes('crescente') && phase.includes('primo')) return '🌓';
      if (phase.includes('crescente')) return '🌒';
      if (phase.includes('gibbosa') && phase.includes('crescente')) return '🌔';
      if (phase.includes('piena') || phase.includes('full')) return '🌕';
      if (phase.includes('gibbosa') && phase.includes('calante')) return '🌖';
      if (phase.includes('calante') && phase.includes('ultimo')) return '🌗';
      if (phase.includes('calante')) return '🌘';
      
      return '🌕'; // default full moon
    }

    // === NUOVA FUNZIONE: Wind Rose SVG ===
    function createWindRoseSVG(direction, speed) {
      const angle = getWindAngle(direction);
      
      return `
        <svg class="wind-rose-svg" viewBox="0 0 100 100" style="transform: rotate(${angle}deg)">
          <circle cx="50" cy="50" r="48" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2"/>
          <circle cx="50" cy="50" r="35" fill="none" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
          <circle cx="50" cy="50" r="22" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
          
          <!-- Punti cardinali -->
          <text x="50" y="12" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="10" font-weight="600">N</text>
          <text x="88" y="55" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">E</text>
          <text x="50" y="92" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">S</text>
          <text x="12" y="55" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="8">O</text>
          
          <!-- Freccia indicatore vento -->
          <path d="M 50 20 L 55 40 L 50 35 L 45 40 Z" fill="#007aff" opacity="0.9"/>
          <path d="M 50 35 L 50 70" stroke="#007aff" stroke-width="3" stroke-linecap="round"/>
          <circle cx="50" cy="50" r="5" fill="#007aff"/>
        </svg>
      `;
    }

    function getWindAngle(direction) {
      const directions = {
        'N': 0, 'NNE': 22.5, 'NE': 45, 'ENE': 67.5,
        'E': 90, 'ESE': 112.5, 'SE': 135, 'SSE': 157.5,
        'S': 180, 'SSW': 202.5, 'SW': 225, 'WSW': 247.5,
        'W': 270, 'WNW': 292.5, 'NW': 315, 'NNW': 337.5,
        'SSO': 202.5, 'SO': 225, 'OSO': 247.5, 'O': 270,
        'ONO': 292.5, 'NO': 315, 'NNO': 337.5
      };
      return directions[direction?.toUpperCase()] || 0;
    }

    // === RENDER HERO CARD ===
    
    function renderHero() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
      
      const today = weatherData.days[0];
      const tempClass = getTempClass(today.temp?.max || 20);
      const weatherIcon = getWeatherIcon(today.summary);
      const moonEmoji = getMoonPhaseEmoji(today.moon_phase);
      
      const html = `
        <div class="hero-card ${tempClass}">
          <div class="hero-header">
            <div class="hero-location">
              <i class="wi wi-horizon"></i>
              ${weatherData.location || 'Procida'}
            </div>
            <div class="hero-date">${formatDate(today.date)}</div>
          </div>

          <div class="hero-main">
            <div class="hero-temp">${Math.round(today.temp?.max || today.temp?.feels_like || 20)}°</div>
            
            <div class="hero-condition">
              <i class="wi ${weatherIcon}"></i>
              <span>${getConditionText(today)}</span>
            </div>

            <div class="hero-minmax">
              <span>
                <i class="wi wi-direction-down"></i>
                ${Math.round(today.temp?.min || 15)}°
              </span>
              <span>
                <i class="wi wi-direction-up"></i>
                ${Math.round(today.temp?.max || 20)}°
              </span>
            </div>
          </div>

          ${today.summary ? `
            <div class="hero-summary">
              ${today.summary}
            </div>
          ` : ''}

          ${today.advice && today.advice.length > 0 ? `
            <div class="advice-pills">
              ${today.advice.map(a => `
                <div class="advice-pill">
                  💡 ${a}
                </div>
              `).join('')}
            </div>
          ` : ''}

          ${today.alerts && today.alerts.length > 0 ? `
            <div class="alerts">
              <strong>⚠️ ALLERTE METEO</strong>
              ${today.alerts.map(a => `<p>${a}</p>`).join('')}
            </div>
          ` : ''}

          <div class="details-pills">
            ${today.rain && today.rain.probability > 0 ? `
              <div class="detail-pill">
                <i class="wi wi-raindrop"></i>
                <span class="value">${today.rain.probability}%</span>
                <span class="label">Pioggia</span>
              </div>
            ` : ''}
            
            ${today.wind && today.wind.periods && today.wind.periods[0] ? `
              <div class="detail-pill">
                <div class="wind-rose-container">
                  ${createWindRoseSVG(today.wind.periods[0].direction, today.wind.periods[0].speed_kmh)}
                </div>
                <span class="value">${today.wind.periods[0].speed_kmh} km/h</span>
                <span class="label">${today.wind.periods[0].direction}</span>
              </div>
            ` : ''}

            ${today.humidity ? `
              <div class="detail-pill">
                <i class="wi wi-humidity"></i>
                <span class="value">${today.humidity}%</span>
                <span class="label">Umidità</span>
              </div>
            ` : ''}

            ${today.uv_index ? `
              <div class="detail-pill">
                <i class="wi wi-day-sunny"></i>
                <span class="value">${today.uv_index}</span>
                <span class="label">UV</span>
              </div>
            ` : ''}

            ${today.pressure ? `
              <div class="detail-pill">
                <i class="wi wi-barometer"></i>
                <span class="value">${today.pressure.value_hPa}</span>
                <span class="label">hPa</span>
              </div>
            ` : ''}

            ${today.sea ? `
              <div class="detail-pill">
                <i class="wi wi-tsunami"></i>
                <span class="value">${today.sea.wave_height_m}m</span>
                <span class="label">${today.sea.condition}</span>
              </div>
            ` : ''}

            ${today.sunrise ? `
              <div class="detail-pill">
                <i class="wi wi-sunrise"></i>
                <span class="value">${today.sunrise}</span>
                <span class="label">Alba</span>
              </div>
            ` : ''}

            ${today.sunset ? `
              <div class="detail-pill">
                <i class="wi wi-sunset"></i>
                <span class="value">${today.sunset}</span>
                <span class="label">Tramonto</span>
              </div>
            ` : ''}

            ${today.moon_phase ? `
              <div class="detail-pill moon-phase-pill">
                <span class="moon-emoji">${moonEmoji}</span>
                <span class="label">${today.moon_phase}</span>
              </div>
            ` : ''}
          </div>
        </div>
      `;
      
      document.getElementById('hero-container').innerHTML = html;
    }

    function getConditionText(day) {
      if (day.rain && day.rain.probability > 70) return 'Pioggia';
      if (day.rain && day.rain.probability > 40) return 'Possibile pioggia';
      const summary = (day.summary || '').toLowerCase();
      if (summary.includes('sereno')) return 'Sereno';
      if (summary.includes('nuvoloso')) return 'Nuvoloso';
      return 'Variabile';
    }

    // === RENDER RAIN TIMELINE ===
    
    function renderRainTimeline() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;
      
      const today = weatherData.days[0];
      if (!today.rain || !today.rain.periods || today.rain.periods.length === 0) return;

      const periodsHTML = today.rain.periods.map(p => {
        const start = getTimePosition(p.start);
        const end = getTimePosition(p.end);
        const width = end - start;
        
        return `
          <div class="timeline-period ${p.intensity}" 
               style="left: ${start}%; width: ${width}%;"
               title="${p.start} - ${p.end}: ${p.intensity}">
            <span>${p.start}-${p.end}</span>
          </div>
        `;
      }).join('');

      const html = `
        <div class="rain-timeline">
          <div class="timeline-header">
            <i class="wi wi-rain"></i>
            Precipitazioni Oggi (${today.rain.total_mm}mm totali)
          </div>
          
          <div class="timeline-bar">
            ${periodsHTML}
          </div>

          <div class="timeline-legend">
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(52, 199, 89, 0.8);"></div>
              <span>Leggera</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(255, 149, 0, 0.8);"></div>
              <span>Moderata</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background: rgba(255, 59, 48, 0.9);"></div>
              <span>Forte</span>
            </div>
          </div>
        </div>
      `;

      document.getElementById('rain-timeline-container').innerHTML = html;
    }

    // === NUOVA FUNZIONE: Temperature Chart ===
    function renderTempChart() {
      if (!weatherData || !weatherData.days || weatherData.days.length === 0) return;

      const temps = weatherData.days.map(d => d.temp?.max || 20);
      const maxTemp = Math.max(...temps);
      const minTemp = Math.min(...temps);
      const range = maxTemp - minTemp || 1;

      const barsHTML = weatherData.days.map((day, i) => {
        const temp = day.temp?.max || 20;
        const height = ((temp - minTemp) / range) * 100;
        
        return `
          <div class="temp-bar">
            <div class="temp-value">${Math.round(temp)}°</div>
            <div class="temp-bar-visual" style="height: ${height}px; min-height: 20px;"></div>
            <div class="temp-day-label">${getShortDate(day.date)}</div>
          </div>
        `;
      }).join('');

      const html = `
        <div class="temp-chart-container">
          <div class="chart-title">
            <i class="wi wi-thermometer"></i>
            Temperature Massime - 7 Giorni
          </div>
          <div class="temp-chart">
            ${barsHTML}
          </div>
        </div>
      `;

      document.getElementById('temp-chart-container').innerHTML = html;
    }

    // === RENDER STATS ===
    
    function renderStats() {
      if (!weatherData || !weatherData.weekStats) return;
      const stats = weatherData.weekStats;
      
      const html = `
        <div class="stats-grid">
          <div class="stat-card animate-on-load animate-delay-1">
            <i class="wi wi-thermometer" style="color: var(--accent-orange);"></i>
            <div class="stat-value">${stats.maxTemp}°C</div>
            <div class="stat-label">Max Settimana</div>
          </div>
          <div class="stat-card animate-on-load animate-delay-2">
            <i class="wi wi-thermometer-exterior" style="color: var(--accent-blue);"></i>
            <div class="stat-value">${stats.minTemp}°C</div>
            <div class="stat-label">Min Settimana</div>
          </div>
          <div class="stat-card animate-on-load animate-delay-3">
            <i class="wi wi-thermometer" style="color: var(--accent-green);"></i>
            <div class="stat-value">${stats.avgTemp}°C</div>
            <div class="stat-label">Media</div>
          </div>
          <div class="stat-card animate-on-load animate-delay-4">
            <i class="wi wi-rain" style="color: var(--accent-blue);"></i>
            <div class="stat-value">${stats.rainyDays}</div>
            <div class="stat-label">Giorni Pioggia</div>
          </div>
        </div>
      `;
      
      document.getElementById('stats-container').innerHTML = html;
    }

    // === RENDER FORECAST DAYS 2-7 ===
    
    function renderForecast() {
      if (!weatherData || !weatherData.days || weatherData.days.length < 2) {
        document.getElementById('forecast-container').innerHTML = `
          <div class="error-message">
            <h2>⚠️ Errore nel caricamento dei dati</h2>
            <p>Impossibile recuperare le previsioni meteo. Riprova più tardi.</p>
          </div>
        `;
        return;
      }

      const futureDays = weatherData.days.slice(1);

      const html = futureDays.map(day => {
        const moonEmoji = getMoonPhaseEmoji(day.moon_phase);
        
        return `
        <div class="day-card-compact">
          <div class="day-card-header">
            <div class="day-name">${formatDate(day.date)}</div>
            <div class="day-temps-compact">
              <span class="temp-max">${Math.round(day.temp?.max || 20)}°</span>
              <span class="temp-min">${Math.round(day.temp?.min || 15)}°</span>
            </div>
          </div>

          ${day.summary ? `
            <div class="day-summary-short">${day.summary}</div>
          ` : ''}

          ${day.advice && day.advice.length > 0 ? `
            <div class="advice-pills">
              ${day.advice.slice(0, 2).map(a => `
                <div class="advice-pill">💡 ${a}</div>
              `).join('')}
            </div>
          ` : ''}

          ${day.alerts && day.alerts.length > 0 ? `
            <div class="alerts">
              <strong>⚠️ ALLERTE</strong>
              ${day.alerts.map(a => `<p>${a}</p>`).join('')}
            </div>
          ` : ''}

          <div class="day-details-row">
            ${day.rain && day.rain.probability > 0 ? `
              <div class="detail-compact">
                <i class="wi wi-raindrop"></i>
                <div class="value">${day.rain.probability}%</div>
                <div class="label">${day.rain.total_mm}mm</div>
              </div>
            ` : ''}

            ${day.wind && day.wind.periods && day.wind.periods[0] ? `
              <div class="detail-compact">
                <div style="width: 40px; height: 40px; margin: 0 auto 4px;">
                  ${createWindRoseSVG(day.wind.periods[0].direction, day.wind.periods[0].speed_kmh)}
                </div>
                <div class="value">${day.wind.periods[0].speed_kmh} km/h</div>
                <div class="label">${day.wind.periods[0].direction}</div>
              </div>
            ` : ''}

            ${day.sea ? `
              <div class="detail-compact">
                <i class="wi wi-tsunami"></i>
                <div class="value">${day.sea.wave_height_m}m</div>
                <div class="label">${day.sea.condition}</div>
              </div>
            ` : ''}

            ${day.humidity ? `
              <div class="detail-compact">
                <i class="wi wi-humidity"></i>
                <div class="value">${day.humidity}%</div>
                <div class="label">Umidità</div>
              </div>
            ` : ''}

            ${day.uv_index ? `
              <div class="detail-compact">
                <i class="wi wi-day-sunny"></i>
                <div class="value">${day.uv_index}</div>
                <div class="label">UV Index</div>
              </div>
            ` : ''}

            ${day.pressure ? `
              <div class="detail-compact">
                <i class="wi wi-barometer"></i>
                <div class="value">${day.pressure.value_hPa}</div>
                <div class="label">${day.pressure.trend || 'hPa'}</div>
              </div>
            ` : ''}

            ${day.moon_phase ? `
              <div class="detail-compact">
                <span style="font-size: 1.5rem; display: block; margin-bottom: 4px;">${moonEmoji}</span>
                <div class="label">${day.moon_phase}</div>
              </div>
            ` : ''}
          </div>
        </div>
      `}).join('');

      document.getElementById('forecast-container').innerHTML = `<div class="days-grid">${html}</div>`;
    }

    // === UPDATE TIMESTAMP ===
    
    function updateTimestamp() {
      if (weatherData && weatherData.generatedAt) {
        const date = new Date(weatherData.generatedAt);
        document.getElementById('last-update').textContent = 
          `Ultimo aggiornamento: ${date.toLocaleString('it-IT')}`;
      }
    }

    // === INIZIALIZZAZIONE ===
    
    renderHero();
    renderRainTimeline();
    renderTempChart();
    renderStats();
    renderForecast();
    updateTimestamp();
  </script>
</body>
</html>
