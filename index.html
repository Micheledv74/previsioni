<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>Previsioni Procida - Dashboard Meteo</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto:wght@400;500;700&display=swap');
    
    html { 
      box-sizing: border-box;
    } 
    
    *,*:before,*:after { 
      box-sizing: inherit; 
    }
    
    body { 
      font-family: 'Roboto', Arial, sans-serif; 
      max-width: 1200px; 
      margin: 0 auto; 
      background: linear-gradient(135deg, #1a2942 0%, #26365a 35%, #3498db 100%); 
      color: #f0f8ff; 
      padding: 20px 16px 24px 16px; 
      overflow-x: hidden; 
      min-height: 100vh; 
    }
    
    /* HEADER */
    .header { 
      font-family: 'Montserrat', sans-serif; 
      font-size: 2.8em; 
      font-weight: 900; 
      text-align: center; 
      color: #ffffff; 
      text-shadow: 2px 4px 20px rgba(9, 23, 42, 0.6); 
      letter-spacing: 3px; 
      user-select: none; 
      margin-bottom: 32px;
      animation: fadeInDown 0.8s ease-out;
    }
    
    /* DASHBOARD GRID */
    .dashboard { 
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    /* BOX STYLING */
    .box { 
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 24px; 
      box-shadow: 0 8px 32px rgba(6, 33, 70, 0.37),
                  0 2px 8px rgba(0, 0, 0, 0.2);
      padding: 28px 24px 32px 24px; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      position: relative;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: fadeInUp 0.6s ease-out backwards;
    }
    
    .box:nth-child(1) { animation-delay: 0.1s; }
    .box:nth-child(2) { animation-delay: 0.2s; }
    .box:nth-child(3) { animation-delay: 0.3s; }
    .box:nth-child(4) { animation-delay: 0.4s; }
    
    .box:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(6, 33, 70, 0.5),
                  0 4px 12px rgba(0, 0, 0, 0.3);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    /* BOX TITLE */
    .box-title { 
      font-size: 1.5rem; 
      font-weight: 900; 
      color: #ffffff; 
      letter-spacing: 1.5px; 
      margin-bottom: 20px; 
      font-family: 'Montserrat', sans-serif;
      text-shadow: 1px 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    /* MAIN INFO */
    .box .main { 
      font-weight: 700; 
      font-size: 1.3em; 
      color: #ffffff;
      text-align: center;
      margin-bottom: 8px;
    }
    
    .box .desc { 
      margin: 8px 0 0 0; 
      font-size: 1.05em; 
      color: #d4e7f7;
      text-align: center;
    }
    
    /* WIND INFO */
    .wind-info { 
      font-weight: 700; 
      font-size: 1.3em; 
      margin: 0; 
      display: flex; 
      justify-content: center; 
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .wind-info span { 
      display: inline-block; 
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    
    .wind-info span:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.05);
    }
    
    .wind-info .wind-speed { 
      color: #84dbff; 
    }
    
    .wind-info .wind-dir { 
      color: #a9edff; 
    }
    
    .folata-max { 
      color: #ffd472; 
      font-weight: 700; 
      font-size: 1.15em; 
      margin-top: 12px;
      padding: 10px 18px;
      background: rgba(255, 212, 114, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(255, 212, 114, 0.2);
    }
    
    /* BOX SUMMARY */
    .box-summary { 
      width: 100%; 
      margin-top: 20px; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center;
      font-size: 1.02em;
      gap: 8px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
    }
    
    .box-summary-row {
      width: 100%;
      display: flex;
      flex-direction: row;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .box-summary-row2 {
      text-align: center;
      width: 100%;
    }
    
    .summary-label { 
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.08);
      transition: all 0.3s ease;
    }
    
    .summary-label:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-2px);
    }
    
    .summary-max { color: #ffd472; }
    .summary-min { color: #6fd7f8; }
    .summary-dir { color: #8effa6; }
    .summary-mean { color: #b6fffa; }
    .summary-range { color: #fee3a1; }
    .summary-std { color: #c2cafd;}
    .summary-trend-up { color: #09e889; }
    .summary-trend-down { color: #ff9a00; }
    .summary-trend-stable { color: #ffd472; }
    .summary-max-mm { color: #a1b4ff; }
    .summary-min-mm { color: #72b6cc; }
    .summary-hour { color: #e0deff;}
    .summary-temp { color: #ffb2e6;}
    .summary-celeste { color: #6fd7f8; }
    
    /* BUTTON */
    button.detail-btn { 
      margin-top: 16px; 
      background: linear-gradient(135deg, #127af7 0%, #3d9eff 100%);
      color: #fff; 
      font-weight: 700; 
      font-size: 1.05em;
      border: none; 
      border-radius: 12px; 
      padding: 14px 32px; 
      cursor: pointer; 
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(18, 122, 247, 0.3);
      letter-spacing: 0.5px;
    }
    
    button.detail-btn:hover { 
      background: linear-gradient(135deg, #45bafe 0%, #5ac8ff 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(18, 122, 247, 0.4);
    }
    
    button.detail-btn:active {
      transform: translateY(0);
    }
    
    /* DETAIL SECTION */
    .detail-section { 
      display: none; 
      margin-top: 16px; 
      width: 100%;
      animation: fadeIn 0.4s ease-out;
    }
    
    .detail-section.active { 
      display: block; 
    }
    
    .chart-wrap { 
      width: 100%; 
      margin: 0 auto 12px auto; 
      border-radius: 16px; 
      background: rgba(33, 50, 96, 0.5);
      backdrop-filter: blur(5px);
      padding: 16px 12px 12px 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* MINI DAYS */
    .mini-days { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 12px; 
      margin: 24px auto 12px auto; 
      justify-content: center;
      padding: 0 16px;
      animation: fadeInUp 0.8s ease-out 0.5s backwards;
    }
    
    .mini-day { 
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(8px);
      color: #c6f3ff; 
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 16px; 
      padding: 14px 20px; 
      font-size: 1.05em;
      font-weight: 600;
      min-width: 95px; 
      box-shadow: 0 4px 12px rgba(32, 43, 59, 0.3);
      cursor: pointer; 
      user-select: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .mini-day .icon {
      font-size: 1.4em;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }
    
    .mini-day:hover { 
      background: rgba(79, 117, 203, 0.35);
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(32, 43, 59, 0.4);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .mini-day.active { 
      background: linear-gradient(135deg, rgba(91, 144, 197, 0.9) 0%, rgba(69, 186, 254, 0.8) 100%);
      box-shadow: 0 8px 24px rgba(91, 144, 197, 0.5),
                  0 0 20px rgba(219, 239, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.4);
      transform: translateY(-3px) scale(1.05);
      color: #ffffff;
    }
    
    /* FOOTER */
    .footer { 
      margin-top: 40px; 
      text-align: center; 
      color: #dbefff; 
      font-size: 1.05rem; 
      font-weight: 500; 
      text-shadow: 0 2px 8px rgba(40, 60, 88, 0.6);
      animation: fadeIn 1s ease-out 0.6s backwards;
    }
    
    /* ANIMATIONS */
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    /* RESPONSIVE */
    @media (max-width: 800px) {
      .dashboard {
        gap: 16px;
      }
      .box {
        padding: 24px 20px 28px 20px;
      }
      .header {
        font-size: 2.2em;
      }
    }
    
    @media (max-width: 650px) {
      .dashboard {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .box {
        width: 100%;
      }
      .header {
        font-size: 1.8em;
        margin-bottom: 24px;
      }
      .wind-info {
        flex-direction: column;
        gap: 12px;
      }
    }
    
    @media (max-width: 510px) {
      .mini-day {
        padding: 12px 16px;
        font-size: 0.95em;
        min-width: 85px;
      }
      .header {
        font-size: 1.5em;
      }
      .box-title {
        font-size: 1.3rem;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="header">PREVISIONI METEO PROCIDA</div>
  <div class="dashboard">
    <section class="box vento" id="windbox"></section>
    <section class="box pioggia" id="rainbox"></section>
    <section class="box mare" id="seabox"></section>
    <section class="box pressione" id="pressbox"></section>
  </div>
  <div class="mini-days" id="miniDaysBox"></div>
  <div class="footer" id="footer"></div>
  <script>
    const DATA = {
      days:[
        { day_label:"14/10", icon:"☀️", temp_max:22, temp_min:18, precipitation:2.3, wind_max:13, wind_gust:19, wind_min:6, wind_dir:90,
          hourly_winds:[7,9,11,13,12,10,7,6,10,12,9,8,7,6,6,7,8,9,11,12,13,12,10,9],
          hourly_wind_directions:[80,90,90,100,110,120,120,130,140,150,150,155,160,160,170,170,180,180,180,180,170,160,150,140],
          hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
          hourly_precips:[0,0,0,0,0,0.4,0.8,0.0,0,0,0,0,0.2,0,0,0,0.7,0,0,0,0,0,0,0],
          hourly_pressures:[1017,1018,1018,1018,1018,1018,1017,1017,1017,1017,1018,1019,1020,1019,1018,1018,1017,1016,1016,1016,1016,1016,1017,1017]
        },
        { day_label:"15/10", icon:"⛅", temp_max:21, temp_min:15, precipitation:0.5, wind_max:10, wind_gust:17, wind_min:5, wind_dir:70,
          hourly_winds:[5,7,8,9,7,8,8,8,9,10,10,9,8,8,7,6,8,8,7,7,6,6,5,5],
          hourly_wind_directions:[70,72,75,76,78,80,83,85,87,90,92,95,97,98,99,100,100,101,102,103,103,104,105,105],
          hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
          hourly_precips:[0,0,0,0,0,0,0,0,0.1,0.3,0,0,0,0,0,0,0.1,0,0,0,0,0,0,0],
          hourly_pressures:[1011,1011,1012,1012,1012,1012,1012,1012,1011,1011,1011,1012,1013,1012,1011,1011,1010,1010,1009,1009,1009,1008,1008,1008]
        },
        { day_label:"16/10", icon:"🌤️", temp_max:20, temp_min:14, precipitation:0, wind_max:12, wind_gust:16, wind_min:5, wind_dir:60,
          hourly_winds:[7,8,7,6,9,10,12,11,9,8,7,6,7,8,7,6,10,11,12,11,10,9,8,7],
          hourly_wind_directions:[60,60,70,70,75,80,80,75,70,65,60,55,60,65,70,70,75,80,85,85,80,75,70,65],
          hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
          hourly_precips:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
          hourly_pressures:[1012,1013,1013,1013,1012,1012,1011,1011,1011,1010,1010,1009,1009,1010,1010,1011,1012,1013,1013,1014,1014,1013,1012,1012]
        },
        { day_label:"17/10", icon:"🌧️", temp_max:18, temp_min:13, precipitation:5.6, wind_max:15, wind_gust:22, wind_min:9, wind_dir:120,
          hourly_winds:[8,9,10,12,14,16,15,13,12,11,10,9,8,7,6,8,9,11,13,14,13,12,11,10],
          hourly_wind_directions:[120,120,120,120,130,130,140,140,140,140,130,120,120,110,110,110,110,120,120,130,130,130,130,120],
          hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
          hourly_precips:[1.2,1.3,1.4,1.5,0.7,0.5,0.2,0.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
          hourly_pressures:[1015,1015,1014,1013,1012,1012,1011,1010,1010,1011,1012,1013,1013,1013,1013,1014,1015,1016,1016,1017,1017,1016,1016,1015]
        },
        { day_label:"18/10", icon:"⛅", temp_max:19, temp_min:15, precipitation:0.8, wind_max:11, wind_gust:15, wind_min:6, wind_dir:105,
          hourly_winds:[9,10,11,12,12,11,10,9,9,9,8,7,7,8,9,10,11,11,10,10,9,8,8,7],
          hourly_wind_directions:[105,105,105,105,100,100,95,95,90,90,85,80,80,80,80,80,85,85,90,90,90,90,95,95],
          hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
          hourly_precips:[0,0,0,0,0.1,0.3,0.4,0.5,0.3,0.1,0,0,0,0,0,0.2,0.1,0,0,0,0,0,0,0],
          hourly_pressures:[1014,1014,1015,1015,1015,1016,1016,1016,1016,1015,1014,1013,1013,1013,1013,1013,1014,1015,1015,1015,1015,1015,1014,1014]
        },
        { day_label:"19/10", icon:"🌦️", temp_max:20, temp_min:14, precipitation:1.2, wind_max:8, wind_gust:12, wind_min:4, wind_dir:90,
          hourly_winds:[6,7,7,7,8,8,7,7,6,6,5,5,5,4,4,5,6,7,6,6,5,5,6,7],
          hourly_wind_directions:[90,90,90,85,85,80,80,75,75,75,70,70,70,65,65,65,65,70,70,70,75,75,75,80],
          hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
          hourly_precips:[0,0,0,0,0,0.1,0.2,0.3,0.3,0.2,0.1,0,0,0,0,0,0.1,0.2,0,0,0,0,0,0],
          hourly_pressures:[1013,1012,1012,1011,1011,1011,1011,1010,1010,1010,1011,1012,1012,1013,1013,1013,1013,1014,1014,1014,1014,1013,1013,1013]
        },
        { day_label:"20/10", icon:"⛅", temp_max:21, temp_min:13, precipitation:0.9, wind_max:9, wind_gust:14, wind_min:7, wind_dir:80,
          hourly_winds:[7,7,8,9,9,10,10,10,9,9,8,8,7,6,6,6,7,7,8,9,10,10,9,8],
          hourly_wind_directions:[80,80,80,85,85,85,90,90,90,90,95,95,95,100,100,100,100,100,90,90,90,90,90,90],
          hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
          hourly_precips:[0,0,0,0,0,0,0.1,0.1,0.2,0.2,0.1,0,0,0,0,0,0,0,0,0,0,0,0,0],
          hourly_pressures:[1011,1011,1011,1012,1012,1013,1013,1013,1013,1013,1012,1012,1011,1011,1011,1011,1012,1012,1012,1012,1012,1012,1012,1012]
        }
      ],
      sea:[
        [
          {time:"00:00",wave_height:0.08,sea_surface_temperature:21.9,swell_height:0.04,swell_direction:209},
          {time:"03:00",wave_height:0.09,sea_surface_temperature:22.0,swell_height:0.05,swell_direction:212},
          {time:"06:00",wave_height:0.07,sea_surface_temperature:22.3,swell_height:0.05,swell_direction:215},
          {time:"09:00",wave_height:0.06,sea_surface_temperature:22.5,swell_height:0.03,swell_direction:218},
          {time:"12:00",wave_height:0.12,sea_surface_temperature:22.6,swell_height:0.06,swell_direction:215},
          {time:"15:00",wave_height:0.14,sea_surface_temperature:22.8,swell_height:0.07,swell_direction:217},
          {time:"18:00",wave_height:0.13,sea_surface_temperature:22.4,swell_height:0.06,swell_direction:218},
          {time:"21:00",wave_height:0.10,sea_surface_temperature:22.1,swell_height:0.05,swell_direction:220}
        ],
        [
          {time:"00:00",wave_height:0.04,sea_surface_temperature:21.2,swell_height:0.02,swell_direction:210},
          {time:"03:00",wave_height:0.05,sea_surface_temperature:21.7,swell_height:0.02,swell_direction:212},
          {time:"06:00",wave_height:0.05,sea_surface_temperature:21.8,swell_height:0.01,swell_direction:214},
          {time:"09:00",wave_height:0.06,sea_surface_temperature:21.9,swell_height:0.02,swell_direction:216},
          {time:"12:00",wave_height:0.10,sea_surface_temperature:22.0,swell_height:0.04,swell_direction:215},
          {time:"15:00",wave_height:0.12,sea_surface_temperature:22.2,swell_height:0.05,swell_direction:217},
          {time:"18:00",wave_height:0.11,sea_surface_temperature:22.0,swell_height:0.04,swell_direction:218},
          {time:"21:00",wave_height:0.08,sea_surface_temperature:21.8,swell_height:0.03,swell_direction:220}
        ],
        [
          {time:"00:00",wave_height:0.05,sea_surface_temperature:21.0,swell_height:0.03,swell_direction:210},
          {time:"03:00",wave_height:0.06,sea_surface_temperature:21.1,swell_height:0.03,swell_direction:211},
          {time:"06:00",wave_height:0.05,sea_surface_temperature:21.2,swell_height:0.02,swell_direction:212},
          {time:"09:00",wave_height:0.05,sea_surface_temperature:21.3,swell_height:0.02,swell_direction:213},
          {time:"12:00",wave_height:0.07,sea_surface_temperature:21.4,swell_height:0.03,swell_direction:214},
          {time:"15:00",wave_height:0.09,sea_surface_temperature:21.6,swell_height:0.03,swell_direction:215},
          {time:"18:00",wave_height:0.10,sea_surface_temperature:21.3,swell_height:0.03,swell_direction:216},
          {time:"21:00",wave_height:0.07,sea_surface_temperature:21.4,swell_height:0.02,swell_direction:217}
        ],
        [
          {time:"00:00",wave_height:0.06,sea_surface_temperature:20.7,swell_height:0.04,swell_direction:210},
          {time:"03:00",wave_height:0.06,sea_surface_temperature:20.6,swell_height:0.04,swell_direction:211},
          {time:"06:00",wave_height:0.05,sea_surface_temperature:20.5,swell_height:0.03,swell_direction:212},
          {time:"09:00",wave_height:0.06,sea_surface_temperature:20.4,swell_height:0.03,swell_direction:213},
          {time:"12:00",wave_height:0.06,sea_surface_temperature:20.5,swell_height:0.04,swell_direction:214},
          {time:"15:00",wave_height:0.06,sea_surface_temperature:20.6,swell_height:0.04,swell_direction:215},
          {time:"18:00",wave_height:0.07,sea_surface_temperature:20.6,swell_height:0.04,swell_direction:216},
          {time:"21:00",wave_height:0.07,sea_surface_temperature:20.5,swell_height:0.03,swell_direction:217}
        ],
        [
          {time:"00:00",wave_height:0.08,sea_surface_temperature:20.2,swell_height:0.05,swell_direction:210},
          {time:"03:00",wave_height:0.08,sea_surface_temperature:20.1,swell_height:0.05,swell_direction:211},
          {time:"06:00",wave_height:0.07,sea_surface_temperature:20.1,swell_height:0.04,swell_direction:212},
          {time:"09:00",wave_height:0.07,sea_surface_temperature:20.0,swell_height:0.05,swell_direction:213},
          {time:"12:00",wave_height:0.08,sea_surface_temperature:20.1,swell_height:0.06,swell_direction:214},
          {time:"15:00",wave_height:0.08,sea_surface_temperature:20.1,swell_height:0.06,swell_direction:215},
          {time:"18:00",wave_height:0.08,sea_surface_temperature:20.2,swell_height:0.06,swell_direction:216},
          {time:"21:00",wave_height:0.07,sea_surface_temperature:20.3,swell_height:0.04,swell_direction:217}
        ],
        [
          {time:"00:00",wave_height:0.11,sea_surface_temperature:19.9,swell_height:0.07,swell_direction:210},
          {time:"03:00",wave_height:0.11,sea_surface_temperature:19.8,swell_height:0.07,swell_direction:211},
          {time:"06:00",wave_height:0.10,sea_surface_temperature:19.8,swell_height:0.06,swell_direction:212},
          {time:"09:00",wave_height:0.10,sea_surface_temperature:19.7,swell_height:0.06,swell_direction:213},
          {time:"12:00",wave_height:0.10,sea_surface_temperature:19.7,swell_height:0.06,swell_direction:214},
          {time:"15:00",wave_height:0.10,sea_surface_temperature:19.8,swell_height:0.07,swell_direction:215},
          {time:"18:00",wave_height:0.10,sea_surface_temperature:19.9,swell_height:0.07,swell_direction:216},
          {time:"21:00",wave_height:0.10,sea_surface_temperature:20.0,swell_height:0.07,swell_direction:217}
        ]
      ]
    };

    let selectedDayIndex = 0;
    let windChart, rainChart, seaChart, pressChart;

    function rainIcon(valmm) {
      if (valmm < 0.1) return '';
      if (valmm < 0.5) return '💧';
      if (valmm < 1) return '💧💧';
      if (valmm < 3) return '💧💧💧';
      if (valmm < 10) return '💧💧💧💧';
      return '💧💧💧💧💧';
    }

    function windDirectionName(deg) {
      const winds = [
        { name: "Tramontana", abbr: "N" }, { name: "Grecale", abbr: "NE" },
        { name: "Levante", abbr: "E" }, { name: "Scirocco", abbr: "SE" },
        { name: "Ostro", abbr: "S" }, { name: "Libeccio", abbr: "SO" },
        { name: "Ponente", abbr: "O" }, { name: "Maestrale", abbr: "NO" }
      ];
      const idx = Math.floor(((deg + 22.5) % 360) / 45);
      return winds[idx] ? winds[idx].name + " (" + winds[idx].abbr + ")" : "N/D";
    }

    function calculateMean(arr) { if (!arr.length) return 0; return arr.reduce((a, b) => a + b, 0) / arr.length; }
    function calculateRange(arr) { if (!arr.length) return 0; return Math.max(...arr) - Math.min(...arr); }
    function calculateStdDev(arr) { if (!arr.length) return 0; const m = calculateMean(arr); return Math.sqrt(arr.reduce((a, b) => a + (b - m) ** 2, 0) / arr.length); }

    function pressureTrend(arr) {
      if (!arr || arr.length < 5) return "N/D";
      const meanStart = (arr + arr + arr) / 3, meanEnd = (arr[arr.length - 3] + arr[arr.length - 2] + arr[arr.length - 1]) / 3;
      if (meanEnd > meanStart + 1) return '<span class="summary-trend-up">in aumento ⬆️ (alta)</span>';
      if (meanStart > meanEnd + 1) return '<span class="summary-trend-down">in calo ⬇️ (bassa)</span>';
      return '<span class="summary-trend-stable">stabile ↔️</span>';
    }

    function toggleDetail(id) {
      let el = document.getElementById(id);
      document.querySelectorAll('.detail-section').forEach(e => {
        if (e !== el) e.classList.remove('active');
      });
      el.classList.toggle('active');
    }

    function renderMiniDays() {
      let html = "";
      DATA.days.forEach((d, i) => {
        html += `<div class="mini-day${i === selectedDayIndex ? " active" : ""}" onclick="selectDay(${i})">
            <span>${d.day_label}</span><span class="icon">${d.icon}</span>
          </div>`;
      });
      document.getElementById("miniDaysBox").innerHTML = html;
    }

    function selectDay(dayIndex) {
      selectedDayIndex = dayIndex;
      renderAll();
    }

    function renderWind() {
      const d = DATA.days[selectedDayIndex];
      const windSpeed = d.hourly_winds ? d.hourly_winds[new Date().getHours()] : d.wind_max || "--";
      const windDeg = d.hourly_wind_directions ? d.hourly_wind_directions[new Date().getHours()] : d.wind_dir || "--";
      const windDirTxt = windDirectionName(windDeg);
      const max = d.hourly_winds ? Math.max(...d.hourly_winds) : d.wind_max || "--";
      const min = d.hourly_winds ? Math.min(...d.hourly_winds) : d.wind_min || "--";
      const maxDir = d.hourly_wind_directions ? windDirectionName(Math.max(...d.hourly_wind_directions)) : windDirTxt;
      document.getElementById("windbox").innerHTML = `
        <div class="box-title">🌬️ Vento ${d.day_label}</div>
        <p class="wind-info"><span class="wind-speed">🍃 ${windSpeed} km/h</span><span class="wind-dir">⎋ ${windDeg}° ${windDirTxt}</span></p>
        <div class="folata-max">⚡ Folata max: <b>${d.wind_gust || d.wind_max || "--"} km/h</b></div>
        <button class="detail-btn" onclick="toggleDetail('wind-detail')">📊 Dettagli / Grafico</button>
        <div class="detail-section" id="wind-detail"><div class="chart-wrap"><canvas id="windchart"></canvas></div></div>
        <div class="box-summary">
          <div class="box-summary-row">
            <span class="summary-label summary-max">Massimo: ${max} km/h</span>
            <span class="summary-label summary-min">Minimo: ${min} km/h</span>
          </div>
          <div class="box-summary-row2">
            <span class="summary-label summary-dir">Direzione max: ${maxDir}</span>
          </div>
        </div>
      `;
      if (windChart) windChart.destroy();
      const ctx = document.getElementById('windchart').getContext('2d');
      windChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: d.hourly_labels || [],
          datasets: [{
            label: 'Vento (km/h)',
            data: d.hourly_winds || [],
            borderColor: '#66E5FF',
            backgroundColor: 'rgba(102, 229, 255, 0.15)',
            fill: true,
            tension: 0.3,
            pointRadius: 3,
            pointHoverRadius: 6,
            pointBackgroundColor: '#66E5FF',
            pointBorderColor: '#fff',
            pointBorderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { 
              display: true,
              labels: { color: '#c6f3ff', font: { size: 13, weight: '600' } }
            }
          },
          scales: { 
            y: { 
              beginAtZero: true,
              grid: { color: 'rgba(255, 255, 255, 0.1)' },
              ticks: { color: '#c6f3ff' }
            },
            x: {
              grid: { color: 'rgba(255, 255, 255, 0.05)' },
              ticks: { color: '#c6f3ff' }
            }
          }
        }
      });
    }

    function renderRain() {
      const d = DATA.days[selectedDayIndex];
      const pioggia = d.precipitation || 0;
      const max = d.hourly_precips ? Math.max(...d.hourly_precips) : 0;
      const oraMax = d.hourly_labels && d.hourly_precips ? d.hourly_labels[d.hourly_precips.indexOf(max)] : '--';
      document.getElementById("rainbox").innerHTML = `
        <div class="box-title">🌧️ Pioggia ${d.day_label}</div>
        <div class="main">Totale oggi: <b>${pioggia.toFixed(1)} mm</b> ${rainIcon(pioggia)}</div>
        <div class="desc"><b>Max oraria:</b> ${max} mm &nbsp; <b>Ora più piovosa:</b> ${oraMax}</div>
        <button class="detail-btn" onclick="toggleDetail('rain-detail')">📊 Dettagli / Grafico</button>
        <div class="detail-section" id="rain-detail"><div class="chart-wrap"><canvas id="rainchart"></canvas></div></div>
        <div class="box-summary">
          <div class="box-summary-row">
            <span class="summary-label summary-max">Max oraria: ${max} mm</span>
            <span class="summary-label summary-hour">Ora più piovosa: ${oraMax}</span>
          </div>
        </div>
      `;
      if (rainChart) rainChart.destroy();
      const ctx = document.getElementById('rainchart').getContext('2d');
      rainChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: d.hourly_labels || [],
          datasets: [{
            label: 'Precipitazioni (mm)',
            data: d.hourly_precips || [],
            backgroundColor: 'rgba(82, 197, 247, 0.7)',
            borderColor: '#52c5f7',
            borderWidth: 2,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { 
              display: true,
              labels: { color: '#c6f3ff', font: { size: 13, weight: '600' } }
            }
          },
          scales: { 
            y: { 
              beginAtZero: true,
              grid: { color: 'rgba(255, 255, 255, 0.1)' },
              ticks: { color: '#c6f3ff' }
            },
            x: {
              grid: { color: 'rgba(255, 255, 255, 0.05)' },
              ticks: { color: '#c6f3ff' }
            }
          }
        }
      });
    }

    function renderSea() {
      const merged = DATA.sea[selectedDayIndex] || [];
      const waveMean = calculateMean(merged.map(h => h.wave_height));
      const waveRange = calculateRange(merged.map(h => h.wave_height));
      const waveStdDev = calculateStdDev(merged.map(h => h.wave_height));
      const seaTemp = calculateMean(merged.map(h => h.sea_surface_temperature));
      document.getElementById("seabox").innerHTML = `
        <div class="box-title">🌊 Mare ${DATA.days[selectedDayIndex].day_label}</div>
        <div class="main">Altezza media onda: <b>${waveMean.toFixed(2)} m</b></div>
        <div class="desc">Temperatura mare: <b>${seaTemp.toFixed(1)} °C</b></div>
        <button class="detail-btn" onclick="toggleDetail('sea-detail')">📊 Dettagli / Grafico</button>
        <div class="detail-section" id="sea-detail"><div class="chart-wrap"><canvas id="seachart"></canvas></div></div>
        <div class="box-summary">
          <div class="box-summary-row">
            <span class="summary-label summary-mean">Hsig: ${waveMean.toFixed(2)} m</span>
            <span class="summary-label summary-range">Range: ${waveRange.toFixed(2)} m</span>
            <span class="summary-label summary-std">Dev.Std.: ${waveStdDev.toFixed(2)} m</span>
          </div>
        </div>
      `;
      if (seaChart) seaChart.destroy();
      const ctx = document.getElementById('seachart').getContext('2d');
      seaChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: merged.map(h => h.time),
          datasets: [
            { 
              label: 'Onda (m)', 
              data: merged.map(h => h.wave_height), 
              borderColor: '#41f8bd', 
              backgroundColor: 'rgba(65, 248, 189, 0.15)', 
              fill: true, 
              tension: 0.3, 
              pointRadius: 4, 
              pointHoverRadius: 7,
              pointBackgroundColor: '#41f8bd',
              pointBorderColor: '#fff',
              pointBorderWidth: 2
            },
            { 
              label: 'Swell (m)', 
              data: merged.map(h => h.swell_height), 
              borderColor: '#21D08A', 
              backgroundColor: 'rgba(33, 208, 138, 0.1)', 
              fill: true, 
              tension: 0.25, 
              pointRadius: 4, 
              pointHoverRadius: 7,
              pointBackgroundColor: '#21D08A',
              pointBorderColor: '#fff',
              pointBorderWidth: 2
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { 
              display: true,
              labels: { color: '#c6f3ff', font: { size: 13, weight: '600' } }
            }
          },
          scales: { 
            y: { 
              beginAtZero: true,
              grid: { color: 'rgba(255, 255, 255, 0.1)' },
              ticks: { color: '#c6f3ff' }
            },
            x: {
              grid: { color: 'rgba(255, 255, 255, 0.05)' },
              ticks: { color: '#c6f3ff' }
            }
          }
        }
      });
    }

    function renderPress() {
      const d = DATA.days[selectedDayIndex];
      const arr = d.hourly_pressures || [];
      const pressMean = calculateMean(arr);
      document.getElementById("pressbox").innerHTML = `
        <div class="box-title">🔽 Pressione ${d.day_label}</div>
        <div class="main">Media oggi: <b>${pressMean.toFixed(1)} hPa</b></div>
        <div class="desc">Tendenza: ${pressureTrend(arr)}</div>
        <button class="detail-btn" onclick="toggleDetail('press-detail')">📊 Dettagli / Grafico</button>
        <div class="detail-section" id="press-detail"><div class="chart-wrap"><canvas id="presschart"></canvas></div></div>
        <div class="box-summary">
          <div class="box-summary-row">
            <span class="summary-label summary-max">Max: ${Math.max(...arr)} hPa</span>
            <span class="summary-label summary-min">Min: ${Math.min(...arr)} hPa</span>
          </div>
        </div>
      `;
      if (pressChart) pressChart.destroy();
      const ctx = document.getElementById('presschart').getContext('2d');
      pressChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: d.hourly_labels || [],
          datasets: [{
            label: 'Pressione (hPa)',
            data: arr,
            borderColor: '#ffd472',
            backgroundColor: 'rgba(255, 212, 114, 0.15)',
            fill: true,
            tension: 0.3,
            pointRadius: 3,
            pointHoverRadius: 6,
            pointBackgroundColor: '#ffd472',
            pointBorderColor: '#fff',
            pointBorderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { 
              display: true,
              labels: { color: '#c6f3ff', font: { size: 13, weight: '600' } }
            }
          },
          scales: { 
            y: { 
              beginAtZero: false,
              grid: { color: 'rgba(255, 255, 255, 0.1)' },
              ticks: { color: '#c6f3ff' }
            },
            x: {
              grid: { color: 'rgba(255, 255, 255, 0.05)' },
              ticks: { color: '#c6f3ff' }
            }
          }
        }
      });
    }

    function renderFooter() {
      document.getElementById("footer").innerHTML = `Powered by Open-Meteo • UI by micheledv74 • Ultimo agg.: <span id="updated_stamp">${DATA.days.day_label}</span>`;
    }

    function renderAll() {
      renderWind();
      renderRain();
      renderSea();
      renderPress();
      renderMiniDays();
      renderFooter();
    }

    renderAll();
  </script>
</body>
</html>
