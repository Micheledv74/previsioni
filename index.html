<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>Test Grafico Pioggia Dinamico</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background:#22365c; color:#f0f8ff; font-family:Roboto,Arial,sans-serif;}
    .mini-day { cursor:pointer; padding:8px 12px; background:#355088; border-radius:7px; margin:3px; display:inline-block; }
    .mini-day.active { background:#4fa9df; font-weight:700; color:#fff;}
    .rain-box { max-width:410px; margin:30px auto; padding:22px; background:rgba(37,59,102,0.22); border-radius:16px;}
  </style>
</head>
<body>
  <div id="miniDaysBox"></div>
  <div class="rain-box" id="rainbox"></div>
<script>
const DATA = {
  days:[
    { day_label:"14/10", icon:"‚òÄÔ∏è", precipitation:2.3, hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
      hourly_precips:[0,0,0,0,0,0.4,0.8,0.0,0,0,0,0,0.2,0,0,0,0.7,0,0,0,0,0,0,0]
    },
    { day_label:"15/10", icon:"‚õÖ", precipitation:0.5, hourly_labels:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],
      hourly_precips:[0,0,0,0,0,0,0,0,0.1,0.3,0,0,0,0,0,0,0.1,0,0,0,0,0,0,0]
    }
  ]
};
function rainIcon(valmm){if(valmm<0.1)return'';if(valmm<0.5)return'üíß';if(valmm<1)return'üíßüíß';if(valmm<3)return'üíßüíßüíß';if(valmm<10)return'üíßüíßüíßüíß';return'üíßüíßüíßüíßüíß';}

let selectedDayIndex = 0;
let rainChart;

function renderMiniDays() {
  let html = "";
  DATA.days.forEach((d, i) => {
    html += `<div class="mini-day${i === selectedDayIndex ? " active" : ""}" onclick="selectDay(${i})">
        ${d.day_label} <span>${d.icon}</span>
      </div>`;
  });
  document.getElementById("miniDaysBox").innerHTML = html;
}

function selectDay(dayIndex) {
  selectedDayIndex = dayIndex;
  renderRain();
  renderMiniDays();
}

function renderRain() {
  const d = DATA.days[selectedDayIndex];
  const pioggia = d.precipitation || 0;
  const max = Math.max(...d.hourly_precips);
  const oraMax = d.hourly_labels[d.hourly_precips.indexOf(max)];
  document.getElementById("rainbox").innerHTML = `
    <h3>üåßÔ∏è Pioggia ${d.day_label}</h3>
    <div>Totale oggi: <b>${pioggia.toFixed(1)} mm</b> ${rainIcon(pioggia)}</div>
    <div><b>Max oraria:</b> ${max} mm &nbsp; <b>Ora pi√π piovosa:</b> ${oraMax}</div>
    <button onclick="toggleRainDetail()">Dettagli / Grafico</button>
    <div id="rain-detail" style="display:none;">
      <canvas id="rainchart"></canvas>
    </div>
  `;
}
function toggleRainDetail() {
  const el = document.getElementById('rain-detail');
  el.style.display = el.style.display === "none" ? "block" : "none";
  if (el.style.display === "block") {
    renderRainChart();
  } else {
    if(rainChart) rainChart.destroy();
  }
}
function renderRainChart() {
  const d = DATA.days[selectedDayIndex];
  if (rainChart) rainChart.destroy();
  const ctx = document.getElementById('rainchart').getContext('2d');
  rainChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: d.hourly_labels,
      datasets: [{
        label: 'Precipitazioni (mm)',
        data: d.hourly_precips,
        backgroundColor: '#52c5f7',
        borderColor: '#52afe7',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {legend: {display: false}},
      scales: {y: {beginAtZero: true}, x:{}}
    }
  });
}

renderMiniDays();
renderRain();
</script>
</body>
</html>
