<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>AI Weather Data</title>
</head>
<body>
<script>
window.aiWeatherData = {
  summary: "```json\n{\n  \"summary\": \"Mattinata (dalle {CURRENT_TIME.split(':')[0]}:00 alle 12:00) generalmente serena con temperature intorno ai ({TEMP_MORNING_AVG}°C). Pomeriggio (dalle 12:00 alle 18:00) poco nuvoloso con massime di ({TEMP_MAX}°C). In serata e nottata (dopo le 18:00) condizioni stabili con minime di ({TEMP_MIN}°C). Venti {WIND_BEAUFORT_SCALE} (Forza {WIND_BEAUFORT_FORCE}, {WIND_MAX_SPEED} km/h) da {WIND_DIRECTION}. Mare {SEA_CONDITION} (onde {WAVE_HEIGHT:.1f}m).\",\n  \"advice\": [\n    \"Temperature miti ({TEMP_MAX}°C): abbigliamento leggero sufficiente. Porta una felpa per la sera e una giacca antivento per il vento sostenuto.\",\n    \"Collegamenti marittimi: {MARITIME_ADVICE}\",\n    \"Condizioni favorevoli per attività nautiche e balneazione. Indice UV moderato, usare crema solare nelle ore centrali. Temperatura del mare gradevole ({SEA_TEMP}°C) per la balneazione.\"\n  ],\n  \"alerts\": [\n    {\n      \"type\": \"Situazione Meteo Normale\",\n      \"description\": \"Giornata senza criticità meteo. Condizioni stabili e favorevoli per tutte le attività. Temperature gradevoli ({TEMP_MIN}-{TEMP_MAX}°C) e mare calmo ({WAVE_HEIGHT:.1f}m). In accordo con l'allerta {BULLETIN_SEVERITY} della Protezione Civile Campania ({BULLETIN_VALIDITY}).\",\n      \"severity\": \"{BULLETIN_SEVERITY}\"\n    }\n  ]\n}\n```\n```python\nimport json\nfrom datetime import datetime, timedelta\n\n# These will be dynamically replaced by the environment\nCURRENT_DATE = \"{CURRENT_DATE}\"\nCURRENT_TIME = \"{CURRENT_TIME}\"\n\n# Helper to convert Beaufort scale\ndef get_beaufort_scale_text(speed_kmh):\n    if speed_kmh < 12: return \"Calmo/Bava\"\n    elif speed_kmh < 29: return \"Leggero/Moderato\"\n    elif speed_kmh < 50: return \"Teso/Fresco\"\n    elif speed_kmh < 75: return \"Forte/Burrasca\"\n    elif speed_kmh < 103: return \"Burrasca forte/Tempesta\"\n    else: return \"Uragano\"\n\ndef get_beaufort_force(speed_kmh):\n    if speed_kmh < 2: return 0\n    elif speed_kmh < 6: return 1\n    elif speed_kmh < 12: return 2\n    elif speed_kmh < 20: return 3\n    elif speed_kmh < 29: return 4\n    elif speed_kmh < 39: return 5\n    elif speed_kmh < 50: return 6\n    elif speed_kmh < 62: return 7\n    elif speed_kmh < 75: return 8\n    elif speed_kmh < 89: return 9\n    elif speed_kmh < 103: return 10\n    elif speed_kmh < 118: return 11\n    else: return 12\n\ndef get_rain_intensity_text(mmh):\n    if mmh < 10: return \"leggere\"\n    elif mmh < 30: return \"moderate\"\n    elif mmh < 50: return \"intense\"\n    else: return \"molto intense\"\n\n# Severity mapping and helpers\nSEVERITY_LEVELS = {\"VERDE\": 0, \"GIALLO\": 1, \"ARANCIONE\": 2, \"ROSSO\": 3}\nSEVERITY_NAMES = {0: \"VERDE\", 1: \"GIALLO\", 2: \"ARANCIONE\", 3: \"ROSSO\"}\n\ndef get_numeric_severity(level_name):\n    return SEVERITY_LEVELS.get(level_name, 0) # Default to VERDE if invalid\n\ndef get_string_severity(numeric_level):\n    return SEVERITY_NAMES.get(numeric_level, \"VERDE\")\n\ndef elevate_severity(current_level_numeric, target_level_numeric):\n    return max(current_level_numeric, target_level_numeric)\n\ndef generate_forecast(input_data_json):\n    # --- 1. Parsing Input Data ---\n    if isinstance(input_data_json, str):\n        input_data = json.loads(input_data_json)\n    else:\n        input_data = input_data_json\n\n    aggregated_forecast = next((item for item in input_data if \"location\" in item and item[\"location\"] == \"Procida\"), None)\n    rainviewer_data = next((item for item in input_data if \"source\" in item and item[\"source\"] == \"rainviewer\"), None)\n    bollettino_regionale_data = next((item for item in input_data if \"bollettino_regionale\" in item), None)\n\n    # Handle missing days[0] fallback\n    days_data = None\n    if aggregated_forecast and \"days\" in aggregated_forecast:\n        if aggregated_forecast[\"days\"] and len(aggregated_forecast[\"days\"]) > 0:\n            days_data = aggregated_forecast[\"days\"][0]\n        elif len(aggregated_forecast[\"days\"]) > 1: # Fallback to days[1]\n            days_data = aggregated_forecast[\"days\"][1]\n    \n    # Critical fallback if no daily data at all (should not happen based on prompt but for safety)\n    if not days_data:\n        days_data = {\n            \"temp\": {\"max\": 20, \"min\": 15},\n            \"rain\": {\"total_mm\": 0, \"probability\": 0, \"periods\": []},\n            \"wind\": {\"periods\": [{\"time_start\": \"00:00\", \"speed_kmh\": 10, \"direction_text\": \"variabile\"}]},\n            \"sea\": {\"wave_height_m\": 0.5, \"condition\": \"calmo\", \"temperature_c\": 22},\n            \"uv_index\": 3\n        }\n\n    # --- 2. Identify Current Hour & Relevant Data ---\n    current_dt = datetime.strptime(f\"{CURRENT_DATE} {CURRENT_TIME}\", \"%Y-%m-%d %H:%M\")\n    current_hour = current_dt.hour\n\n    current_wind_speed = 0\n    if days_data and \"wind\" in days_data and \"periods\" in days_data[\"wind\"]:\n        # Find the most relevant wind period (closest to current_hour)\n        wind_periods = days_data[\"wind\"][\"periods\"]\n        if wind_periods:\n            closest_wind_period = min(wind_periods, key=lambda p: abs(int(p[\"time_start\"].split(\":\")[0]) - current_hour))\n            current_wind_speed = closest_wind_period[\"speed_kmh\"]\n        \n    max_wind_speed_day = max([p[\"speed_kmh\"] for p in days_data[\"wind\"][\"periods\"]], default=0) if days_data and \"wind\" in days_data else 0\n    wind_direction_text = days_data[\"wind\"][\"periods\"][0].get(\"direction_text\", \"variabile\") if days_data and \"wind\" in days_data and days_data[\"wind\"][\"periods\"] else \"variabile\"\n\n    max_rain_intensity_mmh = 0\n    if days_data and \"rain\" in days_data and \"periods\" in days_data[\"rain\"]:\n        max_rain_intensity_mmh = max([p.get(\"intensity_mmh\", 0) for p in days_data[\"rain\"][\"periods\"]], default=0)\n    \n    total_rain_mm = days_data[\"rain\"].get(\"total_mm\", 0)\n\n    # --- 3. Calculate Overall Severity and Phenomenon-specific Severities ---\n    bollettino_livello = None\n    bollettino_validita = \"non disponibile\"\n    \n    if bollettino_regionale_data and \"livello_allerta\" in bollettino_regionale_data:\n        bollettino_livello = bollettino_regionale_data[\"livello_allerta\"]\n        bollettino_validita = bollettino_regionale_data[\"validita\"]\n\n    current_overall_severity_numeric = get_numeric_severity(bollettino_livello) if bollettino_livello else 0\n\n    base_phenomenon_severity_numeric = get_numeric_severity(bollettino_livello) if bollettino_livello else 0\n    potential_severity_rain = base_phenomenon_severity_numeric\n    potential_severity_wind = base_phenomenon_severity_numeric\n    potential_severity_sea = base_phenomenon_severity_numeric\n\n    # RainViewer Priority (STEP 3)\n    rain_in_minutes = -1\n    has_rain_incoming = False\n    if rainviewer_data and rainviewer_data.get(\"nowcast_summary\", {}).get(\"has_rain_incoming\", False):\n        has_rain_incoming = True\n        rain_in_minutes = rainviewer_data[\"nowcast_summary\"][\"rain_in_minutes\"]\n        if rain_in_minutes < 20:\n            potential_severity_rain = elevate_severity(potential_severity_rain, get_numeric_severity(\"GIALLO\"))\n            current_overall_severity_numeric = elevate_severity(current_overall_severity_numeric, get_numeric_severity(\"GIALLO\"))\n\n    # Rain analysis\n    rain_probability = days_data[\"rain\"].get(\"probability\", 0)\n    \n    if max_rain_intensity_mmh > 50 or total_rain_mm > 70: \n        potential_severity_rain = elevate_severity(potential_severity_rain, get_numeric_severity(\"ROSSO\"))\n    elif max_rain_intensity_mmh > 30 or total_rain_mm > 40:\n        potential_severity_rain = elevate_severity(potential_severity_rain, get_numeric_severity(\"ARANCIONE\"))\n    elif max_rain_intensity_mmh > 10 or (total_rain_mm > 10 and rain_probability > 50):\n        potential_severity_rain = elevate_severity(potential_severity_rain, get_numeric_severity(\"GIALLO\"))\n    \n    current_overall_severity_numeric = elevate_severity(current_overall_severity_numeric, potential_severity_rain)\n\n    # Wind analysis\n    if max_wind_speed_day > 70:\n        potential_severity_wind = elevate_severity(potential_severity_wind, get_numeric_severity(\"ROSSO\"))\n    elif max_wind_speed_day > 50:\n        potential_severity_wind = elevate_severity(potential_severity_wind, get_numeric_severity(\"ARANCIONE\"))\n    elif max_wind_speed_day > 40:\n        potential_severity_wind = elevate_severity(potential_severity_wind, get_numeric_severity(\"GIALLO\"))\n    \n    current_overall_severity_numeric = elevate_severity(current_overall_severity_numeric, potential_severity_wind)\n\n    # Sea analysis\n    wave_height = days_data[\"sea\"].get(\"wave_height_m\", 0.5)\n    sea_condition = days_data[\"sea\"].get(\"condition\", \"calmo\")\n    sea_temperature_c = days_data[\"sea\"].get(\"temperature_c\", 22)\n\n    if wave_height > 3.5:\n        potential_severity_sea = elevate_severity(potential_severity_sea, get_numeric_severity(\"ROSSO\"))\n    elif wave_height > 2.5:\n        potential_severity_sea = elevate_severity(potential_severity_sea, get_numeric_severity(\"ARANCIONE\"))\n    elif wave_height > 1.5:\n        potential_severity_sea = elevate_severity(potential_severity_sea, get_numeric_severity(\"GIALLO\"))\n\n    current_overall_severity_numeric = elevate_severity(current_overall_severity_numeric, potential_severity_sea)\n\n    # Maritime Connections specific elevation (STEP 4)\n    if wave_height > 2.5 or current_wind_speed > 45: \n        current_overall_severity_numeric = elevate_severity(current_overall_severity_numeric, get_numeric_severity(\"GIALLO\"))\n\n    # Step 2: Converging sources\n    rain_significant = (total_rain_mm > 10 and rain_probability > 50) or (max_rain_intensity_mmh > 10)\n    wind_strong_consecutive = False\n    if days_data and \"wind\" in days_data and \"periods\" in days_data[\"wind\"]:\n        consecutive_strong_wind_count = 0\n        for p in days_data[\"wind\"][\"periods\"]:\n            if p[\"speed_kmh\"] > 40:\n                consecutive_strong_wind_count += 1\n                if consecutive_strong_wind_count >= 3:\n                    wind_strong_consecutive = True\n                    break\n            else:\n                consecutive_strong_wind_count = 0\n    sea_rough = (wave_height > 2.0)\n    \n    convergence_count = sum([rain_significant, wind_strong_consecutive, sea_rough])\n    if convergence_count >= 2:\n        current_overall_severity_numeric = elevate_severity(current_overall_severity_numeric, get_numeric_severity(\"GIALLO\"))\n\n\n    # Final Hierarchical Constraints (STEP 5)\n    if bollettino_livello:\n        bollettino_numeric = get_numeric_severity(bollettino_livello)\n        if bollettino_numeric == 0: # VERDE\n            current_overall_severity_numeric = min(current_overall_severity_numeric, get_numeric_severity(\"ARANCIONE\"))\n        elif bollettino_numeric == 1: # GIALLO\n            current_overall_severity_numeric = min(current_overall_severity_numeric, get_numeric_severity(\"ROSSO\"))\n        \n        # Exception for extreme phenomena:\n        if max_wind_speed_day > 70 or max_rain_intensity_mmh > 50 or wave_height > 3.5:\n             current_overall_severity_numeric = elevate_severity(current_overall_severity_numeric, get_numeric_severity(\"ROSSO\"))\n        \n        current_overall_severity_numeric = max(current_overall_severity_numeric, bollettino_numeric)\n    \n    final_overall_severity_string = get_string_severity(current_overall_severity_numeric)\n\n    # --- 4. Generate Summary ---\n    summary_parts_time_based = []\n    \n    temp_min = days_data[\"temp\"][\"min\"]\n    temp_max = days_data[\"temp\"][\"max\"]\n\n    morning_end_hour = 12\n    afternoon_start_hour = 12\n    afternoon_end_hour = 18\n    evening_start_hour = 18\n\n    morning_weather_desc = \"generalmente serena\"\n    afternoon_weather_desc = \"poco nuvolosa\"\n    evening_weather_desc = \"stabile\"\n\n    if total_rain_mm > 0 and rain_probability > 20:\n        morning_weather_desc = \"nuvolosa con possibilità di piogge\"\n        afternoon_weather_desc = \"instabile con rovesci\"\n        evening_weather_desc = \"nuvolosa\"\n    \n    morning_temp_avg = (temp_max + temp_min) / 2 # Simple average, refine if needed\n    \n    morning_phrase = f\"Mattinata (dalle {current_hour}:00 alle {morning_end_hour}:00) {morning_weather_desc} con temperature intorno ai ({morning_temp_avg:.0f}°C).\"\n    if has_rain_incoming and rain_in_minutes < (morning_end_hour - current_hour) * 60 and rain_in_minutes > 0:\n        morning_phrase += f\" Attenzione: pioggia in arrivo tra {rain_in_minutes} minuti.\"\n    summary_parts_time_based.append(morning_phrase)\n\n    afternoon_phrase = f\"Pomeriggio (dalle {afternoon_start_hour}:00 alle {afternoon_end_hour}:00) {afternoon_weather_desc} con massime di ({temp_max}°C).\"\n    summary_parts_time_based.append(afternoon_phrase)\n\n    evening_phrase = f\"In serata e nottata (dopo le {evening_start_hour}:00) {evening_weather_desc} con minime di ({temp_min}°C).\"\n    summary_parts_time_based.append(evening_phrase)\n\n    general_conditions_parts = []\n    if max_wind_speed_day > 0:\n        general_conditions_parts.append(f\"Venti {get_beaufort_scale_text(max_wind_speed_day)} (Forza {get_beaufort_force(max_wind_speed_day)}, {max_wind_speed_day} km/h) da {wind_direction_text}.\")\n    \n    general_conditions_parts.append(f\"Mare {sea_condition} (onde {wave_height:.1f}m).\")\n\n    final_summary = \" \".join(summary_parts_time_based + general_conditions_parts).strip()\n    \n    if len(final_summary) < 180 and final_summary:\n        final_summary += f\" Le temperature complessive oscilleranno tra ({temp_min}-{temp_max}°C).\"\n    if len(final_summary) > 250:\n        final_summary = final_summary[:247].strip() + \"...\"\n    if not final_summary:\n        final_summary = f\"Previsioni meteo per Procida: temperature tra ({temp_min}-{temp_max}°C), vento medio di ({current_wind_speed} km/h), mare ({wave_height:.1f}m).\"\n\n    # --- 5. Generate Advice ---\n    advice_list = []\n\n    clothing_advice = \"\"\n    if temp_max > 25:\n        clothing_advice += \"Temperature estive: abbigliamento leggero. \"\n    elif temp_max > 18:\n        clothing_advice += f\"Temperature miti ({temp_max}°C): abbigliamento leggero sufficiente. \"\n    else:\n        clothing_advice += f\"Temperature fresche ({temp_max}°C): si consiglia uno strato in più. \"\n    \n    if total_rain_mm > 5 or (has_rain_incoming and rain_in_minutes < 60):\n        clothing_advice += \"Porta un ombrello o impermeabile per eventuali piogge. \"\n    if max_wind_speed_day > 30:\n        clothing_advice += \"Vento sostenuto, proteggiti con una giacca antivento.\"\n    advice_list.append(clothing_advice.strip())\n\n    maritime_connections_advice = \"\"\n    if wave_height > 2.0 or current_wind_speed > 40:\n        factors = []\n        if wave_height > 2.0: factors.append(f\"mare mosso ({wave_height:.1f}m)\")\n        if current_wind_speed > 40: factors.append(f\"vento forte ({get_beaufort_scale_text(current_wind_speed)} Forza {get_beaufort_force(current_wind_speed)}, {current_wind_speed} km/h)\")\n        \n        maritime_connections_advice = f\"Collegamenti marittimi: possibili ritardi/disagi per traghetti e aliscafi a causa di {', '.join(factors)}. Verificare orari aggiornati con compagnie (Caremar, Medmar, SNAV).\"\n    else:\n        maritime_connections_advice = \"Collegamenti marittimi: condizioni favorevoli per traghetti e aliscafi. Servizio regolare previsto.\"\n    advice_list.append(maritime_connections_advice)\n\n    nautical_advice = \"\"\n    if wave_height > 1.0 or max_wind_speed_day > 30:\n        nautical_advice += \"Per le attività nautiche (vela, pesca), si raccomanda cautela e di consultare i bollettini locali. \"\n    else:\n        nautical_advice += \"Condizioni favorevoli per attività nautiche e balneazione. \"\n    \n    uv_index = days_data.get(\"uv_index\", 0)\n    if uv_index > 6:\n        nautical_advice += \"Indice UV elevato, proteggersi dal sole. \"\n    elif uv_index > 3:\n        nautical_advice += \"Indice UV moderato, usare crema solare nelle ore centrali. \"\n    \n    if sea_temperature_c > 20:\n        nautical_advice += f\"Temperatura del mare gradevole ({sea_temperature_c:.0f}°C) per la balneazione.\"\n    \n    advice_list.append(nautical_advice.strip())\n\n    # --- 6. Generate Alerts ---\n    alerts_list = []\n    \n    if bollettino_livello == \"VERDE\":\n        alerts_list.append({\n            \"type\": \"Situazione Meteo Normale\",\n            \"description\": f\"Giornata senza criticità meteo. Condizioni stabili e favorevoli per tutte le attività. Temperature gradevoli ({temp_min}-{temp_max}°C) e mare calmo ({wave_height:.1f}m). In accordo con l'allerta VERDE della Protezione Civile Campania ({bollettino_validita}).\",\n            \"severity\": \"VERDE\"\n        })\n    else:\n        # Rain Alert\n        if potential_severity_rain > get_numeric_severity(\"VERDE\") or (has_rain_incoming and rain_in_minutes < 60):\n            rain_alert_desc = \"\"\n            if has_rain_incoming and rain_in_minutes < 30:\n                rain_alert_desc = f\"Piogge intense in arrivo tra {rain_in_minutes} minuti (Rainviewer). \"\n                if total_rain_mm > 0:\n                    rain_alert_desc += f\"Accumuli previsti di {total_rain_mm}mm nelle prossime ore. \"\n                rain_alert_desc += \"Possibili allagamenti localizzati e disagi alla viabilità. \"\n            elif total_rain_mm > 0 and rain_probability > 30:\n                rain_alert_desc = f\"Piogge {get_rain_intensity_text(max_rain_intensity_mmh)} ({max_rain_intensity_mmh}mm/h) con accumuli previsti fino a {total_rain_mm}mm. \"\n                rain_alert_desc += \"Possibili disagi locali, prestare attenzione. \"\n            \n            if rain_alert_desc:\n                alerts_list.append({\n                    \"type\": \"Piogge Intense\" if potential_severity_rain >= get_numeric_severity(\"ARANCIONE\") else \"Piogge\",\n                    \"description\": rain_alert_desc + (f\"In accordo con l'allerta {get_string_severity(potential_severity_rain)} della Protezione Civile Campania ({bollettino_validita}).\" if bollettino_livello else \"\"),\n                    \"severity\": get_string_severity(potential_severity_rain)\n                })\n\n        # Wind Alert\n        if potential_severity_wind > get_numeric_severity(\"VERDE\"):\n            wind_alert_desc = f\"Raffiche di vento fino a {max_wind_speed_day} km/h ({get_beaufort_scale_text(max_wind_speed_day)} Forza {get_beaufort_force(max_wind_speed_day)}) previste. \"\n            if max_wind_speed_day > 70:\n                wind_alert_desc += \"Pericolo concreto per strutture esposte e navigazione, evitare zone costiere. \"\n            elif max_wind_speed_day > 50:\n                wind_alert_desc += \"Possibili disagi ai collegamenti marittimi e caduta rami, prestare attenzione. \"\n            else:\n                wind_alert_desc += \"Possibili difficoltà per la navigazione di piccole imbarcazioni. \"\n\n            alerts_list.append({\n                \"type\": \"Vento Forte\",\n                \"description\": wind_alert_desc + (f\"In accordo con l'allerta {get_string_severity(potential_severity_wind)} della Protezione Civile Campania ({bollettino_validita}).\" if bollettino_livello else \"\"),\n                \"severity\": get_string_severity(potential_severity_wind)\n            })\n\n        # Sea Alert\n        if potential_severity_sea > get_numeric_severity(\"VERDE\"):\n            sea_alert_desc = f\"Mare {sea_condition} con onde significative fino a {wave_height:.1f}m. \"\n            if wave_height > 3.5:\n                sea_alert_desc += \"Condizioni estreme, pericolo per tutte le attività marittime e balneari. \"\n            elif wave_height > 2.5:\n                sea_alert_desc += \"Fortemente sconsigliata la navigazione per piccole e medie imbarcazioni. \"\n            else:\n                sea_alert_desc += \"Si raccomanda la massima cautela per la navigazione e le attività balneari. \"\n\n            alerts_list.append({\n                \"type\": \"Mare Molto Mosso\",\n                \"description\": sea_alert_desc + (f\"In accordo con l'allerta {get_string_severity(potential_severity_sea)} della Protezione Civile Campania ({bollettino_validita}).\" if bollettino_livello else \"\"),\n                \"severity\": get_string_severity(potential_severity_sea)\n            })\n        \n        # If bollettino_livello is ROSSO, ensure at least one alert is ROSSO\n        if bollettino_livello == \"ROSSO\" and not any(a[\"severity\"] == \"ROSSO\" for a in alerts_list):\n            if alerts_list:\n                alerts_list.sort(key=lambda x: get_numeric_severity(x[\"severity\"]), reverse=True)\n                highest_alert = alerts_list[0]\n                highest_alert[\"severity\"] = \"ROSSO\"\n                highest_alert[\"description\"] = \"ALLERTA ROSSA UFFICIALE: \" + highest_alert[\"description\"].replace(\n                    f\"In accordo con l'allerta {get_string_severity(get_numeric_severity(highest_alert['severity']))}\",\n                    f\"In accordo con l'allerta ROSSA\"\n                ) + \" Pericolo per persone e infrastrutture. Massima attenzione.\"\n            else:\n                alerts_list.append({\n                    \"type\": \"Allerta Meteo Rossa\",\n                    \"description\": f\"Situazione di elevata criticità, in accordo con l'allerta ROSSA della Protezione Civile Campania ({bollettino_validita}). Pericolo per persone e infrastrutture, seguire scrupolosamente le indicazioni delle autorità.\",\n                    \"severity\": \"ROSSO\"\n                })\n\n        # Ensure all generated alerts have their severity capped by final_overall_severity_string\n        for alert in alerts_list:\n            alert_numeric_severity = get_numeric_severity(alert[\"severity\"])\n            if alert_numeric_severity > current_overall_severity_numeric:\n                original_severity_str = alert[\"severity\"]\n                alert[\"severity\"] = get_string_severity(current_overall_severity_numeric)\n                if bollettino_livello:\n                    alert[\"description\"] = alert[\"description\"].replace(\n                        f\"In accordo con l'allerta {original_severity_str}\",\n                        f\"In accordo con l'allerta {get_string_severity(current_overall_severity_numeric)}\"\n                    )\n            # Add bulletin reference if missing\n            if bollettino_livello and bollettino_validita not in alert[\"description\"]:\n                 alert[\"description\"] += f\" In accordo con l'allerta {alert['severity']} della Protezione Civile Campania ({bollettino_validita}).\"\n\n    # --- Construct Final Output JSON ---\n    output_json = {\n        \"summary\": final_summary,\n        \"advice\": advice_list,\n        \"alerts\": alerts_list\n    }\n\n    return json.dumps(output_json, ensure_ascii=False, indent=2)\n\n```",
  advice: [],
  alerts: [],
  timestamp: "2025-11-23T09:04:37.148Z"
};
</script>
</body>
</html>
