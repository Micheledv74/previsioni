<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>AI Weather Data</title>
</head>
<body>
<script>
window.aiWeatherData = {
  summary: "```json\n{\n  \"summary\": \"Mattinata (da {CURRENT_TIME}) serena con temperature gradevoli (circa {temp_feels_like_day}°C) e venti da {current_wind_direction.lower()} ({beaufort_desc_current_wind}, {current_wind_speed_kmh} km/h). Il pomeriggio proseguirà con cieli sereni e venti in lieve calo ({beaufort_desc_max_afternoon_wind}, max {max_afternoon_wind_speed} km/h). La serata sarà fresca (minima {temp_min}°C) con venti deboli ({beaufort_desc_min_evening_wind}, {min_evening_wind_speed} km/h). {rain_info} Mare {sea_condition.lower()} (onde {wave_height_m}m). Temperature giornaliere comprese tra ({temp_min} e {temp_max}°C).\",\n  \"advice\": [\n    \"Temperature miti ({temp_feels_like_day}°C): abbigliamento leggero sufficiente. Porta una felpa per la sera, quando le temperature scenderanno fino a ({temp_min}°C).\",\n    \"Collegamenti marittimi: {maritime_status_message}\",\n    \"{uv_advice} {sea_temp_advice}\"\n  ],\n  \"alerts\": [\n    {\n      \"type\": \"Categoria fenomeno in italiano\",\n      \"description\": \"Descrizione dettagliata dell'allerta con dati numerici, orari relativi e validità del bollettino se presente.\",\n      \"severity\": \"VERDE | GIALLO | ARANCIONE | ROSSO\"\n    }\n  ]\n}\n```\n\n```python\nimport json\nfrom datetime import datetime, timedelta\n\n# These placeholders will be dynamically replaced by the actual current date and time\n# when the function is invoked in the operational environment.\n# For local testing, you can assign example values like \"15/05/2024\" and \"10:30\".\n# CURRENT_DATE = \"15/05/2024\"\n# CURRENT_TIME = \"10:30\"\n\ndef get_beaufort_desc(speed_kmh):\n    \"\"\"Returns a simplified Beaufort scale description for a given wind speed in km/h.\"\"\"\n    if speed_kmh < 12: return \"Calmo/Bava\" # Forza 0-2\n    elif speed_kmh < 29: return \"Leggero/Moderato\" # Forza 3-4\n    elif speed_kmh < 50: return \"Teso/Fresco\" # Forza 5-6\n    elif speed_kmh < 75: return \"Forte/Burrasca\" # Forza 7-8\n    elif speed_kmh < 103: return \"Burrasca forte/Tempesta\" # Forza 9-10\n    else: return \"Uragano\" # Forza 11-12\n\ndef severity_to_int(severity_str):\n    \"\"\"Converts string severity level to integer for comparison.\"\"\"\n    if severity_str == \"VERDE\": return 0\n    if severity_str == \"GIALLO\": return 1\n    if severity_str == \"ARANCIONE\": return 2\n    if severity_str == \"ROSSO\": return 3\n    return 0 # Default to VERDE\n\ndef int_to_severity(severity_int):\n    \"\"\"Converts integer severity level back to string.\"\"\"\n    if severity_int == 0: return \"VERDE\"\n    if severity_int == 1: return \"GIALLO\"\n    if severity_int == 2: return \"ARANCIONE\"\n    if severity_int == 3: return \"ROSSO\"\n    return \"VERDE\"\n\ndef get_relative_time_description(event_hour, current_dt):\n    \"\"\"Generates a relative time description for an event hour.\"\"\"\n    if event_hour is None:\n        return \"\"\n\n    event_dt = current_dt.replace(hour=event_hour, minute=0, second=0, microsecond=0)\n    \n    if event_dt < current_dt - timedelta(minutes=30):\n        # Event happened more than 30 mins ago\n        if event_dt.hour >= 0 and event_dt.hour < 6: return \"nella notte\"\n        if event_dt.hour >= 6 and event_dt.hour < 12: return \"nella mattinata odierna\"\n        if event_dt.hour >= 12 and event_dt.hour < 18: return \"nel primo pomeriggio\"\n        if event_dt.hour >= 18: return \"in serata precedente\"\n        return f\"nelle ore precedenti (circa alle {event_hour}:00)\"\n    elif event_dt >= current_dt - timedelta(minutes=30) and event_dt <= current_dt + timedelta(minutes=30):\n        return \"nell'ora corrente\"\n    elif event_dt.hour == current_dt.hour + 1:\n        return \"nella prossima ora\"\n    elif event_dt.hour < 12: # Morning\n        return f\"nella tarda mattinata (dalle {event_hour}:00)\"\n    elif event_dt.hour >= 12 and event_dt.hour < 18: # Afternoon\n        return f\"nel pomeriggio (dalle {event_hour}:00)\"\n    elif event_dt.hour >= 18 and event_dt.hour < 21: # Early evening\n        return f\"in serata (dalle {event_hour}:00)\"\n    elif event_dt.hour >= 21: # Late evening/night\n        return f\"nella tarda serata/notte (dalle {event_hour}:00)\"\n    return f\"dalle {event_hour}:00\"\n\n\ndef generate_forecast(input_data, current_date_str, current_time_str):\n    # --- 0. Parse Current Time ---\n    current_dt = datetime.strptime(f\"{current_date_str} {current_time_str}\", \"%d/%m/%Y %H:%M\")\n    current_hour = current_dt.hour\n    current_minute = current_dt.minute\n\n    # --- 1. Initialize data and handle missing sources ---\n    forecast_data = None\n    rainviewer_data = None\n    bollettino_regionale = None\n\n    for item in input_data:\n        if \"location\" in item and item[\"location\"] == \"Procida\":\n            forecast_data = item\n        elif \"source\" in item and item[\"source\"] == \"rainviewer\":\n            rainviewer_data = item\n        elif \"bollettino_regionale\" in item:\n            bollettino_regionale = item[\"bollettino_regionale\"]\n\n    # Handle missing forecast data (days[0])\n    day0 = None\n    if forecast_data and \"days\" in forecast_data and len(forecast_data[\"days\"]) > 0:\n        day0 = forecast_data[\"days\"][0]\n    \n    # Fallback to days[1] if days[0] is missing\n    if day0 is None and forecast_data and \"days\" in forecast_data and len(forecast_data[\"days\"]) > 1:\n        day0 = forecast_data[\"days\"][1]\n        # For this exercise, assume day0 is always available or fallback is handled silently.\n    \n    if day0 is None:\n        return json.dumps({\"error\": \"Dati previsionali giornalieri non disponibili per Procida.\"})\n\n    # --- 2. Extract Today's Data with fallbacks ---\n    temp_max = day0.get('temp', {}).get('max', 25)\n    temp_min = day0.get('temp', {}).get('min', 15)\n    feels_like_day = day0.get('temp', {}).get('feels_like_day', int((temp_max + temp_min) / 2)) \n    \n    rain_total_mm = day0.get('rain', {}).get('total_mm', 0)\n    rain_probability = day0.get('rain', {}).get('probability', 0)\n    rain_periods = day0.get('rain', {}).get('periods', [])\n    \n    wind_periods = day0.get('wind', {}).get('periods', [])\n    max_wind_speed_today = day0.get('wind', {}).get('max_speed_kmh', 0)\n    \n    current_wind_speed_kmh = 10\n    current_wind_direction = \"variabile\"\n    current_wind = next((p for p in wind_periods if p['hour'] == current_hour), None)\n    if current_wind:\n        current_wind_speed_kmh = current_wind['speed_kmh']\n        current_wind_direction = current_wind['direction']\n\n    wave_height_m = day0.get('sea', {}).get('wave_height_m', 0.5)\n    sea_condition = day0.get('sea', {}).get('condition', 'Calmo')\n    sea_temperature_c = day0.get('sea', {}).get('temperature_c', 18)\n    uv_index = day0.get('uv_index', 3)\n\n    # --- 3. Determine Base Severity (Step 1) ---\n    base_severity_int = 0 # VERDE\n    bollettino_present = False\n    bollettino_validita = \"\"\n    if bollettino_regionale and \"livello_allerta\" in bollettino_regionale:\n        bollettino_present = True\n        base_severity_int = severity_to_int(bollettino_regionale[\"livello_allerta\"])\n        bollettino_validita = bollettino_regionale[\"validita\"]\n    \n    max_calculated_severity_int = base_severity_int\n\n    # --- 4. Analyze individual phenomena for potential severity increases (Step 2, 4) ---\n    \n    # Rain forecast severity\n    rain_forecast_severity = 0\n    if rain_total_mm > 50: rain_forecast_severity = 3 # ROSSO\n    elif rain_total_mm > 30 and rain_probability > 50: rain_forecast_severity = 2 # ARANCIONE\n    elif rain_total_mm > 10 and rain_probability > 50: rain_forecast_severity = 1 # GIALLO\n\n    # Wind forecast severity\n    wind_forecast_severity = 0\n    if max_wind_speed_today > 70: wind_forecast_severity = 3 # ROSSO\n    elif max_wind_speed_today > 50: wind_forecast_severity = 2 # ARANCIONE\n    elif max_wind_speed_today > 40: wind_forecast_severity = 1 # GIALLO\n\n    # Sea forecast severity\n    sea_forecast_severity = 0\n    if wave_height_m > 3.5: sea_forecast_severity = 3 # ROSSO\n    elif wave_height_m > 2.5: sea_forecast_severity = 2 # ARANCIONE\n    elif wave_height_m > 1.5: sea_forecast_severity = 1 # GIALLO\n\n    # If bollettino is absent, the base severity is the highest of these phenomena\n    if not bollettino_present:\n        base_severity_int = max(rain_forecast_severity, wind_forecast_severity, sea_forecast_severity)\n        max_calculated_severity_int = base_severity_int\n    else:\n        # If bollettino is present, combine and take max, ensuring it's at least base_severity_int\n        max_calculated_severity_int = max(base_severity_int, rain_forecast_severity, wind_forecast_severity, sea_forecast_severity)\n\n    # Step 3 - Rainviewer priority (for GIALLO minimum)\n    rain_incoming_summary = None\n    rain_in_minutes = None\n    if rainviewer_data and rainviewer_data['nowcast_summary']['has_rain_incoming']:\n        rain_in_minutes = rainviewer_data['nowcast_summary']['rain_in_minutes']\n        if rain_in_minutes is not None and rain_in_minutes < 30:\n            rain_incoming_summary = f\"pioggia in arrivo tra {rain_in_minutes} minuti\"\n            if rain_in_minutes < 20: # Severity increase for GIALLO\n                max_calculated_severity_int = max(max_calculated_severity_int, severity_to_int(\"GIALLO\"))\n\n    # Step 4 - Collegamenti Marittimi (for GIALLO minimum)\n    maritime_connection_impact = False\n    if wave_height_m > 2.5 or current_wind_speed_kmh > 45:\n        maritime_connection_impact = True\n        max_calculated_severity_int = max(max_calculated_severity_int, severity_to_int(\"GIALLO\"))\n    \n    # --- 5. Apply Final Hierarchical Constraints (Step 5) ---\n    # Ensure severity does not go more than 2 levels above bollettino, unless extreme override\n    if bollettino_present:\n        is_extreme_override = False\n        if max_wind_speed_today > 70 or (rain_total_mm > 50 and rain_probability > 70) or wave_height_m > 3.5:\n            is_extreme_override = True\n        \n        if not is_extreme_override and max_calculated_severity_int > base_severity_int + 2:\n            max_calculated_severity_int = base_severity_int + 2\n        \n        # Always ensure it's at least the bollettino level\n        max_calculated_severity_int = max(max_calculated_severity_int, base_severity_int)\n\n\n    # --- 6. Generate Alerts ---\n    final_alerts = []\n    \n    if bollettino_present and bollettino_regionale[\"livello_allerta\"] == \"VERDE\":\n        # Rule for VERDE: exactly one informative alert\n        final_alerts.append({\n            \"type\": \"Situazione Meteo Normale\",\n            \"description\": f\"Giornata senza criticità meteo. Condizioni stabili e favorevoli per tutte le attività. Temperature gradevoli ({temp_min}-{temp_max}°C) e mare calmo ({wave_height_m}m). In accordo con l'allerta VERDE della Protezione Civile Campania ({bollettino_validita}).\",\n            \"severity\": \"VERDE\"\n        })\n    else:\n        # For GIALLO, ARANCIONE, ROSSO or absent bollettino: generate alerts for specific phenomena\n        \n        candidate_alerts = []\n\n        # Rainviewer specific alert\n        if rain_incoming_summary and rain_in_minutes is not None and rain_in_minutes < 30:\n            alert_severity_rv = max(severity_to_int(\"GIALLO\"), base_severity_int) # Min GIALLO if triggered\n            rv_desc = f\"Piogge intense in arrivo tra {rain_in_minutes} minuti (Rainviewer).\"\n            total_rain_next_hours = 0\n            for i in range(current_hour, min(current_hour + 3, 24)): # Sum rain for next 3 hours\n                rp = next((p for p in rain_periods if rp and p['hour'] == i), None)\n                if rp: total_rain_next_hours += rp['mm']\n            \n            if total_rain_next_hours > 0:\n                rv_desc += f\" Accumuli previsti di {total_rain_next_hours}mm nelle prossime ore.\"\n            \n            rv_desc += \" Possibili allagamenti localizzati e disagi alla circolazione.\" \n            if bollettino_present:\n                rv_desc += f\" Si raccomanda prudenza e attenzione, in accordo con l'allerta {int_to_severity(alert_severity_rv)} della Protezione Civile Campania ({bollettino_validita}).\"\n            else:\n                rv_desc += \" Si raccomanda prudenza e attenzione.\"\n            \n            candidate_alerts.append({\n                \"type\": \"Piogge Imminenti\",\n                \"description\": rv_desc,\n                \"severity\": int_to_severity(alert_severity_rv)\n            })\n\n        # General Rain alert \n        if rain_forecast_severity > 0:\n            alert_severity_rain = max(rain_forecast_severity, base_severity_int)\n            \n            # Add general rain alert only if no higher or equal severity \"Piogge\" alert already exists\n            existing_rain_alert_sufficient = False\n            for a in candidate_alerts:\n                if a['type'].startswith(\"Piogge\") and severity_to_int(a['severity']) >= alert_severity_rain:\n                    existing_rain_alert_sufficient = True\n                    break\n            \n            if not existing_rain_alert_sufficient:\n                description = f\"Previsione di piogge intense con accumuli fino a ({rain_total_mm}mm) e probabilità del ({rain_probability}%).\"\n                if alert_severity_rain >= severity_to_int(\"ARANCIONE\"):\n                    description += \" Possibili allagamenti localizzati, disagi alla circolazione e difficoltà nei deflussi.\"\n                \n                first_rain_hour = None\n                last_rain_hour = None\n                for p in rain_periods:\n                    if p['mm'] > 0:\n                        if first_rain_hour is None: first_rain_hour = p['hour']\n                        last_rain_hour = p['hour']\n                \n                if first_rain_hour is not None:\n                    if first_rain_hour == last_rain_hour:\n                        description += f\" Prevalentemente {get_relative_time_description(first_rain_hour, current_dt)}.\"\n                    else:\n                        description += f\" Distribuite tra le {first_rain_hour}:00 e le {last_rain_hour}:00.\"\n                \n                if bollettino_present:\n                    description += f\" In accordo con l'allerta {int_to_severity(alert_severity_rain)} della Protezione Civile Campania ({bollettino_validita}).\"\n                candidate_alerts.append({\"type\": \"Piogge Intense\", \"description\": description, \"severity\": int_to_severity(alert_severity_rain)})\n\n        # Wind alert\n        if wind_forecast_severity > 0:\n            alert_severity_wind = max(wind_forecast_severity, base_severity_int)\n            description = f\"Venti forti previsti con raffiche fino a ({max_wind_speed_today} km/h) da {current_wind_direction.upper()}.\"\n            if alert_severity_wind >= severity_to_int(\"ARANCIONE\"):\n                description += \" Possibili danni a strutture esposte e vegetazione, interruzioni di servizi e difficoltà per le attività all'aperto.\"\n            \n            peak_wind_hour = None\n            peak_wind_val = 0\n            for p in wind_periods:\n                if p['speed_kmh'] > peak_wind_val:\n                    peak_wind_val = p['speed_kmh']\n                    peak_wind_hour = p['hour']\n            if peak_wind_hour is not None:\n                description += f\" Le raffiche più intense sono attese {get_relative_time_description(peak_wind_hour, current_dt)}.\"\n            \n            if bollettino_present:\n                description += f\" In accordo con l'allerta {int_to_severity(alert_severity_wind)} della Protezione Civile Campania ({bollettino_validita}).\"\n            candidate_alerts.append({\"type\": \"Vento Forte\", \"description\": description, \"severity\": int_to_severity(alert_severity_wind)})\n\n        # Sea / Maritime Connections alert\n        if sea_forecast_severity > 0 or maritime_connection_impact:\n            alert_severity_sea = max(sea_forecast_severity, base_severity_int)\n            if maritime_connection_impact: # If maritime rule triggered, ensure at least GIALLO\n                alert_severity_sea = max(alert_severity_sea, severity_to_int(\"GIALLO\"))\n                \n            description = f\"Mare {sea_condition.lower()} con onde fino a ({wave_height_m}m).\"\n            if wave_height_m > 2.0 or current_wind_speed_kmh > 40:\n                description += \" Possibili disagi e ritardi per i collegamenti marittimi (traghetti e aliscafi). Si consiglia di verificare gli orari con le compagnie di navigazione.\"\n            if alert_severity_sea >= severity_to_int(\"ARANCIONE\"):\n                description += \" Si sconsiglia la navigazione per piccole imbarcazioni e attività nautiche.\"\n            \n            if bollettino_present:\n                description += f\" In accordo con l'allerta {int_to_severity(alert_severity_sea)} della Protezione Civile Campania ({bollettino_validita}).\"\n            candidate_alerts.append({\"type\": \"Mare Molto Mosso\", \"description\": description, \"severity\": int_to_severity(alert_severity_sea)})\n\n        # Consolidate candidate_alerts into final_alerts, ensuring distinct types and correct severity\n        added_types = set()\n        for alert in candidate_alerts:\n            # Add if not already added, or if this one has higher severity for the same type\n            if alert['type'] not in added_types or \\\n               severity_to_int(alert['severity']) > severity_to_int(next((a for a in final_alerts if a['type'] == alert['type']), {'severity': 'VERDE'})['severity']):\n                \n                if alert['type'] in added_types: # Replace existing if higher severity\n                    final_alerts = [a for a in final_alerts if a['type'] != alert['type']]\n                final_alerts.append(alert)\n                added_types.add(alert['type'])\n        \n        # Final adjustment: Ensure at least one alert reaches max_calculated_severity_int (if > VERDE)\n        if max_calculated_severity_int > severity_to_int(\"VERDE\"):\n            highest_alert_severity_in_list = 0\n            if final_alerts:\n                highest_alert_severity_in_list = max(severity_to_int(a['severity']) for a in final_alerts)\n\n            if highest_alert_severity_in_list < max_calculated_severity_int:\n                if not final_alerts: # If no specific alerts were generated but max_calculated_severity_int is high\n                    general_alert_type = \"Attenzione Meteo\"\n                    general_alert_desc = f\"Persistono condizioni di attenzione meteo. Si raccomanda prudenza. \"\n                    if max_calculated_severity_int == severity_to_int(\"GIALLO\"):\n                        general_alert_type = \"Attenzione Meteo\"\n                        general_alert_desc += \"Condizioni meteo instabili con possibili fenomeni localizzati.\"\n                    elif max_calculated_severity_int == severity_to_int(\"ARANCIONE\"):\n                        general_alert_type = \"Allerta Moderata\"\n                        general_alert_desc += \"Condizioni di criticità moderata, con fenomeni intensi e possibili disagi.\"\n                    elif max_calculated_severity_int == severity_to_int(\"ROSSO\"):\n                        general_alert_type = \"Allerta Elevata\"\n                        general_alert_desc += \"Condizioni di criticità elevata, con pericoli concreti per persone e infrastrutture. Massima prudenza.\"\n\n                    if bollettino_present:\n                        general_alert_desc += f\" In accordo con l'allerta {int_to_severity(max_calculated_severity_int)} della Protezione Civile Campania ({bollettino_validita}).\"\n                    \n                    final_alerts.append({\n                        \"type\": general_alert_type,\n                        \"description\": general_alert_desc,\n                        \"severity\": int_to_severity(max_calculated_severity_int)\n                    })\n                else:\n                    # Boost the most severe existing alert's severity up to max_calculated_severity_int\n                    most_severe_alert = max(final_alerts, key=lambda x: severity_to_int(x['severity']))\n                    most_severe_alert['severity'] = int_to_severity(max_calculated_severity_int)\n                    if bollettino_present:\n                        # Update description to reflect current bollettino level if it's the official alert\n                        most_severe_alert['description'] = most_severe_alert['description'].split(\"In accordo\")[0].strip() + f\". In accordo con l'allerta {most_severe_alert['severity']} della Protezione Civile Campania ({bollettino_validita}).\"\n\n    # --- 7. Generate Summary ---\n    summary_parts = []\n    \n    current_time_display = current_dt.strftime(\"%H:%M\")\n    \n    # Morning (current_time to ~12:00)\n    if current_hour < 12:\n        morning_wind_speed = current_wind_speed_kmh\n        morning_wind_desc = get_beaufort_desc(morning_wind_speed)\n        morning_temp = feels_like_day\n        summary_parts.append(f\"Mattinata (da {current_time_display}) serena con temperature gradevoli (circa {morning_temp}°C) e venti da {current_wind_direction.lower()} ({morning_wind_desc}, {morning_wind_speed} km/h).\")\n\n    # Afternoon (12:00-18:00)\n    afternoon_wind_periods = [p['speed_kmh'] for p in wind_periods if p['hour'] >= max(current_hour, 12) and p['hour'] < 18]\n    if afternoon_wind_periods:\n        max_afternoon_wind = max(afternoon_wind_periods)\n        summary_parts.append(f\"Il pomeriggio proseguirà con cieli sereni e venti in lieve calo ({get_beaufort_desc(max_afternoon_wind)}, max {max_afternoon_wind} km/h).\")\n    elif current_hour >=12 and current_hour < 18:\n        summary_parts.append(f\"Il pomeriggio si manterrà sereno con venti {get_beaufort_desc(current_wind_speed_kmh)} ({current_wind_speed_kmh} km/h).\")\n\n    # Evening/Night (18:00-24:00)\n    evening_wind_periods = [p['speed_kmh'] for p in wind_periods if p['hour'] >= max(current_hour, 18) and p['hour'] < 24]\n    if evening_wind_periods:\n        min_evening_wind = min(evening_wind_periods)\n        summary_parts.append(f\"La serata sarà fresca (minima {temp_min}°C) con venti deboli ({get_beaufort_desc(min_evening_wind)}, {min_evening_wind} km/h).\")\n    elif current_hour >= 18:\n        summary_parts.append(f\"La serata sarà fresca (minima {temp_min}°C) con venti deboli.\")\n\n    # General info\n    rain_info_str = \"\"\n    if rain_incoming_summary:\n        rain_info_str = f\"{rain_incoming_summary}. \"\n    elif rain_total_mm > 0:\n        rain_info_str = f\"Possibili deboli piogge localizzate ({rain_total_mm}mm). \"\n    else:\n        rain_info_str = f\"Nessuna pioggia significativa prevista. \"\n    \n    summary_general_info = f\"{rain_info_str}Mare {sea_condition.lower()} (onde {wave_height_m}m). Temperature giornaliere comprese tra ({temp_min} e {temp_max}°C).\"\n    summary_final = \" \".join(summary_parts) + \" \" + summary_general_info\n\n    # Trim to 250 characters if necessary\n    if len(summary_final) > 250:\n        summary_final = summary_final[:247].strip() + \"...\"\n    \n    # --- 8. Generate Advice ---\n    advice_list = []\n\n    # Abbigliamento e attività outdoor\n    current_temp_for_advice = feels_like_day\n    advice_list.append(f\"Temperature miti ({current_temp_for_advice}°C): abbigliamento leggero sufficiente. Porta una felpa per la sera, quando le temperature scenderanno fino a ({temp_min}°C).\")\n\n    # Collegamenti Marittimi\n    maritime_status = \"\"\n    if wave_height_m > 2.0 or current_wind_speed_kmh > 40:\n        maritime_factors = []\n        if wave_height_m > 2.0:\n            maritime_factors.append(f\"mare mosso (onde {wave_height_m}m)\")\n        if current_wind_speed_kmh > 40:\n            maritime_factors.append(f\"vento forte ({current_wind_speed_kmh} km/h)\")\n        maritime_status = f\"Collegamenti marittimi: possibili ritardi/disagi per traghetti e aliscafi a causa di {', '.join(maritime_factors)}. Verificare orari aggiornati con compagnie (Caremar, Medmar, SNAV).\"\n    else:\n        maritime_status = \"Collegamenti marittimi: condizioni favorevoli per traghetti e aliscafi. Servizio regolare previsto.\"\n    advice_list.append(maritime_status)\n\n    # Sicurezza locale / attività nautiche\n    uv_advice = \"\"\n    if uv_index >= 6:\n        uv_advice = f\"Indice UV alto ({uv_index}): si raccomanda protezione solare e cappello nelle ore centrali.\"\n    elif uv_index >= 3:\n        uv_advice = f\"Indice UV moderato ({uv_index}): proteggi la pelle, specialmente nelle ore più calde.\"\n    else:\n        uv_advice = \"Indice UV basso.\"\n\n    sea_temp_advice = f\"Temperatura del mare gradevole ({sea_temperature_c}°C), ideale per la balneazione e attività nautiche leggere.\"\n    if sea_temperature_c < 18:\n        sea_temp_advice = f\"Temperatura del mare fresca ({sea_temperature_c}°C), considerare l'uso di una muta per la balneazione prolungata.\"\n\n    advice_list.append(f\"{uv_advice} {sea_temp_advice}\")\n\n    # --- 9. Final JSON Output ---\n    output = {\n        \"summary\": summary_final,\n        \"advice\": advice_list,\n        \"alerts\": final_alerts\n    }\n\n    return json.dumps(output, indent=2, ensure_ascii=False)\n```",
  advice: [],
  alerts: [],
  timestamp: "2025-11-07T14:05:59.592Z"
};
</script>
</body>
</html>
